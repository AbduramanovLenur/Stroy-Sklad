import{u as X,a as Y,x as Z,y as L,b as ee,c as te,r as O,z as se,d as I,e as oe,k as N,h as t,A as B,i as r,t as ne,m as i,o as l,s as M,H as d}from"./index-H_0aiVi0.js";import{a as ae,u as ce}from"./generic.services-JTKdN61J.js";import{u as ue}from"./useQuery-EMBcCh_r.js";import{g as re,d as ie}from"./crud.services--PpE2J7D.js";import{r as le}from"./index-YpiLZt2A.js";const de={key:0,class:"products"},me={class:"products__inner section-padding"},pe={key:2,class:"empty-table shadowed"},Ce={__name:"index",async setup(_e){let a,h;const m=ae(),Q=X(),{t:H}=Y(),K=Z(),{page:p,limit:_,search:x}=L(K),z=ee(),{user:s}=L(z),T=te(()=>{var e,o;return!!((o=(e=s==null?void 0:s.value.user)==null?void 0:e.modules)!=null&&o.includes(d.PRODUCT.READ))}),S=O(""),D=le(x,500),V=O([{id:1,label:"productsName",width:70}]),{data:c,isLoading:F,isSuccess:y,isError:W}=([a,h]=se(()=>ue({queryKey:["products",{page:p,limit:_,debouncedSearch:D,organizationId:s.value.user.organizationId}],queryFn:()=>re("construction_material",p.value,_.value,D.value),select:e=>{let o=[...e==null?void 0:e.constructionMaterial];return o=o.map(u=>{const n={...u,material:u.fullName};return delete n.fullName,delete n.quantityType,n}),{constructionMaterial:o,count:e==null?void 0:e.count}},enabled:T})),a=await a,h(),a),{mutate:$}=ce({mutationFn:e=>ie("construction_material",e),onSuccess:e=>{e!=null&&e.success&&(m.invalidateQueries({queryKey:["products"]}),m.invalidateQueries({queryKey:["productById",S]}),m.invalidateQueries({queryKey:["materialsList"]}),setTimeout(()=>Q.success(H("deleteToast")),150))}}),j=async e=>{S.value=e,$(e)};return(e,o)=>{var C,f,g,v,P,b,E,w,U,R,k,A,q;const u=i("HeadPage"),n=i("Table"),G=i("Pagination"),J=i("Spinner");return T.value?(l(),I("section",de,[oe("div",me,[N(u,{title:"productsTitle",to:t(M).CREATE_PRODUCT.path,isShowCreate:(g=(f=(C=t(s))==null?void 0:C.user)==null?void 0:f.modules)==null?void 0:g.includes(t(d).PRODUCT.CREATE)},null,8,["to","isShowCreate"]),t(y)&&((v=t(c))!=null&&v.count)?(l(),B(n,{key:0,headers:V.value,table:(P=t(c))==null?void 0:P.constructionMaterial,to:t(M).UPDATE_PRODUCT.name,options:{page:t(p),limit:t(_)},isShowUpdate:(w=(E=(b=t(s))==null?void 0:b.user)==null?void 0:E.modules)==null?void 0:w.includes(t(d).PRODUCT.UPDATE),isShowDelete:(k=(R=(U=t(s))==null?void 0:U.user)==null?void 0:R.modules)==null?void 0:k.includes(t(d).PRODUCT.DELETE),onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):r("",!0),N(G,{count:(A=t(c))==null?void 0:A.count,isSucces:t(y)},null,8,["count","isSucces"]),t(F)?(l(),B(J,{key:1})):r("",!0),t(y)&&!((q=t(c))!=null&&q.count)||t(W)?(l(),I("div",pe,ne(e.$t("emptyTableTitle")),1)):r("",!0)])])):r("",!0)}}};export{Ce as default};
