import{u as me,a as ce,b as de,y as pe,c as z,r as h,z as g,B as ie,d as _,e as G,k as T,h as r,w as ye,F as x,C as he,D as I,i as v,l as ge,G as _e,m as c,o as n,s as b,A as D,f as N,t as S,H as Ie,E as ve}from"./index-qYaOSAk5.js";import{u as be,r as l}from"./i18n-validators-FA-njMbI.js";import{a as Ne,u as Se}from"./generic.services-uSp9rJcx.js";import{u as w}from"./useQuery-3KlBkAoQ.js";import{a as we,u as $e}from"./crud.services-6H1cbtzh.js";import{e as Re,b as Ke}from"./manual.services-e5QN_9-o.js";const Le={key:0,class:"manage section-height shadowed"},Ee={class:"manage__inner section-padding"},ke={__name:"update",async setup(Ue){let s,u;const $=Ne(),R=ge(),H=_e(),O=me(),{t:Q}=ce(),A=de(),{user:d}=pe(A),m=z(()=>{var o,i;return!!((i=(o=d==null?void 0:d.value.user)==null?void 0:o.modules)!=null&&i.includes(Ie.ORG_USER.UPDATE))}),p=h(H.params.id),a=h({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:"",roleId:[],stateId:[]}),W=z(()=>({id:{required:l},fullName:{required:l},userName:{required:l},phoneNumber:{required:l},organizationId:{required:l},roleId:{required:l},stateId:{required:l}})),t=be(W,a),{data:j,isSuccess:J,isLoading:X}=([s,u]=g(()=>w({queryKey:["rolesList",{organizationId:a.value.organizationId}],queryFn:()=>Re(),enabled:m})),s=await s,u(),s),{data:Y,isSuccess:Z,isLoading:f}=([s,u]=g(()=>w({queryKey:["states"],queryFn:()=>Ke(),enabled:m})),s=await s,u(),s),ee=h([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:j,success:J,loading:X,select:!0},{id:6,model:"stateId",label:"employeesStateLabel",placeholder:"employeesStatePlaceholder",errorKey:"stateId",options:Y,success:Z,loading:f,select:!0}]),{isError:oe}=([s,u]=g(()=>w({queryKey:["orgUserById",p],queryFn:()=>we("user",p.value),select:o=>{a.value.id=o.id,a.value.fullName=o.fullName,a.value.userName=o.userName,a.value.phoneNumber=o.phoneNumber,a.value.organizationId=o.organizationId,a.value.roleId=[o.roleId],a.value.stateId=[o.stateId]},enabled:m})),s=await s,u(),s);ie(oe,o=>{o&&R.push(b.ORG_USER.path)});const{mutate:ae,status:se}=Se({onMutate:o=>{o.roleId=o.roleId[0],o.stateId=o.stateId[0]},mutationFn:o=>$e("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=ve(a.value),$.invalidateQueries({queryKey:["orgUsers"]}),$.invalidateQueries({queryKey:["orgUserById",p]}),R.push(b.ORG_USER.path),setTimeout(()=>O.success(Q("updateToast")),150))}}),te=async()=>{if(t.value.$validate(),t.value.$errors.length)return;const o={...a.value};ae(o),t.value.$reset()};return(o,i)=>{var K,L;const re=c("ManageHead"),le=c("FormInput"),ue=c("FormSelect"),ne=c("CustomButton");return m.value?(n(),_("section",Le,[G("div",Ee,[T(re,{title:"editEmployeesTitle",to:r(b).ORG_USER.path},null,8,["to"]),G("form",{class:"manage__form form-manage",onSubmit:ye(te,["prevent"])},[(n(!0),_(x,null,he(ee.value,e=>{var E,U,V,F,B,P,q,C,k,M;return n(),_(x,{key:e.id},[e!=null&&e.select?v("",!0):(n(),D(le,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":y=>a.value[e.model]=y,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(U=(E=r(t))==null?void 0:E[e==null?void 0:e.errorKey])==null?void 0:U.$error,type:e==null?void 0:e.type,textError:(B=(F=(V=r(t))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:F.$errors[0])==null?void 0:B.$message},{default:I(()=>[N(S(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),e!=null&&e.select?(n(),D(ue,{key:1,modelValue:a.value[e.model],"onUpdate:modelValue":y=>a.value[e.model]=y,modelModifiers:{trim:!0},width:500,options:e.options,error:(q=(P=r(t))==null?void 0:P[e==null?void 0:e.errorKey])==null?void 0:q.$error,placeholder:e==null?void 0:e.placeholder,textError:(M=(k=(C=r(t))==null?void 0:C[e==null?void 0:e.errorKey])==null?void 0:k.$errors[0])==null?void 0:M.$message,success:e.success,loading:e.loading},{default:I(()=>[N(S(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):v("",!0)],64)}),128)),T(ne,{className:`form__submit ${(L=(K=r(t))==null?void 0:K.stateId.$errors[0])!=null&&L.$message?"centered":""}`,disabled:r(se)==="pending"},{default:I(()=>[N(S(o.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):v("",!0)}}};export{ke as default};
