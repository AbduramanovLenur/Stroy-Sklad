import{u as le,a as ue,b as ne,y as de,c as F,r as _,z as b,B as me,d as I,e as C,k as ie,h as s,w as ce,F as T,C as U,A as y,i as v,D as V,l as pe,G as he,m as n,o as l,s as R,f as K,t as w,H as ye,E as fe}from"./index-_XMrp3Vl.js";import{u as _e,r as g}from"./i18n-validators-8-I6ziaJ.js";import{a as ve,u as ge}from"./generic.services-t_drLwo6.js";import{u as E}from"./useQuery-aI4x6Qnk.js";import{a as Ne,u as Me}from"./crud.services-6WaoEN5X.js";import{c as Se,b as $e}from"./manual.services-m5fLkJn9.js";const be={key:0,class:"manage section-height shadowed"},Ie={class:"manage__inner section-padding"},Be={__name:"update",async setup(Ve){let t,u;const N=ve(),L=pe(),x=he(),A=le(),{t:H}=ue(),Q=ne(),{user:M}=de(Q),f=F(()=>{var o,d;return!!((d=(o=M==null?void 0:M.value.user)==null?void 0:o.modules)!=null&&d.includes(ye.ROLE.UPDATE))}),S=_(x.params.id),a=_({id:"",shortName:"",fullName:"",roleModules:[],stateId:[]}),D=F(()=>({id:{required:g},shortName:{required:g},fullName:{required:g},stateId:{required:g}})),r=_e(D,a),{data:O,isLoading:P,isSuccess:q}=([t,u]=b(()=>E({queryKey:["modules"],queryFn:()=>Se(),enabled:f})),t=await t,u(),t),{data:G,isSuccess:z,isLoading:W}=([t,u]=b(()=>E({queryKey:["states"],queryFn:()=>$e(),enabled:f})),t=await t,u(),t),j=_([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"}]),J=_([{id:1,model:"stateId",label:"stateRoleLabel",placeholder:"stateRolePlaceholder",errorKey:"stateId",options:G,success:z,loading:W}]),{isError:X}=([t,u]=b(()=>E({queryKey:["rolesById",S],queryFn:()=>Ne("Role",S.value),select:o=>{a.value.id=o.id,a.value.shortName=o.shortName,a.value.fullName=o.fullName,a.value.roleModules=[...o.roleModules],a.value.stateId=[o.stateId]},enabled:f})),t=await t,u(),t);me(X,o=>{o&&L.push(R.HOME.path)});const{mutate:Y}=ge({onMutate:o=>{o.stateId=o.stateId[0]},mutationFn:o=>Me("Role",o),onSuccess:o=>{o!=null&&o.success&&(a.value=fe(a.value),N.invalidateQueries({queryKey:["roles"]}),N.invalidateQueries({queryKey:["rolesById",S]}),N.invalidateQueries({queryKey:["rolesList"]}),L.push(R.ROLE.path),setTimeout(()=>A.success(H("updateToast")),150))}}),Z=()=>{if(r.value.$validate(),r.value.$errors.length)return;const o={...a.value};Y(o),r.value.$reset()};return(o,d)=>{var B,k;const ee=n("ManageHead"),oe=n("FormInput"),ae=n("FormSelect"),te=n("ActionsModules"),se=n("CustomButton"),re=n("Spinner");return f.value?(l(),I("section",be,[C("div",Ie,[ie(ee,{title:"editRolesTitle",to:s(R).ROLE.path},null,8,["to"]),C("form",{class:"manage__form form-manage",onSubmit:ce(Z,["prevent"])},[(l(!0),I(T,null,U(j.value,e=>{var m,i,c,p,h;return l(),y(oe,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":$=>a.value[e.model]=$,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(i=(m=s(r))==null?void 0:m[e.errorKey])==null?void 0:i.$error,textError:(h=(p=(c=s(r))==null?void 0:c[e.errorKey])==null?void 0:p.$errors[0])==null?void 0:h.$message},{default:V(()=>[K(w(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(l(!0),I(T,null,U(J.value,e=>{var m,i,c,p,h;return l(),y(ae,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":$=>a.value[e.model]=$,modelModifiers:{trim:!0},width:500,options:e.options,error:(i=(m=s(r))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:i.$error,placeholder:e==null?void 0:e.placeholder,textError:(h=(p=(c=s(r))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:h.$message,success:e.success,loading:e.loading},{default:V(()=>[K(w(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),s(q)?(l(),y(te,{key:0,modelValue:a.value.roleModules,"onUpdate:modelValue":d[0]||(d[0]=e=>a.value.roleModules=e),actions:s(O)},null,8,["modelValue","actions"])):v("",!0),s(q)?(l(),y(se,{key:1,className:`form__submit manage__submit ${(k=(B=s(r))==null?void 0:B.fullName.$errors[0])!=null&&k.$message?"centered":""}`},{default:V(()=>[K(w(o.$t("formButton")),1)]),_:1},8,["className"])):v("",!0)],32),s(P)?(l(),y(re,{key:0})):v("",!0)])])):v("",!0)}}};export{Be as default};
