import{u as ae,a as se,b as te,y as oe,c as K,r as p,z as q,B as re,d as I,e as C,k as F,h as r,w as le,F as M,C as k,D as S,i as ne,l as ue,G as de,m as f,o as i,s as $,A as T,f as N,t as x,H as me,E as ie}from"./index-_XMrp3Vl.js";import{u as ce,r as V}from"./i18n-validators-8-I6ziaJ.js";import{a as pe,u as fe}from"./generic.services-t_drLwo6.js";import{u as L}from"./useQuery-aI4x6Qnk.js";import{a as ye,u as he}from"./crud.services-6WaoEN5X.js";import{b as _e}from"./manual.services-m5fLkJn9.js";const ve={key:0,class:"manage section-height shadowed"},ge={class:"manage__inner section-padding"},be={__name:"update",async setup(Ee){let t,c;const y=pe(),b=ue(),P=de(),U=ae(),{t:H}=se(),Q=te(),{user:h}=oe(Q),_=K(()=>{var a,g;return!!((g=(a=h==null?void 0:h.value.user)==null?void 0:a.modules)!=null&&g.includes(me.EXPENS.UPDATE))}),v=p(P.params.id),s=p({id:"",fullName:"",stateId:[]}),D=K(()=>({id:{required:V},fullName:{required:V},stateId:{required:V}})),o=ce(D,s),{data:A,isSuccess:R,isLoading:X}=([t,c]=q(()=>L({queryKey:["states"],queryFn:()=>_e(),enabled:_})),t=await t,c(),t),G=p([{id:1,model:"fullName",label:"nameExpensesLabel",placeholder:"nameExpensesPlaceholder",icon:"input-company",errorKey:"fullName"}]),z=p([{id:1,model:"stateId",label:"stateExpensesLabel",placeholder:"stateExpensesPlaceholder",errorKey:"stateId",options:A,success:R,loading:X}]),{isError:O}=([t,c]=q(()=>L({queryKey:["expensesById",v],queryFn:()=>ye("cost",v.value),select:a=>{s.value.id=a.id,s.value.fullName=a.fullname,s.value.stateId=[a.stateId]},enabled:_})),t=await t,c(),t);re(O,a=>{a&&b.push($.HOME.path)});const{mutate:W}=fe({onMutate:a=>{a.stateId=a.stateId[0]},mutationFn:a=>he("cost",a),onSuccess:a=>{a!=null&&a.success&&(s.value=ie(s.value),y.invalidateQueries({queryKey:["expenses"]}),y.invalidateQueries({queryKey:["expensesById",v]}),y.invalidateQueries({queryKey:["costsList"]}),b.push($.EXPENS.path),setTimeout(()=>U.success(H("updateToast")),150))}}),j=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const a={...s.value};W(a),o.value.$reset()};return(a,g)=>{var w,B;const J=f("ManageHead"),Y=f("FormInput"),Z=f("FormSelect"),ee=f("CustomButton");return _.value?(i(),I("section",ve,[C("div",ge,[F(J,{title:"editExpensesTitle",to:r($).EXPENS.path},null,8,["to"]),C("form",{class:"manage__form form-manage",onSubmit:le(j,["prevent"])},[(i(!0),I(M,null,k(G.value,e=>{var l,n,u,d,m;return i(),T(Y,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":E=>s.value[e.model]=E,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(n=(l=r(o))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:n.$error,textError:(m=(d=(u=r(o))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:d.$errors[0])==null?void 0:m.$message},{default:S(()=>[N(x(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(i(!0),I(M,null,k(z.value,e=>{var l,n,u,d,m;return i(),T(Z,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":E=>s.value[e.model]=E,modelModifiers:{trim:!0},width:500,options:e.options,error:(n=(l=r(o))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(d=(u=r(o))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:d.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:S(()=>[N(x(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),F(ee,{className:`form__submit ${(B=(w=r(o))==null?void 0:w.stateId.$errors[0])!=null&&B.$message?"centered":""}`},{default:S(()=>[N(x(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ne("",!0)}}};export{be as default};
