{"version":3,"file":"objects-5zg1FS4D.js","sources":["../../src/views/objects.vue"],"sourcesContent":["<template>\r\n    <section class=\"object\">\r\n        <div class=\"object__inner section-padding\">\r\n            <HeadPage \r\n                title=\"objectTitle\" \r\n                @onSearch=\"($event) => objectsForm.search = $event\"\r\n                @onOpenFormModal=\"() => objectHandler('create')\"\r\n            />\r\n            <Table \r\n                v-if=\"isSuccessObjects && objects.length\"\r\n                :headers=\"headers\" \r\n                :table=\"objects\" \r\n                @onActionEdit=\"($event) => objectHandler('edit', $event)\"\r\n                @onActionDelete=\"deleteObjectHandler\"\r\n            />\r\n            <Spinner \r\n                v-if=\"isLoadingObjects\" \r\n            />\r\n            <div \r\n                v-if=\"(isSuccessObjects && !objects.length) || isError\" \r\n                class=\"empty-table\"\r\n            >\r\n                {{ $t(\"emptyTableTitle\") }}\r\n            </div>\r\n        </div>\r\n        <FormModal :title=\"titleModal\">\r\n            <form class=\"object__form\" @submit.prevent=\"submitFormHandler\">\r\n                <FormInput \r\n                    v-for=\"input in inputs\"\r\n                    :key=\"input.id\"\r\n                    v-model=\"objectsForm[input.model]\"\r\n                    :width=\"500\" \r\n                    :placeholder=\"$t(input.placeholder)\"\r\n                    :name=\"input.icon\"\r\n                    :error=\"v$?.[input.errorKey].$error\" \r\n                    :textError=\"v$?.[input.errorKey].$errors[0]?.$message\"\r\n                >\r\n                    {{ $t(input.label) }}\r\n                </FormInput>\r\n                <FormSelect \r\n                    v-for=\"select in selects\"\r\n                    :key=\"select.id\"\r\n                    v-model=\"objectsForm[select.model]\" \r\n                    :width=\"500\" \r\n                    :options=\"select.options\"\r\n                    :error=\"v$?.[select?.errorKey]?.$error\" \r\n                    :textError=\"v$?.[select?.errorKey]?.$errors[0]?.$message\"\r\n                    :success=\"select.success\"\r\n                    :loading=\"select.loading\"\r\n                    :show=\"select?.show\"\r\n                    :requestFlag=\"requestFlag\"\r\n                >\r\n                    {{ $t(select.label) }}\r\n                </FormSelect>\r\n                <CustomButton \r\n                    :className=\"`form__submit ${v$?.districtId.$errors[0]?.$message ? 'centered' : ''}`\"\r\n                >\r\n                    {{ $t(\"formButton\") }}\r\n                </CustomButton>\r\n            </form>\r\n        </FormModal>\r\n    </section>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from \"vue\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { useVuelidate } from \"@vuelidate/core\";\r\nimport { required } from \"@/utils/i18n-validators.js\";\r\nimport { \r\n    useQueryClient, \r\n    useQuery, \r\n    useMutation \r\n} from \"@tanstack/vue-query\";\r\nimport { useModalsStore } from \"@/store/modalsStore.js\";\r\nimport { \r\n    getList, \r\n    getWithId, \r\n    create, \r\n    updateById, \r\n    deleteWithId \r\n} from \"@/services/crud.services.js\";\r\nimport {\r\n    manualGetRegions,\r\n    manualGetDistricts,\r\n    manualGetStates\r\n} from \"@/services/manual.services.js\";\r\nimport { clearForm } from \"@/utils/secondary-functions.js\";\r\n\r\n\r\nconst queryClient = useQueryClient();\r\n\r\nconst modalsStore = useModalsStore();\r\nconst { toggleIsOpenModalForm } = modalsStore;\r\nconst { isOpenModalForm } = storeToRefs(modalsStore);\r\n\r\nconst titleModal = ref(\"addNewObjectTitle\");\r\nconst requestFlag = ref(\"\");\r\nconst requestId = ref(0);\r\n\r\nconst isEnabled = computed(() => isOpenModalForm);\r\nconst isEdit = computed(() => isOpenModalForm && requestFlag.value === 'edit');\r\n\r\nconst {\r\n    data: regions,\r\n    isSuccess: isSuccessRegions,\r\n    isLoading: isLoadingRegions\r\n} = await useQuery({\r\n    queryKey: [\"regions\"],\r\n    queryFn: () => manualGetRegions(),\r\n    enabled: isEnabled\r\n});\r\n\r\nconst {\r\n    data: districts,\r\n    isSuccess: isSuccessDistricts,\r\n    isLoading: isLoadingDistricts\r\n} = await useQuery({\r\n    queryKey: [\"districts\"],\r\n    queryFn: () => manualGetDistricts(),\r\n    enabled: isEnabled\r\n});\r\n\r\nconst {\r\n    data: states,\r\n    isSuccess: isSuccessStates,\r\n    isLoading: isLoadingStates\r\n} = await useQuery({\r\n    queryKey: [\"states\"],\r\n    queryFn: () => manualGetStates(),\r\n    enabled: isEdit\r\n});\r\n\r\nconst objectsForm = ref({\r\n    id: \"\",\r\n    name: \"\",\r\n    organizationId: \"\",\r\n    regionId: \"\",\r\n    districtId: \"\",\r\n    address: \"\",\r\n    stateId: \"\",\r\n    search: \"\"\r\n});\r\n\r\nconst rules = computed(() => ({\r\n    name: { required },\r\n    organizationId: { required },\r\n    regionId: { required },\r\n    districtId: { required },\r\n    address: { required },\r\n}));\r\n\r\nconst headers = ref([\r\n    { id: 1, label: \"objectName\" },\r\n    { id: 2, label: \"objectOrganization\" },\r\n    { id: 3, label: \"objectAddress\" },\r\n    { id: 4, label: \"objectState\" },\r\n    { id: 5, label: \"objectAction\" }\r\n]);\r\n\r\nconst inputs = ref([\r\n    { \r\n        id: 1, \r\n        model: \"name\", \r\n        label: \"nameObjectLabel\", \r\n        placeholder: \"nameObjectPlaceholder\", \r\n        icon: \"input-company\",\r\n        errorKey: \"name\",\r\n    },\r\n    { \r\n        id: 2, \r\n        model: \"address\", \r\n        label: \"addressObjectLabel\", \r\n        placeholder: \"addressObjectPlaceholder\", \r\n        icon: \"address\",\r\n        errorKey: \"address\",\r\n    },\r\n]);\r\n\r\nconst selects = ref([\r\n    { \r\n        id: 1, \r\n        model: \"regionId\", \r\n        label: \"regionObjectLabel\", \r\n        options: regions,\r\n        errorKey: \"regionId\",\r\n        success: isSuccessRegions,\r\n        loading: isLoadingRegions,\r\n        show: [\"create\", \"edit\"]\r\n    },\r\n    { \r\n        id: 2, \r\n        model: \"districtId\", \r\n        label: \"districtObjectLabel\", \r\n        options: districts,\r\n        errorKey: \"districtId\",\r\n        success: isSuccessDistricts,\r\n        loading: isLoadingDistricts,\r\n        show: [\"create\", \"edit\"]\r\n    },\r\n    { \r\n        id: 3, \r\n        model: \"stateId\", \r\n        label: \"stateObjectLabel\", \r\n        options: states,\r\n        success: isSuccessStates,\r\n        loading: isLoadingStates,\r\n        show: \"update\",\r\n        show: [\"edit\"]\r\n    }\r\n]);\r\n\r\nconst v$ = useVuelidate(rules, objectsForm);\r\n\r\nconst {\r\n    data: objects,\r\n    isLoading: isLoadingObjects,\r\n    isSuccess: isSuccessObjects,\r\n    isError\r\n} = await useQuery({\r\n    queryKey: [\"objects\"],\r\n    queryFn: () => getList(\"building_object\")\r\n});\r\n\r\nconst {} = await useQuery({\r\n    queryKey: [\"objectById\", requestId],\r\n    queryFn: () => getWithId(\"building_object\", requestId.value),\r\n    select: (data) => {\r\n        objectsForm.value.id = data.id;\r\n        objectsForm.value.name = data.fullname;\r\n        objectsForm.value.organizationId = data.organizationId;\r\n        objectsForm.value.regionId = data.regionId;\r\n        objectsForm.value.districtId = data.districtId;\r\n        objectsForm.value.address = data.address;\r\n        objectsForm.value.stateId = data.stateId;\r\n    },\r\n    enabled: isEdit\r\n});\r\n\r\nconst { mutate: createMutate } = useMutation({\r\n    mutationFn: (body) => create(\"building_object\", body),\r\n    onSuccess: () => {\r\n        queryClient.invalidateQueries({ queryKey: [\"objects\"] });\r\n    }\r\n});\r\n\r\nconst { mutate: updateMutate } = useMutation({\r\n    mutationFn: (body) => updateById(\"building_object\", body),\r\n    onSuccess: () => {\r\n        queryClient.invalidateQueries({ queryKey: [\"objects\"] });\r\n        queryClient.invalidateQueries({ queryKey: [\"objectById\", requestId] });\r\n    }\r\n});\r\n\r\nconst { mutate: mutateDelete } = useMutation({\r\n    mutationFn: (idx) => deleteWithId(\"building_object\", idx),\r\n    onSuccess: () => {\r\n        queryClient.invalidateQueries({ queryKey: [\"objects\"] });\r\n        queryClient.invalidateQueries({ queryKey: [\"objectById\", requestId] });\r\n    }\r\n});\r\n\r\nconst isOpenFormModal = (title, flag) => {\r\n    titleModal.value = title;\r\n    requestFlag.value = flag;\r\n    toggleIsOpenModalForm();\r\n\r\n    if (requestFlag.value === \"create\" && isOpenModalForm.value) {\r\n        objectsForm.value = clearForm(objectsForm.value);\r\n        v$.value.$reset();\r\n    }\r\n}\r\n\r\nconst objectHandler = (flag, idx) => {\r\n    if (flag === \"edit\" && idx) {\r\n        requestId.value = idx;\r\n        isOpenFormModal(\"editObjectTitle\", \"edit\");\r\n        return;\r\n    }\r\n\r\n    isOpenFormModal(\"addNewObjectTitle\", \"create\");\r\n}\r\n\r\nconst deleteObjectHandler = async (idx) => {\r\n    mutateDelete(idx);\r\n}\r\n\r\nconst submitFormHandler = async () => {\r\n\r\n    // const organizationId = localStorage.getItem(\"organizationId\");\r\n    const organizationId = 1;\r\n    objectsForm.value.organizationId = organizationId;\r\n\r\n    v$.value.$validate();\r\n\r\n    if (v$.value.$errors.length) {\r\n        return;\r\n    }\r\n\r\n    if (requestFlag.value === \"create\") {\r\n        delete objectsForm.value.id;\r\n        delete objectsForm.value.stateId;\r\n        delete objectsForm.value.search;\r\n\r\n        createMutate(objectsForm.value);\r\n    } else {\r\n        updateMutate(objectsForm.value);\r\n    }\r\n\r\n    objectsForm.value = clearForm(objectsForm.value);\r\n    toggleIsOpenModalForm();\r\n    v$.value.$reset();\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.object {\r\n    &__form {\r\n        display: grid;\r\n        grid-template-columns: repeat(2, 1fr);\r\n        gap: 20px;\r\n        @media (max-width: 1024px) {\r\n            gap: 10px;\r\n        }\r\n        @media (max-width: 768px) {\r\n            grid-template-columns: repeat(1, 1fr);\r\n            gap: 20px;\r\n        }\r\n    }\r\n}\r\n</style>"],"names":["queryClient","useQueryClient","modalsStore","useModalsStore","toggleIsOpenModalForm","isOpenModalForm","storeToRefs","titleModal","ref","requestFlag","requestId","isEnabled","computed","isEdit","regions","isSuccessRegions","isLoadingRegions","__temp","__restore","_withAsyncContext","useQuery","manualGetRegions","districts","isSuccessDistricts","isLoadingDistricts","manualGetDistricts","states","isSuccessStates","isLoadingStates","manualGetStates","objectsForm","rules","required","headers","inputs","selects","v$","useVuelidate","objects","isLoadingObjects","isSuccessObjects","isError","getList","getWithId","data","createMutate","useMutation","body","create","updateMutate","updateById","mutateDelete","idx","deleteWithId","isOpenFormModal","title","flag","clearForm","objectHandler","deleteObjectHandler","submitFormHandler"],"mappings":"qgBA0FA,MAAMA,EAAcC,GAAc,EAE5BC,EAAcC,GAAc,EAC5B,CAAE,sBAAAC,CAAuB,EAAGF,EAC5B,CAAE,gBAAAG,CAAiB,EAAGC,GAAYJ,CAAW,EAE7CK,EAAaC,EAAI,mBAAmB,EACpCC,EAAcD,EAAI,EAAE,EACpBE,EAAYF,EAAI,CAAC,EAEjBG,EAAYC,EAAS,IAAMP,CAAe,EAC1CQ,EAASD,EAAS,IAAMP,GAAmBI,EAAY,QAAU,MAAM,EAEvE,CACF,KAAMK,EACN,UAAWC,EACX,UAAWC,CACf,GAAU,CAAAC,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACf,SAAU,CAAC,SAAS,EACpB,QAAS,IAAMC,GAAkB,EACjC,QAASV,CACb,CAAC,CAAA,mBAEK,CACF,KAAMW,EACN,UAAWC,EACX,UAAWC,CACf,GAAU,CAAAP,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACf,SAAU,CAAC,WAAW,EACtB,QAAS,IAAMK,GAAoB,EACnC,QAASd,CACb,CAAC,CAAA,mBAEK,CACF,KAAMe,EACN,UAAWC,GACX,UAAWC,EACf,GAAU,CAAAX,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACf,SAAU,CAAC,QAAQ,EACnB,QAAS,IAAMS,GAAiB,EAChC,QAAShB,CACb,CAAC,CAAA,mBAEKiB,EAActB,EAAI,CACpB,GAAI,GACJ,KAAM,GACN,eAAgB,GAChB,SAAU,GACV,WAAY,GACZ,QAAS,GACT,QAAS,GACT,OAAQ,EACZ,CAAC,EAEKuB,GAAQnB,EAAS,KAAO,CAC1B,KAAM,CAAE,SAAAoB,CAAU,EAClB,eAAgB,CAAE,SAAAA,CAAU,EAC5B,SAAU,CAAE,SAAAA,CAAU,EACtB,WAAY,CAAE,SAAAA,CAAU,EACxB,QAAS,CAAE,SAAAA,CAAU,CACzB,EAAE,EAEIC,GAAUzB,EAAI,CAChB,CAAE,GAAI,EAAG,MAAO,YAAc,EAC9B,CAAE,GAAI,EAAG,MAAO,oBAAsB,EACtC,CAAE,GAAI,EAAG,MAAO,eAAiB,EACjC,CAAE,GAAI,EAAG,MAAO,aAAe,EAC/B,CAAE,GAAI,EAAG,MAAO,cAAgB,CACpC,CAAC,EAEK0B,GAAS1B,EAAI,CACf,CACI,GAAI,EACJ,MAAO,OACP,MAAO,kBACP,YAAa,wBACb,KAAM,gBACN,SAAU,MACb,EACD,CACI,GAAI,EACJ,MAAO,UACP,MAAO,qBACP,YAAa,2BACb,KAAM,UACN,SAAU,SACb,CACL,CAAC,EAEK2B,GAAU3B,EAAI,CAChB,CACI,GAAI,EACJ,MAAO,WACP,MAAO,oBACP,QAASM,EACT,SAAU,WACV,QAASC,EACT,QAASC,EACT,KAAM,CAAC,SAAU,MAAM,CAC1B,EACD,CACI,GAAI,EACJ,MAAO,aACP,MAAO,sBACP,QAASM,EACT,SAAU,aACV,QAASC,EACT,QAASC,EACT,KAAM,CAAC,SAAU,MAAM,CAC1B,EACD,CACI,GAAI,EACJ,MAAO,UACP,MAAO,mBACP,QAASE,EACT,QAASC,GACT,QAASC,GACT,KAAM,SACN,KAAM,CAAC,MAAM,CAChB,CACL,CAAC,EAEKQ,EAAKC,GAAaN,GAAOD,CAAW,EAEpC,CACF,KAAMQ,EACN,UAAWC,GACX,UAAWC,EACX,QAAAC,EACJ,GAAU,CAAAxB,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACf,SAAU,CAAC,SAAS,EACpB,QAAS,IAAMsB,GAAQ,iBAAiB,CAC5C,CAAC,CAAA,mBAEgB,CAAAzB,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACtB,SAAU,CAAC,aAAcV,CAAS,EAClC,QAAS,IAAMiC,GAAU,kBAAmBjC,EAAU,KAAK,EAC3D,OAASkC,GAAS,CACdd,EAAY,MAAM,GAAKc,EAAK,GAC5Bd,EAAY,MAAM,KAAOc,EAAK,SAC9Bd,EAAY,MAAM,eAAiBc,EAAK,eACxCd,EAAY,MAAM,SAAWc,EAAK,SAClCd,EAAY,MAAM,WAAac,EAAK,WACpCd,EAAY,MAAM,QAAUc,EAAK,QACjCd,EAAY,MAAM,QAAUc,EAAK,OACpC,EACD,QAAS/B,CACb,CAAC,CAAA,gBAED,KAAM,CAAE,OAAQgC,EAAc,EAAGC,EAAY,CACzC,WAAaC,GAASC,GAAO,kBAAmBD,CAAI,EACpD,UAAW,IAAM,CACb/C,EAAY,kBAAkB,CAAE,SAAU,CAAC,SAAS,CAAG,CAAA,CAC1D,CACL,CAAC,EAEK,CAAE,OAAQiD,EAAc,EAAGH,EAAY,CACzC,WAAaC,GAASG,GAAW,kBAAmBH,CAAI,EACxD,UAAW,IAAM,CACb/C,EAAY,kBAAkB,CAAE,SAAU,CAAC,SAAS,CAAG,CAAA,EACvDA,EAAY,kBAAkB,CAAE,SAAU,CAAC,aAAcU,CAAS,CAAC,CAAE,CACxE,CACL,CAAC,EAEK,CAAE,OAAQyC,EAAc,EAAGL,EAAY,CACzC,WAAaM,GAAQC,GAAa,kBAAmBD,CAAG,EACxD,UAAW,IAAM,CACbpD,EAAY,kBAAkB,CAAE,SAAU,CAAC,SAAS,CAAG,CAAA,EACvDA,EAAY,kBAAkB,CAAE,SAAU,CAAC,aAAcU,CAAS,CAAC,CAAE,CACxE,CACL,CAAC,EAEK4C,EAAkB,CAACC,EAAOC,IAAS,CACrCjD,EAAW,MAAQgD,EACnB9C,EAAY,MAAQ+C,EACpBpD,IAEIK,EAAY,QAAU,UAAYJ,EAAgB,QAClDyB,EAAY,MAAQ2B,EAAU3B,EAAY,KAAK,EAC/CM,EAAG,MAAM,SAEjB,EAEMsB,EAAgB,CAACF,EAAMJ,IAAQ,CACjC,GAAII,IAAS,QAAUJ,EAAK,CACxB1C,EAAU,MAAQ0C,EAClBE,EAAgB,kBAAmB,MAAM,EACzC,MACH,CAEDA,EAAgB,oBAAqB,QAAQ,CACjD,EAEMK,GAAsB,MAAOP,GAAQ,CACvCD,GAAaC,CAAG,CACpB,EAEMQ,GAAoB,SAAY,CAIlC9B,EAAY,MAAM,eAAiB,EAEnCM,EAAG,MAAM,YAEL,CAAAA,EAAG,MAAM,QAAQ,SAIjB3B,EAAY,QAAU,UACtB,OAAOqB,EAAY,MAAM,GACzB,OAAOA,EAAY,MAAM,QACzB,OAAOA,EAAY,MAAM,OAEzBe,GAAaf,EAAY,KAAK,GAE9BmB,GAAanB,EAAY,KAAK,EAGlCA,EAAY,MAAQ2B,EAAU3B,EAAY,KAAK,EAC/C1B,IACAgC,EAAG,MAAM,SACb"}