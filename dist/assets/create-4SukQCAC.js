import{u as ce,a as ue,r as d,y as n,c as _,x as me,b as L,d as K,f as j,k as b,w as pe,F,e as q,B as S,g as ge,h as f,o as h,A as w,z as M,i as k,t as A}from"./index-rVcEkfs7.js";import{u as Ie,r}from"./i18n-validators-9lIM3i5c.js";import{a as be,u as he}from"./generic.services-VYFQaCza.js";import{u as c}from"./useQuery-2Cvei3en.js";import{c as ye}from"./crud.services-eAS52g5X.js";import{h as fe,i as ve,g as _e,d as Le,e as Se,j as ke}from"./manual.services-j3cZoIi_.js";const Ae={class:"manage section-height shadowed"},Be={class:"manage__inner section-padding"},Oe={__name:"create",async setup(Ke){let o,s;const $=be(),C=ge();ce(),ue();const l=d(localStorage.getItem("organizationId")),O=d(localStorage.getItem("id")),B=d(!1),{data:V,isSuccess:P,isLoading:N}=([o,s]=n(()=>c({queryKey:["floors",{organizationId:l}],queryFn:()=>fe(l.value)})),o=await o,s(),o),{data:x,isSuccess:E,isLoading:R}=([o,s]=n(()=>c({queryKey:["costs",{organizationId:l}],queryFn:()=>ve(l.value)})),o=await o,s(),o),{data:z,isSuccess:G,isLoading:T}=([o,s]=n(()=>c({queryKey:["materials",{organizationId:l}],queryFn:()=>_e(l.value)})),o=await o,s(),o),{data:U,isSuccess:H,isLoading:Q}=([o,s]=n(()=>c({queryKey:["roles"],queryFn:()=>Le()})),o=await o,s(),o),{data:D,isSuccess:J,isLoading:W}=([o,s]=n(()=>c({queryKey:["objectsList",{organizationId:l}],queryFn:()=>Se(l.value)})),o=await o,s(),o),t=d({userId:O.value,organizationId:l.value,deadline:"",constructionMaterialIds:[],buildingObjectId:[],buildingBlockId:[],floorId:[],costId:[],roleIds:[]}),y=_(()=>t.value.buildingObjectId),X=_(()=>!!y.value.length);me(y,()=>{B.value||(t.value.buildingBlockId=[])},{immediate:!0});const{data:Y,isSuccess:Z,isLoading:ee}=([o,s]=n(()=>c({queryKey:["blocksList",{blockId:y}],queryFn:()=>ke(y.value),enabled:X})),o=await o,s(),o),oe=_(()=>({userId:{required:r},organizationId:{required:r},deadline:{required:r},constructionMaterialIds:{required:r},buildingObjectId:{required:r},buildingBlockId:{required:r},floorId:{required:r},costId:{required:r},roleIds:{required:r}})),i=Ie(oe,t),ae=d([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),se=d([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",errorKey:"floorId",options:V,success:P,loading:N},{id:2,model:"constructionMaterialIds",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",errorKey:"constructionMaterialIds",options:z,success:G,loading:T,multiple:!0},{id:3,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",errorKey:"costId",options:x,success:E,loading:R},{id:4,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:D,success:J,loading:W},{id:5,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:Y,success:Z,loading:ee},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:U,success:H,loading:Q,multiple:!0}]),{mutate:le}=he({onMutate:a=>{B.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.floorId=a.floorId[0],a.costId=a.costId[0]},mutationFn:a=>ye("application",a),onSuccess:()=>{$.invalidateQueries({queryKey:["applications"]}),C.push(w.APPLICATIONS.path)}}),re=()=>{i.value.$validate(),!i.value.$errors.length&&(le(t.value),i.value.$reset())};return(a,je)=>{const te=f("ManageHead"),ie=f("FormInput"),de=f("FormSelect"),ne=f("CustomButton");return h(),L("section",Ae,[K("div",Be,[j(te,{title:"addNewApplicationTitle",to:b(w).APPLICATIONS.path},null,8,["to"]),K("form",{class:"manage__form form-manage",onSubmit:pe(re,["prevent"])},[(h(!0),L(F,null,q(ae.value,e=>{var u,m,p,g,I;return h(),M(ie,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":v=>t.value[e.model]=v,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(m=(u=b(i))==null?void 0:u[e.errorKey])==null?void 0:m.$error,textError:(I=(g=(p=b(i))==null?void 0:p[e.errorKey])==null?void 0:g.$errors[0])==null?void 0:I.$message,type:e==null?void 0:e.type},{default:S(()=>[k(A(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(h(!0),L(F,null,q(se.value,e=>{var u,m,p,g,I;return h(),M(de,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":v=>t.value[e.model]=v,width:500,options:e.options,error:(m=(u=b(i))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:m.$error,placeholder:e==null?void 0:e.placeholder,textError:(I=(g=(p=b(i))==null?void 0:p[e==null?void 0:e.errorKey])==null?void 0:g.$errors[0])==null?void 0:I.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:S(()=>[k(A(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128)),j(ne,{className:"form__submit"},{default:S(()=>[k(A(a.$t("formButton")),1)]),_:1})],32)])])}}};export{Oe as default};
//# sourceMappingURL=create-4SukQCAC.js.map
