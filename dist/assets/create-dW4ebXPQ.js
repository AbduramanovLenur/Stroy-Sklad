import{_ as de,u as ne,a as ie,r as u,c as i,B as ce,m as b,o as n,d as f,e as w,t as v,F as T,C as O,z as K,D as A,f as k,k as C,J as Re,q as Ge,b as He,x as xe,y as S,h as m,w as Qe,i as te,l as Je,A as se,G as We,I as H}from"./index-JvbhfmnW.js";import{u as Xe,r as L}from"./i18n-validators-pdrHvBMx.js";import{a as Ye,u as Ze}from"./generic.services-nPQjChLr.js";import{u as $}from"./useQuery-83Oo_vnt.js";import{c as ea}from"./crud.services-ysnFdDpK.js";import{e as aa,f as oa,g as la,h as ta,i as sa,j as ra}from"./manual.services-jHvvpFhH.js";import{v as re}from"./v4-yQnnJER4.js";const da={class:"application-form"},na={class:"application-form__title"},ia={class:"application-form__overlay form-manage"},ca={__name:"ApplicationForm",props:["selects","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(P,{emit:l}){const d=ne(),{t:q}=ie(),j=P,N=l,t=u({floorId:[],costId:[],constructionMaterialId:[],count:"",price:""}),U=i(()=>j.buildingBlockId);ce(U,()=>{t.value.floorId=[]});const p=u([{id:1,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"},{id:2,model:"price",label:"priceAppLabel",placeholder:"priceAppPlaceholder",icon:"money"}]),V=()=>{if(!Re(t.value)){d.error(q("isEmptyModal"));return}t.value={floorId:t.value.floorId[0],costId:t.value.costId[0],constructionMaterialId:t.value.constructionMaterialId[0],count:t.value.count,price:t.value.price},N("onAddTable",t.value),console.log(t.value),t.value=Ge(t.value)};return(c,B)=>{const z=b("FormSelect"),s=b("FormInput"),D=b("CustomButton");return n(),f("div",da,[w("h4",na,v(c.$t("appInfo")),1),w("div",ia,[(n(!0),f(T,null,O(P.selects,a=>(n(),K(z,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":M=>t.value[a.model]=M,width:500,options:a.options,placeholder:a==null?void 0:a.placeholder,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple},{default:A(()=>[k(v(c.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128)),(n(!0),f(T,null,O(p.value,a=>(n(),K(s,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":M=>t.value[a.model]=M,width:500,placeholder:c.$t(a.placeholder),name:a.icon,type:a==null?void 0:a.type},{default:A(()=>[k(v(c.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),C(D,{className:"form__submit",type:"button",onClick:V},{default:A(()=>[k(v(c.$t("addButtonForm")),1)]),_:1})])])}}},ua=de(ca,[["__scopeId","data-v-3c1b7b05"]]),pa={key:0,class:"manage section-height shadowed"},ma={class:"manage__inner section-padding"},ba={class:"manage__overlay"},va={key:0,class:"error"},ga={__name:"create",async setup(P){let l,d;const q=Ye(),j=Je(),N=ne(),{t}=ie(),U=He(),{user:p}=xe(U),V=i(()=>{var o,r;return!!((r=(o=p==null?void 0:p.value.user)==null?void 0:o.modules)!=null&&r.includes(We.APPLICATION.CREATE))}),c=u(!1),B=u([]),z=u([{id:1,label:"appFloor",width:215},{id:2,label:"appMaterial",width:290},{id:3,label:"appCount",width:250},{id:4,label:"appPrice",width:300},{id:5,label:"appCost"}]),s=u({deadline:"",buildingObjectId:[],buildingBlockId:[],roleIds:[],createApplicationTables:[],details:""}),D=i(()=>({deadline:{required:L},buildingObjectId:{required:L},buildingBlockId:{required:L},roleIds:{required:L},createApplicationTables:{required:L},details:{required:L}})),a=Xe(D,s),{data:M,isSuccess:ue,isLoading:pe}=([l,d]=S(()=>$({queryKey:["rolesList",{organizationId:p.value.user.organizationId}],queryFn:()=>aa(),enabled:V})),l=await l,d(),l),{data:me,isSuccess:be,isLoading:ve}=([l,d]=S(()=>$({queryKey:["objectsList",{organizationId:p.value.user.organizationId}],queryFn:()=>oa(),enabled:V})),l=await l,d(),l),E=i(()=>s.value.buildingObjectId),ge=i(()=>!!E.value.length);ce(E,()=>{c.value||(s.value.buildingBlockId=[])},{immediate:!0});const{data:he,isSuccess:Ie,isLoading:_e}=([l,d]=S(()=>$({queryKey:["blocksList",{blockId:E}],queryFn:()=>sa(E.value),enabled:ge})),l=await l,d(),l),R=i(()=>s.value.buildingBlockId),G=i(()=>!!R.value.length),{data:x,isSuccess:ye,isLoading:fe}=([l,d]=S(()=>$({queryKey:["floorsList",{floorId:R}],queryFn:()=>ra(R.value),enabled:G})),l=await l,d(),l),{data:Q,isSuccess:Ae,isLoading:ke}=([l,d]=S(()=>$({queryKey:["costsList",{organizationId:p.value.user.organizationId}],queryFn:()=>la(),enabled:G})),l=await l,d(),l),{data:J,isSuccess:Se,isLoading:Le}=([l,d]=S(()=>$({queryKey:["materialsList",{organizationId:p.value.user.organizationId}],queryFn:()=>ta(),enabled:G})),l=await l,d(),l),$e=u([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),Ve=u([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:me,success:be,loading:ve},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:he,success:Ie,loading:_e},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:M,success:ue,loading:pe,multiple:!0}]),Be=u([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:x,success:ye,loading:fe},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:Q,success:Ae,loading:ke},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:J,success:Se,loading:Le}]),Me=u([{id:1,model:"details",label:"appCommentLabel",placeholder:"appCommentPlaceholder",errorKey:"details"}]),W=i(()=>H(x.value)),X=i(()=>H(Q.value)),Y=i(()=>H(J.value)),Fe=o=>{var r;return(r=W.value[o.floorId])==null?void 0:r.name},Ce=o=>{var r;return(r=X.value[o.costId])==null?void 0:r.name},we=o=>{var r;return(r=Y.value[o==null?void 0:o.constructionMaterialId])==null?void 0:r.name},Te=i(()=>Object.keys(W.value).length&&Object.keys(X.value).length&&Object.keys(Y.value).length),Oe=o=>{if(Te){B.value.push({delId:re(),floorValue:Fe(o),costValue:Ce(o),constructionMaterialValue:we(o),count:o.count,price:o.price}),s.value.createApplicationTables.push({delId:re(),...o});return}N.error(t("estimateEmptyData"))},Ke=o=>{s.value.createApplicationTables=s.value.createApplicationTables.filter(r=>r.delId!==o),B.value=B.value.filter(r=>r.delId!==o)},{mutate:Ee}=Ze({onMutate:o=>{c.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.buildingBlockId=o.buildingBlockId[0]},mutationFn:o=>ea("application",o),onSuccess:()=>{q.invalidateQueries({queryKey:["applications"]}),j.push(se.APPLICATIONS.path)}}),Pe=()=>{a.value.$validate(),!a.value.$errors.length&&(Ee(s.value),a.value.$reset())};return(o,r)=>{var Z,ee,ae,oe,le;const qe=b("ManageHead"),je=b("FormInput"),Ne=b("FormSelect"),Ue=b("SubTable"),ze=b("FormTextarea"),De=b("CustomButton");return V.value?(n(),f("section",pa,[w("div",ma,[C(qe,{title:"addNewApplicationTitle",to:m(se).APPLICATIONS.path},null,8,["to"]),w("form",{class:"manage__form",onSubmit:Qe(Pe,["prevent"])},[w("div",ba,[(n(!0),f(T,null,O($e.value,e=>{var g,h,I,_,y;return n(),K(je,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":F=>s.value[e.model]=F,modelModifiers:{trim:!0},width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(h=(g=m(a))==null?void 0:g[e.errorKey])==null?void 0:h.$error,textError:(y=(_=(I=m(a))==null?void 0:I[e.errorKey])==null?void 0:_.$errors[0])==null?void 0:y.$message,type:e==null?void 0:e.type},{default:A(()=>[k(v(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(n(!0),f(T,null,O(Ve.value,e=>{var g,h,I,_,y;return n(),K(Ne,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":F=>s.value[e.model]=F,modelModifiers:{trim:!0},width:500,options:e.options,error:(h=(g=m(a))==null?void 0:g[e==null?void 0:e.errorKey])==null?void 0:h.$error,placeholder:e==null?void 0:e.placeholder,textError:(y=(_=(I=m(a))==null?void 0:I[e==null?void 0:e.errorKey])==null?void 0:_.$errors[0])==null?void 0:y.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:A(()=>[k(v(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128))]),C(ua,{selects:Be.value,buildingBlockId:s.value.buildingBlockId,isSubmit:c.value,onOnAddTable:Oe},null,8,["selects","buildingBlockId","isSubmit"]),(ee=(Z=m(a))==null?void 0:Z.createApplicationTables)!=null&&ee.$error?(n(),f("span",va,v((le=(oe=(ae=m(a))==null?void 0:ae.createApplicationTables)==null?void 0:oe.$errors[0])==null?void 0:le.$message),1)):te("",!0),C(Ue,{headers:z.value,table:B.value,onOnActionDelete:Ke,isShowDelete:!0},null,8,["headers","table"]),(n(!0),f(T,null,O(Me.value,e=>{var g,h,I,_,y;return n(),K(ze,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":F=>s.value[e.model]=F,modelModifiers:{trim:!0},width:500,placeholder:o.$t(e.placeholder),error:(h=(g=m(a))==null?void 0:g[e.errorKey])==null?void 0:h.$error,textError:(y=(_=(I=m(a))==null?void 0:I[e.errorKey])==null?void 0:_.$errors[0])==null?void 0:y.$message},{default:A(()=>[k(v(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","error","textError"])}),128)),C(De,{className:"manage__submit"},{default:A(()=>[k(v(o.$t("appButton")),1)]),_:1})],32)])])):te("",!0)}}},Sa=de(ga,[["__scopeId","data-v-e13e9c7b"]]);export{Sa as default};
//# sourceMappingURL=create-dW4ebXPQ.js.map
