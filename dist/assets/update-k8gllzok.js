import{u as be,a as ge,r as d,b as Ie,y as pe,c as y,z as I,B as E,d as K,e as P,k as R,h as i,w as he,F as M,C as D,D as S,i as ve,l as fe,G as ye,m as _,o as p,s as $,A as U,f as q,t as w,H as _e,E as ke}from"./index-4UPdn8r5.js";import{u as Fe,r as l}from"./i18n-validators-rYP8hPEZ.js";import{a as Oe,u as Le}from"./generic.services-suEnlNvN.js";import{u as h}from"./useQuery-J_Xc9Nln.js";import{a as Be,u as Ke}from"./crud.services-eNoFKDSu.js";import{f as Se,m as $e,a as qe,b as we}from"./manual.services-sihQqlgC.js";const je={key:0,class:"manage section-height shadowed"},Ce={class:"manage__inner section-padding"},Ue={__name:"update",async setup(Ve){let o,r;const k=Oe(),j=fe(),x=ye();be(),ge();const F=d(x.params.id),A=Ie(),{user:v}=pe(A),n=y(()=>{var e,L;return!!((L=(e=v==null?void 0:v.value.user)==null?void 0:e.modules)!=null&&L.includes(_e.BLOCK.UPDATE))}),C=d(!1),O=d(!1),a=d({id:"",fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[],stateId:[]}),G=y(()=>({id:{required:l},fullname:{required:l},numberOfFloors:{required:l},roomsOnFloor:{required:l},address:{required:l},buildingObjectId:{required:l},regionId:{required:l},districtId:{required:l},stateId:{required:l}})),t=Fe(G,a),{data:H,isSuccess:Q,isLoading:T}=([o,r]=I(()=>h({queryKey:["regions"],queryFn:()=>$e(),enabled:n})),o=await o,r(),o),f=y(()=>a.value.regionId),z=y(()=>!!f.value.length);E(f,()=>{!O.value&&!C.value&&(a.value.districtId=[]),O.value=!1},{immediate:!0});const{data:W,isSuccess:J,isLoading:X}=([o,r]=I(()=>h({queryKey:["districts",{districtId:f}],queryFn:()=>qe(f.value),enabled:z})),o=await o,r(),o),{data:Y,isSuccess:Z,isLoading:ee}=([o,r]=I(()=>h({queryKey:["objectsList",{organizationId:v.value.user.organizationId}],queryFn:()=>Se(),enabled:n})),o=await o,r(),o),{data:se,isSuccess:oe,isLoading:ae}=([o,r]=I(()=>h({queryKey:["states"],queryFn:()=>we(),enabled:n})),o=await o,r(),o),re=d([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),le=d([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:Y,success:Z,loading:ee},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:H,success:Q,loading:T},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:W,success:J,loading:X},{id:4,model:"stateId",label:"stateBlocksLabel",placeholder:"stateBlocksPlaceholder",errorKey:"stateId",options:se,success:oe,loading:ae}]),{isError:te}=([o,r]=I(()=>h({queryKey:["blocksById",F],queryFn:()=>Be("building_block",F.value),select:e=>{a.value.id=e.id,a.value.fullname=e.fullName,a.value.numberOfFloors=e.numberOfFloors,a.value.roomsOnFloor=e.roomsOnFloor,a.value.address=e.address,a.value.buildingObjectId=[e.buildingObjectId],a.value.regionId=[e.regionId],a.value.districtId=[e.districtId],a.value.stateId=[e.stateId],O.value=!0},enabled:n})),o=await o,r(),o);E(te,e=>{e&&j.push($.HOME.path)});const{mutate:de}=Le({onMutate:e=>{C.value=!0,e.buildingObjectId=e.buildingObjectId[0],e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>Ke("building_block",e),onSuccess:e=>{a.value=ke(a.value),k.invalidateQueries({queryKey:["blocks"]}),k.invalidateQueries({queryKey:["blocksById",F]}),k.invalidateQueries({queryKey:["blocksList"]}),j.push($.BLOCK.path)}}),ie=async()=>{if(t.value.$validate(),t.value.$errors.length)return;const e={...a.value};de(e),t.value.$reset()};return(e,L)=>{var V,N;const ne=_("ManageHead"),ue=_("FormInput"),ce=_("FormSelect"),me=_("CustomButton");return n.value?(p(),K("section",je,[P("div",Ce,[R(ne,{title:"editBlocksTitle",to:i($).BLOCK.path},null,8,["to"]),P("form",{class:"manage__form form-manage",onSubmit:he(ie,["prevent"])},[(p(!0),K(M,null,D(re.value,s=>{var u,c,m,b,g;return p(),U(ue,{key:s.id,modelValue:a.value[s.model],"onUpdate:modelValue":B=>a.value[s.model]=B,width:500,placeholder:e.$t(s.placeholder),name:s.icon,error:(c=(u=i(t))==null?void 0:u[s==null?void 0:s.errorKey])==null?void 0:c.$error,textError:(g=(b=(m=i(t))==null?void 0:m[s==null?void 0:s.errorKey])==null?void 0:b.$errors[0])==null?void 0:g.$message},{default:S(()=>[q(w(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(p(!0),K(M,null,D(le.value,s=>{var u,c,m,b,g;return p(),U(ce,{key:s.id,modelValue:a.value[s.model],"onUpdate:modelValue":B=>a.value[s.model]=B,width:500,options:s.options,error:(c=(u=i(t))==null?void 0:u[s==null?void 0:s.errorKey])==null?void 0:c.$error,placeholder:s==null?void 0:s.placeholder,textError:(g=(b=(m=i(t))==null?void 0:m[s==null?void 0:s.errorKey])==null?void 0:b.$errors[0])==null?void 0:g.$message,success:s.success,loading:s.loading},{default:S(()=>[q(w(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),R(me,{className:`form__submit ${(N=(V=i(t))==null?void 0:V.stateId.$errors[0])!=null&&N.$message?"centered":""}`},{default:S(()=>[q(w(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ve("",!0)}}};export{Ue as default};
