import{_ as U,o as u,d as p,e as i,L as Be,t as c,w as ne,I as ie,c as r,F as E,C as ue,p as Fe,n as Pe,u as je,a as Ve,r as b,b as Ne,y as qe,z as h,ai as Ke,B as ze,k as S,h as I,D as g,aj as De,A as M,i as _,l as He,G as Re,m as O,s as $,f as k,H,J as R}from"./index-qYaOSAk5.js";import{a as Ee,e as Ue,f as Qe}from"./crud.services-6H1cbtzh.js";import{f as Ge,g as We,h as Je,i as Xe,j as Ye}from"./manual.services-e5QN_9-o.js";import{a as Ze,u as oe}from"./generic.services-uSp9rJcx.js";import{u as y}from"./useQuery-3KlBkAoQ.js";const xe={class:"confirmation-modal__title"},ea={class:"confirmation-modal__triggers"},aa={__name:"ConfirmationModal",props:["isOpen"],setup(m){return(a,l)=>(u(),p("div",{class:ie(`confirmation-modal ${m.isOpen?"is-active":""}`),onClick:l[3]||(l[3]=()=>a.$emit("onNotConfirmed"))},[i("div",{class:"confirmation-modal__overlay",onClick:l[2]||(l[2]=ne(()=>{},["stop"]))},[i("h4",xe,[Be(a.$slots,"default",{},void 0,!0)]),i("div",ea,[i("button",{type:"button",class:"confirmation-modal__accepted",onClick:l[0]||(l[0]=()=>a.$emit("onConfirmed"))},c(a.$t("yesButton")),1),i("button",{type:"button",class:"confirmation-modal__refused",onClick:l[1]||(l[1]=()=>a.$emit("onNotConfirmed"))},c(a.$t("noButton")),1)])])],2))}},le=U(aa,[["__scopeId","data-v-c25f4d7f"]]),sa=m=>(Fe("data-v-28fb4607"),m=m(),Pe(),m),ta={class:"histories"},oa={class:"histories__label"},la={class:"histories__list"},na={class:"histories__head"},ia={class:"histories__name"},ua=sa(()=>i("div",{class:"histories__divider"}," - ",-1)),ca={class:"histories__status"},da={class:"histories__date"},ra={__name:"Histories",props:["histories"],setup(m){const a=r(()=>l=>{let v=new Date(l),t=v.toISOString().split("T")[0],A=v.toISOString().split("T")[1].split(".")[0];return`${t} ${A}`});return(l,v)=>(u(),p("div",ta,[i("div",oa,c(l.$t("historiesLabel")),1),i("ul",la,[(u(!0),p(E,null,ue(m.histories,t=>(u(),p("li",{key:t.id,class:"histories__item"},[i("div",{class:ie(`histories__box ${(t==null?void 0:t.statusId)===1?"created":(t==null?void 0:t.statusId)===7?"accepted":(t==null?void 0:t.statusId)===20?"expected":(t==null?void 0:t.statusId)===15?"refused":""}`)},[i("div",na,[i("div",ia,c(t==null?void 0:t.userName),1),ua,i("div",ca,c(t==null?void 0:t.status),1)]),i("div",da,c(a.value(t==null?void 0:t.createdDate)),1)],2)]))),128))])]))}},pa=U(ra,[["__scopeId","data-v-28fb4607"]]),ma={key:0,class:"manage section-height shadowed"},va={class:"manage__inner section-padding"},ba={class:"manage__overlay"},_a={key:0,class:"manage__triggers"},Ia={__name:"view",async setup(m){let a,l;const v=Ze(),t=He(),A=Re(),Q=je(),{t:G}=Ve(),C=b(A.params.id),ce=Ne(),{user:d}=qe(ce),B=r(()=>{var e,o;return(o=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)==null?void 0:o.includes(H.APPLICATION.READ)}),F=b(!1),P=b(!1),de=b([{id:1,label:"appFloor",width:20},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:20},{id:4,label:"appPrice",width:30}]),n=b({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],applicationTables:[],details:"",statusId:"",hasPermission:[],histories:[]}),{data:re,isSuccess:pe,isLoading:me}=([a,l]=h(()=>y({queryKey:["objectsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Ge(),enabled:B})),a=await a,l(),a),j=r(()=>n.value.buildingObjectId[0]),ve=r(()=>!!j.value),{data:be,isSuccess:_e,isLoading:Ie}=([a,l]=h(()=>y({queryKey:["blocksList",{blockId:j,organizationId:d.value.user.organizationId}],queryFn:()=>We(j.value),enabled:ve})),a=await a,l(),a),V=r(()=>n.value.buildingBlockId[0]),N=r(()=>!!V.value),{data:ge,isSuccess:ga,isLoading:ka}=([a,l]=h(()=>y({queryKey:["floorsList",{floorId:V,organizationId:d.value.user.organizationId}],queryFn:()=>Je(V.value),enabled:N})),a=await a,l(),a),{data:ke,isSuccess:Ca,isLoading:fa}=([a,l]=h(()=>y({queryKey:["costsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Xe(),enabled:N})),a=await a,l(),a),{data:Ce,isSuccess:ha,isLoading:Sa}=([a,l]=h(()=>y({queryKey:["materialsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Ye(),enabled:N})),a=await a,l(),a),fe=b([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"},{id:2,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:re,success:pe,loading:me,select:!0},{id:3,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:be,success:_e,loading:Ie,select:!0}]),{isError:he}=([a,l]=h(()=>y({queryKey:["applicationsById",C],queryFn:()=>Ee("application",C.value),select:e=>{n.value.id=e.id,n.value.deadline=e.deadline,n.value.buildingObjectId=[e.buildingObjectId],n.value.buildingBlockId=[e.buildingBlockId],n.value.applicationTables=[...e.applicationTables],n.value.details=e.details,n.value.statusId=e.statusId,n.value.hasPermission=e.hasPermission,n.value.histories=e.applicationHistories},enabled:B})),a=await a,l(),a),W=r(()=>R(ge.value||[])),J=r(()=>R(ke.value||[])),X=r(()=>R(Ce.value||[])),Se=e=>{var o;return(o=W.value[e.floorId])==null?void 0:o.name},Oe=e=>{var o;return(o=J.value[e.costId])==null?void 0:o.name},ye=e=>{var o;return(o=X.value[e==null?void 0:e.constructionMaterialId])==null?void 0:o.name},Y=b(!1),Z=b(!0);Ke(()=>{var w,T,L;const e=(w=Object.keys(W.value))==null?void 0:w.length,o=(T=Object.keys(J.value))==null?void 0:T.length,q=(L=Object.keys(X.value))==null?void 0:L.length,K=n.value.applicationTables.length;e&&o&&q&&K&&(n.value.applicationTables=n.value.applicationTables.map(f=>({...f,floorValue:Se(f),costValue:Oe(f),constructionMaterialValue:ye(f)})),Y.value=!0,Z.value=!1)}),ze(he,e=>{e&&t.push($.APPLICATION.path)});const{mutate:Le,status:Me}=oe({mutationFn:e=>Ue("application",e),onSuccess:e=>{e!=null&&e.success&&(v.invalidateQueries({queryKey:["applications"]}),v.invalidateQueries({queryKey:["applicationsById",C]}),t.push($.APPLICATION.path),setTimeout(()=>Q.success(G("cancelToast")),150))}}),{mutate:we,status:Te}=oe({mutationFn:e=>Qe("application",e),onSuccess:e=>{e!=null&&e.success&&(v.invalidateQueries({queryKey:["applications"]}),v.invalidateQueries({queryKey:["applicationsById",C]}),t.push($.APPLICATION.path),setTimeout(()=>Q.success(G("acceptToast")),150))}}),$e=()=>{Le(C.value)},Ae=()=>{we(C.value)};return(e,o)=>{var z,x,ee,ae,se,te;const q=O("ManageHead"),K=O("FormInput"),w=O("FormSelect"),T=O("SubTable"),L=O("MyButton"),f=O("Spinner");return B.value?(u(),p("section",ma,[i("div",va,[S(q,{title:"addNewApplicationTitle",to:I($).APPLICATION.path},null,8,["to"]),Y.value?(u(),p("form",{key:0,class:"manage__form",onSubmit:o[3]||(o[3]=ne(()=>{},["prevent"]))},[i("div",ba,[(u(!0),p(E,null,ue(fe.value,s=>(u(),p(E,{key:s.id},[s!=null&&s.select?_("",!0):(u(),M(K,{key:0,modelValue:n.value[s.model],"onUpdate:modelValue":D=>n.value[s.model]=D,width:500,placeholder:e.$t(s.placeholder),name:s.icon,type:s==null?void 0:s.type,isDisabled:!0},{default:g(()=>[k(c(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),s!=null&&s.select?(u(),M(w,{key:1,modelValue:n.value[s.model],"onUpdate:modelValue":D=>n.value[s.model]=D,modelModifiers:{trim:!0},width:500,options:s.options,placeholder:s==null?void 0:s.placeholder,success:s.success,loading:s.loading,isMultiSelect:s==null?void 0:s.multiple,isDisabled:!0},{default:g(()=>[k(c(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"])):_("",!0)],64))),128))]),S(T,{headers:de.value,table:n.value.applicationTables},null,8,["headers","table"]),S(De,{modelValue:n.value.details,"onUpdate:modelValue":o[0]||(o[0]=s=>n.value.details=s),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),isDisabled:!0},{default:g(()=>[k(c(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder"]),n.value.hasPermission?(u(),p("div",_a,[(ee=(x=(z=I(d))==null?void 0:z.user)==null?void 0:x.modules)!=null&&ee.includes(I(H).APPLICATION.CONFIRM)?(u(),M(L,{key:0,icon:"approve",type:"submit",color:"green",width:180,onClick:o[1]||(o[1]=()=>F.value=!0),disabled:I(Te)==="pending"},{default:g(()=>[k(c(e.$t("acceptButton")),1)]),_:1},8,["disabled"])):_("",!0),(te=(se=(ae=I(d))==null?void 0:ae.user)==null?void 0:se.modules)!=null&&te.includes(I(H).APPLICATION.REFUSAL)?(u(),M(L,{key:1,icon:"refusal",type:"submit",color:"red",width:180,onClick:o[2]||(o[2]=()=>P.value=!0),disabled:I(Me)==="pending"},{default:g(()=>[k(c(e.$t("cancelButton")),1)]),_:1},8,["disabled"])):_("",!0)])):_("",!0),S(pa,{histories:n.value.histories},null,8,["histories"])],32)):_("",!0),Z.value?(u(),M(f,{key:1})):_("",!0)]),S(le,{isOpen:F.value,onOnConfirmed:Ae,onOnNotConfirmed:o[4]||(o[4]=()=>F.value=!1)},{default:g(()=>[k(c(e.$t("sureConfirm")),1)]),_:1},8,["isOpen"]),S(le,{isOpen:P.value,onOnConfirmed:$e,onOnNotConfirmed:o[5]||(o[5]=()=>P.value=!1)},{default:g(()=>[k(c(e.$t("sureRefused")),1)]),_:1},8,["isOpen"])])):_("",!0)}}},Ta=U(Ia,[["__scopeId","data-v-f249018d"]]);export{Ta as default};
