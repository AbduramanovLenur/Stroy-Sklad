import{g as Y,d as Z}from"./crud.services-z-7dMtvc.js";import{u as ee,a as te,x as se,y as O,b as oe,c as ae,r as q,z as ne,d as L,e as ie,k as Q,A as ce,h as e,B as I,i,t as J,m as c,o as u,f as ue,s as K,H as r}from"./index-bESyHmKb.js";import{u as re}from"./generic.services-WkEajj6v.js";import{u as le}from"./useQuery-1aHXDk8s.js";import{u as de}from"./useMutation-pOycABst.js";import{r as me}from"./index-wDFVcmwW.js";const be={key:0,class:"object"},_e={class:"object__inner section-padding"},ye={key:2,class:"empty-table shadowed"},fe={__name:"index",async setup(pe){let a,_;const o=re(),N=ee(),{t:P}=te(),U=se(),{page:l,limit:d,search:x}=O(U),H=oe(),{user:s}=O(H),y=ae(()=>{var t,b;return!!((b=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&b.includes(r.OBJECT.READ))}),p=q(""),h=me(x,500),R=q([{id:1,label:"objectName",width:40},{id:2,label:"objectAddress",width:30}]),{data:n,isLoading:V,isSuccess:m,isError:z}=([a,_]=ne(()=>le({queryKey:["objects",{page:l,limit:d,debouncedSearch:h,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>Y("building_object",l.value,d.value,h.value),enabled:y})),a=await a,_(),a),{mutate:F}=de({mutationFn:t=>Z("building_object",t),onSuccess:t=>{t!=null&&t.success&&(o.invalidateQueries({queryKey:["objects"]}),o.invalidateQueries({queryKey:["objectById",p.value.toString()]}),o.invalidateQueries({queryKey:["objectsList"]}),o.invalidateQueries({queryKey:["blocks"]}),o.invalidateQueries({queryKey:["blocksList"]}),setTimeout(()=>N.success(P("deleteToast")),150))}}),M=async t=>{p.value=t,F(t)};return(t,b)=>{var T,S,v,E,g,f,j,C,w,B,k,D,A;const $=c("HeadPage"),W=c("Table"),G=c("Pagination"),X=c("Spinner");return y.value?(u(),L("section",be,[ie("div",_e,[Q($,{title:"objectTitle",to:e(K).CREATE_OBJECT.path,isShowCreate:(v=(S=(T=e(s))==null?void 0:T.user)==null?void 0:S.modules)==null?void 0:v.includes(e(r).OBJECT.CREATE)},{default:ce(()=>[ue(J(t.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),e(m)&&((E=e(n))!=null&&E.count)?(u(),I(W,{key:0,headers:R.value,table:(g=e(n))==null?void 0:g.objects,to:e(K).UPDATE_OBJECT.name,options:{page:e(l),limit:e(d)},isShowUpdate:(C=(j=(f=e(s))==null?void 0:f.user)==null?void 0:j.modules)==null?void 0:C.includes(e(r).OBJECT.UPDATE),isShowDelete:(k=(B=(w=e(s))==null?void 0:w.user)==null?void 0:B.modules)==null?void 0:k.includes(e(r).OBJECT.DELETE),onOnActionDelete:M},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):i("",!0),Q(G,{count:(D=e(n))==null?void 0:D.count,isSucces:e(m)},null,8,["count","isSucces"]),e(V)?(u(),I(X,{key:1})):i("",!0),e(m)&&!((A=e(n))!=null&&A.count)||e(z)?(u(),L("div",ye,J(t.$t("emptyTableTitle")),1)):i("",!0)])])):i("",!0)}}};export{fe as default};
