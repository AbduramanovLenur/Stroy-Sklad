import{u as me,a as be,b as ge,y as pe,c as d,r as h,z as y,B as he,d as _,e as P,k as T,h as a,w as ye,F as D,C as _e,D as I,i as v,l as Ie,m,o as n,s as x,A,f as k,t as L,H as ve,E as ke}from"./index-qYaOSAk5.js";import{u as Le,r as l}from"./i18n-validators-FA-njMbI.js";import{a as Fe,u as Oe}from"./generic.services-uSp9rJcx.js";import{u as F}from"./useQuery-3KlBkAoQ.js";import{c as Ke}from"./crud.services-6H1cbtzh.js";import{f as Be,m as $e,a as Se}from"./manual.services-e5QN_9-o.js";const we={key:0,class:"manage section-height shadowed"},Ce={class:"manage__inner section-padding"},Pe={__name:"create",async setup(Ve){let o,c;const O=Fe(),U=Ie(),H=me(),{t:Q}=be(),z=ge(),{user:u}=pe(z),b=d(()=>{var s,g;return!!((g=(s=u==null?void 0:u.value.user)==null?void 0:s.modules)!=null&&g.includes(ve.BLOCK.CREATE))}),K=h(!1),r=h({fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[]}),G=d(()=>({fullname:{required:l},numberOfFloors:{required:l},roomsOnFloor:{required:l},address:{required:l},buildingObjectId:{required:l},regionId:{required:l},districtId:{required:l}})),t=Le(G,r),{data:J,isSuccess:W,isLoading:X}=([o,c]=y(()=>F({queryKey:["regions"],queryFn:()=>$e(),enabled:b})),o=await o,c(),o),i=d(()=>r.value.regionId[0]),Y=d(()=>!!i.value);he(i,()=>{K.value||(r.value.districtId=[])},{immediate:!0});const{data:Z,isSuccess:f,isLoading:ee}=([o,c]=y(()=>F({queryKey:["districts",{districtId:i}],queryFn:()=>Se(i.value),enabled:Y})),o=await o,c(),o),{data:se,isSuccess:oe,isLoading:re}=([o,c]=y(()=>F({queryKey:["objectsList",{organizationId:u.value.user.organizationId}],queryFn:()=>Be(),enabled:b})),o=await o,c(),o),te=h([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"},{id:5,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:se,success:oe,loading:re,select:!0},{id:6,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:J,success:W,loading:X,select:!0},{id:7,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:Z,success:f,loading:ee,select:!0}]),{mutate:ae,status:le}=Oe({onMutate:s=>{K.value=!0,s.buildingObjectId=s.buildingObjectId[0],s.regionId=s.regionId[0],s.districtId=s.districtId[0]},mutationFn:s=>Ke("building_block",s),onSuccess:s=>{s!=null&&s.success&&(r.value=ke(r.value),O.invalidateQueries({queryKey:["blocks"]}),O.invalidateQueries({queryKey:["blocksList"]}),U.push(x.BLOCK.path),setTimeout(()=>H.success(Q("createToast")),150))}}),ce=()=>{if(t.value.$validate(),t.value.$errors.length)return;const s={...r.value};ae(s),t.value.$reset()};return(s,g)=>{var B,$;const ne=m("ManageHead"),ue=m("FormInput"),ie=m("FormSelect"),de=m("CustomButton");return b.value?(n(),_("section",we,[P("div",Ce,[T(ne,{title:"addNewBlocksTitle",to:a(x).BLOCK.path},null,8,["to"]),P("form",{class:"manage__form form-manage",onSubmit:ye(ce,["prevent"])},[(n(!0),_(D,null,_e(te.value,e=>{var S,w,C,V,j,N,q,E,R,M;return n(),_(D,{key:e.id},[e!=null&&e.select?v("",!0):(n(),A(ue,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":p=>r.value[e.model]=p,width:500,placeholder:s.$t(e.placeholder),name:e.icon,error:(w=(S=a(t))==null?void 0:S[e.errorKey])==null?void 0:w.$error,textError:(j=(V=(C=a(t))==null?void 0:C[e.errorKey])==null?void 0:V.$errors[0])==null?void 0:j.$message},{default:I(()=>[k(L(s.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(n(),A(ie,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":p=>r.value[e.model]=p,modelModifiers:{trim:!0},width:500,options:e.options,error:(q=(N=a(t))==null?void 0:N[e==null?void 0:e.errorKey])==null?void 0:q.$error,placeholder:e==null?void 0:e.placeholder,textError:(M=(R=(E=a(t))==null?void 0:E[e==null?void 0:e.errorKey])==null?void 0:R.$errors[0])==null?void 0:M.$message,success:e.success,loading:e.loading},{default:I(()=>[k(L(s.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):v("",!0)],64)}),128)),T(de,{className:`form__submit ${($=(B=a(t))==null?void 0:B.districtId.$errors[0])!=null&&$.$message?"centered":""}`,disabled:a(le)==="pending"},{default:I(()=>[k(L(s.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):v("",!0)}}};export{Pe as default};
