import{u as ee,a as ae,b as te,y as oe,c as F,r as K,z as re,d as i,e as U,k as B,h as r,w as se,F as H,C as ne,D as d,i as p,l as ue,m as c,o as s,s as N,A as T,f as h,t as _,H as ce,E as le}from"./index-Znn7x0w2.js";import{c as me}from"./crud.services-oovoAPUX.js";import{j as ie}from"./manual.services-CtkFg6uR.js";import{u as de,r as W}from"./i18n-validators-IvsyUnkI.js";import{a as pe,u as he}from"./generic.services-CuHvXiDr.js";import{u as _e}from"./useQuery-n34yz_OD.js";const ye={key:0,class:"manage section-height shadowed"},ge={class:"manage__inner section-padding"},Ce={__name:"create",async setup(ve){let n,y;const A=pe(),L=ue(),R=ee(),{t:x}=ae(),z=te(),{user:u}=oe(z),g=F(()=>{var a,l;return!!((l=(a=u==null?void 0:u.value.user)==null?void 0:a.modules)!=null&&l.includes(ce.WAREHOUSE.CREATE))}),t=K({materialId:[],quantity:""}),D=F(()=>({materialId:{required:W},quantity:{required:W}})),o=de(D,t),{data:O,isSuccess:P,isLoading:Q}=([n,y]=re(()=>_e({queryKey:["materialsList",{organizationId:u.value.user.organizationId}],queryFn:()=>ie(),enabled:g})),n=await n,y(),n),j=K([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:O,success:P,loading:Q,select:!0},{id:2,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),{mutate:G}=he({onMutate:a=>{a.materialId=a.materialId[0]},mutationFn:a=>me("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(t.value=le(t.value),A.invalidateQueries({queryKey:["warehouse"]}),L.push(N.WAREHOUSE.path),setTimeout(()=>R.success(x("createToast")),150))}}),J=()=>{if(o.value.$validate(),o.value.$errors.length)return;const a={...t.value};G(a),o.value.$reset()};return(a,l)=>{var v,$;const X=c("ManageHead"),Y=c("FormInput"),Z=c("FormSelect"),f=c("CustomButton");return g.value?(s(),i("section",ye,[U("div",ge,[B(X,{title:"addNewProductTitle",to:r(N).WAREHOUSE.path},null,8,["to"]),U("form",{class:"manage__form form-manage",onSubmit:se(J,["prevent"])},[(s(!0),i(H,null,ne(j.value,e=>{var E,S,V,q,w,C,I,M,b,k;return s(),i(H,{key:e.id},[e!=null&&e.select?p("",!0):(s(),T(Y,{key:0,modelValue:t.value[e.model],"onUpdate:modelValue":m=>t.value[e.model]=m,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(S=(E=r(o))==null?void 0:E[e.errorKey])==null?void 0:S.$error,textError:(w=(q=(V=r(o))==null?void 0:V[e.errorKey])==null?void 0:q.$errors[0])==null?void 0:w.$message},{default:d(()=>[h(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(s(),T(Z,{key:1,modelValue:t.value[e.model],"onUpdate:modelValue":m=>t.value[e.model]=m,modelModifiers:{trim:!0},width:500,options:e.options,error:(I=(C=r(o))==null?void 0:C[e==null?void 0:e.errorKey])==null?void 0:I.$error,placeholder:e==null?void 0:e.placeholder,textError:(k=(b=(M=r(o))==null?void 0:M[e==null?void 0:e.errorKey])==null?void 0:b.$errors[0])==null?void 0:k.$message,success:e.success,loading:e.loading},{default:d(()=>[h(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):p("",!0)],64)}),128)),B(f,{className:`form__submit ${($=(v=r(o))==null?void 0:v.quantity.$errors[0])!=null&&$.$message?"centered":""}`},{default:d(()=>[h(_(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):p("",!0)}}};export{Ce as default};
