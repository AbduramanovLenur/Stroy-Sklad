import{u as ae,a as te,b as oe,y as re,c as F,r as K,z as se,d as i,e as U,k as B,h as r,w as ne,F as H,C as ue,D as d,i as p,l as ce,m as c,o as s,s as N,A as T,f as h,t as _,H as le,E as me}from"./index-qYaOSAk5.js";import{c as ie}from"./crud.services-6H1cbtzh.js";import{j as de}from"./manual.services-e5QN_9-o.js";import{u as pe,r as W}from"./i18n-validators-FA-njMbI.js";import{a as he,u as _e}from"./generic.services-uSp9rJcx.js";import{u as ye}from"./useQuery-3KlBkAoQ.js";const ge={key:0,class:"manage section-height shadowed"},ve={class:"manage__inner section-padding"},Ce={__name:"create",async setup($e){let n,y;const A=he(),L=ce(),R=ae(),{t:x}=te(),z=oe(),{user:u}=re(z),g=F(()=>{var a,l;return!!((l=(a=u==null?void 0:u.value.user)==null?void 0:a.modules)!=null&&l.includes(le.WAREHOUSE.CREATE))}),t=K({materialId:[],quantity:""}),D=F(()=>({materialId:{required:W},quantity:{required:W}})),o=pe(D,t),{data:O,isSuccess:P,isLoading:Q}=([n,y]=se(()=>ye({queryKey:["materialsList",{organizationId:u.value.user.organizationId}],queryFn:()=>de(),enabled:g})),n=await n,y(),n),j=K([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:O,success:P,loading:Q,select:!0},{id:2,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),{mutate:G,status:J}=_e({onMutate:a=>{a.materialId=a.materialId[0]},mutationFn:a=>ie("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(t.value=me(t.value),A.invalidateQueries({queryKey:["warehouse"]}),L.push(N.WAREHOUSE.path),setTimeout(()=>R.success(x("createToast")),150))}}),X=()=>{if(o.value.$validate(),o.value.$errors.length)return;const a={...t.value};G(a),o.value.$reset()};return(a,l)=>{var v,$;const Y=c("ManageHead"),Z=c("FormInput"),f=c("FormSelect"),ee=c("CustomButton");return g.value?(s(),i("section",ge,[U("div",ve,[B(Y,{title:"addNewProductTitle",to:r(N).WAREHOUSE.path},null,8,["to"]),U("form",{class:"manage__form form-manage",onSubmit:ne(X,["prevent"])},[(s(!0),i(H,null,ue(j.value,e=>{var E,S,V,b,q,w,C,I,M,k;return s(),i(H,{key:e.id},[e!=null&&e.select?p("",!0):(s(),T(Z,{key:0,modelValue:t.value[e.model],"onUpdate:modelValue":m=>t.value[e.model]=m,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(S=(E=r(o))==null?void 0:E[e.errorKey])==null?void 0:S.$error,textError:(q=(b=(V=r(o))==null?void 0:V[e.errorKey])==null?void 0:b.$errors[0])==null?void 0:q.$message},{default:d(()=>[h(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(s(),T(f,{key:1,modelValue:t.value[e.model],"onUpdate:modelValue":m=>t.value[e.model]=m,modelModifiers:{trim:!0},width:500,options:e.options,error:(C=(w=r(o))==null?void 0:w[e==null?void 0:e.errorKey])==null?void 0:C.$error,placeholder:e==null?void 0:e.placeholder,textError:(k=(M=(I=r(o))==null?void 0:I[e==null?void 0:e.errorKey])==null?void 0:M.$errors[0])==null?void 0:k.$message,success:e.success,loading:e.loading},{default:d(()=>[h(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):p("",!0)],64)}),128)),B(ee,{className:`form__submit ${($=(v=r(o))==null?void 0:v.quantity.$errors[0])!=null&&$.$message?"centered":""}`,disabled:r(J)==="pending"},{default:d(()=>[h(_(a.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):p("",!0)}}};export{Ce as default};
