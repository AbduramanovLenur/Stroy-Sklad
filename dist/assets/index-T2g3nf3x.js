import{g as J,d as Y}from"./crud.services-j9N-rseG.js";import{u as Z,a as ee,x as se,y as I,b as te,c as ae,r as X,z as oe,d as q,e as ne,k as L,A as ie,h as e,B as R,i as c,t as V,m as l,o as d,f as re,s as H,H as p}from"./index-QWM1teQg.js";import{u as ue}from"./generic.services-gfDTK8oT.js";import{u as ce}from"./useQuery-53-aSZRv.js";import{u as le}from"./useMutation-qCLal6Gk.js";import{r as de}from"./index-VIb5IjJC.js";const pe={key:0,class:"expenses"},me={class:"expenses__inner section-padding"},he={key:2,class:"empty-table shadowed"},fe={__name:"index",async setup(_e){let n,E;const S=ue(),Q=Z(),{t:z}=ee(),F=se(),{page:m,limit:h,search:K}=I(F),M=te(),{user:t}=I(M),x=ae(()=>{var s,a;return!!((a=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)!=null&&a.includes(p.EXPENS.READ))}),y=X(""),b=de(K,500),U=X([{id:1,label:"expensesObjectName",width:15},{id:2,label:"expensesBlockName",width:15},{id:3,label:"expensesFloorName",width:10},{id:5,label:"expensesMaterial",width:25},{id:6,label:"expensesCount",width:10},{id:7,label:"expensesType",width:30}]),{data:i,isLoading:O,isSuccess:_,isError:W}=([n,E]=oe(()=>ce({queryKey:["expenses",{page:m,limit:h,debouncedSearch:b,organizationId:t.value.user.organizationId,name:t.value.user.fullName}],queryFn:()=>J("expense",m.value,h.value,b.value),select:({expenses:s,count:a})=>{let o=[...s];return o=o.map(r=>{const u={...r,expensPrice:r.price};return delete u.price,u}),{expenses:o,count:a}},enabled:x})),n=await n,E(),n),{mutate:$}=le({mutationFn:s=>Y("expense",s),onSuccess:s=>{s!=null&&s.success&&(S.invalidateQueries({queryKey:["expenses"]}),S.invalidateQueries({queryKey:["expensById",y]}),setTimeout(()=>Q.success(z("deleteToast")),150))}}),j=async s=>{y.value=s,$(s)};return(s,a)=>{var w,f,T,g,v,N,C,P,k,D,B,A;const o=l("HeadPage"),r=l("Table"),u=l("Pagination"),G=l("Spinner");return x.value?(d(),q("section",pe,[ne("div",me,[L(o,{title:"expensesTitle",to:e(H).CREATE_EXPENS.path,isShowCreate:(T=(f=(w=e(t))==null?void 0:w.user)==null?void 0:f.modules)==null?void 0:T.includes(e(p).EXPENS.CREATE)},{default:ie(()=>[re(V(s.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),e(_)&&((g=e(i))!=null&&g.count)?(d(),R(r,{key:0,headers:U.value,table:(v=e(i))==null?void 0:v.expenses,to:e(H).VIEW_EXPENS.name,options:{page:e(m),limit:e(h)},isShowUpdate:(P=(C=(N=e(t))==null?void 0:N.user)==null?void 0:C.modules)==null?void 0:P.includes(e(p).EXPENS.READ),isShowDelete:(B=(D=(k=e(t))==null?void 0:k.user)==null?void 0:D.modules)==null?void 0:B.includes(e(p).EXPENS.DELETE),isShowEye:!0,onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):c("",!0),L(u,{count:(A=e(i))==null?void 0:A.count,isSucces:e(_)},null,8,["count","isSucces"]),e(O)?(d(),R(G,{key:1})):c("",!0),e(_)&&!e(i).count||e(W)?(d(),q("div",he,V(s.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}};export{fe as default};
