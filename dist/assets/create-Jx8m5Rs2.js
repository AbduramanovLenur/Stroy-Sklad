import{_ as re,u as de,a as ie,r as b,c,B as ne,m as v,o as n,d as A,e as T,t as g,F as w,C as O,z as K,D as k,f as V,k as C,J as ze,q as De,b as Re,x as xe,y as S,h as m,w as Ge,i as te,l as He,A as se,G as Qe,I as x}from"./index-sKMtYVf1.js";import{u as Je,r as L}from"./i18n-validators-UluQ0_Lr.js";import{a as We,u as Xe}from"./generic.services-Y9l1kbCB.js";import{u as $}from"./useQuery-oNoZrsai.js";import{c as Ye}from"./crud.services-OfzCCZDD.js";import{e as Ze,f as ea,g as aa,h as oa,i as la,j as ta}from"./manual.services-XDT6etPx.js";import{v as sa}from"./v4-yQnnJER4.js";const ra={class:"application-form"},da={class:"application-form__title"},ia={class:"application-form__overlay form-manage"},na={__name:"ApplicationForm",props:["selects","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(P,{emit:o}){const d=de(),{t:j}=ie(),q=P,N=o,r=b({floorId:[],costId:[],constructionMaterialId:[],count:"",price:""}),U=c(()=>q.buildingBlockId);ne(U,()=>{r.value.floorId=[]});const p=b([{id:1,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"},{id:2,model:"price",label:"priceAppLabel",placeholder:"priceAppPlaceholder",icon:"money"}]),M=()=>{if(!ze(r.value)){d.error(j("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count,price:r.value.price},N("onAddTable",r.value),r.value=De(r.value)};return(u,G)=>{const s=v("FormSelect"),z=v("FormInput"),i=v("CustomButton");return n(),A("div",ra,[T("h4",da,g(u.$t("appInfo")),1),T("div",ia,[(n(!0),A(w,null,O(P.selects,l=>(n(),K(s,{key:l.id,modelValue:r.value[l.model],"onUpdate:modelValue":B=>r.value[l.model]=B,width:500,options:l.options,placeholder:l==null?void 0:l.placeholder,success:l.success,loading:l.loading,isMultiSelect:l==null?void 0:l.multiple},{default:k(()=>[V(g(u.$t(l.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128)),(n(!0),A(w,null,O(p.value,l=>(n(),K(z,{key:l.id,modelValue:r.value[l.model],"onUpdate:modelValue":B=>r.value[l.model]=B,width:500,placeholder:u.$t(l.placeholder),name:l.icon,type:l==null?void 0:l.type},{default:k(()=>[V(g(u.$t(l.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),C(i,{className:"form__submit",type:"button",onClick:M},{default:k(()=>[V(g(u.$t("addButtonForm")),1)]),_:1})])])}}},ca=re(na,[["__scopeId","data-v-45cd5d2b"]]),ua={key:0,class:"manage section-height shadowed"},pa={class:"manage__inner section-padding"},ma={class:"manage__overlay"},ba={key:0,class:"error"},va={__name:"create",async setup(P){let o,d;const j=We(),q=He(),N=de(),{t:r}=ie(),U=Re(),{user:p}=xe(U),M=c(()=>{var a,t;return!!((t=(a=p==null?void 0:p.value.user)==null?void 0:a.modules)!=null&&t.includes(Qe.APPLICATION.CREATE))}),u=b(!1),G=b([{id:1,label:"appFloor",width:215},{id:2,label:"appMaterial",width:290},{id:3,label:"appCount",width:250},{id:4,label:"appPrice",width:300},{id:5,label:"appCost"}]),s=b({deadline:"",buildingObjectId:[],buildingBlockId:[],roleIds:[],createApplicationTables:[],details:""}),z=c(()=>({deadline:{required:L},buildingObjectId:{required:L},buildingBlockId:{required:L},roleIds:{required:L},createApplicationTables:{required:L},details:{required:L}})),i=Je(z,s),{data:l,isSuccess:B,isLoading:ce}=([o,d]=S(()=>$({queryKey:["rolesList",{organizationId:p.value.user.organizationId}],queryFn:()=>Ze(),enabled:M})),o=await o,d(),o),{data:ue,isSuccess:pe,isLoading:me}=([o,d]=S(()=>$({queryKey:["objectsList",{organizationId:p.value.user.organizationId}],queryFn:()=>ea(),enabled:M})),o=await o,d(),o),E=c(()=>s.value.buildingObjectId),be=c(()=>!!E.value.length);ne(E,()=>{u.value||(s.value.buildingBlockId=[])},{immediate:!0});const{data:ve,isSuccess:ge,isLoading:he}=([o,d]=S(()=>$({queryKey:["blocksList",{blockId:E}],queryFn:()=>la(E.value),enabled:be})),o=await o,d(),o),D=c(()=>s.value.buildingBlockId),R=c(()=>!!D.value.length),{data:H,isSuccess:Ie,isLoading:_e}=([o,d]=S(()=>$({queryKey:["floorsList",{floorId:D}],queryFn:()=>ta(D.value),enabled:R})),o=await o,d(),o),{data:Q,isSuccess:ye,isLoading:fe}=([o,d]=S(()=>$({queryKey:["costsList",{organizationId:p.value.user.organizationId}],queryFn:()=>aa(),enabled:R})),o=await o,d(),o),{data:J,isSuccess:Ae,isLoading:ke}=([o,d]=S(()=>$({queryKey:["materialsList",{organizationId:p.value.user.organizationId}],queryFn:()=>oa(),enabled:R})),o=await o,d(),o),Ve=b([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),Se=b([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:ue,success:pe,loading:me},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:ve,success:ge,loading:he},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:l,success:B,loading:ce,multiple:!0}]),Le=b([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:H,success:Ie,loading:_e},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:Q,success:ye,loading:fe},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:J,success:Ae,loading:ke}]),$e=b([{id:1,model:"details",label:"appCommentLabel",placeholder:"appCommentPlaceholder",errorKey:"details"}]),W=c(()=>x(H.value)),X=c(()=>x(Q.value)),Y=c(()=>x(J.value)),Me=a=>{var t;return(t=W.value[a.floorId])==null?void 0:t.name},Be=a=>{var t;return(t=X.value[a.costId])==null?void 0:t.name},Fe=a=>{var t;return(t=Y.value[a==null?void 0:a.constructionMaterialId])==null?void 0:t.name},Ce=c(()=>Object.keys(W.value).length&&Object.keys(X.value).length&&Object.keys(Y.value).length),Te=a=>{if(Ce){s.value.createApplicationTables.push({...a,delId:sa(),floorValue:Me(a),costValue:Be(a),constructionMaterialValue:Fe(a)});return}N.error(r("estimateEmptyData"))},we=a=>{s.value.createApplicationTables=s.value.createApplicationTables.filter(t=>t.delId!==a)},{mutate:Oe}=Xe({onMutate:a=>{u.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.createApplicationTables=a.createApplicationTables.map(t=>(delete t.delId,delete t.floorValue,delete t.costValue,delete t.constructionMaterialValue,t))},mutationFn:a=>Ye("application",a),onSuccess:()=>{j.invalidateQueries({queryKey:["applications"]}),q.push(se.APPLICATION.path)}}),Ke=()=>{i.value.$validate(),!i.value.$errors.length&&(Oe(s.value),i.value.$reset())};return(a,t)=>{var Z,ee,ae,oe,le;const Ee=v("ManageHead"),Pe=v("FormInput"),je=v("FormSelect"),qe=v("SubTable"),Ne=v("FormTextarea"),Ue=v("CustomButton");return M.value?(n(),A("section",ua,[T("div",pa,[C(Ee,{title:"addNewApplicationTitle",to:m(se).APPLICATION.path},null,8,["to"]),T("form",{class:"manage__form",onSubmit:Ge(Ke,["prevent"])},[T("div",ma,[(n(!0),A(w,null,O(Ve.value,e=>{var h,I,_,y,f;return n(),K(Pe,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":F=>s.value[e.model]=F,modelModifiers:{trim:!0},width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(I=(h=m(i))==null?void 0:h[e.errorKey])==null?void 0:I.$error,textError:(f=(y=(_=m(i))==null?void 0:_[e.errorKey])==null?void 0:y.$errors[0])==null?void 0:f.$message,type:e==null?void 0:e.type},{default:k(()=>[V(g(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(n(!0),A(w,null,O(Se.value,e=>{var h,I,_,y,f;return n(),K(je,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":F=>s.value[e.model]=F,modelModifiers:{trim:!0},width:500,options:e.options,error:(I=(h=m(i))==null?void 0:h[e==null?void 0:e.errorKey])==null?void 0:I.$error,placeholder:e==null?void 0:e.placeholder,textError:(f=(y=(_=m(i))==null?void 0:_[e==null?void 0:e.errorKey])==null?void 0:y.$errors[0])==null?void 0:f.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:k(()=>[V(g(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128))]),C(ca,{selects:Le.value,buildingBlockId:s.value.buildingBlockId,isSubmit:u.value,onOnAddTable:Te},null,8,["selects","buildingBlockId","isSubmit"]),(ee=(Z=m(i))==null?void 0:Z.createApplicationTables)!=null&&ee.$error?(n(),A("span",ba,g((le=(oe=(ae=m(i))==null?void 0:ae.createApplicationTables)==null?void 0:oe.$errors[0])==null?void 0:le.$message),1)):te("",!0),C(qe,{headers:G.value,table:s.value.createApplicationTables,onOnActionDelete:we,isShowDelete:!0},null,8,["headers","table"]),(n(!0),A(w,null,O($e.value,e=>{var h,I,_,y,f;return n(),K(Ne,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":F=>s.value[e.model]=F,modelModifiers:{trim:!0},width:500,placeholder:a.$t(e.placeholder),error:(I=(h=m(i))==null?void 0:h[e.errorKey])==null?void 0:I.$error,textError:(f=(y=(_=m(i))==null?void 0:_[e.errorKey])==null?void 0:y.$errors[0])==null?void 0:f.$message},{default:k(()=>[V(g(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","error","textError"])}),128)),C(Ue,{className:"manage__submit"},{default:k(()=>[V(g(a.$t("appButton")),1)]),_:1})],32)])])):te("",!0)}}},ka=re(va,[["__scopeId","data-v-456f1fc2"]]);export{ka as default};
//# sourceMappingURL=create-Jx8m5Rs2.js.map
