import{u as ge,a as be,r,z as d,c as g,y as F,d as K,e as O,k as ve,h as b,w as ye,F as w,C,l as he,E as fe,m as j,o as v,B as A,A as $,D as V,f as P,t as E}from"./index-8f2nY-tA.js";import{u as ke,r as t}from"./i18n-validators-fCwa1ZSs.js";import{a as _e,u as Be}from"./generic.services-2-3LJT-B.js";import{u as n}from"./useQuery-eGcy0OjN.js";import{a as Le,u as Se}from"./crud.services-swolhUoO.js";import{f as Fe,j as Ke,k as je,i as Ae,h as qe,d as Me}from"./manual.services-mSBZeXJB.js";const Oe={class:"manage section-height shadowed"},we={class:"manage__inner section-padding"},Ne={__name:"update",async setup(Ce){let o,s;const q=_e(),M=he(),R=fe();ge(),be();const f=r(R.params.id),k=r(localStorage.getItem("organizationId")),_=r(!1),B=r(!1),L=r(!1),l=r({userId:"",deadline:"",constructionMaterialIds:[],buildingObjectId:[],buildingBlockId:[],floorId:[],costId:[],roleIds:[]}),{data:x,isSuccess:G,isLoading:N}=([o,s]=d(()=>n({queryKey:["objectsList",{organizationId:k}],queryFn:()=>Fe()})),o=await o,s(),o),y=g(()=>l.value.buildingObjectId),T=g(()=>!!y.value.length);F(y,a=>{!B.value&&!_.value&&(l.value.buildingBlockId=[]),B.value=!1},{immediate:!0});const{data:D,isSuccess:H,isLoading:Q}=([o,s]=d(()=>n({queryKey:["blocksList",{blockId:y}],queryFn:()=>Ke(y.value),enabled:T})),o=await o,s(),o),h=g(()=>l.value.buildingBlockId),U=g(()=>!!h.value.length);F(h,a=>{!L.value&&!_.value&&(l.value.floorId=[]),L.value=!1},{immediate:!0});const{data:z,isSuccess:W,isLoading:J}=([o,s]=d(()=>n({queryKey:["floors",{floorId:h}],queryFn:()=>je(h.value),enabled:U})),o=await o,s(),o),{data:X,isSuccess:Y,isLoading:Z}=([o,s]=d(()=>n({queryKey:["costs",{organizationId:k}],queryFn:()=>Ae()})),o=await o,s(),o),{data:ee,isSuccess:oe,isLoading:ae}=([o,s]=d(()=>n({queryKey:["materials",{organizationId:k}],queryFn:()=>qe()})),o=await o,s(),o),{data:le,isSuccess:se,isLoading:re}=([o,s]=d(()=>n({queryKey:["roles"],queryFn:()=>Me()})),o=await o,s(),o),te=g(()=>({userId:{required:t},deadline:{required:t},constructionMaterialIds:{required:t},buildingObjectId:{required:t},buildingBlockId:{required:t},floorId:{required:t},costId:{required:t},roleIds:{required:t}})),i=ke(te,l),ie=r([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),de=r([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:x,success:G,loading:N},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:D,success:H,loading:Q},{id:3,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",errorKey:"floorId",options:z,success:W,loading:J},{id:4,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",errorKey:"costId",options:X,success:Y,loading:Z},{id:5,model:"constructionMaterialIds",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",errorKey:"constructionMaterialIds",options:ee,success:oe,loading:ae,multiple:!0},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:le,success:se,loading:re,multiple:!0}]),{isError:ne}=([o,s]=d(()=>n({queryKey:["applicationsById",f],queryFn:()=>Le("application",f.value),select:a=>{l.value.id=a.id,l.value.userId=a.userId,l.value.deadline=a.deadline,l.value.constructionMaterialIds=[...a.constructionMaterialIds],l.value.buildingObjectId=[a.buildingObjectId],l.value.buildingBlockId=[a.buildingBlockId],l.value.floorId=[a.floorId],l.value.costId=[a.costId],l.value.roleIds=[...a.roleIds],B.value=!0,L.value=!0}})),o=await o,s(),o);F(ne,a=>{a&&M.push(A.HOME.path)});const{mutate:ue}=Be({onMutate:a=>{_.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.floorId=a.floorId[0],a.costId=a.costId[0]},mutationFn:a=>Se("application",a),onSuccess:()=>{q.invalidateQueries({queryKey:["applications"]}),q.invalidateQueries({queryKey:["applicationsById",f]}),M.push(A.APPLICATIONS.path)}}),ce=async()=>{i.value.$validate(),!i.value.$errors.length&&(ue(l.value),i.value.$reset())};return(a,$e)=>{const pe=j("ManageHead"),me=j("FormInput"),Ie=j("FormSelect");return v(),K("section",Oe,[O("div",we,[ve(pe,{title:"editApplicationTitle",to:b(A).APPLICATIONS.path},null,8,["to"]),O("form",{class:"manage__form form-manage",onSubmit:ye(ce,["prevent"])},[(v(!0),K(w,null,C(ie.value,e=>{var u,c,p,m,I;return v(),$(me,{key:e.id,modelValue:l.value[e.model],"onUpdate:modelValue":S=>l.value[e.model]=S,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(c=(u=b(i))==null?void 0:u[e.errorKey])==null?void 0:c.$error,textError:(I=(m=(p=b(i))==null?void 0:p[e.errorKey])==null?void 0:m.$errors[0])==null?void 0:I.$message,type:e==null?void 0:e.type,isDisabled:!0},{default:V(()=>[P(E(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(v(!0),K(w,null,C(de.value,e=>{var u,c,p,m,I;return v(),$(Ie,{key:e.id,modelValue:l.value[e.model],"onUpdate:modelValue":S=>l.value[e.model]=S,width:500,options:e.options,error:(c=(u=b(i))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:c.$error,placeholder:e==null?void 0:e.placeholder,textError:(I=(m=(p=b(i))==null?void 0:p[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:I.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple,isDisabled:!0},{default:V(()=>[P(E(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128))],32)])])}}};export{Ne as default};
//# sourceMappingURL=update-AB4PfCQ2.js.map
