import{_ as Z,u as j,a as x,b as ee,y as te,c as g,r as oe,z as q,d,e as i,k as m,A as y,h as f,w as se,F as ae,D as ne,B as le,i as h,l as ie,m as _,o as r,f as A,t as E,s as re,H as I}from"./index-qUiWQIQ6.js";import{u as ue}from"./generic.services-8Di1lKyZ.js";import{u as V}from"./useQuery-Kymga6PU.js";import{u as ce}from"./useMutation-ZRy4kEQe.js";import{j as de,k as me}from"./crud.services-CGVkA17z.js";import{e as _e}from"./manual.services-bydibDWF.js";import{v as u}from"./v4-yQnnJER4.js";const pe={key:0,class:"management-role section-height shadowed"},ve={class:"management-role__inner section-padding"},ge={class:"management-role__head"},ye={class:"management-role__selects"},fe={class:"management-role__select-box"},he={class:"management-role__actions"},Ae=["onClick"],Ee=["onClick"],Ie={__name:"management-role",async setup(Me){let l,p;const M=ue();ie();const T=j(),{t:b}=x(),F=ee(),{user:s}=te(F),k=g(()=>{var e,t;return(t=(e=s==null?void 0:s.value.user)==null?void 0:e.modules)==null?void 0:t.includes(I.MANAGEMENT_ROLE.READ)}),N=g(()=>{var e,t,o,n;return((t=(e=s==null?void 0:s.value.user)==null?void 0:e.modules)==null?void 0:t.includes(I.MANAGEMENT_ROLE.CREATE))||((n=(o=s==null?void 0:s.value.user)==null?void 0:o.modules)==null?void 0:n.includes(I.MANAGEMENT_ROLE.UPDATE))}),a=oe([{uuid:u(),roleIds:[],label:"creatorApp"},{uuid:u(),roleIds:[],label:"confirmApp"}]),{data:G,isSuccess:z,isLoading:D}=([l,p]=q(()=>V({queryKey:["rolesList",{organizationId:s.value.user.organizationId}],queryFn:()=>_e(),enabled:k})),l=await l,p(),l),{data:ke,isSuccess:K,isLoading:P}=([l,p]=q(()=>V({queryKey:["positions",{organizationId:s.value.user.organizationId}],queryFn:()=>de("application_position"),select:e=>{if(e.length)return a.value=e.map((t,o)=>{let n={};return o===0?n={id:t.id,uuid:u(),roleIds:[...t.roleIds],label:"creatorApp"}:o+1===e.length?n={id:t.id,uuid:u(),roleIds:[...t.roleIds],label:"confirmApp"}:n={id:t.id,uuid:u(),roleIds:[...t.roleIds],label:"inspectorApp"},n}),e},enabled:k})),l=await l,p(),l),Q=g(()=>z.value&&K.value),O=g(()=>D.value&&P.value),U=e=>{a.value.splice(e,0,{uuid:u(),roleIds:[],label:"inspectorApp"})},$=e=>a.value.splice(e,1),{mutate:H}=ce({onMutate:e=>{e=e.map(t=>{const o={...t};return o==null||delete o.uuid,o==null||delete o.label,o})},mutationFn:e=>me("application_position",e),onSuccess:e=>{e!=null&&e.success&&(M.invalidateQueries({queryKey:["positions"]}),M.invalidateQueries({queryKey:["applications"]}),M.invalidateQueries({queryKey:["applicationsById"]}),setTimeout(()=>T.success(b("createToast")),150))}}),J=()=>{if(a.value.some(t=>!t.roleIds.length)){T.error(b("isEmptyRole"));return}console.log(a.value),H(a.value)};return(e,t)=>{const o=_("Title"),n=_("MyButton"),W=_("FormSelect"),R=_("Icon"),X=_("CustomButton");return k.value?(r(),d("section",pe,[i("div",ve,[i("div",ge,[m(o,null,{default:y(()=>[A(`\r
                    `+E(e.$t("managementTitle"))+`\r
                `,1)]),_:1}),m(n,{to:f(re).MANAGEMENT.path,icon:"back",type:"link",color:"black"},{default:y(()=>[A(E(e.$t("backButton")),1)]),_:1},8,["to"])]),i("form",{class:"management-role__form",onSubmit:se(J,["prevent"])},[i("div",ye,[(r(!0),d(ae,null,ne(a.value,(v,c)=>{var S,C,B,L,w;return r(),d("div",{class:"management-role__select",key:v.uuid},[i("div",fe,[m(W,{modelValue:v.roleIds,"onUpdate:modelValue":Y=>v.roleIds=Y,modelModifiers:{trim:!0},width:500,options:f(G),placeholder:"managementRolePlaceholder",success:Q.value,loading:O.value,isMultiSelect:!0},{default:y(()=>[A(E(e.$t(v.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","success","loading"])]),i("div",he,[c+1!==((S=a.value)==null?void 0:S.length)&&N.value?(r(),d("div",{key:0,class:"management-role__icon",onClick:()=>U(c+1)},[m(R,{name:"plus"})],8,Ae)):h("",!0),c!==0&&c+1!==((C=a.value)==null?void 0:C.length)&&((w=(L=(B=f(s))==null?void 0:B.user)==null?void 0:L.modules)!=null&&w.includes(f(I).MANAGEMENT_ROLE.DELETE))?(r(),d("div",{key:1,class:"management-role__icon",onClick:()=>$(c)},[m(R,{name:"delete-role"})],8,Ee)):h("",!0)])])}),128))]),N.value?(r(),le(X,{key:0,className:"form__submit"},{default:y(()=>[A(E(e.$t("formButton")),1)]),_:1})):h("",!0)],32)])])):h("",!0)}}},Le=Z(Ie,[["__scopeId","data-v-229c76cd"]]);export{Le as default};
