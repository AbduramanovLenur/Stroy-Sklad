import{u as Ie,a as he,r as d,b as fe,y as ve,c as y,z as I,B as E,d as K,e as M,k as P,h as i,w as pe,F as R,C as D,D as S,i as ye,l as _e,G as ke,m as _,o as h,s as $,A as T,f as q,t as w,H as Fe,E as Oe}from"./index-VgBwKPk7.js";import{u as Le,r as t}from"./i18n-validators-uSV-iEIu.js";import{a as Be,u as Ke}from"./generic.services-7eNzkFTP.js";import{u as f}from"./useQuery-2gfhWntW.js";import{a as Se,u as $e}from"./crud.services-uT7UuOOz.js";import{f as qe,m as we,a as je,b as Ce}from"./manual.services-C_1Eo4kj.js";const Ve={key:0,class:"manage section-height shadowed"},Ne={class:"manage__inner section-padding"},xe={__name:"update",async setup(Ee){let o,r;const k=Be(),j=_e(),U=ke(),x=Ie(),{t:A}=he(),F=d(U.params.id),G=fe(),{user:v}=ve(G),n=y(()=>{var e,L;return!!((L=(e=v==null?void 0:v.value.user)==null?void 0:e.modules)!=null&&L.includes(Fe.BLOCK.UPDATE))}),C=d(!1),O=d(!1),a=d({id:"",fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[],stateId:[]}),H=y(()=>({id:{required:t},fullname:{required:t},numberOfFloors:{required:t},roomsOnFloor:{required:t},address:{required:t},buildingObjectId:{required:t},regionId:{required:t},districtId:{required:t},stateId:{required:t}})),l=Le(H,a),{data:Q,isSuccess:z,isLoading:W}=([o,r]=I(()=>f({queryKey:["regions"],queryFn:()=>we(),enabled:n})),o=await o,r(),o),p=y(()=>a.value.regionId),J=y(()=>!!p.value.length);E(p,()=>{!O.value&&!C.value&&(a.value.districtId=[]),O.value=!1},{immediate:!0});const{data:X,isSuccess:Y,isLoading:Z}=([o,r]=I(()=>f({queryKey:["districts",{districtId:p}],queryFn:()=>je(p.value),enabled:J})),o=await o,r(),o),{data:ee,isSuccess:se,isLoading:oe}=([o,r]=I(()=>f({queryKey:["objectsList",{organizationId:v.value.user.organizationId}],queryFn:()=>qe(),enabled:n})),o=await o,r(),o),{data:ae,isSuccess:re,isLoading:te}=([o,r]=I(()=>f({queryKey:["states"],queryFn:()=>Ce(),enabled:n})),o=await o,r(),o),le=d([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),de=d([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:ee,success:se,loading:oe},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:Q,success:z,loading:W},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:X,success:Y,loading:Z},{id:4,model:"stateId",label:"stateBlocksLabel",placeholder:"stateBlocksPlaceholder",errorKey:"stateId",options:ae,success:re,loading:te}]),{isError:ie}=([o,r]=I(()=>f({queryKey:["blocksById",F],queryFn:()=>Se("building_block",F.value),select:e=>{a.value.id=e.id,a.value.fullname=e.fullName,a.value.numberOfFloors=e.numberOfFloors,a.value.roomsOnFloor=e.roomsOnFloor,a.value.address=e.address,a.value.buildingObjectId=[e.buildingObjectId],a.value.regionId=[e.regionId],a.value.districtId=[e.districtId],a.value.stateId=[e.stateId],O.value=!0},enabled:n})),o=await o,r(),o);E(ie,e=>{e&&j.push($.HOME.path)});const{mutate:ne}=Ke({onMutate:e=>{C.value=!0,e.buildingObjectId=e.buildingObjectId[0],e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>$e("building_block",e),onSuccess:e=>{e!=null&&e.success&&(a.value=Oe(a.value),k.invalidateQueries({queryKey:["blocks"]}),k.invalidateQueries({queryKey:["blocksById",F]}),k.invalidateQueries({queryKey:["blocksList"]}),j.push($.BLOCK.path),setTimeout(()=>x.success(A("updateToast")),150))}}),ue=async()=>{if(l.value.$validate(),l.value.$errors.length)return;const e={...a.value};ne(e),l.value.$reset()};return(e,L)=>{var V,N;const ce=_("ManageHead"),me=_("FormInput"),be=_("FormSelect"),ge=_("CustomButton");return n.value?(h(),K("section",Ve,[M("div",Ne,[P(ce,{title:"editBlocksTitle",to:i($).BLOCK.path},null,8,["to"]),M("form",{class:"manage__form form-manage",onSubmit:pe(ue,["prevent"])},[(h(!0),K(R,null,D(le.value,s=>{var u,c,m,b,g;return h(),T(me,{key:s.id,modelValue:a.value[s.model],"onUpdate:modelValue":B=>a.value[s.model]=B,width:500,placeholder:e.$t(s.placeholder),name:s.icon,error:(c=(u=i(l))==null?void 0:u[s==null?void 0:s.errorKey])==null?void 0:c.$error,textError:(g=(b=(m=i(l))==null?void 0:m[s==null?void 0:s.errorKey])==null?void 0:b.$errors[0])==null?void 0:g.$message},{default:S(()=>[q(w(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(h(!0),K(R,null,D(de.value,s=>{var u,c,m,b,g;return h(),T(be,{key:s.id,modelValue:a.value[s.model],"onUpdate:modelValue":B=>a.value[s.model]=B,modelModifiers:{trim:!0},width:500,options:s.options,error:(c=(u=i(l))==null?void 0:u[s==null?void 0:s.errorKey])==null?void 0:c.$error,placeholder:s==null?void 0:s.placeholder,textError:(g=(b=(m=i(l))==null?void 0:m[s==null?void 0:s.errorKey])==null?void 0:b.$errors[0])==null?void 0:g.$message,success:s.success,loading:s.loading},{default:S(()=>[q(w(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),P(ge,{className:`form__submit ${(N=(V=i(l))==null?void 0:V.stateId.$errors[0])!=null&&N.$message?"centered":""}`},{default:S(()=>[q(w(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ye("",!0)}}};export{xe as default};
