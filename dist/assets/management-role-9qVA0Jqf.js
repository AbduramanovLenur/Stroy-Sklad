import{_ as O,u as J,a as W,b as X,x as Y,c as I,r as Z,y as M,d as m,e as i,k as r,D as v,h as E,w as j,F as x,C as ee,i as A,l as se,m as d,o as p,f as g,t as y,A as te,G as oe}from"./index--bVPgmc9.js";import{a as ae,u as ne}from"./generic.services-3AZ_16v5.js";import{u as R}from"./useQuery-KWqGbv1N.js";import{h as le,i as ie}from"./crud.services--2m-2OGJ.js";import{e as re}from"./manual.services-SHxMhgMQ.js";import{v as u}from"./v4-yQnnJER4.js";const ue={key:0,class:"management-role section-height shadowed"},ce={class:"management-role__inner section-padding"},me={class:"management-role__head"},de={class:"management-role__selects"},pe={class:"management-role__select-box"},_e={class:"management-role__actions"},ve=["onClick"],ge=["onClick"],ye={__name:"management-role",async setup(fe){let a,_;const f=ae();se();const B=J(),{t:w}=W(),N=X(),{user:c}=Y(N),h=I(()=>{var e,t;return!!((t=(e=c==null?void 0:c.value.user)==null?void 0:e.modules)!=null&&t.includes(oe.MANAGEMENT_ROLE.CREATE))}),o=Z([{uuid:u(),roleIds:[],label:"creatorApp"},{uuid:u(),roleIds:[],label:"confirmApp"}]),{data:T,isSuccess:q,isLoading:L}=([a,_]=M(()=>R({queryKey:["rolesList",{organizationId:c.value.user.organizationId}],queryFn:()=>re(),enabled:h})),a=await a,_(),a),{data:he,isSuccess:V,isLoading:F}=([a,_]=M(()=>R({queryKey:["positions",{organizationId:c.value.user.organizationId}],queryFn:()=>le("application_position"),select:e=>{if(e.length)return o.value=e.map((t,s)=>{let l={};return s===0?l={uuid:u(),roleIds:[...t.roleIds],label:"creatorApp"}:s+1===e.length?l={uuid:u(),roleIds:[...t.roleIds],label:"confirmApp"}:l={uuid:u(),roleIds:[...t.roleIds],label:"inspectorApp"},l}),e},enabled:h})),a=await a,_(),a),K=I(()=>q.value&&V.value),Q=I(()=>L.value&&F.value),z=e=>{o.value.splice(e,0,{uuid:u(),roleIds:[],label:"inspectorApp"})},G=e=>{o.value.splice(e,1)},{mutate:P}=ne({onMutate:e=>{e=e.map(t=>{const s={...t};return s==null||delete s.uuid,s==null||delete s.label,s})},mutationFn:e=>ie("application_position",e),onSuccess:()=>{f.invalidateQueries({queryKey:["positions"]}),f.invalidateQueries({queryKey:["applications"]}),f.invalidateQueries({queryKey:["applicationsById"]})}}),$=()=>{if(o.value.some(t=>!t.roleIds.length)){B.error(w("isEmptyRole"));return}P(o.value)};return(e,t)=>{const s=d("Title"),l=d("MyButton"),U=d("FormSelect"),b=d("Icon"),D=d("CustomButton");return h.value?(p(),m("section",ue,[i("div",ce,[i("div",me,[r(s,null,{default:v(()=>[g(`\r
                    `+y(e.$t("managementTitle"))+`\r
                `,1)]),_:1}),r(l,{to:E(te).MANAGEMENT.path,icon:"back",type:"link",color:"black"},{default:v(()=>[g(y(e.$t("backButton")),1)]),_:1},8,["to"])]),i("form",{class:"management-role__form",onSubmit:j($,["prevent"])},[i("div",de,[(p(!0),m(x,null,ee(o.value,(k,n)=>{var C,S;return p(),m("div",{class:"management-role__select",key:k.uuid},[i("div",pe,[r(U,{modelValue:o.value[n].roleIds,"onUpdate:modelValue":H=>o.value[n].roleIds=H,width:500,options:E(T),placeholder:"managementRolePlaceholder",success:K.value,loading:Q.value,isMultiSelect:!0},{default:v(()=>[g(y(e.$t(k.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","success","loading"])]),i("div",_e,[n+1!==((C=o.value)==null?void 0:C.length)?(p(),m("div",{key:0,class:"management-role__icon",onClick:()=>z(n+1)},[r(b,{name:"plus"})],8,ve)):A("",!0),n!==0&&n+1!==((S=o.value)==null?void 0:S.length)?(p(),m("div",{key:1,class:"management-role__icon",onClick:()=>G(n)},[r(b,{name:"delete-role"})],8,ge)):A("",!0)])])}),128))]),r(D,{className:"form__submit"},{default:v(()=>[g(y(e.$t("formButton")),1)]),_:1})],32)])])):A("",!0)}}},Me=O(ye,[["__scopeId","data-v-3876fd0f"]]);export{Me as default};
//# sourceMappingURL=management-role-9qVA0Jqf.js.map
