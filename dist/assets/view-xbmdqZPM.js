import{_ as ee,c,o as n,d as v,e as d,t as u,F as P,C as $,H as Ve,p as qe,n as Pe,u as $e,a as Ne,r as w,b as Ke,x as De,y as h,B as X,k as Y,h as p,w as Re,z as _,i as b,D as A,ag as Ee,l as He,E as ze,m as k,A as C,f as L,G as V,I as q}from"./index-PETUmaAP.js";import{a as Ue,u as Z}from"./generic.services-keg-kLkd.js";import{u as f}from"./useQuery-snUqoZeO.js";import{a as Qe,e as Ge,f as xe}from"./crud.services-B84SRtCm.js";import{f as We,g as Je,h as Xe,i as Ye,j as Ze}from"./manual.services-WXTEfgwA.js";const ea=I=>(qe("data-v-3492d9e9"),I=I(),Pe(),I),aa={class:"histories"},sa={class:"histories__label"},ta={class:"histories__list"},la={class:"histories__head"},oa={class:"histories__name"},ia={class:"histories__role-name"},na=ea(()=>d("div",{class:"histories__divider"}," - ",-1)),da={class:"histories__status"},ca={class:"histories__date"},ua={__name:"Histories",props:["histories"],setup(I){const s=c(()=>i=>{let m=new Date(i),a=m.toISOString().split("T")[0],M=m.toISOString().split("T")[1].split(".")[0];return`${a} ${M}`});return(i,m)=>(n(),v("div",aa,[d("div",sa,u(i.$t("historiesLabel")),1),d("ul",ta,[(n(!0),v(P,null,$(I.histories,a=>(n(),v("li",{key:a.id,class:"histories__item"},[d("div",{class:Ve(`histories__box ${(a==null?void 0:a.statusId)===1?"created":(a==null?void 0:a.statusId)===7?"accepted":(a==null?void 0:a.statusId)===20?"expected":(a==null?void 0:a.statusId)===15?"refused":""}`)},[d("div",la,[d("div",oa,u(a==null?void 0:a.userName),1),d("div",ia,u(a==null?void 0:a.role),1),na,d("div",da,u(a==null?void 0:a.status),1)]),d("div",ca,u(s.value(a==null?void 0:a.createdDate)),1)],2)]))),128))])]))}},ra=ee(ua,[["__scopeId","data-v-3492d9e9"]]),pa={key:0,class:"manage section-height shadowed"},ma={class:"manage__inner section-padding"},_a={class:"manage__overlay"},ba={key:3,class:"manage__triggers"},va={__name:"view",async setup(I){let s,i;const m=Ue(),a=He(),M=ze();$e(),Ne();const g=w(M.params.id),ae=Ke(),{user:r}=De(ae),O=c(()=>{var e,o;return!!((o=(e=r==null?void 0:r.value.user)==null?void 0:e.modules)!=null&&o.includes(V.APPLICATION.READ))}),se=w([{id:1,label:"appFloor",width:350},{id:2,label:"appMaterial",width:370},{id:3,label:"appCount",width:260},{id:4,label:"appPrice",width:350}]),t=w({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],applicationTables:[],details:"",statusId:"",allowedActionRoleIds:[],histories:[]}),{data:te,isSuccess:le,isLoading:oe}=([s,i]=h(()=>f({queryKey:["objectsList",{organizationId:r.value.user.organizationId}],queryFn:()=>We(),enabled:O})),s=await s,i(),s),B=c(()=>t.value.buildingObjectId),ie=c(()=>{var e;return!!((e=B.value)!=null&&e.length)}),{data:ne,isSuccess:de,isLoading:ce}=([s,i]=h(()=>f({queryKey:["blocksList",{blockId:B}],queryFn:()=>Ye(B.value),enabled:ie})),s=await s,i(),s),T=c(()=>t.value.buildingBlockId),y=c(()=>{var e;return!!((e=T.value)!=null&&e.length)}),{data:ue,isSuccess:re,isLoading:pe}=([s,i]=h(()=>f({queryKey:["floorsList",{floorId:T}],queryFn:()=>Ze(T.value),enabled:y})),s=await s,i(),s),{data:me,isSuccess:_e,isLoading:be}=([s,i]=h(()=>f({queryKey:["costsList",{organizationId:r.value.user.organizationId}],queryFn:()=>Je(),enabled:y})),s=await s,i(),s),{data:ve,isSuccess:Ie,isLoading:ge}=([s,i]=h(()=>f({queryKey:["materialsList",{organizationId:r.value.user.organizationId}],queryFn:()=>Xe(),enabled:y})),s=await s,i(),s),F=c(()=>{var e;return!!(_e&&Ie&&re&&((e=t.value.applicationTables)!=null&&e.length))}),he=w([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),ke=w([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:te,success:le,loading:oe},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:ne,success:de,loading:ce}]),{isError:fe}=([s,i]=h(()=>f({queryKey:["applicationsById",g],queryFn:()=>Qe("application",g.value),select:e=>{t.value.id=e.id,t.value.deadline=e.deadline,t.value.buildingObjectId=[e.buildingObjectId],t.value.buildingBlockId=[e.buildingBlockId],t.value.applicationTables=[...e.applicationTables],t.value.details=e.details,t.value.statusId=e.statusId,t.value.allowedActionRoleIds=e.allowedActionRoleIds,t.value.histories=e.applicationHistories},enabled:O})),s=await s,i(),s),N=c(()=>q(ue.value||[])),K=c(()=>q(me.value||[])),D=c(()=>q(ve.value||[])),Se=e=>{var o;return(o=N.value[e.floorId])==null?void 0:o.name},we=e=>{var o;return(o=K.value[e.costId])==null?void 0:o.name},Ae=e=>{var o;return(o=D.value[e==null?void 0:e.constructionMaterialId])==null?void 0:o.name},Le=c(()=>{var e,o,S;return((e=Object.keys(N.value))==null?void 0:e.length)&&((o=Object.keys(K.value))==null?void 0:o.length)&&((S=Object.keys(D.value))==null?void 0:S.length)});X(Le,e=>{e&&(t.value.applicationTables=t.value.applicationTables.map(o=>({...o,floorValue:Se(o),costValue:we(o),constructionMaterialValue:Ae(o)})))},{immediate:!0}),X(fe,e=>{e&&a.push(C.HOME.path)});const{mutate:Ce}=Z({mutationFn:e=>Ge("application",e),onSuccess:()=>{m.invalidateQueries({queryKey:["applications"]}),m.invalidateQueries({queryKey:["applicationsById",g]}),a.push(C.APPLICATION.path)}}),{mutate:Me}=Z({mutationFn:e=>xe("application",e),onSuccess:()=>{m.invalidateQueries({queryKey:["applications"]}),m.invalidateQueries({queryKey:["applicationsById",g]}),a.push(C.APPLICATION.path)}}),Oe=()=>{Ce(g.value)},Be=()=>{Me(g.value)};return(e,o)=>{var E,H,z,U,Q,G,x,W,J;const S=k("ManageHead"),Te=k("FormInput"),ye=k("FormSelect"),Fe=k("SubTable"),je=k("Spinner"),R=k("MyButton");return O.value?(n(),v("section",pa,[d("div",ma,[Y(S,{title:"addNewApplicationTitle",to:p(C).APPLICATION.path},null,8,["to"]),d("form",{class:"manage__form",onSubmit:o[1]||(o[1]=Re(()=>{},["prevent"]))},[d("div",_a,[(n(!0),v(P,null,$(he.value,l=>(n(),_(Te,{key:l.id,modelValue:t.value[l.model],"onUpdate:modelValue":j=>t.value[l.model]=j,width:500,placeholder:e.$t(l.placeholder),name:l.icon,type:l==null?void 0:l.type,isDisabled:!0},{default:A(()=>[L(u(e.$t(l.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),(n(!0),v(P,null,$(ke.value,l=>(n(),_(ye,{key:l.id,modelValue:t.value[l.model],"onUpdate:modelValue":j=>t.value[l.model]=j,width:500,options:l.options,placeholder:l==null?void 0:l.placeholder,success:l.success,loading:l.loading,isMultiSelect:l==null?void 0:l.multiple,isDisabled:!0},{default:A(()=>[L(u(e.$t(l.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128))]),F.value?(n(),_(Fe,{key:0,headers:se.value,table:t.value.applicationTables},null,8,["headers","table"])):b("",!0),p(be)||p(ge)||p(pe)||!((E=t.value.applicationTables)!=null&&E.length)?(n(),_(je,{key:1})):b("",!0),F.value?(n(),_(Ee,{key:2,modelValue:t.value.details,"onUpdate:modelValue":o[0]||(o[0]=l=>t.value.details=l),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),isDisabled:!0},{default:A(()=>[L(u(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder"])):b("",!0),F.value&&t.value.statusId!==7&&t.value.statusId!==15&&t.value.allowedActionRoleIds.includes((z=(H=p(r))==null?void 0:H.user)==null?void 0:z.roleId)?(n(),v("div",ba,[(G=(Q=(U=p(r))==null?void 0:U.user)==null?void 0:Q.modules)!=null&&G.includes(p(V).APPLICATION.CONFIRM)?(n(),_(R,{key:0,icon:"approve",type:"submit",color:"green",width:180,onClick:Be},{default:A(()=>[L(u(e.$t("acceptButton")),1)]),_:1})):b("",!0),(J=(W=(x=p(r))==null?void 0:x.user)==null?void 0:W.modules)!=null&&J.includes(p(V).APPLICATION.REFUSAL)?(n(),_(R,{key:1,icon:"refusal",type:"submit",color:"red",width:180,onClick:Oe},{default:A(()=>[L(u(e.$t("cancelButton")),1)]),_:1})):b("",!0)])):b("",!0)],32),Y(ra,{histories:t.value.histories},null,8,["histories"])])])):b("",!0)}}},Sa=ee(va,[["__scopeId","data-v-c1749edb"]]);export{Sa as default};
//# sourceMappingURL=view-xbmdqZPM.js.map
