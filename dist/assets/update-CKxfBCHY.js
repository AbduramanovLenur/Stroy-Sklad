import{u as he,a as ge,r as _,c as Ne,z as y,B as ve,d as b,e as Q,k as Ie,h as s,w as _e,F as Y,C as be,A as m,i as d,D as h,l as Re,G as $e,m as c,o as u,s as R,f as g,t as N,E as De}from"./index-Znn7x0w2.js";import{a as Me,u as Se}from"./crud.services-oovoAPUX.js";import{d as Ve,b as we,c as Ee}from"./manual.services-CtkFg6uR.js";import{u as Le,r}from"./i18n-validators-IvsyUnkI.js";import{a as ze,u as Ke}from"./generic.services-CuHvXiDr.js";import{u as v}from"./useQuery-n34yz_OD.js";const Pe={class:"manage section-height shadowed"},Fe={class:"manage__inner section-padding"},xe={__name:"update",async setup(qe){let t,n;const $=ze(),D=Re(),W=$e(),j=he(),{t:J}=ge(),I=_(W.params.id),a=_({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:[],updateRoleDto:{id:0,stateId:0,fullName:"OrgAdmin",shortName:"OrgAdmin",roleModules:[]},stateId:[]}),X=Ne(()=>({id:{required:r},fullName:{required:r},userName:{required:r},phoneNumber:{required:r},organizationId:{required:r},updateRoleDto:{id:{required:r},stateId:{required:r},fullName:{required:r},shortName:{required:r},roleModules:{required:r}},stateId:{required:r}})),l=Le(X,a),{data:Z,isSuccess:f,isLoading:ee}=([t,n]=y(()=>v({queryKey:["organizations"],queryFn:()=>Ve()})),t=await t,n(),t),{data:oe,isSuccess:ae,isLoading:te}=([t,n]=y(()=>v({queryKey:["states"],queryFn:()=>we()})),t=await t,n(),t),{data:se,isLoading:re,isSuccess:M}=([t,n]=y(()=>v({queryKey:["modules"],queryFn:()=>Ee()})),t=await t,n(),t),le=_([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"updateRoleDto.fullName"},{id:6,model:"organizationId",label:"employeesOrganizationLabel",placeholder:"employeesOrganizationPlaceholder",errorKey:"organizationId",options:Z,success:f,loading:ee,select:!0},{id:7,model:"stateId",label:"employeesStatePlaceholder",placeholder:"employeesStatePlaceholder",errorKey:"stateId",options:oe,success:ae,loading:te,select:!0}]),{isError:ue}=([t,n]=y(()=>v({queryKey:["employeeById",I],queryFn:()=>Me("user",I.value),select:o=>{console.log(o),a.value.id=o.id,a.value.fullName=o.fullName,a.value.userName=o.userName,a.value.phoneNumber=o.phoneNumber,a.value.organizationId=[o.organizationId],a.value.stateId=[o.stateId],a.value.updateRoleDto.id=o.role.id,a.value.updateRoleDto.stateId=o.role.stateId,a.value.updateRoleDto.shortName=o.role.shortName,a.value.updateRoleDto.fullName=o.role.fullName,a.value.updateRoleDto.roleModules=[...o.role.roleModules]}})),t=await t,n(),t);ve(ue,o=>{o&&D.push(R.HOME.path)});const{mutate:ne}=Ke({onMutate:o=>{o.organizationId=o.organizationId[0],o.stateId=o.stateId[0]},mutationFn:o=>Se("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=De(a.value),$.invalidateQueries({queryKey:["employees"]}),$.invalidateQueries({queryKey:["employeeById",I]}),D.push(R.EMPLOYEES.path),setTimeout(()=>j.success(J("updateToast")),150))}}),me=async()=>{if(a.value.updateRoleDto.shortName=a.value.updateRoleDto.fullName,l.value.$validate(),l.value.$errors.length)return;const o={...a.value};ne(o),l.value.$reset()};return(o,i)=>{var V,w;const de=c("ManageHead"),S=c("FormInput"),ce=c("FormSelect"),pe=c("ActionsModules"),ie=c("CustomButton"),ye=c("Spinner");return u(),b("section",Pe,[Q("div",Fe,[Ie(de,{title:"editEmployeesTitle",to:s(R).EMPLOYEES.path},null,8,["to"]),Q("form",{class:"manage__form form-manage",onSubmit:_e(me,["prevent"])},[(u(!0),b(Y,null,be(le.value,e=>{var E,L,z,K,P,F,q,k,B,O,C,A,U,x,T,G,H;return u(),b(Y,{key:e.id},[!(e!=null&&e.select)&&e.model!=="updateRoleDto.fullName"?(u(),m(S,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":p=>a.value[e.model]=p,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(L=(E=s(l))==null?void 0:E[e==null?void 0:e.errorKey])==null?void 0:L.$error,type:e==null?void 0:e.type,textError:(P=(K=(z=s(l))==null?void 0:z[e==null?void 0:e.errorKey])==null?void 0:K.$errors[0])==null?void 0:P.$message},{default:h(()=>[g(N(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])):d("",!0),!(e!=null&&e.select)&&e.model==="updateRoleDto.fullName"?(u(),m(S,{key:1,modelValue:a.value.updateRoleDto.fullName,"onUpdate:modelValue":i[0]||(i[0]=p=>a.value.updateRoleDto.fullName=p),width:500,placeholder:o.$t("employeesRolePlaceholder"),name:"person",error:(k=(q=(F=s(l))==null?void 0:F.updateRoleDto)==null?void 0:q.fullName)==null?void 0:k.$error,textError:(A=(C=(O=(B=s(l))==null?void 0:B.updateRoleDto)==null?void 0:O.fullName)==null?void 0:C.$errors[0])==null?void 0:A.$message},{default:h(()=>[g(N(o.$t("employeesRoleLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"])):d("",!0),e!=null&&e.select?(u(),m(ce,{key:2,modelValue:a.value[e.model],"onUpdate:modelValue":p=>a.value[e.model]=p,modelModifiers:{trim:!0},width:500,options:e.options,error:(x=(U=s(l))==null?void 0:U[e==null?void 0:e.errorKey])==null?void 0:x.$error,placeholder:e==null?void 0:e.placeholder,textError:(H=(G=(T=s(l))==null?void 0:T[e==null?void 0:e.errorKey])==null?void 0:G.$errors[0])==null?void 0:H.$message,success:e.success,loading:e.loading},{default:h(()=>[g(N(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):d("",!0)],64)}),128)),s(M)?(u(),m(pe,{key:0,modelValue:a.value.updateRoleDto.roleModules,"onUpdate:modelValue":i[1]||(i[1]=e=>a.value.updateRoleDto.roleModules=e),actions:s(se)},null,8,["modelValue","actions"])):d("",!0),s(M)?(u(),m(ie,{key:1,className:`form__submit ${(w=(V=s(l))==null?void 0:V.stateId.$errors[0])!=null&&w.$message?"centered":""}`},{default:h(()=>[g(N(o.$t("formButton")),1)]),_:1},8,["className"])):d("",!0),s(re)?(u(),m(ye,{key:2})):d("",!0)],32)])])}}};export{xe as default};
