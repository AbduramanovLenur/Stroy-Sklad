import{u as ue,a as ne,b as le,y as ce,c as m,r as N,z as B,d as h,e as L,k as U,h as o,w as me,F as H,D as ie,A as _,i as v,l as de,m as i,o as l,s as Q,B as W,f as g,t as d,H as pe,E as ye}from"./index-0sPBClUI.js";import{c as he}from"./crud.services-BcOS3M0E.js";import{j as _e,k as ve}from"./manual.services-EJwfGIwS.js";import{u as ge,r as A}from"./i18n-validators-q99RgDXY.js";import{u as $e}from"./generic.services-zebC7xpi.js";import{u as R}from"./useQuery-eQS1GidE.js";import{u as qe}from"./useMutation-33x-pTwH.js";const Se={key:0,class:"manage section-height shadowed"},Ee={class:"manage__inner section-padding"},Ne={__name:"create",async setup(be){let s,c;const $=$e(),x=de(),z=ue(),{t:D}=ne(),O=le(),{user:u}=ce(O),q=m(()=>{var a,y;return!!((y=(a=u==null?void 0:u.value.user)==null?void 0:a.modules)!=null&&y.includes(pe.WAREHOUSE.CREATE))}),t=N({materialId:[],quantity:""}),P=m(()=>({materialId:{required:A},quantity:{required:A}})),r=ge(P,t),{data:j,isSuccess:G,isLoading:J}=([s,c]=B(()=>R({queryKey:["materialsList",{organizationId:u.value.user.organizationId,name:u.value.user.fullName}],queryFn:()=>_e(),enabled:q})),s=await s,c(),s),p=m(()=>t.value.materialId[0]),X=m(()=>!!p.value),{data:Y,isSuccess:Ie,isLoading:Ve}=([s,c]=B(()=>R({queryKey:["types",p,{organizationId:u.value.user.organizationId,name:u.value.user.fullName}],queryFn:()=>ve(p.value),enabled:X})),s=await s,c(),s),Z=N([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:j,success:G,loading:J,select:!0},{id:2,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),{mutate:f,status:ee}=qe({onMutate:a=>{a.materialId=a.materialId[0]},mutationFn:a=>he("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(t.value=ye(t.value),$.invalidateQueries({queryKey:["warehouse"]}),$.invalidateQueries({queryKey:["reports","warehouse"]}),x.push(Q.WAREHOUSE.path),setTimeout(()=>z.success(D("createToast")),150))}}),ae=()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...t.value};f(a),r.value.$reset()};return(a,y)=>{var S,E;const te=i("ManageHead"),se=i("FormInput"),re=i("FormSelect"),oe=i("CustomButton");return q.value?(l(),h("section",Se,[L("div",Ee,[U(te,{title:"addNewProductTitle",to:o(Q).WAREHOUSE.path},null,8,["to"]),L("form",{class:"manage__form form-manage",onSubmit:me(ae,["prevent"])},[(l(!0),h(H,null,ie(Z.value,e=>{var b,I,V,w,M,T,C,K,k,F;return l(),h(H,{key:e.id},[e!=null&&e.select?v("",!0):(l(),W(se,{key:0,modelValue:t.value[e.model],"onUpdate:modelValue":n=>t.value[e.model]=n,placeholder:a.$t(e.placeholder),name:e.icon,error:(I=(b=o(r))==null?void 0:b[e.errorKey])==null?void 0:I.$error,textError:(M=(w=(V=o(r))==null?void 0:V[e.errorKey])==null?void 0:w.$errors[0])==null?void 0:M.$message},{default:_(()=>{var n;return[g(d(a.$t(e.label))+" "+d((n=o(Y))==null?void 0:n[0].name),1)]}),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(l(),W(re,{key:1,modelValue:t.value[e.model],"onUpdate:modelValue":n=>t.value[e.model]=n,modelModifiers:{trim:!0},options:e.options,error:(C=(T=o(r))==null?void 0:T[e==null?void 0:e.errorKey])==null?void 0:C.$error,placeholder:e==null?void 0:e.placeholder,textError:(F=(k=(K=o(r))==null?void 0:K[e==null?void 0:e.errorKey])==null?void 0:k.$errors[0])==null?void 0:F.$message,success:e.success,loading:e.loading},{default:_(()=>[g(d(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):v("",!0)],64)}),128)),U(oe,{className:`form__submit ${(E=(S=o(r))==null?void 0:S.quantity.$errors[0])!=null&&E.$message?"centered":""}`,disabled:o(ee)==="pending"},{default:_(()=>[g(d(a.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):v("",!0)}}};export{Ne as default};
