import{u as re,a as se,r as g,y as I,c as _,x as ae,b as y,d as S,j,g as i,w as te,F as w,B as V,C as v,k as le,l as h,o as b,A as C,z as N,e as k,t as F}from"./index-LIAghTzt.js";import{u as ie,r as t}from"./i18n-validators-Soiy62qZ.js";import{a as de,u as ne}from"./generic.services-g7-190gM.js";import{u as L}from"./useQuery-lbUIVZoa.js";import{c as ce}from"./crud.services-v10L7FpB.js";import{m as ue,a as me,e as ge}from"./manual.services-T8eI6v5K.js";const be={class:"manage section-height shadowed"},pe={class:"manage__inner section-padding"},Le={__name:"create",async setup(he){let r,l;const q=de(),P=le();re(),se();const O=g(localStorage.getItem("organizationId")),B=g(!1),s=g({fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[]}),{data:R,isSuccess:x,isLoading:E}=([r,l]=I(()=>L({queryKey:["regions"],queryFn:()=>ue()})),r=await r,l(),r),p=_(()=>s.value.regionId),M=_(()=>!!p.value.length);ae(p,()=>{B.value||(s.value.districtId=[])},{immediate:!0});const{data:A,isSuccess:D,isLoading:U}=([r,l]=I(()=>L({queryKey:["districts",{districtId:p}],queryFn:()=>me(p.value),enabled:M})),r=await r,l(),r),{data:z,isSuccess:G,isLoading:H}=([r,l]=I(()=>L({queryKey:["objectsList",{organizationId:O}],queryFn:()=>ge(O.value)})),r=await r,l(),r),Q=_(()=>({fullname:{required:t},numberOfFloors:{required:t},roomsOnFloor:{required:t},address:{required:t},buildingObjectId:{required:t},regionId:{required:t},districtId:{required:t}})),a=ie(Q,s),T=g([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),J=g([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:z,success:G,loading:H},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:R,success:x,loading:E},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:A,success:D,loading:U}]),{mutate:W}=ne({onMutate:o=>{B.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.regionId=o.regionId[0],o.districtId=o.districtId[0]},mutationFn:o=>ce("building_block",o),onSuccess:()=>{q.invalidateQueries({queryKey:["blocks"]}),P.push(C.BLOCKS.path)}}),X=()=>{a.value.$validate(),!a.value.$errors.length&&(W(s.value),a.value.$reset())};return(o,fe)=>{var K,$;const Y=h("ManageHead"),Z=h("FormInput"),ee=h("FormSelect"),oe=h("CustomButton");return b(),y("section",be,[S("div",pe,[j(Y,{title:"addNewBlocksTitle",to:i(C).BLOCKS.path},null,8,["to"]),S("form",{class:"manage__form form-manage",onSubmit:te(X,["prevent"])},[(b(!0),y(w,null,V(T.value,e=>{var d,n,c,u,m;return b(),N(Z,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":f=>s.value[e.model]=f,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(n=(d=i(a))==null?void 0:d[e.errorKey])==null?void 0:n.$error,textError:(m=(u=(c=i(a))==null?void 0:c[e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message},{default:v(()=>[k(F(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(b(!0),y(w,null,V(J.value,e=>{var d,n,c,u,m;return b(),N(ee,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":f=>s.value[e.model]=f,width:500,options:e.options,error:(n=(d=i(a))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(u=(c=i(a))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:v(()=>[k(F(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),j(oe,{className:`form__submit ${($=(K=i(a))==null?void 0:K.districtId.$errors[0])!=null&&$.$message?"centered":""}`},{default:v(()=>[k(F(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Le as default};
//# sourceMappingURL=create-_6yITv1r.js.map
