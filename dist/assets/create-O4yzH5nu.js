import{u as ae,a as te,r as m,c as p,z as w,B as oe,d as g,e as E,k as F,h as n,w as se,F as M,C as ne,D as h,l as ie,m as u,o as i,s as P,A as q,f as y,t as _,i as B,E as ce}from"./index-Znn7x0w2.js";import{c as le}from"./crud.services-oovoAPUX.js";import{m as ue,a as de}from"./manual.services-CtkFg6uR.js";import{u as me,r as s}from"./i18n-validators-IvsyUnkI.js";import{a as pe,u as ge}from"./generic.services-CuHvXiDr.js";import{u as k}from"./useQuery-n34yz_OD.js";const he={class:"manage section-height shadowed"},ye={class:"manage__inner section-padding"},Ke={__name:"create",async setup(_e){let t,c;const b=pe(),D=ie(),x=ae(),{t:R}=te(),v=m(!1),a=m({fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[]}),T=p(()=>({fullName:{required:s},inn:{required:s},address:{required:s},phoneNumber:{required:s},director:{required:s},regionId:{required:s},districtId:{required:s}})),o=me(T,a),{data:A,isSuccess:Q,isLoading:U}=([t,c]=w(()=>k({queryKey:["regions"],queryFn:()=>ue()})),t=await t,c(),t),l=p(()=>a.value.regionId[0]),H=p(()=>!!l.value);oe(l,()=>{v.value||(a.value.districtId=[])},{immediate:!0});const{data:G,isSuccess:j,isLoading:J}=([t,c]=w(()=>k({queryKey:["districts",{districtId:l}],queryFn:()=>de(l.value),enabled:H})),t=await t,c(),t),W=m([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",type:"number"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"},{id:6,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:A,success:Q,loading:U,select:!0},{id:7,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:G,success:j,loading:J,select:!0}]),{mutate:X}=ge({onMutate:r=>{v.value=!0,r.regionId=r.regionId[0],r.districtId=r.districtId[0]},mutationFn:r=>le("organization",r),onSuccess:r=>{r!=null&&r.success&&(a.value=ce(a.value),b.invalidateQueries({queryKey:["companies"]}),b.invalidateQueries({queryKey:["organizations"]}),D.push(P.COMPANIES.path),setTimeout(()=>x.success(R("createToast")),150))}}),Y=()=>{if(o.value.$validate(),o.value.$errors.length)return;const r={...a.value};X(r),o.value.$reset()};return(r,be)=>{var I,z;const Z=u("ManageHead"),f=u("FormInput"),ee=u("FormSelect"),re=u("CustomButton");return i(),g("section",he,[E("div",ye,[F(Z,{title:"addNewCompanyTitle",to:n(P).COMPANIES.path},null,8,["to"]),E("form",{class:"manage__form form-manage",onSubmit:se(Y,["prevent"])},[(i(!0),g(M,null,ne(W.value,e=>{var N,$,O,K,S,V,C,L;return i(),g(M,{key:e.id},[e!=null&&e.select?B("",!0):(i(),q(f,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,width:500,placeholder:r.$t(e.placeholder),name:e.icon,error:(N=n(o))==null?void 0:N[e.errorKey].$error,type:e==null?void 0:e.type,textError:(O=($=n(o))==null?void 0:$[e.errorKey].$errors[0])==null?void 0:O.$message},{default:h(()=>[y(_(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),e!=null&&e.select?(i(),q(ee,{key:1,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,modelModifiers:{trim:!0},width:500,options:e.options,error:(S=(K=n(o))==null?void 0:K[e==null?void 0:e.errorKey])==null?void 0:S.$error,placeholder:e==null?void 0:e.placeholder,textError:(L=(C=(V=n(o))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:C.$errors[0])==null?void 0:L.$message,success:e.success,loading:e.loading},{default:h(()=>[y(_(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):B("",!0)],64)}),128)),F(re,{className:`form__submit ${(z=(I=n(o))==null?void 0:I.districtId.$errors[0])!=null&&z.$message?"centered":""}`},{default:h(()=>[y(_(r.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Ke as default};
