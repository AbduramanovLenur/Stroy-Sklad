import{_ as Q,o as d,d as m,e as n,L as Be,t as u,w as ne,I as de,c as p,F as R,C as U,p as Ae,n as Fe,u as je,a as Pe,r,b as Ve,y as qe,z as k,ai as Ne,B as Ke,k as C,h as M,D as _,aj as ze,A as L,i as h,l as He,G as De,m as O,s as T,f,H as D,J as E}from"./index-8l2LyLh8.js";import{a as Ee,e as Re,f as Ue}from"./crud.services-BcMjcvoI.js";import{f as Qe,g as Ge,h as We,i as Je,j as Xe}from"./manual.services-Ls971AW1.js";import{a as Ye,u as le}from"./generic.services-yETqkf3T.js";import{u as S}from"./useQuery-tdqJaMO0.js";const Ze={class:"confirmation-modal__title"},xe={class:"confirmation-modal__triggers"},ea={__name:"ConfirmationModal",props:["isOpen"],setup(v){return(a,o)=>(d(),m("div",{class:de(`confirmation-modal ${v.isOpen?"is-active":""}`),onClick:o[3]||(o[3]=()=>a.$emit("onNotConfirmed"))},[n("div",{class:"confirmation-modal__overlay",onClick:o[2]||(o[2]=ne(()=>{},["stop"]))},[n("h4",Ze,[Be(a.$slots,"default",{},void 0,!0)]),n("div",xe,[n("button",{type:"button",class:"confirmation-modal__accepted",onClick:o[0]||(o[0]=()=>a.$emit("onConfirmed"))},u(a.$t("yesButton")),1),n("button",{type:"button",class:"confirmation-modal__refused",onClick:o[1]||(o[1]=()=>a.$emit("onNotConfirmed"))},u(a.$t("noButton")),1)])])],2))}},ie=Q(ea,[["__scopeId","data-v-c25f4d7f"]]),aa=v=>(Ae("data-v-28fb4607"),v=v(),Fe(),v),sa={class:"histories"},ta={class:"histories__label"},oa={class:"histories__list"},la={class:"histories__head"},ia={class:"histories__name"},na=aa(()=>n("div",{class:"histories__divider"}," - ",-1)),da={class:"histories__status"},ua={class:"histories__date"},ca={__name:"Histories",props:["histories"],setup(v){const a=p(()=>o=>{let b=new Date(o),s=b.toISOString().split("T")[0],B=b.toISOString().split("T")[1].split(".")[0];return`${s} ${B}`});return(o,b)=>(d(),m("div",sa,[n("div",ta,u(o.$t("historiesLabel")),1),n("ul",oa,[(d(!0),m(R,null,U(v.histories,s=>(d(),m("li",{key:s.id,class:"histories__item"},[n("div",{class:de(`histories__box ${(s==null?void 0:s.statusId)===1?"created":(s==null?void 0:s.statusId)===7?"accepted":(s==null?void 0:s.statusId)===20?"expected":(s==null?void 0:s.statusId)===15?"refused":""}`)},[n("div",la,[n("div",ia,u(s==null?void 0:s.userName),1),na,n("div",da,u(s==null?void 0:s.status),1)]),n("div",ua,u(a.value(s==null?void 0:s.createdDate)),1)],2)]))),128))])]))}},ra=Q(ca,[["__scopeId","data-v-28fb4607"]]),pa={key:0,class:"manage section-height shadowed"},ma={class:"manage__inner section-padding"},va={class:"manage__overlay"},ba={key:0,class:"manage__triggers"},_a={__name:"view",async setup(v){let a,o;const b=Ye(),s=He(),B=De(),G=je(),{t:W}=Pe(),I=r(B.params.id),ue=Ve(),{user:c}=qe(ue),A=p(()=>{var e,t;return(t=(e=c==null?void 0:c.value.user)==null?void 0:e.modules)==null?void 0:t.includes(D.APPLICATION.READ)}),F=r(!1),j=r(!1),ce=r([{id:1,label:"appFloor",width:20},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:20},{id:4,label:"appPrice",width:30}]),i=r({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],applicationTables:[],details:"",statusId:"",hasPermission:[],histories:[]}),{data:re,isSuccess:pe,isLoading:me}=([a,o]=k(()=>S({queryKey:["objectsList",{organizationId:c.value.user.organizationId}],queryFn:()=>Qe(),enabled:A})),a=await a,o(),a),P=p(()=>i.value.buildingObjectId[0]),ve=p(()=>!!P.value),{data:be,isSuccess:_e,isLoading:fe}=([a,o]=k(()=>S({queryKey:["blocksList",{blockId:P,organizationId:c.value.user.organizationId}],queryFn:()=>Ge(P.value),enabled:ve})),a=await a,o(),a),V=p(()=>i.value.buildingBlockId[0]),q=p(()=>!!V.value),{data:Ie,isSuccess:fa,isLoading:Ia}=([a,o]=k(()=>S({queryKey:["floorsList",{floorId:V,organizationId:c.value.user.organizationId}],queryFn:()=>We(V.value),enabled:q})),a=await a,o(),a),{data:ge,isSuccess:ga,isLoading:ka}=([a,o]=k(()=>S({queryKey:["costsList",{organizationId:c.value.user.organizationId}],queryFn:()=>Je(),enabled:q})),a=await a,o(),a),{data:ke,isSuccess:Ca,isLoading:ha}=([a,o]=k(()=>S({queryKey:["materialsList",{organizationId:c.value.user.organizationId}],queryFn:()=>Xe(),enabled:q})),a=await a,o(),a),Ce=r([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),he=r([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:re,success:pe,loading:me},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:be,success:_e,loading:fe}]),{isError:Oe}=([a,o]=k(()=>S({queryKey:["applicationsById",I],queryFn:()=>Ee("application",I.value),select:e=>{i.value.id=e.id,i.value.deadline=e.deadline,i.value.buildingObjectId=[e.buildingObjectId],i.value.buildingBlockId=[e.buildingBlockId],i.value.applicationTables=[...e.applicationTables],i.value.details=e.details,i.value.statusId=e.statusId,i.value.hasPermission=e.hasPermission,i.value.histories=e.applicationHistories},enabled:A})),a=await a,o(),a),J=p(()=>E(Ie.value||[])),X=p(()=>E(ge.value||[])),Y=p(()=>E(ke.value||[])),Se=e=>{var t;return(t=J.value[e.floorId])==null?void 0:t.name},ye=e=>{var t;return(t=X.value[e.costId])==null?void 0:t.name},Me=e=>{var t;return(t=Y.value[e==null?void 0:e.constructionMaterialId])==null?void 0:t.name},Z=r(!1),x=r(!0);Ne(()=>{var w,$,y;const e=(w=Object.keys(J.value))==null?void 0:w.length,t=($=Object.keys(X.value))==null?void 0:$.length,N=(y=Object.keys(Y.value))==null?void 0:y.length,K=i.value.applicationTables.length;e&&t&&N&&K&&(i.value.applicationTables=i.value.applicationTables.map(g=>({...g,floorValue:Se(g),costValue:ye(g),constructionMaterialValue:Me(g)})),Z.value=!0,x.value=!1)}),Ke(Oe,e=>{e&&s.push(T.HOME.path)});const{mutate:Le}=le({mutationFn:e=>Re("application",e),onSuccess:e=>{e!=null&&e.success&&(b.invalidateQueries({queryKey:["applications"]}),b.invalidateQueries({queryKey:["applicationsById",I]}),s.push(T.APPLICATION.path),setTimeout(()=>G.success(W("cancelToast")),150))}}),{mutate:we}=le({mutationFn:e=>Ue("application",e),onSuccess:e=>{e!=null&&e.success&&(b.invalidateQueries({queryKey:["applications"]}),b.invalidateQueries({queryKey:["applicationsById",I]}),s.push(T.APPLICATION.path),setTimeout(()=>G.success(W("acceptToast")),150))}}),$e=()=>{Le(I.value)},Te=()=>{we(I.value)};return(e,t)=>{var z,ee,ae,se,te,oe;const N=O("ManageHead"),K=O("FormInput"),w=O("FormSelect"),$=O("SubTable"),y=O("MyButton"),g=O("Spinner");return A.value?(d(),m("section",pa,[n("div",ma,[C(N,{title:"addNewApplicationTitle",to:M(T).APPLICATION.path},null,8,["to"]),Z.value?(d(),m("form",{key:0,class:"manage__form",onSubmit:t[3]||(t[3]=ne(()=>{},["prevent"]))},[n("div",va,[(d(!0),m(R,null,U(Ce.value,l=>(d(),L(K,{key:l.id,modelValue:i.value[l.model],"onUpdate:modelValue":H=>i.value[l.model]=H,width:500,placeholder:e.$t(l.placeholder),name:l.icon,type:l==null?void 0:l.type,isDisabled:!0},{default:_(()=>[f(u(e.$t(l.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),(d(!0),m(R,null,U(he.value,l=>(d(),L(w,{key:l.id,modelValue:i.value[l.model],"onUpdate:modelValue":H=>i.value[l.model]=H,modelModifiers:{trim:!0},width:500,options:l.options,placeholder:l==null?void 0:l.placeholder,success:l.success,loading:l.loading,isMultiSelect:l==null?void 0:l.multiple,isDisabled:!0},{default:_(()=>[f(u(e.$t(l.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128))]),C($,{headers:ce.value,table:i.value.applicationTables},null,8,["headers","table"]),C(ze,{modelValue:i.value.details,"onUpdate:modelValue":t[0]||(t[0]=l=>i.value.details=l),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),isDisabled:!0},{default:_(()=>[f(u(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder"]),i.value.hasPermission?(d(),m("div",ba,[(ae=(ee=(z=M(c))==null?void 0:z.user)==null?void 0:ee.modules)!=null&&ae.includes(M(D).APPLICATION.CONFIRM)?(d(),L(y,{key:0,icon:"approve",type:"submit",color:"green",width:180,onClick:t[1]||(t[1]=()=>F.value=!0)},{default:_(()=>[f(u(e.$t("acceptButton")),1)]),_:1})):h("",!0),(oe=(te=(se=M(c))==null?void 0:se.user)==null?void 0:te.modules)!=null&&oe.includes(M(D).APPLICATION.REFUSAL)?(d(),L(y,{key:1,icon:"refusal",type:"submit",color:"red",width:180,onClick:t[2]||(t[2]=()=>j.value=!0)},{default:_(()=>[f(u(e.$t("cancelButton")),1)]),_:1})):h("",!0)])):h("",!0),C(ra,{histories:i.value.histories},null,8,["histories"])],32)):h("",!0),x.value?(d(),L(g,{key:1})):h("",!0)]),C(ie,{isOpen:F.value,onOnConfirmed:Te,onOnNotConfirmed:t[4]||(t[4]=()=>F.value=!1)},{default:_(()=>[f(u(e.$t("sureConfirm")),1)]),_:1},8,["isOpen"]),C(ie,{isOpen:j.value,onOnConfirmed:$e,onOnNotConfirmed:t[5]||(t[5]=()=>j.value=!1)},{default:_(()=>[f(u(e.$t("sureRefused")),1)]),_:1},8,["isOpen"])])):h("",!0)}}},wa=Q(_a,[["__scopeId","data-v-63150789"]]);export{wa as default};
