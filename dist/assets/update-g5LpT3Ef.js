import{u as ue,a as ce,r as d,y as b,c as k,x as C,b as F,d as N,j as E,g as i,w as me,F as P,B as R,C as O,k as ge,D as be,l as v,o as I,A as L,z as M,e as B,t as K}from"./index-LIAghTzt.js";import{u as Ie,r as l}from"./i18n-validators-Soiy62qZ.js";import{a as pe,u as he}from"./generic.services-g7-190gM.js";import{u as p}from"./useQuery-lbUIVZoa.js";import{a as ve,u as ye}from"./crud.services-v10L7FpB.js";import{m as fe,a as _e,e as ke,b as Fe}from"./manual.services-T8eI6v5K.js";const Oe={class:"manage section-height shadowed"},Le={class:"manage__inner section-padding"},Ce={__name:"update",async setup(Be){let s,r;const S=pe(),$=ge(),x=be();ue(),ce();const y=d(x.params.id),j=d(localStorage.getItem("organizationId")),q=d(!1),f=d(!1),a=d({id:"",fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[],stateId:[]}),{data:D,isSuccess:A,isLoading:G}=([s,r]=b(()=>p({queryKey:["regions"],queryFn:()=>fe()})),s=await s,r(),s),h=k(()=>a.value.regionId),H=k(()=>!!h.value.length);C(h,()=>{!f.value&&!q.value&&(a.value.districtId=[]),f.value=!1},{immediate:!0});const{data:Q,isSuccess:U,isLoading:z}=([s,r]=b(()=>p({queryKey:["districts",{districtId:h}],queryFn:()=>_e(h.value),enabled:H})),s=await s,r(),s),{data:T,isSuccess:W,isLoading:J}=([s,r]=b(()=>p({queryKey:["objectsList",{organizationId:j}],queryFn:()=>ke(j.value)})),s=await s,r(),s),{data:X,isSuccess:Y,isLoading:Z}=([s,r]=b(()=>p({queryKey:["states"],queryFn:()=>Fe()})),s=await s,r(),s),ee=k(()=>({id:{required:l},fullname:{required:l},numberOfFloors:{required:l},roomsOnFloor:{required:l},address:{required:l},buildingObjectId:{required:l},regionId:{required:l},districtId:{required:l},stateId:{required:l}})),t=Ie(ee,a),oe=d([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),se=d([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:T,success:W,loading:J},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:D,success:A,loading:G},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:Q,success:U,loading:z},{id:4,model:"stateId",label:"stateBlocksLabel",placeholder:"stateBlocksPlaceholder",errorKey:"stateId",options:X,success:Y,loading:Z}]),{isError:ae}=([s,r]=b(()=>p({queryKey:["blocksById",y],queryFn:()=>ve("building_block",y.value),select:o=>{a.value.id=o.id,a.value.fullname=o.fullName,a.value.numberOfFloors=o.numberOfFloors,a.value.roomsOnFloor=o.roomsOnFloor,a.value.address=o.address,a.value.buildingObjectId=[o.buildingObjectId],a.value.regionId=[o.regionId],a.value.districtId=[o.districtId],a.value.stateId=[o.stateId],f.value=!0}})),s=await s,r(),s);C(ae,o=>{o&&$.push(L.HOME.path)});const{mutate:re}=he({onMutate:o=>{q.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.regionId=o.regionId[0],o.districtId=o.districtId[0],o.stateId=o.stateId[0]},mutationFn:o=>ye("building_block",o),onSuccess:()=>{S.invalidateQueries({queryKey:["blocks"]}),S.invalidateQueries({queryKey:["blocksById",y]}),$.push(L.BLOCKS.path)}}),le=async()=>{t.value.$validate(),!t.value.$errors.length&&(re(a.value),t.value.$reset())};return(o,Ke)=>{var w,V;const te=v("ManageHead"),de=v("FormInput"),ie=v("FormSelect"),ne=v("CustomButton");return I(),F("section",Oe,[N("div",Le,[E(te,{title:"editBlocksTitle",to:i(L).BLOCKS.path},null,8,["to"]),N("form",{class:"manage__form form-manage",onSubmit:me(le,["prevent"])},[(I(!0),F(P,null,R(oe.value,e=>{var n,u,c,m,g;return I(),M(de,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":_=>a.value[e.model]=_,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(u=(n=i(t))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:u.$error,textError:(g=(m=(c=i(t))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message},{default:O(()=>[B(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(I(!0),F(P,null,R(se.value,e=>{var n,u,c,m,g;return I(),M(ie,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":_=>a.value[e.model]=_,width:500,options:e.options,error:(u=(n=i(t))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(g=(m=(c=i(t))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message,success:e.success,loading:e.loading},{default:O(()=>[B(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),E(ne,{className:`form__submit ${(V=(w=i(t))==null?void 0:w.stateId.$errors[0])!=null&&V.$message?"centered":""}`},{default:O(()=>[B(K(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Ce as default};
//# sourceMappingURL=update-g5LpT3Ef.js.map
