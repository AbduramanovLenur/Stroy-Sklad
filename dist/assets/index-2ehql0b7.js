import{n as x,s as H,r as l,q as K,x as F,y as M,b as T,d as R,f as N,k as e,z as C,l as m,t as U,h as c,o as r,A as k}from"./index-rVcEkfs7.js";import{a as j,u as W}from"./generic.services-VYFQaCza.js";import{u as $}from"./useQuery-2Cvei3en.js";import{g as G,d as J}from"./crud.services-eAS52g5X.js";import{r as X}from"./index-Jhl1hIUk.js";const Y={class:"applications"},Z={class:"applications__inner"},ee={key:2,class:"empty-table shadowed"},le={__name:"index",async setup(te){let n,_;const g=j(),h=x(),{setSearchValue:y,setPagePagination:D}=h,{page:p,limit:d,search:b}=H(h),S=l(localStorage.getItem("organizationId")),I=l(localStorage.getItem("roleId"));K(()=>{y("")}),F(b,()=>{D(1)});const f=l(""),v=X(b,500),z=l([{id:1,label:"applicationUserName",width:130},{id:2,label:"applicationOrganization",width:185},{id:3,label:"applicationDocDate",width:210},{id:4,label:"applicationDedline",width:240},{id:5,label:"applicationObject",width:100},{id:6,label:"applicationBlock",width:95},{id:7,label:"applicationCost",width:330},{id:8,label:"applicationState"},{id:9,label:"applicationAction"}]),{data:s,isLoading:q,isSuccess:u,isError:B}=([n,_]=M(()=>$({queryKey:["applications",{page:p,limit:d,debouncedSearch:v,organizationId:S,roleId:I}],queryFn:()=>G("application",p.value,d.value,v.value,{organizationId:S.value,roleId:I.value}),select:t=>{let a={...t};return a.applications=a==null?void 0:a.applications.map(i=>{const o={...i,name:i.userName,company:i.organizationName};return delete o.userName,delete o.organizationName,delete o.state,delete o.stateId,o}),a}})),n=await n,_(),n),{mutate:O}=W({mutationFn:t=>J("application",t),onSuccess:()=>{g.invalidateQueries({queryKey:["applications"]}),g.invalidateQueries({queryKey:["applicationsById",f]})}}),E=async t=>{f.value=t,O(t)};return(t,a)=>{var w,A,P;const i=c("HeadPage"),o=c("Table"),L=c("Pagination"),Q=c("Spinner");return r(),T("section",Y,[R("div",Z,[N(i,{title:"applicationTitle",to:e(k).CREATE_APPLICATIONS.path,onOnSearch:a[0]||(a[0]=V=>e(y)(V))},null,8,["to"]),e(u)&&((w=e(s))!=null&&w.count)?(r(),C(o,{key:0,headers:z.value,table:(A=e(s))==null?void 0:A.applications,to:e(k).UPDATE_APPLICATIONS.name,options:{page:e(p),limit:e(d)},isShow:!0,onOnActionDelete:E},null,8,["headers","table","to","options"])):m("",!0),N(L,{count:(P=e(s))==null?void 0:P.count,isSucces:e(u)},null,8,["count","isSucces"]),e(q)?(r(),C(Q,{key:1})):m("",!0),e(u)&&!e(s).count||e(B)?(r(),T("div",ee,U(t.$t("emptyTableTitle")),1)):m("",!0)])])}}};export{le as default};
//# sourceMappingURL=index-2ehql0b7.js.map
