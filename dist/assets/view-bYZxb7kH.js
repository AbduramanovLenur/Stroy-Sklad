import{_ as Be,u as Ce,a as Me,r as c,b as Ve,x as Fe,c as d,y as r,B as D,d as y,e as F,k as q,h as i,w as qe,F as A,C as j,z as h,i as L,D as I,l as Ae,E as je,m as b,o as n,A as w,f as _,t as f,ae as Oe,G as Ke,I as O}from"./index-JvbhfmnW.js";import{a as Te,u as U}from"./generic.services-nPQjChLr.js";import{u as p}from"./useQuery-83Oo_vnt.js";import{a as Pe,b as Ne,e as ze}from"./crud.services-ysnFdDpK.js";import{e as Ee,f as Re,g as De,h as Ue,i as $e,j as Ge}from"./manual.services-jHvvpFhH.js";const Qe={key:0,class:"manage section-height shadowed"},He={class:"manage__inner section-padding"},We={class:"manage__overlay"},xe={key:2,class:"manage__triggers"},Je={__name:"view",async setup(Xe){let o,t;const k=Te(),B=Ae(),$=je();Ce(),Me();const m=c($.params.id),G=Ve(),{user:u}=Fe(G),S=d(()=>{var e,s;return!!((s=(e=u==null?void 0:u.value.user)==null?void 0:e.modules)!=null&&s.includes(Ke.APPLICATION.READ))}),v=c([]),Q=c([{id:1,label:"appFloor",width:215},{id:2,label:"appMaterial",width:290},{id:3,label:"appCount",width:250},{id:4,label:"appPrice",width:300},{id:5,label:"appCost"}]),l=c({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],roleIds:[],applicationTables:[],details:"",statusId:""}),{data:H,isSuccess:W,isLoading:x}=([o,t]=r(()=>p({queryKey:["rolesList",{organizationId:u.value.user.organizationId}],queryFn:()=>Ee(),enabled:S})),o=await o,t(),o),{data:J,isSuccess:X,isLoading:Y}=([o,t]=r(()=>p({queryKey:["objectsList",{organizationId:u.value.user.organizationId}],queryFn:()=>Re(),enabled:S})),o=await o,t(),o),C=d(()=>l.value.buildingObjectId),Z=d(()=>!!C.value.length),{data:ee,isSuccess:ae,isLoading:oe}=([o,t]=r(()=>p({queryKey:["blocksList",{blockId:C}],queryFn:()=>$e(C.value),enabled:Z})),o=await o,t(),o),M=d(()=>l.value.buildingBlockId),V=d(()=>!!M.value.length),{data:le,isSuccess:K,isLoading:se}=([o,t]=r(()=>p({queryKey:["floorsList",{floorId:M}],queryFn:()=>Ge(M.value),enabled:V})),o=await o,t(),o),{data:te,isSuccess:T,isLoading:ie}=([o,t]=r(()=>p({queryKey:["costsList",{organizationId:u.value.user.organizationId}],queryFn:()=>De(),enabled:V})),o=await o,t(),o),{data:ne,isSuccess:P,isLoading:de}=([o,t]=r(()=>p({queryKey:["materialsList",{organizationId:u.value.user.organizationId}],queryFn:()=>Ue(),enabled:V})),o=await o,t(),o),ue=c([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),ce=c([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:J,success:X,loading:Y},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:ee,success:ae,loading:oe},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:H,success:W,loading:x,multiple:!0}]),re=c([{id:1,model:"details",label:"appCommentLabel",placeholder:"appCommentPlaceholder",errorKey:"details"}]),{isError:pe}=([o,t]=r(()=>p({queryKey:["applicationsById",m],queryFn:()=>Pe("application",m.value),select:e=>{l.value.id=e.id,l.value.deadline=e.deadline,l.value.buildingObjectId=[e.buildingObjectId],l.value.buildingBlockId=[e.buildingBlockId],l.value.roleIds=[...e.roleIds],l.value.applicationTables=[...e.applicationTables],l.value.details=e.details,l.value.statusId=e.statusId},enabled:S})),o=await o,t(),o),N=d(()=>O(le.value||[])),z=d(()=>O(te.value||[])),E=d(()=>O(ne.value||[])),me=e=>{var s;return(s=N.value[e.floorId])==null?void 0:s.name},be=e=>{var s;return(s=z.value[e.costId])==null?void 0:s.name},ve=e=>{var s;return(s=E.value[e==null?void 0:e.constructionMaterialId])==null?void 0:s.name},ge=d(()=>Object.keys(N.value).length&&Object.keys(z.value).length&&Object.keys(E.value).length);D(ge,e=>{e&&(l.value.applicationTables.forEach(s=>{v.value.push({floorValue:me(s),costValue:be(s),constructionMaterialValue:ve(s),count:s.count,price:s.price})}),console.log(l.value.applicationTables),console.log(v.value))},{immediate:!0}),D(pe,e=>{e&&B.push(w.HOME.path)});const{mutate:ye}=U({mutationFn:e=>Ne("application",e),onSuccess:()=>{k.invalidateQueries({queryKey:["applications"]}),k.invalidateQueries({queryKey:["applicationsById",m]}),B.push(w.APPLICATIONS.path)}}),{mutate:he}=U({mutationFn:e=>ze("application",e),onSuccess:()=>{k.invalidateQueries({queryKey:["applications"]}),k.invalidateQueries({queryKey:["applicationsById",m]}),B.push(w.APPLICATIONS.path)}}),Ie=()=>{ye(m.value)},_e=()=>{he(m.value)};return(e,s)=>{const fe=b("ManageHead"),ke=b("FormInput"),Se=b("FormSelect"),Le=b("SubTable"),we=b("Spinner"),R=b("MyButton");return S.value?(n(),y("section",Qe,[F("div",He,[q(fe,{title:"addNewApplicationTitle",to:i(w).APPLICATIONS.path},null,8,["to"]),F("form",{class:"manage__form",onSubmit:s[0]||(s[0]=qe(()=>{},["prevent"]))},[F("div",We,[(n(!0),y(A,null,j(ue.value,a=>(n(),h(ke,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":g=>l.value[a.model]=g,width:500,placeholder:e.$t(a.placeholder),name:a.icon,type:a==null?void 0:a.type,isDisabled:!0},{default:I(()=>[_(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),(n(!0),y(A,null,j(ce.value,a=>(n(),h(Se,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":g=>l.value[a.model]=g,width:500,options:a.options,placeholder:a==null?void 0:a.placeholder,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple,isDisabled:!0},{default:I(()=>[_(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128))]),i(T)&&i(P)&&i(K)&&v.value?(n(),h(Le,{key:0,headers:Q.value,table:v.value},null,8,["headers","table"])):L("",!0),i(ie)||i(de)||i(se)||!v.value.length?(n(),h(we,{key:1})):L("",!0),(n(!0),y(A,null,j(re.value,a=>(n(),h(Oe,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":g=>l.value[a.model]=g,width:500,placeholder:e.$t(a.placeholder),isDisabled:!0},{default:I(()=>[_(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]))),128)),i(T)&&i(P)&&i(K)&&l.value.statusId!==7&&l.value.statusId!==15?(n(),y("div",xe,[q(R,{icon:"approve",type:"submit",color:"green",width:180,onClick:_e},{default:I(()=>[_(f(e.$t("acceptButton")),1)]),_:1}),q(R,{icon:"refusal",type:"submit",color:"red",width:180,onClick:Ie},{default:I(()=>[_(f(e.$t("cancelButton")),1)]),_:1})])):L("",!0)],32)])])):L("",!0)}}},la=Be(Je,[["__scopeId","data-v-529f8be7"]]);export{la as default};
//# sourceMappingURL=view-bYZxb7kH.js.map
