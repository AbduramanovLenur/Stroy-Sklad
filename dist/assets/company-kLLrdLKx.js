import{_ as he,r as l,k as h,c as ge,o as n,a as I,b as q,i as g,l as p,e as z,t as y,g as r,m as F,h as N,F as M,d as T,w as pe}from"./index-tguTEyM9.js";import{u as ye,c as be,r as d}from"./secondary-functions-itmedAoL.js";import{u as ve,a as fe,b as K,T as we,F as _e,A as Ie,c as ze,d as Fe,e as Se,C as qe,f as Ne,g as b,S as Ke,h as Oe,i as $e,j as Ce,m as Le,k as Ve,l as Be,n as ke,o as De}from"./Spinner-fYZ6DMpY.js";const Me={class:"company"},Te={class:"company__inner"},Ae={class:"company__head"},Ee={key:2,class:"empty-table"},Pe={__name:"company",async setup(Qe){let o,s;const v=ve(),A=fe(),{toggleIsOpenModalForm:O}=A,$=l(""),f=l(""),w=l(""),{data:E,isSuccess:P,isLoading:Q,refetch:G}=([o,s]=h(()=>b({queryKey:["regions"],queryFn:()=>Le(),enabled:!1})),o=await o,s(),o),{data:H,isSuccess:R,isLoading:U,refetch:x}=([o,s]=h(()=>b({queryKey:["districts"],queryFn:()=>Ve(),enabled:!1})),o=await o,s(),o),{data:W,isSuccess:j,isLoading:J,refetch:X}=([o,s]=h(()=>b({queryKey:["statesCompany"],queryFn:()=>Be(),enabled:!1})),o=await o,s(),o),t=l({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:"",districtId:"",stateId:""}),Y=ge(()=>({fullName:{required:d},inn:{required:d},address:{required:d},phoneNumber:{required:d},director:{required:d},regionId:{required:d},districtId:{required:d}})),Z=l([{id:1,label:"organizationName",width:220},{id:2,label:"organizationInn",width:115},{id:3,label:"organizationRegion",width:215},{id:4,label:"organizationDistrict",width:155},{id:5,label:"organizationAddress",width:200},{id:6,label:"organizationPhone",width:170},{id:7,label:"organizationDirector",width:245},{id:7,label:"organizationState",width:100},{id:8,label:"organizationAction",width:130}]),ee=l([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName",show:["create","edit"]},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",show:["create","edit"]},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address",show:["create","edit"]},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber",show:["create","edit"]},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director",show:["create","edit"]}]),ae=l([{id:1,model:"regionId",label:"regionOrganizationLabel",options:E,errorKey:"regionId",success:P,loading:Q,show:["create","edit"]},{id:2,model:"districtId",label:"districtOrganizationLabel",options:H,errorKey:"districtId",success:R,loading:U,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:W,success:j,loading:J,show:"update",show:["edit"]}]),i=ye(Y,t),{data:S,isLoading:oe,isSuccess:C}=([o,s]=h(()=>b({queryKey:["companies"],queryFn:()=>ke("organization")})),o=await o,s(),o),{refetch:te}=([o,s]=h(()=>b({queryKey:["companiesById",w],queryFn:()=>De("organization",w.value),select:e=>{t.value.id=e.id,t.value.fullName=e.fullName,t.value.inn=e.inn,t.value.address=e.address,t.value.phoneNumber=e.phoneNumber,t.value.director=e.director,t.value.regionId=e.regionId,t.value.districtId=e.districtId,t.value.stateId=e.stateId},enabled:!1})),o=await o,s(),o),{mutate:re}=K({mutationFn:e=>Oe("organization",e),onSuccess:()=>{v.invalidateQueries({queryKey:["companies"]})}}),{mutate:se}=K({mutationFn:e=>$e("organization",e),onSuccess:()=>{v.invalidateQueries({queryKey:["companies"]}),v.invalidateQueries({queryKey:["getByIdCompany",w]})}}),{mutate:ie}=K({mutationFn:e=>Ce("organization",e),onSuccess:()=>{v.invalidateQueries({queryKey:["companies"]})}}),ne=e=>{console.log(e)},L=(e,V)=>{$.value=e,f.value=V,G(),x(),O()},le=()=>{L("addNewCompanyTitle","create")},de=e=>{w.value=e,te(),X(),L("editCompanyTitle","edit")},ce=async e=>{ie(e)},ue=async()=>{i.value.$validate(),!i.value.$errors.length&&(f.value==="create"?(delete t.value.id,delete t.value.stateId,re(t.value)):se(t.value),O(),t.value=be(t.value),i.value.$reset())};return(e,V)=>(n(),I("section",Me,[q("div",Te,[q("div",Ae,[g(we,null,{default:p(()=>[z(`\r
                    `+y(e.$t("comapnyTitle"))+`\r
                `,1)]),_:1}),g(_e,{onOnSearch:ne}),g(Ie,{onOnOpenFormModal:le})]),r(C)&&r(S).length?(n(),F(ze,{key:0,headers:Z.value,table:r(S),onOnActionEdit:de,onOnActionDelete:ce},null,8,["headers","table"])):N("",!0),r(oe)?(n(),F(Ke,{key:1})):N("",!0),r(C)&&!r(S).length?(n(),I("div",Ee,y(e.$t("emptyTableTitle")),1)):N("",!0)]),g(Ne,{title:$.value},{default:p(()=>{var B,k;return[q("form",{class:"company__form",onSubmit:pe(ue,["prevent"])},[(n(!0),I(M,null,T(ee.value,a=>{var c,u,m;return n(),F(Fe,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":_=>t.value[a.model]=_,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(c=r(i))==null?void 0:c[a.errorKey].$error,textError:(m=(u=r(i))==null?void 0:u[a.errorKey].$errors[0])==null?void 0:m.$message,show:a.show,requestFlag:f.value},{default:p(()=>[z(y(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","show","requestFlag"])}),128)),(n(!0),I(M,null,T(ae.value,a=>{var c,u,m,_,D;return n(),F(Se,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":me=>t.value[a.model]=me,width:500,options:a.options,error:(u=(c=r(i))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:u.$error,textError:(D=(_=(m=r(i))==null?void 0:m[a==null?void 0:a.errorKey])==null?void 0:_.$errors[0])==null?void 0:D.$message,success:a.success,loading:a.loading,show:a==null?void 0:a.show,requestFlag:f.value},{default:p(()=>[z(y(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),g(qe,{className:`form__submit ${(k=(B=r(i))==null?void 0:B.districtId.$errors[0])!=null&&k.$message?"centered":""}`},{default:p(()=>[z(y(e.$t("formButton")),1)]),_:1},8,["className"])],32)]}),_:1},8,["title"])]))}},Ue=he(Pe,[["__scopeId","data-v-17c92194"]]);export{Ue as default};
