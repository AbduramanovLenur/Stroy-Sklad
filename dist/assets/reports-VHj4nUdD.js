import{l as V,m as $}from"./crud.services-CGVkA17z.js";import{_ as z,u as M,a as W,b as j,y as Q,c as P,r as R,z as H,d as i,e as d,k as x,A as K,F as G,D as J,h as s,t as _,i as c,B as g,m,o as r,f as X,I as Y,H as C}from"./index-qUiWQIQ6.js";import{u as Z}from"./useQuery-Kymga6PU.js";import{u as ee}from"./useMutation-ZRy4kEQe.js";import"./generic.services-8Di1lKyZ.js";const te={key:0,class:"reports"},se={class:"reports__inner"},oe={class:"reports__head shadowed"},ae={class:"reports__tabs"},re=["onClick"],ne={class:"reports__download-icon"},le={class:"reports__download-value"},ie={key:2,class:"empty-table shadowed"},de={__name:"reports",async setup(ce){let u,b;const q=M(),{t:E}=W(),L=j(),{user:n}=Q(L),y=P(()=>{var e,t;return!!((t=(e=n==null?void 0:n.value.user)==null?void 0:e.modules)!=null&&t.includes(C.REPORTS.READ))}),l=R("expense"),B=R([{id:1,label:"reportsExpens",query:"expense"},{id:2,label:"reportsWarehouse",query:"warehouse"}]),I=[{id:1,label:"reportsMaterial",width:20},{id:2,label:"reportsQuantity",width:10},{id:3,label:"reportsObyekt",width:20},{id:4,label:"reportsBlock",width:20},{id:5,label:"reportsFloor",width:10},{id:6,label:"reportsBudget",width:20}],O=[{id:1,label:"reportsMaterial",width:70},{id:2,label:"reportsQuantity",width:30}],{data:h,isLoading:D,isSuccess:w,isError:N}=([u,b]=H(()=>Z({queryKey:["reports",l,{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>V(l.value),select:e=>e.map(t=>{const o={...t,quantityTypeValue:t.quantityType};return delete o.quantityType,o}),enabled:y})),u=await u,b(),u),{mutate:U}=ee({mutationFn:e=>$(e),onSuccess:e=>{if(!(e!=null&&e.success))return;const t=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(t),a=document.createElement("a");a.href=o,a.setAttribute("download","filename.xlsx"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(o),document.body.removeChild(a),setTimeout(()=>q.success(E("downloadToast")),150)}});return(e,t)=>{var f,v,k,T,S;const o=m("Title"),a=m("Icon"),A=m("Table"),F=m("Spinner");return y.value?(r(),i("section",te,[d("div",se,[d("div",oe,[x(o,null,{default:K(()=>[X(`\r
                    `+_(e.$t("reportsTitle"))+`\r
                `,1)]),_:1}),d("div",ae,[(r(!0),i(G,null,J(B.value,p=>(r(),i("div",{key:p.id,class:Y(`reports__tab ${l.value===p.query?"is-active":""}`),onClick:()=>l.value=p.query},_(e.$t(p.label)),11,re))),128))]),(k=(v=(f=s(n))==null?void 0:f.user)==null?void 0:v.modules)!=null&&k.includes(s(C).REPORTS.DOWNLOAD)?(r(),i("button",{key:0,class:"reports__download hovered",type:"button",onClick:t[0]||(t[0]=()=>s(U)(l.value))},[d("span",ne,[x(a,{name:"download"})]),d("span",le,_(e.$t("downloadLink")),1)])):c("",!0)]),s(w)&&((T=s(h))!=null&&T.length)?(r(),g(A,{key:0,headers:l.value==="expense"?I:O,table:s(h),isShowUpdate:!1,isShowDelete:!1,isShowState:!1},null,8,["headers","table"])):c("",!0),s(D)?(r(),g(F,{key:1})):c("",!0),s(w)&&!((S=s(h))!=null&&S.length)||s(N)?(r(),i("div",ie,_(e.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}},be=z(de,[["__scopeId","data-v-3575b4bc"]]);export{be as default};
