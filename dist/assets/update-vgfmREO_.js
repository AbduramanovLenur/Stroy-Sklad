import{u as ee,a as ae,r as p,y as I,c as se,x as te,b as f,d as B,f as w,k as i,w as oe,F as V,e as F,B as j,g as re,C as de,h,o as g,A as S,z as C,i as $,t as K}from"./index-83KN3zvu.js";import{u as ie,r as d}from"./i18n-validators-_d1FbLxZ.js";import{a as ne,u as le}from"./generic.services-Nv3JxhQ5.js";import{u as y}from"./useQuery-08AU-ufr.js";import{a as ce,u as ue}from"./crud.services-VbQaEYyd.js";import{m as me,a as ge,b as pe}from"./manual.services-sGtPegzs.js";const Ie={class:"manage section-height shadowed"},he={class:"manage__inner section-padding"},Ke={__name:"update",async setup(ye){let s,o;const b=ne(),L=re(),E=de();ee(),ae();const _=p(E.params.id),{data:z,isSuccess:M,isLoading:k}=([s,o]=I(()=>y({queryKey:["regions"],queryFn:()=>me()})),s=await s,o(),s),{data:x,isSuccess:N,isLoading:Q}=([s,o]=I(()=>y({queryKey:["districts"],queryFn:()=>ge()})),s=await s,o(),s),{data:R,isSuccess:T,isLoading:D}=([s,o]=I(()=>y({queryKey:["states"],queryFn:()=>pe()})),s=await s,o(),s),t=p({id:"",name:"",address:"",organizationId:"",regionId:[],districtId:[],stateId:[]}),H=se(()=>({id:{required:d},name:{required:d},address:{required:d},organizationId:{required:d},regionId:{required:d},districtId:{required:d},stateId:{required:d}})),r=ie(H,t),P=p([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"}]),U=p([{id:1,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",options:z,errorKey:"regionId",success:M,loading:k},{id:2,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",options:x,errorKey:"districtId",success:N,loading:Q},{id:3,model:"stateId",label:"stateObjectLabel",placeholder:"stateObjectLabel",options:R,success:T,loading:D}]),{isError:G}=([s,o]=I(()=>y({queryKey:["objectById",_],queryFn:()=>ce("building_object",_.value),select:a=>{t.value.id=a.id,t.value.name=a.fullName,t.value.organizationId=a.organizationId,t.value.address=a.address,t.value.regionId=[a.regionId],t.value.districtId=[a.districtId],t.value.stateId=[a.stateId]}})),s=await s,o(),s);te(G,a=>{a&&L.push(S.HOME.path)});const{mutate:A}=le({onMutate:a=>{a.regionId=a.regionId[0],a.districtId=a.districtId[0],a.stateId=a.stateId[0]},mutationFn:a=>ue("building_object",a),onSuccess:()=>{b.invalidateQueries({queryKey:["objects"]}),b.invalidateQueries({queryKey:["objectById",_]}),b.invalidateQueries({queryKey:["objectsList"]}),L.push(S.OBJECTS.path)}}),J=async()=>{const a=localStorage.getItem("organizationId");t.value.organizationId=a,r.value.$validate(),!r.value.$errors.length&&(A(t.value),r.value.$reset())};return(a,be)=>{var O,q;const W=h("ManageHead"),X=h("FormInput"),Y=h("FormSelect"),Z=h("CustomButton");return g(),f("section",Ie,[B("div",he,[w(W,{title:"editObjectTitle",to:i(S).OBJECTS.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:oe(J,["prevent"])},[(g(!0),f(V,null,F(P.value,e=>{var n,l,c,u,m;return g(),C(X,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":v=>t.value[e.model]=v,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(l=(n=i(r))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,textError:(m=(u=(c=i(r))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message},{default:j(()=>[$(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(g(!0),f(V,null,F(U.value,e=>{var n,l,c,u,m;return g(),C(Y,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":v=>t.value[e.model]=v,width:500,options:e.options,error:(l=(n=i(r))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(u=(c=i(r))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:j(()=>[$(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),w(Z,{className:`form__submit ${(q=(O=i(r))==null?void 0:O.stateId.$errors[0])!=null&&q.$message?"centered":""}`},{default:j(()=>[$(K(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Ke as default};
//# sourceMappingURL=update-vgfmREO_.js.map
