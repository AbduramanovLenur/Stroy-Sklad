import{u as ne,a as ue,r as O,c as me,z as q,d as N,e as B,k as ce,h as r,w as de,F as A,C as pe,A as u,i as m,D as y,l as ie,m as c,o as s,s as U,f as h,t as g,E as ye}from"./index-Znn7x0w2.js";import{c as he}from"./crud.services-oovoAPUX.js";import{c as ge,d as Ne}from"./manual.services-CtkFg6uR.js";import{u as _e,r as n,m as ve}from"./i18n-validators-IvsyUnkI.js";import{a as be,u as Ve}from"./generic.services-CuHvXiDr.js";import{u as x}from"./useQuery-n34yz_OD.js";const $e={class:"manage section-height shadowed"},we={class:"manage__inner section-padding"},Ke={__name:"create",async setup(Me){let l,p;const T=be(),H=ie(),Q=ne(),{t:G}=ue(),a=O({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:[],createRoleDto:{fullName:"OrgAdmin",shortName:"OrgAdmin",roleModules:[]}}),Y=me(()=>({fullName:{required:n},userName:{required:n},password:{required:n,minLength:ve},phoneNumber:{required:n},organizationId:{required:n},createRoleDto:{fullName:{required:n},shortName:{required:n},roleModules:{required:n}}})),t=_e(Y,a),{data:j,isLoading:J,isSuccess:_}=([l,p]=q(()=>x({queryKey:["modules"],queryFn:()=>ge()})),l=await l,p(),l),{data:W,isSuccess:X,isLoading:Z}=([l,p]=q(()=>x({queryKey:["organizations"],queryFn:()=>Ne()})),l=await l,p(),l),f=O([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"createRoleDto.fullName"},{id:6,model:"organizationId",label:"employeesOrganizationLabel",placeholder:"employeesOrganizationPlaceholder",errorKey:"organizationId",options:W,success:X,loading:Z,select:!0}]),{mutate:ee}=Ve({onMutate:o=>{o.organizationId=o.organizationId[0]},mutationFn:o=>he("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=ye(a.value),T.invalidateQueries({queryKey:["employees"]}),H.push(U.EMPLOYEES.path),setTimeout(()=>Q.success(G("createToast")),150))}}),oe=()=>{if(a.value.createRoleDto.shortName=a.value.createRoleDto.fullName,t.value.$validate(),t.value.$errors.length)return;const o={...a.value};ee(o),t.value.$reset()};return(o,i)=>{const ae=c("ManageHead"),v=c("FormInput"),re=c("FormSelect"),te=c("ActionsModules"),se=c("CustomButton"),le=c("Spinner");return s(),N("section",$e,[B("div",we,[ce(ae,{title:"addNewEmployeesTitle",to:r(U).EMPLOYEES.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:de(oe,["prevent"])},[(s(!0),N(A,null,pe(f.value,e=>{var b,V,$,w,M,D,L,R,E,z,S,K,P,k,F,C,I;return s(),N(A,{key:e.id},[!(e!=null&&e.select)&&e.model!=="createRoleDto.fullName"?(s(),u(v,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(V=(b=r(t))==null?void 0:b[e.errorKey])==null?void 0:V.$error,type:e==null?void 0:e.type,textError:(M=(w=($=r(t))==null?void 0:$[e.errorKey])==null?void 0:w.$errors[0])==null?void 0:M.$message},{default:y(()=>[h(g(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])):m("",!0),!(e!=null&&e.select)&&e.model==="createRoleDto.fullName"?(s(),u(v,{key:1,modelValue:a.value.createRoleDto.fullName,"onUpdate:modelValue":i[0]||(i[0]=d=>a.value.createRoleDto.fullName=d),width:500,placeholder:o.$t("employeesRolePlaceholder"),name:"person",error:(R=(L=(D=r(t))==null?void 0:D.createRoleDto)==null?void 0:L.fullName)==null?void 0:R.$error,textError:(K=(S=(z=(E=r(t))==null?void 0:E.createRoleDto)==null?void 0:z.fullName)==null?void 0:S.$errors[0])==null?void 0:K.$message},{default:y(()=>[h(g(o.$t("employeesRoleLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"])):m("",!0),e!=null&&e.select?(s(),u(re,{key:2,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,modelModifiers:{trim:!0},width:500,options:e.options,error:(k=(P=r(t))==null?void 0:P[e==null?void 0:e.errorKey])==null?void 0:k.$error,placeholder:e==null?void 0:e.placeholder,textError:(I=(C=(F=r(t))==null?void 0:F[e==null?void 0:e.errorKey])==null?void 0:C.$errors[0])==null?void 0:I.$message,success:e.success,loading:e.loading},{default:y(()=>[h(g(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):m("",!0)],64)}),128)),r(_)?(s(),u(te,{key:0,modelValue:a.value.createRoleDto.roleModules,"onUpdate:modelValue":i[1]||(i[1]=e=>a.value.createRoleDto.roleModules=e),actions:r(j)},null,8,["modelValue","actions"])):m("",!0),r(_)?(s(),u(se,{key:1,className:"form__submit"},{default:y(()=>[h(g(o.$t("formButton")),1)]),_:1})):m("",!0)],32),r(J)?(s(),u(le,{key:0})):m("",!0)])])}}};export{Ke as default};
