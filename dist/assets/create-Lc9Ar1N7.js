import{u as me,a as be,b as ge,y as pe,c as d,r as y,z as v,C as he,d as _,e as P,k as T,h as a,w as ye,F as D,D as ve,A as I,i as k,l as _e,m,o as u,s as x,B as A,f as L,t as F,H as Ie,E as ke}from"./index-KYHZIXyW.js";import{u as Le,r as l}from"./i18n-validators-TiKQ9SY_.js";import{u as Fe}from"./generic.services-YA4lnf9v.js";import{u as K}from"./useQuery-lv7mhtLD.js";import{u as Ke}from"./useMutation-7roH085H.js";import{c as Oe}from"./crud.services-K83EyEdH.js";import{f as Be,m as $e,a as Se}from"./manual.services-6j76Y8mg.js";const Ce={key:0,class:"manage section-height shadowed"},Ve={class:"manage__inner section-padding"},Te={__name:"create",async setup(Ne){let o,c;const b=Fe(),Q=_e(),U=me(),{t:H}=be(),z=ge(),{user:n}=pe(z),g=d(()=>{var s,p;return!!((p=(s=n==null?void 0:n.value.user)==null?void 0:s.modules)!=null&&p.includes(Ie.BLOCK.CREATE))}),O=y(!1),r=y({fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[]}),G=d(()=>({fullname:{required:l},numberOfFloors:{required:l},roomsOnFloor:{required:l},address:{required:l},buildingObjectId:{required:l},regionId:{required:l},districtId:{required:l}})),t=Le(G,r),{data:f,isSuccess:J,isLoading:W}=([o,c]=v(()=>K({queryKey:["regions"],queryFn:()=>$e(),enabled:g})),o=await o,c(),o),i=d(()=>r.value.regionId[0]),X=d(()=>!!i.value);he(i,()=>{O.value||(r.value.districtId=[])},{immediate:!0});const{data:Y,isSuccess:Z,isLoading:ee}=([o,c]=v(()=>K({queryKey:["districts",{districtId:i}],queryFn:()=>Se(i.value),enabled:X})),o=await o,c(),o),{data:se,isSuccess:oe,isLoading:re}=([o,c]=v(()=>K({queryKey:["objectsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>Be(),enabled:g})),o=await o,c(),o),te=y([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"},{id:5,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:se,success:oe,loading:re,select:!0},{id:6,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:f,success:J,loading:W,select:!0},{id:7,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:Y,success:Z,loading:ee,select:!0}]),{mutate:ae,status:le}=Ke({onMutate:s=>{O.value=!0,s.buildingObjectId=s.buildingObjectId[0],s.regionId=s.regionId[0],s.districtId=s.districtId[0]},mutationFn:s=>Oe("building_block",s),onSuccess:s=>{s!=null&&s.success&&(r.value=ke(r.value),b.invalidateQueries({queryKey:["blocks"]}),b.invalidateQueries({queryKey:["blocksList"]}),b.invalidateQueries({queryKey:["floorsList"]}),Q.push(x.BLOCK.path),setTimeout(()=>U.success(H("createToast")),150))}}),ce=()=>{if(t.value.$validate(),t.value.$errors.length)return;const s={...r.value};ae(s),t.value.$reset()};return(s,p)=>{var B,$;const ne=m("ManageHead"),ue=m("FormInput"),ie=m("FormSelect"),de=m("CustomButton");return g.value?(u(),_("section",Ce,[P("div",Ve,[T(ne,{title:"addNewBlocksTitle",to:a(x).BLOCK.path},null,8,["to"]),P("form",{class:"manage__form form-manage",onSubmit:ye(ce,["prevent"])},[(u(!0),_(D,null,ve(te.value,e=>{var S,C,V,N,j,q,w,E,R,M;return u(),_(D,{key:e.id},[e!=null&&e.select?k("",!0):(u(),A(ue,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":h=>r.value[e.model]=h,placeholder:s.$t(e.placeholder),name:e.icon,error:(C=(S=a(t))==null?void 0:S[e.errorKey])==null?void 0:C.$error,textError:(j=(N=(V=a(t))==null?void 0:V[e.errorKey])==null?void 0:N.$errors[0])==null?void 0:j.$message},{default:I(()=>[L(F(s.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(u(),A(ie,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":h=>r.value[e.model]=h,modelModifiers:{trim:!0},options:e.options,error:(w=(q=a(t))==null?void 0:q[e==null?void 0:e.errorKey])==null?void 0:w.$error,placeholder:e==null?void 0:e.placeholder,textError:(M=(R=(E=a(t))==null?void 0:E[e==null?void 0:e.errorKey])==null?void 0:R.$errors[0])==null?void 0:M.$message,success:e.success,loading:e.loading},{default:I(()=>[L(F(s.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):k("",!0)],64)}),128)),T(de,{className:`form__submit ${($=(B=a(t))==null?void 0:B.districtId.$errors[0])!=null&&$.$message?"centered":""}`,disabled:a(le)==="pending"},{default:I(()=>[L(F(s.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):k("",!0)}}};export{Te as default};
