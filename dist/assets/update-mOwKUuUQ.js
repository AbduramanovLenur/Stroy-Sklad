import{u as ce,a as me,r as y,b as ie,y as de,c as A,z as _,C as pe,d as g,e as R,k as T,h as o,w as he,F as x,D as ye,A as v,i as I,l as _e,G as ge,m,o as l,s as S,B as P,f as q,t as w,H as ve,E as Ie}from"./index-MC-ZGS-B.js";import{a as Se,u as qe}from"./crud.services-6pM_UmBK.js";import{j as we,b as $e}from"./manual.services-A3PttgtW.js";import{u as Ee,r as i}from"./i18n-validators-kzZnUJdY.js";import{u as be}from"./generic.services-iK8gJFXy.js";import{u as $}from"./useQuery-Q5uFjRao.js";import{u as Ve}from"./useMutation-FykAeqRT.js";const Ke={key:0,class:"manage section-height shadowed"},Be={class:"manage__inner section-padding"},Ne={__name:"update",async setup(Me){let t,u;const E=be(),b=_e(),D=ge(),O=ce(),{t:Q}=me(),d=y(D.params.id),z=ie(),{user:n}=de(z),c=A(()=>{var a,p;return!!((p=(a=n==null?void 0:n.value.user)==null?void 0:a.modules)!=null&&p.includes(ve.WAREHOUSE.UPDATE))}),s=y({id:"",materialId:[],quantity:"",stateId:[]}),G=A(()=>({id:{required:i},materialId:{required:i},quantity:{required:i},stateId:{required:i}})),r=Ee(G,s),{data:j,isSuccess:J,isLoading:X}=([t,u]=_(()=>$({queryKey:["materialsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>we(),enabled:c})),t=await t,u(),t),{data:Y,isSuccess:Z,isLoading:f}=([t,u]=_(()=>$({queryKey:["states"],queryFn:()=>$e(),enabled:c})),t=await t,u(),t),ee=y([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:j,success:J,loading:X,select:!0},{id:2,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"},{id:3,model:"stateId",label:"stateWarehouseLabel",placeholder:"stateWarehousePlaceholder",errorKey:"stateId",options:Y,success:Z,loading:f,select:!0}]),{isError:ae}=([t,u]=_(()=>$({queryKey:["warehouseById",d,n.value.user.fullName],queryFn:()=>Se("warehouse",d.value),select:a=>{s.value.id=a.id,s.value.materialId=[a.materialId],s.value.quantity=a.quantity,s.value.stateId=[a.stateId]},enabled:c})),t=await t,u(),t);pe(ae,a=>{a&&b.push(S.WAREHOUSE.path)});const{mutate:te,status:se}=Ve({onMutate:a=>{a.materialId=a.materialId[0],a.stateId=a.stateId[0]},mutationFn:a=>qe("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(s.value=Ie(s.value),E.invalidateQueries({queryKey:["warehouse"]}),E.invalidateQueries({queryKey:["warehouseById",d]}),b.push(S.WAREHOUSE.path),setTimeout(()=>O.success(Q("updateToast")),150))}}),re=async()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...s.value};te(a),r.value.$reset()};return(a,p)=>{var V,K;const oe=m("ManageHead"),ue=m("FormInput"),ne=m("FormSelect"),le=m("CustomButton");return c.value?(l(),g("section",Ke,[R("div",Be,[T(oe,{title:"editProductTitle",to:o(S).WAREHOUSE.path},null,8,["to"]),R("form",{class:"manage__form form-manage",onSubmit:he(re,["prevent"])},[(l(!0),g(x,null,ye(ee.value,e=>{var B,M,W,C,F,U,L,k,H,N;return l(),g(x,{key:e.id},[e!=null&&e.select?I("",!0):(l(),P(ue,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(M=(B=o(r))==null?void 0:B[e==null?void 0:e.errorKey])==null?void 0:M.$error,textError:(F=(C=(W=o(r))==null?void 0:W[e==null?void 0:e.errorKey])==null?void 0:C.$errors[0])==null?void 0:F.$message},{default:v(()=>[q(w(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(l(),P(ne,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,modelModifiers:{trim:!0},width:500,options:e.options,error:(L=(U=o(r))==null?void 0:U[e==null?void 0:e.errorKey])==null?void 0:L.$error,placeholder:e==null?void 0:e.placeholder,textError:(N=(H=(k=o(r))==null?void 0:k[e==null?void 0:e.errorKey])==null?void 0:H.$errors[0])==null?void 0:N.$message,success:e.success,loading:e.loading},{default:v(()=>[q(w(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):I("",!0)],64)}),128)),T(le,{className:`form__submit ${(K=(V=o(r))==null?void 0:V.stateId.$errors[0])!=null&&K.$message?"centered":""}`,disabled:o(se)==="pending"},{default:v(()=>[q(w(a.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):I("",!0)}}};export{Ne as default};
