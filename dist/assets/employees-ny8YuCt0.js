import{_ as ye,s as pe,r as m,c as E,k as b,o as u,a as S,b as O,i as N,l as w,e as q,t as f,g as l,m as L,h as V,F as G,d as U,w as he}from"./index-GPu3ycXY.js";import{u as ge,c as x,r,m as ve}from"./secondary-functions-7D58TPs_.js";import{u as be,a as Ne,b as M,T as we,F as fe,A as Fe,c as _e,d as Ie,e as Se,C as qe,f as Le,g as F,S as $e,h as Ke,i as ze,j as Ee,p as Oe,q as Ve,l as Me,n as Te,o as Be}from"./Spinner-jnvZGIDj.js";const ke={class:"employees"},Ce={class:"employees__inner"},Pe={class:"employees__head"},Ae={key:2,class:"empty-table"},Qe={__name:"employees",async setup(Re){let s,t;const _=be(),T=Ne(),{toggleIsOpenModalForm:B}=T,{isOpenModalForm:$}=pe(T),k=m("addNewEmployeesTitle"),c=m(""),I=m(""),C=E(()=>$),P=E(()=>$&&c.value=="edit"),{data:H,isSuccess:D,isLoading:W}=([s,t]=b(()=>F({queryKey:["organizations"],queryFn:()=>Oe(),enabled:C})),s=await s,t(),s),{data:j,isSuccess:J,isLoading:X}=([s,t]=b(()=>F({queryKey:["districts"],queryFn:()=>Ve(),enabled:C})),s=await s,t(),s),{data:Y,isSuccess:Z,isLoading:ee}=([s,t]=b(()=>F({queryKey:["statesEmployees"],queryFn:()=>Me(),enabled:P})),s=await s,t(),s),o=m({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:"",roleId:"",stateId:"",search:""}),ae=E(()=>{switch(c.value){case"edit":return{fullName:{required:r},userName:{required:r},phoneNumber:{required:r},organizationId:{required:r},roleId:{required:r}};default:return{fullName:{required:r},userName:{required:r},password:{required:r,minLength:ve},phoneNumber:{required:r},organizationId:{required:r},roleId:{required:r}}}}),oe=m([{id:1,label:"employeesFullName",width:300},{id:2,label:"employeesOrganization",width:320},{id:3,label:"employeesPhone",width:255},{id:4,label:"employeesRole",width:195},{id:5,label:"employeesState",width:250},{id:8,label:"employeesAction",width:190}]),se=m([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber"}]),le=m([{id:1,model:"organizationId",label:"employeesOrganizationLabel",options:H,errorKey:"organizationId",success:D,loading:W,show:["create","edit"]},{id:2,model:"roleId",label:"employeesRoleLabel",options:j,errorKey:"roleId",success:J,loading:X,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:Y,success:Z,loading:ee,show:["edit"]}]),n=ge(ae,o),{data:K,isLoading:re,isSuccess:A}=([s,t]=b(()=>F({queryKey:["employees"],queryFn:()=>Te("user"),select:e=>e.map(d=>{const i={...d,phone:d.phoneNumber,company:d.organizationName};return delete i.phoneNumber,delete i.organizationName,i})})),s=await s,t(),s);[s,t]=b(()=>F({queryKey:["employeesById",I],queryFn:()=>Be("user",I.value),select:e=>{o.value.id=e.id,o.value.fullName=e.fullname,o.value.userName=e.userName,o.value.phoneNumber=e.phoneNumber,o.value.organizationId=e.organizationId,o.value.roleId=e.roleId,o.value.stateId=e.stateId},enabled:P})),s=await s,t();const{mutate:te}=M({mutationFn:e=>Ke("user",e),onSuccess:()=>{_.invalidateQueries({queryKey:["employees"]})}}),{mutate:ne}=M({mutationFn:e=>ze("user",e),onSuccess:()=>{_.invalidateQueries({queryKey:["employees"]}),_.invalidateQueries({queryKey:["getByIdEmployees",I]})}}),{mutate:de}=M({mutationFn:e=>Ee("user",e),onSuccess:()=>{_.invalidateQueries({queryKey:["employees"]})}}),Q=(e,d)=>{k.value=e,c.value=d,B(),c.value==="create"&&$.value&&(o.value=x(o.value),n.value.$reset())},ie=()=>{Q("addNewEmployeesTitle","create")},ue=e=>{I.value=e,Q("editEmployeesTitle","edit")},me=e=>{de(e)},ce=()=>{n.value.$validate(),!n.value.$errors.length&&(c.value==="create"?(delete o.value.id,delete o.value.stateId,te(o.value)):ne(o.value),B(),o.value=x(o.value),n.value.$reset())};return(e,d)=>(u(),S("section",ke,[O("div",Ce,[O("div",Pe,[N(we,null,{default:w(()=>[q(`\r
                    `+f(e.$t("employeesTitle"))+`\r
                `,1)]),_:1}),N(fe,{onOnSearch:d[0]||(d[0]=i=>o.value.search=i)}),N(Fe,{onOnOpenFormModal:ie})]),l(A)&&l(K).length?(u(),L(_e,{key:0,headers:oe.value,table:l(K),onOnActionEdit:ue,onOnActionDelete:me},null,8,["headers","table"])):V("",!0),l(re)?(u(),L($e,{key:1})):V("",!0),l(A)&&!l(K).length?(u(),S("div",Ae,f(e.$t("emptyTableTitle")),1)):V("",!0)]),N(Le,{title:k.value},{default:w(()=>{var i,R;return[O("form",{class:"employees__form",onSubmit:he(ce,["prevent"])},[(u(!0),S(G,null,U(se.value,a=>{var y,p,h,g,v;return u(),L(Ie,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":z=>o.value[a.model]=z,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(p=(y=l(n))==null?void 0:y[a==null?void 0:a.errorKey])==null?void 0:p.$error,textError:(v=(g=(h=l(n))==null?void 0:h[a==null?void 0:a.errorKey])==null?void 0:g.$errors[0])==null?void 0:v.$message},{default:w(()=>[q(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(u(!0),S(G,null,U(le.value,a=>{var y,p,h,g,v;return u(),L(Se,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":z=>o.value[a.model]=z,width:500,options:a.options,error:(p=(y=l(n))==null?void 0:y[a==null?void 0:a.errorKey])==null?void 0:p.$error,textError:(v=(g=(h=l(n))==null?void 0:h[a==null?void 0:a.errorKey])==null?void 0:g.$errors[0])==null?void 0:v.$message,success:a.success,loading:a.loading,show:a.show,requestFlag:c.value},{default:w(()=>[q(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),N(qe,{className:`form__submit ${(R=(i=l(n))==null?void 0:i.roleId.$errors[0])!=null&&R.$message?"centered":""}`},{default:w(()=>[q(f(e.$t("formButton")),1)]),_:1},8,["className"])],32)]}),_:1},8,["title"])]))}},He=ye(Qe,[["__scopeId","data-v-39102e49"]]);export{He as default};
