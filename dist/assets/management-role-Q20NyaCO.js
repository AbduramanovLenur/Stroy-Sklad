import{_ as Z,u as j,a as x,b as ee,y as te,c as g,r as se,z as q,d,e as i,k as m,A as y,h as f,w as oe,F as ae,D as ne,B as le,i as h,l as ie,m as _,o as r,f as A,t as E,s as re,H as I}from"./index-zJOFZS3J.js";import{u as ue}from"./generic.services-5LadNNBD.js";import{u as V}from"./useQuery-F462u6z4.js";import{u as ce}from"./useMutation-WxfEVhVn.js";import{j as de,k as me}from"./crud.services-Eo6zCu9X.js";import{e as _e}from"./manual.services-lJTOI63O.js";import{v as u}from"./v4-yQnnJER4.js";const pe={key:0,class:"management-role section-height shadowed"},ve={class:"management-role__inner section-padding"},ge={class:"management-role__head"},ye={class:"management-role__selects"},fe={class:"management-role__select-box"},he={class:"management-role__actions"},Ae=["onClick"],Ee=["onClick"],Ie={__name:"management-role",async setup(Me){let n,p;const M=ue();ie();const b=j(),{t:T}=x(),F=ee(),{user:o}=te(F),k=g(()=>{var e,s;return(s=(e=o==null?void 0:o.value.user)==null?void 0:e.modules)==null?void 0:s.includes(I.MANAGEMENT_ROLE.READ)}),N=g(()=>{var e,s,t,a;return((s=(e=o==null?void 0:o.value.user)==null?void 0:e.modules)==null?void 0:s.includes(I.MANAGEMENT_ROLE.CREATE))||((a=(t=o==null?void 0:o.value.user)==null?void 0:t.modules)==null?void 0:a.includes(I.MANAGEMENT_ROLE.UPDATE))}),l=se([{uuid:u(),roleIds:[],label:"creatorApp"},{uuid:u(),roleIds:[],label:"confirmApp"}]),{data:G,isSuccess:z,isLoading:D}=([n,p]=q(()=>V({queryKey:["rolesList",{organizationId:o.value.user.organizationId}],queryFn:()=>_e(),enabled:k})),n=await n,p(),n),{data:ke,isSuccess:K,isLoading:P}=([n,p]=q(()=>V({queryKey:["positions",{organizationId:o.value.user.organizationId}],queryFn:()=>de("application_position"),select:e=>{if(e.length)return l.value=e.map((s,t)=>{let a={};return t===0?a={uuid:u(),roleIds:[...s.roleIds],label:"creatorApp"}:t+1===e.length?a={uuid:u(),roleIds:[...s.roleIds],label:"confirmApp"}:a={uuid:u(),roleIds:[...s.roleIds],label:"inspectorApp"},a}),e},enabled:k})),n=await n,p(),n),Q=g(()=>z.value&&K.value),O=g(()=>D.value&&P.value),U=e=>{l.value.splice(e,0,{uuid:u(),roleIds:[],label:"inspectorApp"})},$=e=>l.value.splice(e,1),{mutate:H}=ce({onMutate:e=>{e=e.map(s=>{const t={...s};return t==null||delete t.uuid,t==null||delete t.label,t})},mutationFn:e=>me("application_position",e),onSuccess:e=>{e!=null&&e.success&&(M.invalidateQueries({queryKey:["positions"]}),M.invalidateQueries({queryKey:["applications"]}),M.invalidateQueries({queryKey:["applicationsById"]}),setTimeout(()=>b.success(T("createToast")),150))}}),J=()=>{if(l.value.some(s=>!s.roleIds.length)){b.error(T("isEmptyRole"));return}H(l.value)};return(e,s)=>{const t=_("Title"),a=_("MyButton"),W=_("FormSelect"),R=_("Icon"),X=_("CustomButton");return k.value?(r(),d("section",pe,[i("div",ve,[i("div",ge,[m(t,null,{default:y(()=>[A(`\r
                    `+E(e.$t("managementTitle"))+`\r
                `,1)]),_:1}),m(a,{to:f(re).MANAGEMENT.path,icon:"back",type:"link",color:"black"},{default:y(()=>[A(E(e.$t("backButton")),1)]),_:1},8,["to"])]),i("form",{class:"management-role__form",onSubmit:oe(J,["prevent"])},[i("div",ye,[(r(!0),d(ae,null,ne(l.value,(v,c)=>{var S,C,B,L,w;return r(),d("div",{class:"management-role__select",key:v.uuid},[i("div",fe,[m(W,{modelValue:v.roleIds,"onUpdate:modelValue":Y=>v.roleIds=Y,modelModifiers:{trim:!0},width:500,options:f(G),placeholder:"managementRolePlaceholder",success:Q.value,loading:O.value,isMultiSelect:!0},{default:y(()=>[A(E(e.$t(v.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","success","loading"])]),i("div",he,[c+1!==((S=l.value)==null?void 0:S.length)&&N.value?(r(),d("div",{key:0,class:"management-role__icon",onClick:()=>U(c+1)},[m(R,{name:"plus"})],8,Ae)):h("",!0),c!==0&&c+1!==((C=l.value)==null?void 0:C.length)&&((w=(L=(B=f(o))==null?void 0:B.user)==null?void 0:L.modules)!=null&&w.includes(f(I).MANAGEMENT_ROLE.DELETE))?(r(),d("div",{key:1,class:"management-role__icon",onClick:()=>$(c)},[m(R,{name:"delete-role"})],8,Ee)):h("",!0)])])}),128))]),N.value?(r(),le(X,{key:0,className:"form__submit"},{default:y(()=>[A(E(e.$t("formButton")),1)]),_:1})):h("",!0)],32)])])):h("",!0)}}},Le=Z(Ie,[["__scopeId","data-v-7b303736"]]);export{Le as default};
