import{_ as ue,u as pe,a as me,r as g,c as d,B as be,m,o as c,d as h,e as L,t as b,F as w,C as O,z as E,D as I,f as _,k as f,J as ze,q as He,b as xe,x as Ge,y as S,h as p,w as Qe,i as de,l as Re,A as ce,G as Je,I as x}from"./index-KKCGiaOF.js";import{u as We,r as B}from"./i18n-validators-TpKHFGOg.js";import{a as Xe,u as Ye}from"./generic.services-xhLq1RN3.js";import{u as F}from"./useQuery-W7o1xA7A.js";import{c as Ze}from"./crud.services-tsBZfuRX.js";import{f as ea,g as aa,h as oa,i as la,j as ta}from"./manual.services-1tbz_eEo.js";import{v as sa}from"./v4-yQnnJER4.js";const ra={class:"application-form"},na={class:"application-form__title"},ia={class:"application-form__overlay form-manage"},da={__name:"ApplicationForm",props:["selects","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(j,{emit:l}){const i=pe(),{t:P}=me(),q=j,K=l,r=g({floorId:[],costId:[],constructionMaterialId:[],count:""}),N=d(()=>q.buildingBlockId);be(N,()=>{r.value.floorId=[]});const v=g([{id:1,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"}]),T=()=>{if(!ze(r.value)){i.error(P("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count,price:r.value.price},K("onAddTable",r.value),r.value=He(r.value)};return(u,G)=>{const s=m("FormSelect"),U=m("FormInput"),n=m("CustomButton");return c(),h("div",ra,[L("h4",na,b(u.$t("appInfo")),1),L("div",ia,[(c(!0),h(w,null,O(j.selects,o=>(c(),E(s,{key:o.id,modelValue:r.value[o.model],"onUpdate:modelValue":y=>r.value[o.model]=y,width:500,options:o.options,placeholder:o==null?void 0:o.placeholder,success:o.success,loading:o.loading,isMultiSelect:o==null?void 0:o.multiple},{default:I(()=>[_(b(u.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128)),(c(!0),h(w,null,O(v.value,o=>(c(),E(U,{key:o.id,modelValue:r.value[o.model],"onUpdate:modelValue":y=>r.value[o.model]=y,width:500,placeholder:u.$t(o.placeholder),name:o.icon,type:o==null?void 0:o.type},{default:I(()=>[_(b(u.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),f(n,{className:"form__submit",type:"button",onClick:T},{default:I(()=>[_(b(u.$t("addButtonForm")),1)]),_:1})])])}}},ca=ue(da,[["__scopeId","data-v-f2cfa771"]]),ua={key:0,class:"manage section-height shadowed"},pa={class:"manage__inner section-padding"},ma={class:"manage__overlay"},ba={key:0,class:"error"},va={__name:"create",async setup(j){let l,i;const P=Xe(),q=Re(),K=pe(),{t:r}=me(),N=xe(),{user:v}=Ge(N),T=d(()=>{var e,t;return!!((t=(e=v==null?void 0:v.value.user)==null?void 0:e.modules)!=null&&t.includes(Je.APPLICATION.CREATE))}),u=g(!1),G=g([{id:1,label:"appFloor",width:350},{id:2,label:"appMaterial",width:370},{id:3,label:"appCount",width:260},{id:4,label:"appPrice",width:350}]),s=g({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:""}),U=d(()=>({deadline:{required:B},buildingObjectId:{required:B},buildingBlockId:{required:B},createApplicationTables:{required:B},details:{required:B}})),n=We(U,s),{data:o,isSuccess:y,isLoading:ve}=([l,i]=S(()=>F({queryKey:["objectsList",{organizationId:v.value.user.organizationId}],queryFn:()=>ea(),enabled:T})),l=await l,i(),l),C=d(()=>s.value.buildingObjectId),ge=d(()=>!!C.value.length);be(C,()=>{u.value||(s.value.buildingBlockId=[])},{immediate:!0});const{data:he,isSuccess:Ie,isLoading:_e}=([l,i]=S(()=>F({queryKey:["blocksList",{blockId:C}],queryFn:()=>la(C.value),enabled:ge})),l=await l,i(),l),D=d(()=>s.value.buildingBlockId),z=d(()=>!!D.value.length),{data:Q,isSuccess:fe,isLoading:ye}=([l,i]=S(()=>F({queryKey:["floorsList",{floorId:D}],queryFn:()=>ta(D.value),enabled:z})),l=await l,i(),l),{data:R,isSuccess:Ae,isLoading:ke}=([l,i]=S(()=>F({queryKey:["costsList",{organizationId:v.value.user.organizationId}],queryFn:()=>aa(),enabled:z})),l=await l,i(),l),{data:J,isSuccess:Ve,isLoading:$e}=([l,i]=S(()=>F({queryKey:["materialsList",{organizationId:v.value.user.organizationId}],queryFn:()=>oa(),enabled:z})),l=await l,i(),l),Me=g([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),Se=g([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:o,success:y,loading:ve},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:he,success:Ie,loading:_e}]),Be=g([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:Q,success:fe,loading:ye},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:R,success:Ae,loading:ke},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:J,success:Ve,loading:$e}]),W=d(()=>x(Q.value)),X=d(()=>x(R.value)),Y=d(()=>x(J.value)),Fe=e=>{var t;return(t=W.value[e.floorId])==null?void 0:t.name},Le=e=>{var t;return(t=X.value[e.costId])==null?void 0:t.name},Te=e=>{var t;return(t=Y.value[e==null?void 0:e.constructionMaterialId])==null?void 0:t.name},Ce=d(()=>Object.keys(W.value).length&&Object.keys(X.value).length&&Object.keys(Y.value).length),we=e=>{if(Ce){s.value.createApplicationTables.push({...e,delId:sa(),floorValue:Fe(e),costValue:Le(e),constructionMaterialValue:Te(e)});return}K.error(r("estimateEmptyData"))},Oe=e=>{s.value.createApplicationTables=s.value.createApplicationTables.filter(t=>t.delId!==e)},{mutate:Ee}=Ye({onMutate:e=>{u.value=!0,e.buildingObjectId=e.buildingObjectId[0],e.buildingBlockId=e.buildingBlockId[0],e.createApplicationTables=e.createApplicationTables.map(t=>(delete t.delId,delete t.floorValue,delete t.costValue,delete t.constructionMaterialValue,t))},mutationFn:e=>Ze("application",e),onSuccess:()=>{P.invalidateQueries({queryKey:["applications"]}),q.push(ce.APPLICATION.path)}}),je=()=>{n.value.$validate(),!n.value.$errors.length&&(Ee(s.value),n.value.$reset())};return(e,t)=>{var Z,ee,ae,oe,le,te,se,re,ne,ie;const Pe=m("ManageHead"),qe=m("FormInput"),Ke=m("FormSelect"),Ne=m("SubTable"),Ue=m("FormTextarea"),De=m("CustomButton");return T.value?(c(),h("section",ua,[L("div",pa,[f(Pe,{title:"addNewApplicationTitle",to:p(ce).APPLICATION.path},null,8,["to"]),L("form",{class:"manage__form",onSubmit:Qe(je,["prevent"])},[L("div",ma,[(c(!0),h(w,null,O(Me.value,a=>{var A,k,V,$,M;return c(),E(qe,{key:a.id,modelValue:s.value[a.model],"onUpdate:modelValue":H=>s.value[a.model]=H,modelModifiers:{trim:!0},width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(k=(A=p(n))==null?void 0:A[a.errorKey])==null?void 0:k.$error,textError:(M=($=(V=p(n))==null?void 0:V[a.errorKey])==null?void 0:$.$errors[0])==null?void 0:M.$message,type:a==null?void 0:a.type},{default:I(()=>[_(b(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(c(!0),h(w,null,O(Se.value,a=>{var A,k,V,$,M;return c(),E(Ke,{key:a.id,modelValue:s.value[a.model],"onUpdate:modelValue":H=>s.value[a.model]=H,modelModifiers:{trim:!0},width:500,options:a.options,error:(k=(A=p(n))==null?void 0:A[a==null?void 0:a.errorKey])==null?void 0:k.$error,placeholder:a==null?void 0:a.placeholder,textError:(M=($=(V=p(n))==null?void 0:V[a==null?void 0:a.errorKey])==null?void 0:$.$errors[0])==null?void 0:M.$message,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple},{default:I(()=>[_(b(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128))]),f(ca,{selects:Be.value,buildingBlockId:s.value.buildingBlockId,isSubmit:u.value,onOnAddTable:we},null,8,["selects","buildingBlockId","isSubmit"]),(ee=(Z=p(n))==null?void 0:Z.createApplicationTables)!=null&&ee.$error?(c(),h("span",ba,b((le=(oe=(ae=p(n))==null?void 0:ae.createApplicationTables)==null?void 0:oe.$errors[0])==null?void 0:le.$message),1)):de("",!0),f(Ne,{headers:G.value,table:s.value.createApplicationTables,onOnActionDelete:Oe,isShowDelete:!0},null,8,["headers","table"]),f(Ue,{modelValue:s.value.details,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value.details=a),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),error:(se=(te=p(n))==null?void 0:te.details)==null?void 0:se.$error,textError:(ie=(ne=(re=p(n))==null?void 0:re.details)==null?void 0:ne.$errors[0])==null?void 0:ie.$message},{default:I(()=>[_(b(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),f(De,{className:"manage__submit"},{default:I(()=>[_(b(e.$t("appButton")),1)]),_:1})],32)])])):de("",!0)}}},ka=ue(va,[["__scopeId","data-v-72c43fdf"]]);export{ka as default};
//# sourceMappingURL=create--0eEmCOf.js.map
