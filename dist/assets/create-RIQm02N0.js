import{u as te,a as se,b as ie,y as ne,c as p,r as h,z as O,B as de,d as I,e as B,k as L,h as s,w as le,F as T,C as F,D as $,i as ce,l as ue,m as _,o as u,s as q,A as M,f as S,t as C,H as me,E as ge}from"./index-5G4lX_kF.js";import{u as pe,r as b}from"./i18n-validators-kwMFYdQc.js";import{a as he,u as _e}from"./generic.services-wDHkXJdP.js";import{u as k}from"./useQuery-C9Tez9jj.js";import{c as be}from"./crud.services-8wN-UV3w.js";import{m as ve,a as fe}from"./manual.services-BLVh4IBb.js";const ye={key:0,class:"manage section-height shadowed"},Ie={class:"manage__inner section-padding"},Ke={__name:"create",async setup($e){let o,m;const V=he(),N=ue(),R=te(),{t:D}=se(),x=ie(),{user:v}=ne(x),j=p(()=>{var a,f;return!!((f=(a=v==null?void 0:v.value.user)==null?void 0:a.modules)!=null&&f.includes(me.OBJECT.CREATE))}),w=h(!1),r=h({name:"",address:"",regionId:[],districtId:[]}),U=p(()=>({name:{required:b},address:{required:b},regionId:{required:b},districtId:{required:b}})),t=pe(U,r),{data:H,isSuccess:P,isLoading:Q}=([o,m]=O(()=>k({queryKey:["regions"],queryFn:()=>ve(),enabled:j})),o=await o,m(),o),g=p(()=>r.value.regionId),A=p(()=>!!g.value.length);de(g,()=>{w.value||(r.value.districtId=[])},{immediate:!0});const{data:J,isSuccess:G,isLoading:z}=([o,m]=O(()=>k({queryKey:["districts",{districtId:g}],queryFn:()=>fe(g.value),enabled:A})),o=await o,m(),o),W=h([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"}]),X=h([{id:1,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:H,success:P,loading:Q},{id:2,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:J,success:G,loading:z}]),{mutate:Y}=_e({onMutate:a=>{w.value=!0,a.regionId=a.regionId[0],a.districtId=a.districtId[0]},mutationFn:a=>be("building_object",a),onSuccess:a=>{a!=null&&a.success&&(r.value=ge(r.value),V.invalidateQueries({queryKey:["objects"]}),V.invalidateQueries({queryKey:["objectsList"]}),N.push(q.OBJECT.path),setTimeout(()=>R.success(D("createToast")),150))}}),Z=()=>{if(t.value.$validate(),t.value.$errors.length)return;const a={...r.value};Y(a),t.value.$reset()};return(a,f)=>{var E,K;const ee=_("ManageHead"),ae=_("FormInput"),re=_("FormSelect"),oe=_("CustomButton");return j.value?(u(),I("section",ye,[B("div",Ie,[L(ee,{title:"addNewObjectTitle",to:s(q).OBJECT.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:le(Z,["prevent"])},[(u(!0),I(T,null,F(W.value,e=>{var i,n,d,l,c;return u(),M(ae,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":y=>r.value[e.model]=y,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(n=(i=s(t))==null?void 0:i[e.errorKey])==null?void 0:n.$error,textError:(c=(l=(d=s(t))==null?void 0:d[e.errorKey])==null?void 0:l.$errors[0])==null?void 0:c.$message},{default:$(()=>[S(C(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(u(!0),I(T,null,F(X.value,e=>{var i,n,d,l,c;return u(),M(re,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":y=>r.value[e.model]=y,modelModifiers:{trim:!0},width:500,options:e.options,error:(n=(i=s(t))==null?void 0:i[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(l=(d=s(t))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:l.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:$(()=>[S(C(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(oe,{className:`form__submit ${(K=(E=s(t))==null?void 0:E.districtId.$errors[0])!=null&&K.$message?"centered":""}`},{default:$(()=>[S(C(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ce("",!0)}}};export{Ke as default};
