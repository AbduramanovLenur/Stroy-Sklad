import{u as se,a as le,b as te,y as de,c as U,r as h,z as b,B as ue,d as N,e as B,k as P,h as d,w as ne,F as q,C,D as S,i as me,l as ie,G as ce,m as g,o as p,s as w,A as M,f as $,t as K,H as pe,E as ye}from"./index-4OOvqjps.js";import{u as he,r as l}from"./i18n-validators-S6ZLWYVi.js";import{a as ge,u as fe}from"./generic.services-cM7RLDwf.js";import{u as L}from"./useQuery-k2tfLaah.js";import{a as _e,u as Ie}from"./crud.services-NECAoUBm.js";import{e as ve,b as be}from"./manual.services-SGmJYzSL.js";const Ne={key:0,class:"manage section-height shadowed"},Se={class:"manage__inner section-padding"},Fe={__name:"update",async setup(we){let r,t;const R=ge(),E=ie(),k=ce(),z=se(),{t:T}=le(),G=te(),{user:f}=de(G),y=U(()=>{var o,I;return!!((I=(o=f==null?void 0:f.value.user)==null?void 0:o.modules)!=null&&I.includes(pe.ORG_USER.UPDATE))}),_=h(k.params.id),a=h({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:"",roleId:[],stateId:[]}),x=U(()=>({id:{required:l},fullName:{required:l},userName:{required:l},phoneNumber:{required:l},organizationId:{required:l},roleId:{required:l},stateId:{required:l}})),s=he(x,a),{data:H,isSuccess:D,isLoading:O}=([r,t]=b(()=>L({queryKey:["rolesList",{organizationId:a.value.organizationId}],queryFn:()=>ve(),enabled:y})),r=await r,t(),r),{data:Q,isSuccess:A,isLoading:W}=([r,t]=b(()=>L({queryKey:["states"],queryFn:()=>be(),enabled:y})),r=await r,t(),r),j=h([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"}]),J=h([{id:1,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:H,success:D,loading:O},{id:2,model:"stateId",label:"employeesStateLabel",placeholder:"employeesStatePlaceholder",errorKey:"stateId",options:Q,success:A,loading:W}]),{isError:X}=([r,t]=b(()=>L({queryKey:["orgUserById",_],queryFn:()=>_e("user",_.value),select:o=>{a.value.id=o.id,a.value.fullName=o.fullName,a.value.userName=o.userName,a.value.phoneNumber=o.phoneNumber,a.value.organizationId=o.organizationId,a.value.roleId=[o.roleId],a.value.stateId=[o.stateId]},enabled:y})),r=await r,t(),r);ue(X,o=>{o&&E.push(w.HOME.path)});const{mutate:Y}=fe({onMutate:o=>{o.roleId=o.roleId[0],o.stateId=o.stateId[0]},mutationFn:o=>Ie("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=ye(a.value),R.invalidateQueries({queryKey:["orgUsers"]}),R.invalidateQueries({queryKey:["orgUserById",_]}),E.push(w.ORG_USER.path),setTimeout(()=>z.success(T("updateToast")),150))}}),Z=async()=>{if(s.value.$validate(),s.value.$errors.length)return;const o={...a.value};Y(o),s.value.$reset()};return(o,I)=>{var V,F;const ee=g("ManageHead"),oe=g("FormInput"),ae=g("FormSelect"),re=g("CustomButton");return y.value?(p(),N("section",Ne,[B("div",Se,[P(ee,{title:"editEmployeesTitle",to:d(w).ORG_USER.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:ne(Z,["prevent"])},[(p(!0),N(q,null,C(j.value,e=>{var u,n,m,i,c;return p(),M(oe,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":v=>a.value[e.model]=v,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(n=(u=d(s))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:n.$error,type:e==null?void 0:e.type,textError:(c=(i=(m=d(s))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message},{default:S(()=>[$(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),(p(!0),N(q,null,C(J.value,e=>{var u,n,m,i,c;return p(),M(ae,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":v=>a.value[e.model]=v,modelModifiers:{trim:!0},width:500,options:e.options,error:(n=(u=d(s))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(i=(m=d(s))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:S(()=>[$(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),P(re,{className:`form__submit ${(F=(V=d(s))==null?void 0:V.stateId.$errors[0])!=null&&F.$message?"centered":""}`},{default:S(()=>[$(K(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):me("",!0)}}};export{Fe as default};
