import{u as Z,a as ee,b as ae,x as se,c as K,r as p,y as q,B as oe,d as I,e as C,k as F,h as r,w as te,F as M,C as k,D as $,i as re,l as ne,E as le,m as y,o as i,A as S,z as L,f as x,t as N,G as ue}from"./index-PETUmaAP.js";import{u as de,r as V}from"./i18n-validators-2l0qbyJV.js";import{a as me,u as ie}from"./generic.services-keg-kLkd.js";import{u as P}from"./useQuery-snUqoZeO.js";import{a as ce,u as pe}from"./crud.services-B84SRtCm.js";import{b as ye}from"./manual.services-WXTEfgwA.js";const he={key:0,class:"manage section-height shadowed"},fe={class:"manage__inner section-padding"},xe={__name:"update",async setup(_e){let o,c;const h=me(),b=ne(),U=le();Z(),ee();const Q=ae(),{user:f}=se(Q),_=K(()=>{var a,g;return!!((g=(a=f==null?void 0:f.value.user)==null?void 0:a.modules)!=null&&g.includes(ue.EXPENS.UPDATE))}),v=p(U.params.id),s=p({id:"",fullName:"",stateId:[]}),T=K(()=>({id:{required:V},fullName:{required:V},stateId:{required:V}})),t=de(T,s),{data:H,isSuccess:A,isLoading:D}=([o,c]=q(()=>P({queryKey:["states"],queryFn:()=>ye(),enabled:_})),o=await o,c(),o),R=p([{id:1,model:"fullName",label:"nameExpensesLabel",placeholder:"nameExpensesPlaceholder",icon:"input-company",errorKey:"fullName"}]),X=p([{id:1,model:"stateId",label:"stateExpensesLabel",placeholder:"stateExpensesPlaceholder",errorKey:"stateId",options:H,success:A,loading:D}]),{isError:G}=([o,c]=q(()=>P({queryKey:["expensesById",v],queryFn:()=>ce("cost",v.value),select:a=>{s.value.id=a.id,s.value.fullName=a.fullname,s.value.stateId=[a.stateId]},enabled:_})),o=await o,c(),o);oe(G,a=>{a&&b.push(S.HOME.path)});const{mutate:z}=ie({onMutate:a=>{a.stateId=a.stateId[0]},mutationFn:a=>pe("cost",a),onSuccess:()=>{h.invalidateQueries({queryKey:["expenses"]}),h.invalidateQueries({queryKey:["expensesById",v]}),h.invalidateQueries({queryKey:["costsList"]}),b.push(S.EXPENS.path)}}),O=async()=>{t.value.$validate(),!t.value.$errors.length&&(z(s.value),t.value.$reset())};return(a,g)=>{var w,B;const W=y("ManageHead"),j=y("FormInput"),J=y("FormSelect"),Y=y("CustomButton");return _.value?(i(),I("section",he,[C("div",fe,[F(W,{title:"editExpensesTitle",to:r(S).EXPENS.path},null,8,["to"]),C("form",{class:"manage__form form-manage",onSubmit:te(O,["prevent"])},[(i(!0),I(M,null,k(R.value,e=>{var n,l,u,d,m;return i(),L(j,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":E=>s.value[e.model]=E,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(l=(n=r(t))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,textError:(m=(d=(u=r(t))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:d.$errors[0])==null?void 0:m.$message},{default:$(()=>[x(N(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(i(!0),I(M,null,k(X.value,e=>{var n,l,u,d,m;return i(),L(J,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":E=>s.value[e.model]=E,width:500,options:e.options,error:(l=(n=r(t))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(d=(u=r(t))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:d.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:$(()=>[x(N(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),F(Y,{className:`form__submit ${(B=(w=r(t))==null?void 0:w.stateId.$errors[0])!=null&&B.$message?"centered":""}`},{default:$(()=>[x(N(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):re("",!0)}}};export{xe as default};
//# sourceMappingURL=update-mWLP72vA.js.map
