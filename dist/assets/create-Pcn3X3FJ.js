import{_ as Ae,u as Ve,a as ke,r as A,c as p,C as $e,m as v,o as d,d as b,e as V,t as m,F as w,D as Me,B as f,A as g,f as I,i as k,k as h,K as Ze,q as Fe,b as ea,y as aa,z as B,h as u,w as oa,l as ta,s as ye,H as la,J as G,E as sa}from"./index-td5OKsxi.js";import{c as ra}from"./crud.services-f6-dtRnP.js";import{f as na,g as ca,h as ua,i as ia,j as da}from"./manual.services-EaI1aYj6.js";import{u as pa,r as y}from"./i18n-validators-Zg_qUvB4.js";import{u as ma}from"./generic.services-lfCsIIL0.js";import{u as T}from"./useQuery-wqCEShPl.js";import{u as va}from"./useMutation-td-rGYVU.js";import{v as ga}from"./v4-yQnnJER4.js";const Ia={class:"application-form"},ha={class:"application-form__title"},ba={class:"application-form__overlay form-manage"},_a={__name:"ApplicationForm",props:{subFields:Array,buildingBlockId:Array,isSubmit:Boolean},emits:["onAddTable"],setup(E,{emit:l}){const c=Ve(),{t:O}=ke(),P=E,q=l,r=A({floorId:[],costId:[],constructionMaterialId:[],count:""}),N=p(()=>P.buildingBlockId);$e(N,()=>{r.value.floorId=[]});const n=()=>{if(!Ze(r.value)){c.error(O("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count},q("onAddTable",r.value),r.value=Fe(r.value)};return(i,L)=>{const K=v("FormInput"),s=v("FormSelect"),j=v("CustomButton");return d(),b("div",Ia,[V("h4",ha,m(i.$t("appInfo")),1),V("div",ba,[(d(!0),b(w,null,Me(E.subFields,a=>(d(),b(w,{key:a.id},[a!=null&&a.select?k("",!0):(d(),f(K,{key:0,modelValue:r.value[a.model],"onUpdate:modelValue":$=>r.value[a.model]=$,placeholder:i.$t(a.placeholder),name:a.icon,type:a==null?void 0:a.type},{default:g(()=>[I(m(i.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),a!=null&&a.select?(d(),f(s,{key:1,modelValue:r.value[a.model],"onUpdate:modelValue":$=>r.value[a.model]=$,modelModifiers:{trim:!0},options:a.options,placeholder:a==null?void 0:a.placeholder,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple},{default:g(()=>[I(m(i.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"])):k("",!0)],64))),128)),h(j,{className:"form__submit",type:"button",onClick:n},{default:g(()=>[I(m(i.$t("addButtonForm")),1)]),_:1})])])}}},ya=Ae(_a,[["__scopeId","data-v-50222675"]]),Aa={key:0,class:"manage section-height shadowed"},Va={class:"manage__inner section-padding"},ka={class:"manage__overlay"},$a={key:0,class:"error"},Ma={class:"manage__textareas"},Sa={__name:"create",async setup(E){let l,c;const O=ma(),P=ta(),q=Ve(),{t:r}=ke(),N=ea(),{user:n}=aa(N),i=p(()=>{var e,t;return!!((t=(e=n==null?void 0:n.value.user)==null?void 0:e.modules)!=null&&t.includes(la.APPLICATION.CREATE))}),L=A(!1),K=A([{id:1,label:"appFloor",width:15},{id:2,label:"appMaterial",width:30},{id:3,label:"appType",width:10},{id:4,label:"appCount",width:15},{id:5,label:"appPrice",width:20}]),s=A({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:"",comment:""}),j=p(()=>({deadline:{required:y},buildingObjectId:{required:y},buildingBlockId:{required:y},createApplicationTables:{required:y},details:{required:y},comment:{required:y}})),a=pa(j,s),{data:$,isSuccess:Se,isLoading:Be}=([l,c]=B(()=>T({queryKey:["objectsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>na(),enabled:i})),l=await l,c(),l),C=p(()=>s.value.buildingObjectId),Te=p(()=>!!C.value.length);$e(C,()=>{L.value||(s.value.buildingBlockId=[])},{immediate:!0});const{data:Le,isSuccess:Ce,isLoading:we}=([l,c]=B(()=>T({queryKey:["blocksList",{blockId:C,organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ca(C.value),enabled:Te})),l=await l,c(),l),z=p(()=>s.value.buildingBlockId),fe=p(()=>!!z.value.length),{data:Q,isSuccess:Ee,isLoading:Oe}=([l,c]=B(()=>T({queryKey:["floorsList",{floorId:z,organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ua(z.value),enabled:fe})),l=await l,c(),l),{data:R,isSuccess:Pe,isLoading:qe}=([l,c]=B(()=>T({queryKey:["costsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ia(),enabled:i})),l=await l,c(),l),{data:U,isSuccess:Ne,isLoading:Ke}=([l,c]=B(()=>T({queryKey:["materialsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>da(),enabled:i})),l=await l,c(),l),je=A([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"},{id:2,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:$,success:Se,loading:Be,select:!0},{id:3,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:Le,success:Ce,loading:we,select:!0}]),ze=A([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:Q,success:Ee,loading:Oe,select:!0},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:R,success:Pe,loading:qe,select:!0},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:U,success:Ne,loading:Ke,select:!0},{id:4,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"}]),Ue=p(()=>G(Q.value)),De=p(()=>G(R.value)),He=p(()=>G(U.value)),xe=e=>{var t;return(t=Ue.value[e.floorId])==null?void 0:t.name},Ge=e=>{var t;return(t=De.value[e.costId])==null?void 0:t.name},Qe=e=>{var t;return(t=He.value[e==null?void 0:e.constructionMaterialId])==null?void 0:t.name},Re=e=>{var t,M,S;s.value.createApplicationTables.push({...e,delId:ga(),floorValue:xe(e),costValue:Ge(e),constructionMaterialValue:Qe(e),typeValue:(S=(M=(t=U.value)==null?void 0:t.filter(_=>(_==null?void 0:_.id)===e.constructionMaterialId))==null?void 0:M[0])==null?void 0:S.quantityType})},Je=e=>{s.value.createApplicationTables=s.value.createApplicationTables.filter(t=>t.delId!==e)},{mutate:We,status:Xe}=va({onMutate:e=>{L.value=!0,e.buildingObjectId=e.buildingObjectId[0],e.buildingBlockId=e.buildingBlockId[0],e.createApplicationTables=e.createApplicationTables.map(t=>{const{delId:M,floorValue:S,costValue:_,constructionMaterialValue:J,typeValue:D,...H}=t;return H})},mutationFn:e=>ra("application",e),onSuccess:e=>{e!=null&&e.success&&(s.value=sa(s.value),O.invalidateQueries({queryKey:["applications"]}),P.push(ye.APPLICATION.path),setTimeout(()=>q.success(r("createToast")),150))}}),Ye=()=>{if(a.value.$validate(),a.value.$errors.length)return;const e={...s.value};We(e),a.value.$reset()};return(e,t)=>{var W,X,Y,Z,F,ee,ae,oe,te,le,se,re,ne,ce,ue;const M=v("ManageHead"),S=v("FormInput"),_=v("FormSelect"),J=v("SubTable"),D=v("FormTextarea"),H=v("CustomButton");return i.value?(d(),b("section",Aa,[V("div",Va,[h(M,{title:"addNewApplicationTitle",to:u(ye).APPLICATION.path},null,8,["to"]),V("form",{class:"manage__form",onSubmit:oa(Ye,["prevent"])},[V("div",ka,[(d(!0),b(w,null,Me(je.value,o=>{var ie,de,pe,me,ve,ge,Ie,he,be,_e;return d(),b(w,{key:o.id},[o!=null&&o.select?k("",!0):(d(),f(S,{key:0,modelValue:s.value[o.model],"onUpdate:modelValue":x=>s.value[o.model]=x,placeholder:e.$t(o.placeholder),name:o.icon,error:(de=(ie=u(a))==null?void 0:ie[o.errorKey])==null?void 0:de.$error,textError:(ve=(me=(pe=u(a))==null?void 0:pe[o.errorKey])==null?void 0:me.$errors[0])==null?void 0:ve.$message,type:o==null?void 0:o.type},{default:g(()=>[I(m(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])),o!=null&&o.select?(d(),f(_,{key:1,modelValue:s.value[o.model],"onUpdate:modelValue":x=>s.value[o.model]=x,modelModifiers:{trim:!0},options:o.options,error:(Ie=(ge=u(a))==null?void 0:ge[o==null?void 0:o.errorKey])==null?void 0:Ie.$error,placeholder:o==null?void 0:o.placeholder,textError:(_e=(be=(he=u(a))==null?void 0:he[o==null?void 0:o.errorKey])==null?void 0:be.$errors[0])==null?void 0:_e.$message,success:o.success,loading:o.loading,isMultiSelect:o==null?void 0:o.multiple},{default:g(()=>[I(m(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])):k("",!0)],64)}),128))]),h(ya,{subFields:ze.value,buildingBlockId:s.value.buildingBlockId,isSubmit:L.value,onOnAddTable:Re},null,8,["subFields","buildingBlockId","isSubmit"]),(X=(W=u(a))==null?void 0:W.createApplicationTables)!=null&&X.$error?(d(),b("span",$a,m((F=(Z=(Y=u(a))==null?void 0:Y.createApplicationTables)==null?void 0:Z.$errors[0])==null?void 0:F.$message),1)):k("",!0),h(J,{headers:K.value,table:s.value.createApplicationTables,onOnActionDelete:Je,isShowDelete:!0},null,8,["headers","table"]),V("div",Ma,[h(D,{modelValue:s.value.details,"onUpdate:modelValue":t[0]||(t[0]=o=>s.value.details=o),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appDetailsPlaceholder"),error:(ae=(ee=u(a))==null?void 0:ee.details)==null?void 0:ae.$error,textError:(le=(te=(oe=u(a))==null?void 0:oe.details)==null?void 0:te.$errors[0])==null?void 0:le.$message},{default:g(()=>[I(m(e.$t("appDetailsLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),h(D,{modelValue:s.value.comment,"onUpdate:modelValue":t[1]||(t[1]=o=>s.value.comment=o),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),error:(re=(se=u(a))==null?void 0:se.comment)==null?void 0:re.$error,textError:(ue=(ce=(ne=u(a))==null?void 0:ne.comment)==null?void 0:ce.$errors[0])==null?void 0:ue.$message},{default:g(()=>[I(m(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"])]),h(H,{className:"manage__submit",disabled:u(Xe)==="pending"},{default:g(()=>[I(m(e.$t("appButton")),1)]),_:1},8,["disabled"])],32)])])):k("",!0)}}},Pa=Ae(Sa,[["__scopeId","data-v-1375625a"]]);export{Pa as default};
