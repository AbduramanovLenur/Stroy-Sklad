import{_ as Q,o as d,d as m,e as n,L as Fe,t as u,w as ue,I as ce,c as p,F as E,C as U,p as je,n as Ve,u as qe,a as Ne,r,b as Pe,y as Ke,z as k,ai as ze,B as Re,k as C,h,D as _,aj as He,A as M,i as O,l as De,G as Ee,m as S,s as $,f as I,H,J as D}from"./index-duUvqP-c.js";import{a as Ue,e as Qe,f as Ge}from"./crud.services-W2EdIOzx.js";import{f as We,g as Je,h as Xe,i as Ye,j as Ze}from"./manual.services-UeOdc-dP.js";import{a as xe,u as ne}from"./generic.services-9zWUdppN.js";import{u as w}from"./useQuery-nCo--xAY.js";const ea={class:"confirmation-modal__title"},aa={class:"confirmation-modal__triggers"},sa={__name:"ConfirmationModal",props:["isOpen"],setup(v){return(a,o)=>(d(),m("div",{class:ce(`confirmation-modal ${v.isOpen?"is-active":""}`),onClick:o[3]||(o[3]=()=>a.$emit("onNotConfirmed"))},[n("div",{class:"confirmation-modal__overlay",onClick:o[2]||(o[2]=ue(()=>{},["stop"]))},[n("h4",ea,[Fe(a.$slots,"default",{},void 0,!0)]),n("div",aa,[n("button",{type:"button",class:"confirmation-modal__accepted",onClick:o[0]||(o[0]=()=>a.$emit("onConfirmed"))},u(a.$t("yesButton")),1),n("button",{type:"button",class:"confirmation-modal__refused",onClick:o[1]||(o[1]=()=>a.$emit("onNotConfirmed"))},u(a.$t("noButton")),1)])])],2))}},de=Q(sa,[["__scopeId","data-v-c25f4d7f"]]),ta=v=>(je("data-v-28fb4607"),v=v(),Ve(),v),oa={class:"histories"},la={class:"histories__label"},ia={class:"histories__list"},na={class:"histories__head"},da={class:"histories__name"},ua=ta(()=>n("div",{class:"histories__divider"}," - ",-1)),ca={class:"histories__status"},ra={class:"histories__date"},pa={__name:"Histories",props:["histories"],setup(v){const a=p(()=>o=>{let b=new Date(o),s=b.toISOString().split("T")[0],T=b.toISOString().split("T")[1].split(".")[0];return`${s} ${T}`});return(o,b)=>(d(),m("div",oa,[n("div",la,u(o.$t("historiesLabel")),1),n("ul",ia,[(d(!0),m(E,null,U(v.histories,s=>(d(),m("li",{key:s.id,class:"histories__item"},[n("div",{class:ce(`histories__box ${(s==null?void 0:s.statusId)===1?"created":(s==null?void 0:s.statusId)===7?"accepted":(s==null?void 0:s.statusId)===20?"expected":(s==null?void 0:s.statusId)===15?"refused":""}`)},[n("div",na,[n("div",da,u(s==null?void 0:s.userName),1),ua,n("div",ca,u(s==null?void 0:s.status),1)]),n("div",ra,u(a.value(s==null?void 0:s.createdDate)),1)],2)]))),128))])]))}},ma=Q(pa,[["__scopeId","data-v-28fb4607"]]),va={key:0,class:"manage section-height shadowed"},ba={class:"manage__inner section-padding"},_a={class:"manage__overlay"},Ia={key:0,class:"manage__triggers"},fa={__name:"view",async setup(v){let a,o;const b=xe(),s=De(),T=Ee(),G=qe(),{t:W}=Ne(),f=r(T.params.id),re=Pe(),{user:c}=Ke(re),B=p(()=>{var e,t;return(t=(e=c==null?void 0:c.value.user)==null?void 0:e.modules)==null?void 0:t.includes(H.APPLICATION.READ)}),F=r(!1),j=r(!1),pe=r([{id:1,label:"appFloor",width:20},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:20},{id:4,label:"appPrice",width:30}]),i=r({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],applicationTables:[],details:"",statusId:"",allowedActionRoleIds:[],histories:[]}),{data:me,isSuccess:ve,isLoading:be}=([a,o]=k(()=>w({queryKey:["objectsList",{organizationId:c.value.user.organizationId}],queryFn:()=>We(),enabled:B})),a=await a,o(),a),V=p(()=>i.value.buildingObjectId[0]),_e=p(()=>!!V.value),{data:Ie,isSuccess:fe,isLoading:ge}=([a,o]=k(()=>w({queryKey:["blocksList",{blockId:V,organizationId:c.value.user.organizationId}],queryFn:()=>Je(V.value),enabled:_e})),a=await a,o(),a),q=p(()=>i.value.buildingBlockId[0]),N=p(()=>!!q.value),{data:ke,isSuccess:ga,isLoading:ka}=([a,o]=k(()=>w({queryKey:["floorsList",{floorId:q,organizationId:c.value.user.organizationId}],queryFn:()=>Xe(q.value),enabled:N})),a=await a,o(),a),{data:Ce,isSuccess:Ca,isLoading:ha}=([a,o]=k(()=>w({queryKey:["costsList",{organizationId:c.value.user.organizationId}],queryFn:()=>Ye(),enabled:N})),a=await a,o(),a),{data:he,isSuccess:Oa,isLoading:Sa}=([a,o]=k(()=>w({queryKey:["materialsList",{organizationId:c.value.user.organizationId}],queryFn:()=>Ze(),enabled:N})),a=await a,o(),a),Oe=r([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),Se=r([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:me,success:ve,loading:be},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:Ie,success:fe,loading:ge}]),{isError:we}=([a,o]=k(()=>w({queryKey:["applicationsById",f],queryFn:()=>Ue("application",f.value),select:e=>{i.value.id=e.id,i.value.deadline=e.deadline,i.value.buildingObjectId=[e.buildingObjectId],i.value.buildingBlockId=[e.buildingBlockId],i.value.applicationTables=[...e.applicationTables],i.value.details=e.details,i.value.statusId=e.statusId,i.value.allowedActionRoleIds=e.allowedActionRoleIds,i.value.histories=e.applicationHistories},enabled:B})),a=await a,o(),a),J=p(()=>D(ke.value||[])),X=p(()=>D(Ce.value||[])),Y=p(()=>D(he.value||[])),ye=e=>{var t;return(t=J.value[e.floorId])==null?void 0:t.name},Me=e=>{var t;return(t=X.value[e.costId])==null?void 0:t.name},Le=e=>{var t;return(t=Y.value[e==null?void 0:e.constructionMaterialId])==null?void 0:t.name},Z=r(!1),x=r(!0);ze(()=>{var L,A,y;const e=(L=Object.keys(J.value))==null?void 0:L.length,t=(A=Object.keys(X.value))==null?void 0:A.length,P=(y=Object.keys(Y.value))==null?void 0:y.length,K=i.value.applicationTables.length;e&&t&&P&&K&&(i.value.applicationTables=i.value.applicationTables.map(g=>({...g,floorValue:ye(g),costValue:Me(g),constructionMaterialValue:Le(g)})),Z.value=!0,x.value=!1)}),Re(we,e=>{e&&s.push($.HOME.path)});const{mutate:Ae}=ne({mutationFn:e=>Qe("application",e),onSuccess:e=>{e!=null&&e.success&&(b.invalidateQueries({queryKey:["applications"]}),b.invalidateQueries({queryKey:["applicationsById",f]}),s.push($.APPLICATION.path),setTimeout(()=>G.success(W("cancelToast")),150))}}),{mutate:$e}=ne({mutationFn:e=>Ge("application",e),onSuccess:e=>{e!=null&&e.success&&(b.invalidateQueries({queryKey:["applications"]}),b.invalidateQueries({queryKey:["applicationsById",f]}),s.push($.APPLICATION.path),setTimeout(()=>G.success(W("acceptToast")),150))}}),Te=()=>{Ae(f.value)},Be=()=>{$e(f.value)};return(e,t)=>{var z,ee,ae,se,te,oe,le,ie;const P=S("ManageHead"),K=S("FormInput"),L=S("FormSelect"),A=S("SubTable"),y=S("MyButton"),g=S("Spinner");return B.value?(d(),m("section",va,[n("div",ba,[C(P,{title:"addNewApplicationTitle",to:h($).APPLICATION.path},null,8,["to"]),Z.value?(d(),m("form",{key:0,class:"manage__form",onSubmit:t[3]||(t[3]=ue(()=>{},["prevent"]))},[n("div",_a,[(d(!0),m(E,null,U(Oe.value,l=>(d(),M(K,{key:l.id,modelValue:i.value[l.model],"onUpdate:modelValue":R=>i.value[l.model]=R,width:500,placeholder:e.$t(l.placeholder),name:l.icon,type:l==null?void 0:l.type,isDisabled:!0},{default:_(()=>[I(u(e.$t(l.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),(d(!0),m(E,null,U(Se.value,l=>(d(),M(L,{key:l.id,modelValue:i.value[l.model],"onUpdate:modelValue":R=>i.value[l.model]=R,modelModifiers:{trim:!0},width:500,options:l.options,placeholder:l==null?void 0:l.placeholder,success:l.success,loading:l.loading,isMultiSelect:l==null?void 0:l.multiple,isDisabled:!0},{default:_(()=>[I(u(e.$t(l.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128))]),C(A,{headers:pe.value,table:i.value.applicationTables},null,8,["headers","table"]),C(He,{modelValue:i.value.details,"onUpdate:modelValue":t[0]||(t[0]=l=>i.value.details=l),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),isDisabled:!0},{default:_(()=>[I(u(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder"]),i.value.allowedActionRoleIds.includes((ee=(z=h(c))==null?void 0:z.user)==null?void 0:ee.roleId)?(d(),m("div",Ia,[(te=(se=(ae=h(c))==null?void 0:ae.user)==null?void 0:se.modules)!=null&&te.includes(h(H).APPLICATION.CONFIRM)?(d(),M(y,{key:0,icon:"approve",type:"submit",color:"green",width:180,onClick:t[1]||(t[1]=()=>F.value=!0)},{default:_(()=>[I(u(e.$t("acceptButton")),1)]),_:1})):O("",!0),(ie=(le=(oe=h(c))==null?void 0:oe.user)==null?void 0:le.modules)!=null&&ie.includes(h(H).APPLICATION.REFUSAL)?(d(),M(y,{key:1,icon:"refusal",type:"submit",color:"red",width:180,onClick:t[2]||(t[2]=()=>j.value=!0)},{default:_(()=>[I(u(e.$t("cancelButton")),1)]),_:1})):O("",!0)])):O("",!0),C(ma,{histories:i.value.histories},null,8,["histories"])],32)):O("",!0),x.value?(d(),M(g,{key:1})):O("",!0)]),C(de,{isOpen:F.value,onOnConfirmed:Be,onOnNotConfirmed:t[4]||(t[4]=()=>F.value=!1)},{default:_(()=>[I(u(e.$t("sureConfirm")),1)]),_:1},8,["isOpen"]),C(de,{isOpen:j.value,onOnConfirmed:Te,onOnNotConfirmed:t[5]||(t[5]=()=>j.value=!1)},{default:_(()=>[I(u(e.$t("sureRefused")),1)]),_:1},8,["isOpen"])])):O("",!0)}}},$a=Q(fa,[["__scopeId","data-v-b139a242"]]);export{$a as default};
