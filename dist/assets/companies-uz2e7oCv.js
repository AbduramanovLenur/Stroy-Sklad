import{_ as Ie,m as we,s as Fe,r as d,c as N,n as _,q as u,o as l,d as w,e as A,k as O,i as r,x as F,j as $,t as z,y as S,F as G,f as H,g as L,w as ze}from"./index-2liaKmgz.js";import{u as Se,c as R}from"./secondary-functions-iCQIgTok.js";import{r as c}from"./i18n-validators-fwdRIkV7.js";import{u as qe,a as C,b as f}from"./generic.services-rEPg925p.js";import{a as Ke,b as Ne,c as Oe,m as $e,d as Le,e as Ce,f as Ve,g as Me}from"./manual.services-e0q0vNq6.js";const Be={class:"company"},Te={class:"company__inner section-padding"},ke={key:2,class:"empty-table"},De={__name:"companies",async setup(Ee){let t,i;const p=qe(),V=we(),{toggleIsOpenModalForm:M}=V,{isOpenModalForm:q}=Fe(V),B=d("addNewCompanyTitle"),g=d(""),y=d(0),T=N(()=>q),k=N(()=>q&&g.value=="edit"),{data:U,isSuccess:W,isLoading:j}=([t,i]=_(()=>f({queryKey:["regions"],queryFn:()=>$e(),enabled:T})),t=await t,i(),t),{data:J,isSuccess:X,isLoading:Y}=([t,i]=_(()=>f({queryKey:["districts"],queryFn:()=>Le(),enabled:T})),t=await t,i(),t),{data:Z,isSuccess:ee,isLoading:ae}=([t,i]=_(()=>f({queryKey:["states"],queryFn:()=>Ce(),enabled:k})),t=await t,i(),t),o=d({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:"",districtId:"",stateId:"",search:""}),oe=N(()=>({fullName:{required:c},inn:{required:c},address:{required:c},phoneNumber:{required:c},director:{required:c},regionId:{required:c},districtId:{required:c}})),te=d([{id:1,label:"organizationName",width:220},{id:2,label:"organizationInn",width:115},{id:3,label:"organizationRegion",width:215},{id:4,label:"organizationDistrict",width:155},{id:5,label:"organizationAddress",width:200},{id:6,label:"organizationPhone",width:170},{id:7,label:"organizationDirector",width:245},{id:7,label:"organizationState",width:100},{id:8,label:"organizationAction",width:130}]),re=d([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),ne=d([{id:1,model:"regionId",label:"regionOrganizationLabel",options:U,errorKey:"regionId",success:W,loading:j,show:["create","edit"]},{id:2,model:"districtId",label:"districtOrganizationLabel",options:J,errorKey:"districtId",success:X,loading:Y,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:Z,success:ee,loading:ae,show:"update",show:["edit"]}]),s=Se(oe,o),{data:K,isLoading:ie,isSuccess:D,isError:se}=([t,i]=_(()=>f({queryKey:["companies"],queryFn:()=>Ve("organization")})),t=await t,i(),t);[t,i]=_(()=>f({queryKey:["companiesById",y],queryFn:()=>Me("organization",y.value),select:e=>{o.value.id=e.id,o.value.fullName=e.fullName,o.value.inn=e.inn,o.value.address=e.address,o.value.phoneNumber=e.phoneNumber,o.value.director=e.director,o.value.regionId=e.regionId,o.value.districtId=e.districtId,o.value.stateId=e.stateId},enabled:k})),t=await t,i();const{mutate:le}=C({mutationFn:e=>Ke("organization",e),onSuccess:()=>{p.invalidateQueries({queryKey:["companies"]})}}),{mutate:de}=C({mutationFn:e=>Ne("organization",e),onSuccess:()=>{p.invalidateQueries({queryKey:["companies"]}),p.invalidateQueries({queryKey:["companiesById",y]})}}),{mutate:ue}=C({mutationFn:e=>Oe("organization",e),onSuccess:()=>{p.invalidateQueries({queryKey:["companies"]}),p.invalidateQueries({queryKey:["companiesById",y]})}}),E=(e,n)=>{B.value=e,g.value=n,M(),g.value==="create"&&q.value&&(o.value=R(o.value),s.value.$reset())},P=(e,n)=>{if(e==="edit"&&n){y.value=n,E("editCompanyTitle","edit");return}E("addNewCompanyTitle","create")},ce=async e=>{ue(e)},me=async()=>{s.value.$validate(),!s.value.$errors.length&&(g.value==="create"?(delete o.value.id,delete o.value.stateId,le(o.value)):de(o.value),M(),o.value=R(o.value),s.value.$reset())};return(e,n)=>{const pe=u("HeadPage"),ge=u("Table"),ye=u("Spinner"),he=u("FormInput"),ve=u("FormSelect"),be=u("CustomButton"),_e=u("FormModal");return l(),w("section",Be,[A("div",Te,[O(pe,{title:"comapnyTitle",onOnSearch:n[0]||(n[0]=m=>o.value.search=m),onOnOpenFormModal:n[1]||(n[1]=()=>P("create"))}),r(D)&&r(K).length?(l(),F(ge,{key:0,headers:te.value,table:r(K),onOnActionEdit:n[2]||(n[2]=m=>P("edit",m)),onOnActionDelete:ce},null,8,["headers","table"])):$("",!0),r(ie)?(l(),F(ye,{key:1})):$("",!0),r(D)&&!r(K).length||r(se)?(l(),w("div",ke,z(e.$t("emptyTableTitle")),1)):$("",!0)]),O(_e,{title:B.value},{default:S(()=>{var m,Q;return[A("form",{class:"company__form",onSubmit:ze(me,["prevent"])},[(l(!0),w(G,null,H(re.value,a=>{var h,v,b;return l(),F(he,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":I=>o.value[a.model]=I,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(h=r(s))==null?void 0:h[a.errorKey].$error,textError:(b=(v=r(s))==null?void 0:v[a.errorKey].$errors[0])==null?void 0:b.$message},{default:S(()=>[L(z(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(l(!0),w(G,null,H(ne.value,a=>{var h,v,b,I,x;return l(),F(ve,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":fe=>o.value[a.model]=fe,width:500,options:a.options,error:(v=(h=r(s))==null?void 0:h[a==null?void 0:a.errorKey])==null?void 0:v.$error,textError:(x=(I=(b=r(s))==null?void 0:b[a==null?void 0:a.errorKey])==null?void 0:I.$errors[0])==null?void 0:x.$message,success:a.success,loading:a.loading,show:a==null?void 0:a.show,requestFlag:g.value},{default:S(()=>[L(z(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),O(be,{className:`form__submit ${(Q=(m=r(s))==null?void 0:m.districtId.$errors[0])!=null&&Q.$message?"centered":""}`},{default:S(()=>[L(z(e.$t("formButton")),1)]),_:1},8,["className"])],32)]}),_:1},8,["title"])])}}},He=Ie(De,[["__scopeId","data-v-294767a5"]]);export{He as default};
