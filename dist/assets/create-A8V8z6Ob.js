import{_ as Ie,u as he,a as be,r as b,c as d,B as _e,m,o as u,d as g,e as $,t as v,F as T,C as ye,A as L,D as I,f as h,i as y,k as _,K as Re,q as Je,b as We,y as Xe,z as k,h as i,w as Ye,l as Ze,s as ge,H as Fe,J as U,E as ea}from"./index-pfgEwabb.js";import{u as aa,r as V}from"./i18n-validators-vl7r2d_M.js";import{a as oa,u as ta}from"./generic.services-pFsvETxq.js";import{u as S}from"./useQuery-MTkSqSbf.js";import{c as la}from"./crud.services-dRS2qKm6.js";import{f as sa,g as ra,h as na,i as ca,j as ua}from"./manual.services-HMyLT33c.js";import{v as ia}from"./v4-yQnnJER4.js";const da={class:"application-form"},pa={class:"application-form__title"},ma={class:"application-form__overlay form-manage"},va={__name:"ApplicationForm",props:["subFields","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(C,{emit:t}){const c=he(),{t:w}=be(),E=C,O=t,r=b({floorId:[],costId:[],constructionMaterialId:[],count:""}),f=d(()=>E.buildingBlockId);_e(f,()=>{r.value.floorId=[]});const n=()=>{if(!Re(r.value)){c.error(w("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count},O("onAddTable",r.value),r.value=Je(r.value)};return(p,M)=>{const N=m("FormInput"),l=m("FormSelect"),P=m("CustomButton");return u(),g("div",da,[$("h4",pa,v(p.$t("appInfo")),1),$("div",ma,[(u(!0),g(T,null,ye(C.subFields,e=>(u(),g(T,{key:e.id},[e!=null&&e.select?y("",!0):(u(),L(N,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":A=>r.value[e.model]=A,width:500,placeholder:p.$t(e.placeholder),name:e.icon,type:e==null?void 0:e.type},{default:I(()=>[h(v(p.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),e!=null&&e.select?(u(),L(l,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":A=>r.value[e.model]=A,modelModifiers:{trim:!0},width:500,options:e.options,placeholder:e==null?void 0:e.placeholder,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:I(()=>[h(v(p.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"])):y("",!0)],64))),128)),_(P,{className:"form__submit",type:"button",onClick:n},{default:I(()=>[h(v(p.$t("addButtonForm")),1)]),_:1})])])}}},ga=Ie(va,[["__scopeId","data-v-e46a2199"]]),Ia={key:0,class:"manage section-height shadowed"},ha={class:"manage__inner section-padding"},ba={class:"manage__overlay"},_a={key:0,class:"error"},ya={__name:"create",async setup(C){let t,c;const w=oa(),E=Ze(),O=he(),{t:r}=be(),f=We(),{user:n}=Xe(f),p=d(()=>{var a,s;return!!((s=(a=n==null?void 0:n.value.user)==null?void 0:a.modules)!=null&&s.includes(Fe.APPLICATION.CREATE))}),M=b(!1),N=b([{id:1,label:"appFloor",width:15},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:15},{id:4,label:"appPrice",width:20}]),l=b({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:""}),P=d(()=>({deadline:{required:V},buildingObjectId:{required:V},buildingBlockId:{required:V},createApplicationTables:{required:V},details:{required:V}})),e=aa(P,l),{data:A,isSuccess:Ae,isLoading:ke}=([t,c]=k(()=>S({queryKey:["objectsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>sa(),enabled:p})),t=await t,c(),t),B=d(()=>l.value.buildingObjectId),Ve=d(()=>!!B.value.length);_e(B,()=>{M.value||(l.value.buildingBlockId=[])},{immediate:!0});const{data:Se,isSuccess:$e,isLoading:Me}=([t,c]=k(()=>S({queryKey:["blocksList",{blockId:B,organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ra(B.value),enabled:Ve})),t=await t,c(),t),q=d(()=>l.value.buildingBlockId),K=d(()=>!!q.value.length),{data:D,isSuccess:Be,isLoading:Te}=([t,c]=k(()=>S({queryKey:["floorsList",{floorId:q,organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>na(q.value),enabled:K})),t=await t,c(),t),{data:H,isSuccess:Le,isLoading:Ce}=([t,c]=k(()=>S({queryKey:["costsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ca(),enabled:K})),t=await t,c(),t),{data:x,isSuccess:we,isLoading:Ee}=([t,c]=k(()=>S({queryKey:["materialsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ua(),enabled:K})),t=await t,c(),t),Oe=b([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"},{id:2,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:A,success:Ae,loading:ke,select:!0},{id:3,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:Se,success:$e,loading:Me,select:!0}]),fe=b([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:D,success:Be,loading:Te,select:!0},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:H,success:Le,loading:Ce,select:!0},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:x,success:we,loading:Ee,select:!0},{id:4,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"}]),Ne=d(()=>U(D.value)),Pe=d(()=>U(H.value)),qe=d(()=>U(x.value)),Ke=a=>{var s;return(s=Ne.value[a.floorId])==null?void 0:s.name},je=a=>{var s;return(s=Pe.value[a.costId])==null?void 0:s.name},ze=a=>{var s;return(s=qe.value[a==null?void 0:a.constructionMaterialId])==null?void 0:s.name},Ue=a=>{l.value.createApplicationTables.push({...a,delId:ia(),floorValue:Ke(a),costValue:je(a),constructionMaterialValue:ze(a)})},De=a=>{l.value.createApplicationTables=l.value.createApplicationTables.filter(s=>s.delId!==a)},{mutate:He,status:xe}=ta({onMutate:a=>{M.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.createApplicationTables=a.createApplicationTables.map(s=>{const{delId:G,floorValue:Q,costValue:R,constructionMaterialValue:J,...j}=s;return j})},mutationFn:a=>la("application",a),onSuccess:a=>{a!=null&&a.success&&(l.value=ea(l.value),w.invalidateQueries({queryKey:["applications"]}),E.push(ge.APPLICATION.path),setTimeout(()=>O.success(r("createToast")),150))}}),Ge=()=>{if(e.value.$validate(),e.value.$errors.length)return;const a={...l.value};He(a),e.value.$reset()};return(a,s)=>{var W,X,Y,Z,F,ee,ae,oe,te,le;const G=m("ManageHead"),Q=m("FormInput"),R=m("FormSelect"),J=m("SubTable"),j=m("FormTextarea"),Qe=m("CustomButton");return p.value?(u(),g("section",Ia,[$("div",ha,[_(G,{title:"addNewApplicationTitle",to:i(ge).APPLICATION.path},null,8,["to"]),$("form",{class:"manage__form",onSubmit:Ye(Ge,["prevent"])},[$("div",ba,[(u(!0),g(T,null,ye(Oe.value,o=>{var se,re,ne,ce,ue,ie,de,pe,me,ve;return u(),g(T,{key:o.id},[o!=null&&o.select?y("",!0):(u(),L(Q,{key:0,modelValue:l.value[o.model],"onUpdate:modelValue":z=>l.value[o.model]=z,width:500,placeholder:a.$t(o.placeholder),name:o.icon,error:(re=(se=i(e))==null?void 0:se[o.errorKey])==null?void 0:re.$error,textError:(ue=(ce=(ne=i(e))==null?void 0:ne[o.errorKey])==null?void 0:ce.$errors[0])==null?void 0:ue.$message,type:o==null?void 0:o.type},{default:I(()=>[h(v(a.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])),o!=null&&o.select?(u(),L(R,{key:1,modelValue:l.value[o.model],"onUpdate:modelValue":z=>l.value[o.model]=z,modelModifiers:{trim:!0},width:500,options:o.options,error:(de=(ie=i(e))==null?void 0:ie[o==null?void 0:o.errorKey])==null?void 0:de.$error,placeholder:o==null?void 0:o.placeholder,textError:(ve=(me=(pe=i(e))==null?void 0:pe[o==null?void 0:o.errorKey])==null?void 0:me.$errors[0])==null?void 0:ve.$message,success:o.success,loading:o.loading,isMultiSelect:o==null?void 0:o.multiple},{default:I(()=>[h(v(a.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])):y("",!0)],64)}),128))]),_(ga,{subFields:fe.value,buildingBlockId:l.value.buildingBlockId,isSubmit:M.value,onOnAddTable:Ue},null,8,["subFields","buildingBlockId","isSubmit"]),(X=(W=i(e))==null?void 0:W.createApplicationTables)!=null&&X.$error?(u(),g("span",_a,v((F=(Z=(Y=i(e))==null?void 0:Y.createApplicationTables)==null?void 0:Z.$errors[0])==null?void 0:F.$message),1)):y("",!0),_(J,{headers:N.value,table:l.value.createApplicationTables,onOnActionDelete:De,isShowDelete:!0},null,8,["headers","table"]),_(j,{modelValue:l.value.details,"onUpdate:modelValue":s[0]||(s[0]=o=>l.value.details=o),modelModifiers:{trim:!0},width:500,placeholder:a.$t("appCommentPlaceholder"),error:(ae=(ee=i(e))==null?void 0:ee.details)==null?void 0:ae.$error,textError:(le=(te=(oe=i(e))==null?void 0:oe.details)==null?void 0:te.$errors[0])==null?void 0:le.$message},{default:I(()=>[h(v(a.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),_(Qe,{className:"manage__submit",disabled:i(xe)==="pending"},{default:I(()=>[h(v(a.$t("appButton")),1)]),_:1},8,["disabled"])],32)])])):y("",!0)}}},Ta=Ie(ya,[["__scopeId","data-v-ed92a235"]]);export{Ta as default};
