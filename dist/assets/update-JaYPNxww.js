import{u as ne,a as me,b as ce,y as de,c as z,r as h,z as g,B as pe,d as _,e as T,k as G,h as u,w as ie,F as x,C as ye,D as I,i as v,l as he,G as ge,m as c,o as n,s as b,A as H,f as N,t as S,H as _e,E as Ie}from"./index-8l2LyLh8.js";import{u as ve,r}from"./i18n-validators-Wkg5KBML.js";import{a as be,u as Ne}from"./generic.services-yETqkf3T.js";import{u as w}from"./useQuery-tdqJaMO0.js";import{a as Se,u as we}from"./crud.services-BcMjcvoI.js";import{e as $e,b as Ke}from"./manual.services-Ls971AW1.js";const Le={key:0,class:"manage section-height shadowed"},Re={class:"manage__inner section-padding"},Ce={__name:"update",async setup(Ee){let s,l;const $=be(),K=he(),D=ge(),O=ne(),{t:Q}=me(),A=ce(),{user:d}=de(A),m=z(()=>{var o,i;return!!((i=(o=d==null?void 0:d.value.user)==null?void 0:o.modules)!=null&&i.includes(_e.ORG_USER.UPDATE))}),p=h(D.params.id),a=h({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:"",roleId:[],stateId:[]}),W=z(()=>({id:{required:r},fullName:{required:r},userName:{required:r},phoneNumber:{required:r},organizationId:{required:r},roleId:{required:r},stateId:{required:r}})),t=ve(W,a),{data:j,isSuccess:J,isLoading:X}=([s,l]=g(()=>w({queryKey:["rolesList",{organizationId:a.value.organizationId}],queryFn:()=>$e(),enabled:m})),s=await s,l(),s),{data:Y,isSuccess:Z,isLoading:f}=([s,l]=g(()=>w({queryKey:["states"],queryFn:()=>Ke(),enabled:m})),s=await s,l(),s),ee=h([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:j,success:J,loading:X,select:!0},{id:6,model:"stateId",label:"employeesStateLabel",placeholder:"employeesStatePlaceholder",errorKey:"stateId",options:Y,success:Z,loading:f,select:!0}]),{isError:oe}=([s,l]=g(()=>w({queryKey:["orgUserById",p],queryFn:()=>Se("user",p.value),select:o=>{a.value.id=o.id,a.value.fullName=o.fullName,a.value.userName=o.userName,a.value.phoneNumber=o.phoneNumber,a.value.organizationId=o.organizationId,a.value.roleId=[o.roleId],a.value.stateId=[o.stateId]},enabled:m})),s=await s,l(),s);pe(oe,o=>{o&&K.push(b.HOME.path)});const{mutate:ae}=Ne({onMutate:o=>{o.roleId=o.roleId[0],o.stateId=o.stateId[0]},mutationFn:o=>we("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=Ie(a.value),$.invalidateQueries({queryKey:["orgUsers"]}),$.invalidateQueries({queryKey:["orgUserById",p]}),K.push(b.ORG_USER.path),setTimeout(()=>O.success(Q("updateToast")),150))}}),se=async()=>{if(t.value.$validate(),t.value.$errors.length)return;const o={...a.value};ae(o),t.value.$reset()};return(o,i)=>{var L,R;const te=c("ManageHead"),re=c("FormInput"),le=c("FormSelect"),ue=c("CustomButton");return m.value?(n(),_("section",Le,[T("div",Re,[G(te,{title:"editEmployeesTitle",to:u(b).ORG_USER.path},null,8,["to"]),T("form",{class:"manage__form form-manage",onSubmit:ie(se,["prevent"])},[(n(!0),_(x,null,ye(ee.value,e=>{var E,V,F,U,B,P,q,C,M,k;return n(),_(x,{key:e.id},[e!=null&&e.select?v("",!0):(n(),H(re,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":y=>a.value[e.model]=y,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(V=(E=u(t))==null?void 0:E[e==null?void 0:e.errorKey])==null?void 0:V.$error,type:e==null?void 0:e.type,textError:(B=(U=(F=u(t))==null?void 0:F[e==null?void 0:e.errorKey])==null?void 0:U.$errors[0])==null?void 0:B.$message},{default:I(()=>[N(S(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),e!=null&&e.select?(n(),H(le,{key:1,modelValue:a.value[e.model],"onUpdate:modelValue":y=>a.value[e.model]=y,modelModifiers:{trim:!0},width:500,options:e.options,error:(q=(P=u(t))==null?void 0:P[e==null?void 0:e.errorKey])==null?void 0:q.$error,placeholder:e==null?void 0:e.placeholder,textError:(k=(M=(C=u(t))==null?void 0:C[e==null?void 0:e.errorKey])==null?void 0:M.$errors[0])==null?void 0:k.$message,success:e.success,loading:e.loading},{default:I(()=>[N(S(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):v("",!0)],64)}),128)),G(ue,{className:`form__submit ${(R=(L=u(t))==null?void 0:L.stateId.$errors[0])!=null&&R.$message?"centered":""}`},{default:I(()=>[N(S(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):v("",!0)}}};export{Ce as default};
