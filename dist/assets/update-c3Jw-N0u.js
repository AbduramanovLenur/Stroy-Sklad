import{u as ce,a as me,r as y,b as ie,y as de,c as R,z as _,B as pe,d as g,e as T,k as N,h as o,w as he,F as x,C as ye,D as I,i as v,l as _e,G as ge,m,o as n,s as S,A as P,f as q,t as w,H as Ie,E as ve}from"./index-qYaOSAk5.js";import{a as Se,u as qe}from"./crud.services-6H1cbtzh.js";import{j as we,b as $e}from"./manual.services-e5QN_9-o.js";import{u as Ee,r as i}from"./i18n-validators-FA-njMbI.js";import{a as be,u as Ve}from"./generic.services-uSp9rJcx.js";import{u as $}from"./useQuery-3KlBkAoQ.js";const Ke={key:0,class:"manage section-height shadowed"},Be={class:"manage__inner section-padding"},He={__name:"update",async setup(Me){let t,u;const E=be(),b=_e(),D=ge(),O=ce(),{t:Q}=me(),d=y(D.params.id),z=ie(),{user:l}=de(z),c=R(()=>{var a,p;return!!((p=(a=l==null?void 0:l.value.user)==null?void 0:a.modules)!=null&&p.includes(Ie.WAREHOUSE.UPDATE))}),s=y({id:"",materialId:[],quantity:"",stateId:[]}),G=R(()=>({id:{required:i},materialId:{required:i},quantity:{required:i},stateId:{required:i}})),r=Ee(G,s),{data:j,isSuccess:J,isLoading:X}=([t,u]=_(()=>$({queryKey:["materialsList",{organizationId:l.value.user.organizationId}],queryFn:()=>we(),enabled:c})),t=await t,u(),t),{data:Y,isSuccess:Z,isLoading:f}=([t,u]=_(()=>$({queryKey:["states"],queryFn:()=>$e(),enabled:c})),t=await t,u(),t),ee=y([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:j,success:J,loading:X,select:!0},{id:2,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"},{id:3,model:"stateId",label:"stateWarehouseLabel",placeholder:"stateWarehousePlaceholder",errorKey:"stateId",options:Y,success:Z,loading:f,select:!0}]),{isError:ae}=([t,u]=_(()=>$({queryKey:["warehouseById",d],queryFn:()=>Se("warehouse",d.value),select:a=>{s.value.id=a.id,s.value.materialId=[a.materialId],s.value.quantity=a.quantity,s.value.stateId=[a.stateId]},enabled:c})),t=await t,u(),t);pe(ae,a=>{a&&b.push(S.WAREHOUSE.path)});const{mutate:te,status:se}=Ve({onMutate:a=>{a.materialId=a.materialId[0],a.stateId=a.stateId[0]},mutationFn:a=>qe("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(s.value=ve(s.value),E.invalidateQueries({queryKey:["warehouse"]}),E.invalidateQueries({queryKey:["warehouseById",d]}),b.push(S.WAREHOUSE.path),setTimeout(()=>O.success(Q("updateToast")),150))}}),re=async()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...s.value};te(a),r.value.$reset()};return(a,p)=>{var V,K;const oe=m("ManageHead"),ue=m("FormInput"),ne=m("FormSelect"),le=m("CustomButton");return c.value?(n(),g("section",Ke,[T("div",Be,[N(oe,{title:"editProductTitle",to:o(S).WAREHOUSE.path},null,8,["to"]),T("form",{class:"manage__form form-manage",onSubmit:he(re,["prevent"])},[(n(!0),g(x,null,ye(ee.value,e=>{var B,M,W,C,F,U,L,k,H,A;return n(),g(x,{key:e.id},[e!=null&&e.select?v("",!0):(n(),P(ue,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(M=(B=o(r))==null?void 0:B[e==null?void 0:e.errorKey])==null?void 0:M.$error,textError:(F=(C=(W=o(r))==null?void 0:W[e==null?void 0:e.errorKey])==null?void 0:C.$errors[0])==null?void 0:F.$message},{default:I(()=>[q(w(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(n(),P(ne,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,modelModifiers:{trim:!0},width:500,options:e.options,error:(L=(U=o(r))==null?void 0:U[e==null?void 0:e.errorKey])==null?void 0:L.$error,placeholder:e==null?void 0:e.placeholder,textError:(A=(H=(k=o(r))==null?void 0:k[e==null?void 0:e.errorKey])==null?void 0:H.$errors[0])==null?void 0:A.$message,success:e.success,loading:e.loading},{default:I(()=>[q(w(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):v("",!0)],64)}),128)),N(le,{className:`form__submit ${(K=(V=o(r))==null?void 0:V.stateId.$errors[0])!=null&&K.$message?"centered":""}`,disabled:o(se)==="pending"},{default:I(()=>[q(w(a.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):v("",!0)}}};export{He as default};
