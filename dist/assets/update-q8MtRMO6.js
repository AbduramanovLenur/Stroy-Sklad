import{u as ce,a as de,b as ie,y as pe,c as Q,r as g,z as N,C as he,d as b,e as D,k as ye,h as s,w as _e,F as H,D as ve,B as d,i as n,A as M,l as ge,G as Ne,m,o as l,s as S,f as $,t as I,H as be,E as Me}from"./index-Bee0eIFu.js";import{u as Se,r as h}from"./i18n-validators-ULboWM6n.js";import{u as $e}from"./generic.services-G3ATixRD.js";import{u as R}from"./useQuery-wCvH6pxH.js";import{u as Ie}from"./useMutation-uVamgMOE.js";import{a as Re,u as Ve}from"./crud.services-wQgdXoj4.js";import{c as Ke,b as Le}from"./manual.services-YOtkPLe4.js";const we={key:0,class:"manage section-height shadowed"},Ee={class:"manage__inner section-padding"},Ae={__name:"update",async setup(ke){let a,u;const y=$e(),V=ge(),O=Ne(),P=ce(),{t:G}=de(),z=ie(),{user:i}=pe(z),p=Q(()=>{var t,c;return!!((c=(t=i==null?void 0:i.value.user)==null?void 0:t.modules)!=null&&c.includes(be.ROLE.UPDATE))}),_=g(O.params.id),o=g({id:"",shortName:"",fullName:"",roleModules:[],stateId:[]}),W=Q(()=>({id:{required:h},shortName:{required:h},fullName:{required:h},stateId:{required:h}})),r=Se(W,o),{data:f,isLoading:j,isSuccess:K}=([a,u]=N(()=>R({queryKey:["modules"],queryFn:()=>Ke(),enabled:p})),a=await a,u(),a),{data:J,isSuccess:X,isLoading:Y}=([a,u]=N(()=>R({queryKey:["states"],queryFn:()=>Le(),enabled:p})),a=await a,u(),a),Z=g([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"},{id:3,model:"stateId",label:"stateRoleLabel",placeholder:"stateRolePlaceholder",errorKey:"stateId",options:J,success:X,loading:Y,select:!0}]),{isError:ee}=([a,u]=N(()=>R({queryKey:["rolesById",_,i.value.user.fullName],queryFn:()=>Re("Role",_.value),select:t=>{o.value.id=t.id,o.value.shortName=t.shortName,o.value.fullName=t.fullName,o.value.roleModules=[...t.roleModules],o.value.stateId=[t.stateId]},enabled:p})),a=await a,u(),a);he(ee,t=>{t&&V.push(S.ROLE.path)});const{mutate:te,status:oe}=Ie({onMutate:t=>{t.stateId=t.stateId[0]},mutationFn:t=>Ve("Role",t),onSuccess:t=>{t!=null&&t.success&&(o.value=Me(o.value),y.invalidateQueries({queryKey:["roles"]}),y.invalidateQueries({queryKey:["rolesById",_]}),y.invalidateQueries({queryKey:["rolesList"]}),V.push(S.ROLE.path),setTimeout(()=>P.success(G("updateToast")),150))}}),ae=()=>{if(r.value.$validate(),r.value.$errors.length)return;const t={...o.value};te(t),r.value.$reset()};return(t,c)=>{var L,w;const se=m("ManageHead"),re=m("FormInput"),le=m("FormSelect"),ue=m("ActionsModules"),ne=m("CustomButton"),me=m("Spinner");return p.value?(l(),b("section",we,[D("div",Ee,[ye(se,{title:"editRolesTitle",to:s(S).ROLE.path},null,8,["to"]),D("form",{class:"manage__form form-manage",onSubmit:_e(ae,["prevent"])},[(l(!0),b(H,null,ve(Z.value,e=>{var E,k,q,B,F,C,T,U,x,A;return l(),b(H,{key:e.id},[e!=null&&e.select?n("",!0):(l(),d(re,{key:0,modelValue:o.value[e.model],"onUpdate:modelValue":v=>o.value[e.model]=v,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(k=(E=s(r))==null?void 0:E[e.errorKey])==null?void 0:k.$error,textError:(F=(B=(q=s(r))==null?void 0:q[e.errorKey])==null?void 0:B.$errors[0])==null?void 0:F.$message},{default:M(()=>[$(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(l(),d(le,{key:1,modelValue:o.value[e.model],"onUpdate:modelValue":v=>o.value[e.model]=v,modelModifiers:{trim:!0},width:500,options:e.options,error:(T=(C=s(r))==null?void 0:C[e==null?void 0:e.errorKey])==null?void 0:T.$error,placeholder:e==null?void 0:e.placeholder,textError:(A=(x=(U=s(r))==null?void 0:U[e==null?void 0:e.errorKey])==null?void 0:x.$errors[0])==null?void 0:A.$message,success:e.success,loading:e.loading},{default:M(()=>[$(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):n("",!0)],64)}),128)),s(K)?(l(),d(ue,{key:0,modelValue:o.value.roleModules,"onUpdate:modelValue":c[0]||(c[0]=e=>o.value.roleModules=e),actions:s(f)},null,8,["modelValue","actions"])):n("",!0),s(K)?(l(),d(ne,{key:1,className:`form__submit manage__submit ${(w=(L=s(r))==null?void 0:L.fullName.$errors[0])!=null&&w.$message?"centered":""}`,disabled:s(oe)==="pending"},{default:M(()=>[$(I(t.$t("formButton")),1)]),_:1},8,["className","disabled"])):n("",!0)],32),s(j)?(l(),d(me,{key:0})):n("",!0)])])):n("",!0)}}};export{Ae as default};
