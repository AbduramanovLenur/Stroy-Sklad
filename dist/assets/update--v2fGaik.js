import{u as le,a as de,r as n,c as K,z as y,B as V,d as N,e as B,k as E,h as l,w as ue,F as M,C as P,D as O,l as ce,G as me,m as v,o as p,s as S,A as k,f as $,t as L,E as ge}from"./index-VgBwKPk7.js";import{u as pe,r as s}from"./i18n-validators-uSV-iEIu.js";import{a as he,u as ye}from"./generic.services-7eNzkFTP.js";import{u as I}from"./useQuery-2gfhWntW.js";import{a as ve,u as Ie}from"./crud.services-uT7UuOOz.js";import{m as fe,a as _e,b as be}from"./manual.services-C_1Eo4kj.js";const ze={class:"manage section-height shadowed"},Ke={class:"manage__inner section-padding"},Fe={__name:"update",async setup(Ne){let o,t;const f=he(),q=ce(),D=me(),R=le(),{t:x}=de(),_=n(D.params.id),w=n(!1),b=n(!1),r=n({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[],stateId:[]}),Q=K(()=>({id:{required:s},fullName:{required:s},inn:{required:s},address:{required:s},phoneNumber:{required:s},director:{required:s},regionId:{required:s},districtId:{required:s},stateId:{required:s}})),i=pe(Q,r),{data:T,isSuccess:A,isLoading:G}=([o,t]=y(()=>I({queryKey:["regions"],queryFn:()=>fe()})),o=await o,t(),o),h=K(()=>r.value.regionId),H=K(()=>!!h.value.length);V(h,()=>{!b.value&&!w.value&&(r.value.districtId=[]),b.value=!1},{immediate:!0});const{data:U,isSuccess:W,isLoading:j}=([o,t]=y(()=>I({queryKey:["districts",{districtId:h}],queryFn:()=>_e(h.value),enabled:H})),o=await o,t(),o),{data:J,isSuccess:X,isLoading:Y}=([o,t]=y(()=>I({queryKey:["states"],queryFn:()=>be()})),o=await o,t(),o),Z=n([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",type:"number"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),ee=n([{id:1,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:T,success:A,loading:G},{id:2,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:U,success:W,loading:j},{id:3,model:"stateId",label:"stateOrganizationLabel",placeholder:"stateOrganizationPlaceholder",errorKey:"stateId",options:J,success:X,loading:Y}]),{isError:ae}=([o,t]=y(()=>I({queryKey:["companyById",_],queryFn:()=>ve("organization",_.value),select:e=>{r.value.id=e.id,r.value.fullName=e.fullName,r.value.inn=e.inn,r.value.address=e.address,r.value.phoneNumber=e.phoneNumber,r.value.director=e.director,r.value.regionId=[e==null?void 0:e.regionId],r.value.districtId=[e==null?void 0:e.districtId],r.value.stateId=[e==null?void 0:e.stateId],b.value=!0}})),o=await o,t(),o);V(ae,e=>{e&&q.push(S.HOME.path)});const{mutate:re}=ye({onMutate:e=>{w.value=!0,e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>Ie("organization",e),onSuccess:async e=>{e!=null&&e.success&&(r.value=ge(r.value),f.invalidateQueries({queryKey:["companies"]}),f.invalidateQueries({queryKey:["companyById",_]}),f.invalidateQueries({queryKey:["organizations"]}),q.push(S.COMPANIES.path),setTimeout(()=>R.success(x("updateToast")),150))}}),oe=async()=>{if(i.value.$validate(),i.value.$errors.length)return;const e={...r.value};re(e),i.value.$reset()};return(e,Oe)=>{var C,F;const se=v("ManageHead"),te=v("FormInput"),ie=v("FormSelect"),ne=v("CustomButton");return p(),N("section",ze,[B("div",Ke,[E(se,{title:"editCompanyTitle",to:l(S).COMPANIES.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:ue(oe,["prevent"])},[(p(!0),N(M,null,P(Z.value,a=>{var d,u,c,m,g;return p(),k(te,{key:a.id,modelValue:r.value[a.model],"onUpdate:modelValue":z=>r.value[a.model]=z,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(u=(d=l(i))==null?void 0:d[a==null?void 0:a.errorKey])==null?void 0:u.$error,type:a==null?void 0:a.type,textError:(g=(m=(c=l(i))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message},{default:O(()=>[$(L(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),(p(!0),N(M,null,P(ee.value,a=>{var d,u,c,m,g;return p(),k(ie,{key:a.id,modelValue:r.value[a.model],"onUpdate:modelValue":z=>r.value[a.model]=z,modelModifiers:{trim:!0},width:500,options:a.options,error:(u=(d=l(i))==null?void 0:d[a==null?void 0:a.errorKey])==null?void 0:u.$error,placeholder:a==null?void 0:a.placeholder,textError:(g=(m=(c=l(i))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message,success:a.success,loading:a.loading},{default:O(()=>[$(L(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),E(ne,{className:`form__submit ${(F=(C=l(i))==null?void 0:C.stateId.$errors[0])!=null&&F.$message?"centered":""}`},{default:O(()=>[$(L(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Fe as default};
