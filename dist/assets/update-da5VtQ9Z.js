import{u as ue,a as ce,b as me,y as ge,c as h,r as d,z as I,B as M,d as q,e as T,k as D,h as i,w as pe,F as N,C as R,D as B,i as ve,l as be,G as ye,m as _,o as p,s as L,A as Q,f as w,t as C,H as he,E as Ie}from"./index-zkjpq5my.js";import{u as _e,r as l}from"./i18n-validators-UGKONhRL.js";import{a as fe,u as Se}from"./generic.services-wx_DtCHh.js";import{u as f}from"./useQuery-copJlXh0.js";import{a as je,u as Ke}from"./crud.services-8TgOaY3n.js";import{m as $e,a as Oe,b as qe}from"./manual.services-LRvKoYix.js";const Be={key:0,class:"manage section-height shadowed"},Le={class:"manage__inner section-padding"},Te={__name:"update",async setup(we){let s,r;const v=fe(),E=be(),U=ye();ue(),ce();const x=me(),{user:S}=ge(x),b=h(()=>{var a,$;return!!(($=(a=S==null?void 0:S.value.user)==null?void 0:a.modules)!=null&&$.includes(he.OBJECT.UPDATE))}),j=d(U.params.id),V=d(!1),K=d(!1),t=d({id:"",name:"",address:"",regionId:[],districtId:[],stateId:[]}),H=h(()=>({id:{required:l},name:{required:l},address:{required:l},regionId:{required:l},districtId:{required:l},stateId:{required:l}})),o=_e(H,t),{data:P,isSuccess:G,isLoading:A}=([s,r]=I(()=>f({queryKey:["regions"],queryFn:()=>$e(),enabled:b})),s=await s,r(),s),y=h(()=>t.value.regionId),J=h(()=>!!y.value.length);M(y,()=>{!K.value&&!V.value&&(t.value.districtId=[]),K.value=!1},{immediate:!0});const{data:z,isSuccess:W,isLoading:X}=([s,r]=I(()=>f({queryKey:["districts",{districtId:y}],queryFn:()=>Oe(y.value),enabled:J})),s=await s,r(),s),{data:Y,isSuccess:Z,isLoading:ee}=([s,r]=I(()=>f({queryKey:["states"],queryFn:()=>qe(),enabled:b})),s=await s,r(),s),ae=d([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"}]),se=d([{id:1,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:P,success:G,loading:A},{id:2,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:z,success:W,loading:X},{id:3,model:"stateId",label:"stateObjectLabel",placeholder:"stateObjectLabel",errorKey:"stateId",options:Y,success:Z,loading:ee}]),{isError:te}=([s,r]=I(()=>f({queryKey:["objectById",j],queryFn:()=>je("building_object",j.value),select:a=>{t.value.id=a.id,t.value.name=a.fullName,t.value.address=a.address,t.value.regionId=[a.regionId],t.value.districtId=[a.districtId],t.value.stateId=[a.stateId],K.value=!0},enabled:b})),s=await s,r(),s);M(te,a=>{a&&E.push(L.HOME.path)});const{mutate:re}=Se({onMutate:a=>{V.value=!0,a.regionId=a.regionId[0],a.districtId=a.districtId[0],a.stateId=a.stateId[0]},mutationFn:a=>Ke("building_object",a),onSuccess:a=>{t.value=Ie(t.value),v.invalidateQueries({queryKey:["objects"]}),v.invalidateQueries({queryKey:["objectById",j]}),v.invalidateQueries({queryKey:["objectsList"]}),v.invalidateQueries({queryKey:["blocks"]}),E.push(L.OBJECT.path)}}),oe=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const a={...t.value};re(a),o.value.$reset()};return(a,$)=>{var F,k;const de=_("ManageHead"),ie=_("FormInput"),le=_("FormSelect"),ne=_("CustomButton");return b.value?(p(),q("section",Be,[T("div",Le,[D(de,{title:"editObjectTitle",to:i(L).OBJECT.path},null,8,["to"]),T("form",{class:"manage__form form-manage",onSubmit:pe(oe,["prevent"])},[(p(!0),q(N,null,R(ae.value,e=>{var n,u,c,m,g;return p(),Q(ie,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":O=>t.value[e.model]=O,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(u=(n=i(o))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:u.$error,textError:(g=(m=(c=i(o))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message},{default:B(()=>[w(C(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(p(!0),q(N,null,R(se.value,e=>{var n,u,c,m,g;return p(),Q(le,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":O=>t.value[e.model]=O,width:500,options:e.options,error:(u=(n=i(o))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(g=(m=(c=i(o))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message,success:e.success,loading:e.loading},{default:B(()=>[w(C(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),D(ne,{className:`form__submit ${(k=(F=i(o))==null?void 0:F.stateId.$errors[0])!=null&&k.$message?"centered":""}`},{default:B(()=>[w(C(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ve("",!0)}}};export{Te as default};
