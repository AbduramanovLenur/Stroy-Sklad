import{_ as Ie,u as Le,a as Se,b as Te,y as qe,c as b,r as v,z as g,C as W,d as n,e as m,k as $,A as T,F as q,D as U,h as u,t as _,i as c,B as k,m as w,o as t,f as F,I as Fe,H as G,ak as Ve}from"./index-0sPBClUI.js";import{m as Be,n as je}from"./crud.services-BcOS3M0E.js";import{j as Oe,f as $e,g as Ue,h as Ce,k as Ee}from"./manual.services-EJwfGIwS.js";import{u as I}from"./useQuery-eQS1GidE.js";import{u as Re}from"./useMutation-33x-pTwH.js";import"./generic.services-zebC7xpi.js";const ze={key:0,class:"reports"},Me={class:"reports__inner"},Ne={class:"reports__head"},xe={class:"reports__wrapper shadowed"},Ae={class:"reports__tabs"},Pe=["onClick"],Qe={class:"reports__download-icon"},De={class:"reports__download-value"},Ke={class:"reports__filter-icon"},We={class:"reports__filter-value"},Ge={key:0,class:"reports__filter-fields shadowed"},He={key:0,class:"reports__filter-expense filter-fields"},Ze={key:1,class:"reports__filter-expense filter-fields"},Je={key:2,class:"reports__general shadowed"},Xe={class:"reports__general-label"},Ye={class:"reports__general-value"},fe={key:4,class:"empty-table shadowed"},es={__name:"reports",async setup(ss){let a,i;const H=Le(),{t:Z}=Se(),J=Te(),{user:r}=qe(J),L=b(()=>{var s,l;return!!((l=(s=r==null?void 0:r.value.user)==null?void 0:s.modules)!=null&&l.includes(G.REPORTS.READ))}),y=v("expense"),j=v(!1),X=v([{id:1,label:"reportsExpens",query:"expense"},{id:2,label:"reportsWarehouse",query:"warehouse"}]),Y=v([{id:1,label:"reportsMaterial",width:20},{id:2,label:"reportsQuantity",width:10},{id:3,label:"reportsObyekt",width:20},{id:4,label:"reportsBlock",width:20},{id:5,label:"reportsFloor",width:10},{id:6,label:"reportsBudget",width:20}]),f=v([{id:1,label:"reportsMaterial",width:70},{id:2,label:"reportsQuantity",width:30}]),o=v({MaterialId:[],ObjectId:[],BlockId:[],FloorId:[],QuantityTypeId:[]}),O=b(()=>{const s=Object.keys(o.value);let l=`?tableName=${y.value}&`;return s.forEach(d=>{var p;(p=o.value[d])!=null&&p.length&&(l+=`${d}=${o.value[d]}&`)}),l.slice(0,-1)}),{data:C,isSuccess:E,isLoading:R}=([a,i]=g(()=>I({queryKey:["materialsList",{organizationId:r.value.user.organizationId,name:r.value.user.fullName}],queryFn:()=>Oe(),enabled:L})),a=await a,i(),a),{data:ee,isSuccess:se,isLoading:ae}=([a,i]=g(()=>I({queryKey:["objectsList",{organizationId:r.value.user.organizationId,name:r.value.user.fullName}],queryFn:()=>$e(),enabled:L})),a=await a,i(),a),V=b(()=>{var s;return(s=o.value.ObjectId)==null?void 0:s[0]}),te=b(()=>!!V.value);W(V,()=>{o.value.BlockId=[]},{immediate:!0});const{data:oe,isSuccess:le,isLoading:re}=([a,i]=g(()=>I({queryKey:["blocksList",{blockId:V,organizationId:r.value.user.organizationId,name:r.value.user.fullName}],queryFn:()=>Ue(V.value),enabled:te})),a=await a,i(),a),B=b(()=>{var s;return(s=o.value.BlockId)==null?void 0:s[0]}),ne=b(()=>!!B.value);W(B,()=>{o.value.FloorId=[]},{immediate:!0});const{data:ue,isSuccess:ce,isLoading:ie}=([a,i]=g(()=>I({queryKey:["floorsList",{floorId:B,organizationId:r.value.user.organizationId,name:r.value.user.fullName}],queryFn:()=>Ce(B.value),enabled:ne})),a=await a,i(),a),de=b(()=>L&&y.value==="warehouse"),{data:pe,isSuccess:me,isLoading:_e}=([a,i]=g(()=>I({queryKey:["types"],queryFn:()=>Ee(),enabled:de})),a=await a,i(),a),he=v([{id:1,model:"MaterialId",label:"materialLabel",placeholder:"materialPlacehoder",options:C,success:E,loading:R,select:!0},{id:2,model:"ObjectId",label:"objectLabel",placeholder:"objectPlacehoder",options:ee,success:se,loading:ae,select:!0},{id:3,model:"BlockId",label:"blockLabel",placeholder:"blockPlacehoder",options:oe,success:le,loading:re,select:!0},{id:4,model:"FloorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:ue,success:ce,loading:ie,select:!0}]),ye=v([{id:1,model:"MaterialId",label:"materialLabel",placeholder:"materialPlacehoder",options:C,success:E,loading:R,select:!0},{id:2,model:"QuantityTypeId",label:"quantityTypeLabel",placeholder:"quantityTypePlaceholder",options:pe,success:me,loading:_e,select:!0}]),{data:S,isLoading:ve,isSuccess:z,isError:be}=([a,i]=g(()=>I({queryKey:["reports",O,{organizationId:r.value.user.organizationId,name:r.value.user.fullName}],queryFn:()=>Be(O.value),select:s=>s.map(l=>{const d={...l,quantityTypeValue:l.quantityType};return delete d.quantityType,d}),enabled:L})),a=await a,i(),a),{mutate:ge}=Re({mutationFn:s=>je(s),onSuccess:s=>{if(!(s!=null&&s.success))return;const l=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(l),p=document.createElement("a");p.href=d,p.setAttribute("download","filename.xlsx"),document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(d),document.body.removeChild(p),setTimeout(()=>H.success(Z("downloadToast")),150)}});return(s,l)=>{var x,A,P,Q,D,K;const d=w("Title"),p=w("Icon"),M=w("FormInput"),N=w("FormSelect"),ke=w("Table"),we=w("Spinner");return L.value?(t(),n("section",ze,[m("div",Me,[m("div",Ne,[m("div",xe,[$(d,null,{default:T(()=>[F(`\r
                        `+_(s.$t("reportsTitle"))+`\r
                    `,1)]),_:1}),m("div",Ae,[(t(!0),n(q,null,U(X.value,e=>(t(),n("div",{key:e.id,class:Fe(`reports__tab ${y.value===e.query?"is-active":""}`),onClick:()=>y.value=e.query},_(s.$t(e.label)),11,Pe))),128))]),(P=(A=(x=u(r))==null?void 0:x.user)==null?void 0:A.modules)!=null&&P.includes(u(G).REPORTS.DOWNLOAD)?(t(),n("button",{key:0,class:"reports__download hovered",type:"button",onClick:l[0]||(l[0]=()=>u(ge)(O.value))},[m("span",Qe,[$(p,{name:"download"})]),m("span",De,_(s.$t("downloadLink")),1)])):c("",!0)]),m("div",{class:"reports__filter shadowed",onClick:l[1]||(l[1]=()=>j.value=!j.value)},[m("div",Ke,[$(p,{name:"filter"})]),m("div",We,_(s.$t("filtLabel")),1)])]),j.value?(t(),n("div",Ge,[y.value==="expense"?(t(),n("div",He,[(t(!0),n(q,null,U(he.value,e=>(t(),n(q,{key:e.id},[e!=null&&e.select?c("",!0):(t(),k(M,{key:0,modelValue:o.value[e.model],"onUpdate:modelValue":h=>o.value[e.model]=h,placeholder:s.$t(e.placeholder),name:e.icon,type:e==null?void 0:e.type},{default:T(()=>[F(_(s.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),e!=null&&e.select?(t(),k(N,{key:1,modelValue:o.value[e.model],"onUpdate:modelValue":h=>o.value[e.model]=h,modelModifiers:{trim:!0},options:e.options,placeholder:e==null?void 0:e.placeholder,success:e.success,loading:e.loading},{default:T(()=>[F(_(s.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading"])):c("",!0)],64))),128))])):c("",!0),y.value==="warehouse"?(t(),n("div",Ze,[(t(!0),n(q,null,U(ye.value,e=>(t(),n(q,{key:e.id},[e!=null&&e.select?c("",!0):(t(),k(M,{key:0,modelValue:o.value[e.model],"onUpdate:modelValue":h=>o.value[e.model]=h,placeholder:s.$t(e.placeholder),name:e.icon,type:e==null?void 0:e.type},{default:T(()=>[F(_(s.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),e!=null&&e.select?(t(),k(N,{key:1,modelValue:o.value[e.model],"onUpdate:modelValue":h=>o.value[e.model]=h,modelModifiers:{trim:!0},options:e.options,placeholder:e==null?void 0:e.placeholder,success:e.success,loading:e.loading},{default:T(()=>[F(_(s.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading"])):c("",!0)],64))),128))])):c("",!0)])):c("",!0),u(z)&&((Q=u(S))!=null&&Q.length)?(t(),k(ke,{key:1,headers:y.value==="expense"?Y.value:f.value,table:u(S),isShowUpdate:!1,isShowDelete:!1,isShowState:!1},null,8,["headers","table"])):c("",!0),y.value==="expense"&&((D=u(S))!=null&&D.length)?(t(),n("div",Je,[m("div",Xe,_(s.$t("totalAmount")),1),m("div",Ye,_(u(Ve)(u(S).reduce((e,h)=>e+h.summa,0)))+" UZS ",1)])):c("",!0),u(ve)?(t(),k(we,{key:3})):c("",!0),u(z)&&!((K=u(S))!=null&&K.length)||u(be)?(t(),n("div",fe,_(s.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}},us=Ie(es,[["__scopeId","data-v-6e1a9a26"]]);export{us as default};
