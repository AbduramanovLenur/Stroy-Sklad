import{_ as ne,u as ie,a as de,r as v,c,B as ce,m as p,o as d,d as g,e as F,t as m,F as T,C,A as w,D as h,f as I,k as _,J as Ne,q as Ue,b as ze,y as De,z as M,h as u,w as He,i as se,l as Ge,s as re,G as xe,I as H}from"./index-vMPD68lu.js";import{u as Qe,r as S}from"./i18n-validators-6bFMv5c_.js";import{a as Re,u as Je}from"./generic.services-lYBczCwf.js";import{u as B}from"./useQuery-iPiJsYsS.js";import{c as We}from"./crud.services-Ewelvizm.js";import{f as Xe,g as Ye,h as Ze,i as ea,j as aa}from"./manual.services-4txGHHAa.js";import{v as oa}from"./v4-yQnnJER4.js";const la={class:"application-form"},ta={class:"application-form__title"},sa={class:"application-form__overlay form-manage"},ra={__name:"ApplicationForm",props:["selects","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(O,{emit:t}){const i=ie(),{t:E}=de(),P=O,q=t,s=v({floorId:[],costId:[],constructionMaterialId:[],count:""}),L=c(()=>P.buildingBlockId);ce(L,()=>{s.value.floorId=[]});const f=v([{id:1,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"}]),j=()=>{if(!Ne(s.value)){i.error(E("isEmptyModal"));return}s.value={floorId:s.value.floorId[0],costId:s.value.costId[0],constructionMaterialId:s.value.constructionMaterialId[0],count:s.value.count,price:s.value.price},q("onAddTable",s.value),s.value=Ue(s.value)};return(l,G)=>{const n=p("FormSelect"),K=p("FormInput"),N=p("CustomButton");return d(),g("div",la,[F("h4",ta,m(l.$t("appInfo")),1),F("div",sa,[(d(!0),g(T,null,C(O.selects,o=>(d(),w(n,{key:o.id,modelValue:s.value[o.model],"onUpdate:modelValue":b=>s.value[o.model]=b,width:500,options:o.options,placeholder:o==null?void 0:o.placeholder,success:o.success,loading:o.loading,isMultiSelect:o==null?void 0:o.multiple},{default:h(()=>[I(m(l.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128)),(d(!0),g(T,null,C(f.value,o=>(d(),w(K,{key:o.id,modelValue:s.value[o.model],"onUpdate:modelValue":b=>s.value[o.model]=b,width:500,placeholder:l.$t(o.placeholder),name:o.icon,type:o==null?void 0:o.type},{default:h(()=>[I(m(l.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),_(N,{className:"form__submit",type:"button",onClick:j},{default:h(()=>[I(m(l.$t("addButtonForm")),1)]),_:1})])])}}},na=ne(ra,[["__scopeId","data-v-f2cfa771"]]),ia={key:0,class:"manage section-height shadowed"},da={class:"manage__inner section-padding"},ca={class:"manage__overlay"},ua={key:0,class:"error"},pa={__name:"create",async setup(O){let t,i;const E=Re(),P=Ge();ie(),de();const q=ze(),{user:s}=De(q),L=c(()=>{var e,r;return!!((r=(e=s==null?void 0:s.value.user)==null?void 0:e.modules)!=null&&r.includes(xe.APPLICATION.CREATE))}),f=v(!1),j=v([{id:1,label:"appFloor",width:350},{id:2,label:"appMaterial",width:370},{id:3,label:"appCount",width:260},{id:4,label:"appPrice",width:350}]),l=v({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:""}),G=c(()=>({deadline:{required:S},buildingObjectId:{required:S},buildingBlockId:{required:S},createApplicationTables:{required:S},details:{required:S}})),n=Qe(G,l),{data:K,isSuccess:N,isLoading:o}=([t,i]=M(()=>B({queryKey:["objectsList",{organizationId:s.value.user.organizationId}],queryFn:()=>Xe(),enabled:L})),t=await t,i(),t),b=c(()=>l.value.buildingObjectId),ue=c(()=>!!b.value.length);ce(b,()=>{f.value||(l.value.buildingBlockId=[])},{immediate:!0});const{data:pe,isSuccess:me,isLoading:be}=([t,i]=M(()=>B({queryKey:["blocksList",{blockId:b}],queryFn:()=>ea(b.value),enabled:ue})),t=await t,i(),t),U=c(()=>l.value.buildingBlockId),z=c(()=>!!U.value.length),{data:x,isSuccess:ve,isLoading:ge}=([t,i]=M(()=>B({queryKey:["floorsList",{floorId:U}],queryFn:()=>aa(U.value),enabled:z})),t=await t,i(),t),{data:Q,isSuccess:he,isLoading:Ie}=([t,i]=M(()=>B({queryKey:["costsList",{organizationId:s.value.user.organizationId}],queryFn:()=>Ye(),enabled:z})),t=await t,i(),t),{data:R,isSuccess:_e,isLoading:fe}=([t,i]=M(()=>B({queryKey:["materialsList",{organizationId:s.value.user.organizationId}],queryFn:()=>Ze(),enabled:z})),t=await t,i(),t),ye=v([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),Ae=v([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:K,success:N,loading:o},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:pe,success:me,loading:be}]),ke=v([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:x,success:ve,loading:ge},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:Q,success:he,loading:Ie},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:R,success:_e,loading:fe}]),Ve=c(()=>H(x.value)),$e=c(()=>H(Q.value)),Me=c(()=>H(R.value)),Se=e=>{var r;return(r=Ve.value[e.floorId])==null?void 0:r.name},Be=e=>{var r;return(r=$e.value[e.costId])==null?void 0:r.name},Fe=e=>{var r;return(r=Me.value[e==null?void 0:e.constructionMaterialId])==null?void 0:r.name},Le=e=>{l.value.createApplicationTables.push({...e,delId:oa(),floorValue:Se(e),costValue:Be(e),constructionMaterialValue:Fe(e)})},Te=e=>{l.value.createApplicationTables=l.value.createApplicationTables.filter(r=>r.delId!==e)},{mutate:Ce}=Je({onMutate:e=>{f.value=!0,e.buildingObjectId=e.buildingObjectId[0],e.buildingBlockId=e.buildingBlockId[0],e.createApplicationTables=e.createApplicationTables.map(r=>(delete r.delId,delete r.floorValue,delete r.costValue,delete r.constructionMaterialValue,r))},mutationFn:e=>We("application",e),onSuccess:e=>{E.invalidateQueries({queryKey:["applications"]}),P.push(re.APPLICATION.path)}}),we=()=>{n.value.$validate(),!n.value.$errors.length&&(Ce(l.value),n.value.$reset())};return(e,r)=>{var J,W,X,Y,Z,ee,ae,oe,le,te;const Oe=p("ManageHead"),Ee=p("FormInput"),Pe=p("FormSelect"),qe=p("SubTable"),je=p("FormTextarea"),Ke=p("CustomButton");return L.value?(d(),g("section",ia,[F("div",da,[_(Oe,{title:"addNewApplicationTitle",to:u(re).APPLICATION.path},null,8,["to"]),F("form",{class:"manage__form",onSubmit:He(we,["prevent"])},[F("div",ca,[(d(!0),g(T,null,C(ye.value,a=>{var y,A,k,V,$;return d(),w(Ee,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":D=>l.value[a.model]=D,modelModifiers:{trim:!0},width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(A=(y=u(n))==null?void 0:y[a.errorKey])==null?void 0:A.$error,textError:($=(V=(k=u(n))==null?void 0:k[a.errorKey])==null?void 0:V.$errors[0])==null?void 0:$.$message,type:a==null?void 0:a.type},{default:h(()=>[I(m(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(d(!0),g(T,null,C(Ae.value,a=>{var y,A,k,V,$;return d(),w(Pe,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":D=>l.value[a.model]=D,modelModifiers:{trim:!0},width:500,options:a.options,error:(A=(y=u(n))==null?void 0:y[a==null?void 0:a.errorKey])==null?void 0:A.$error,placeholder:a==null?void 0:a.placeholder,textError:($=(V=(k=u(n))==null?void 0:k[a==null?void 0:a.errorKey])==null?void 0:V.$errors[0])==null?void 0:$.$message,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple},{default:h(()=>[I(m(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128))]),_(na,{selects:ke.value,buildingBlockId:l.value.buildingBlockId,isSubmit:f.value,onOnAddTable:Le},null,8,["selects","buildingBlockId","isSubmit"]),(W=(J=u(n))==null?void 0:J.createApplicationTables)!=null&&W.$error?(d(),g("span",ua,m((Z=(Y=(X=u(n))==null?void 0:X.createApplicationTables)==null?void 0:Y.$errors[0])==null?void 0:Z.$message),1)):se("",!0),_(qe,{headers:j.value,table:l.value.createApplicationTables,onOnActionDelete:Te,isShowDelete:!0},null,8,["headers","table"]),_(je,{modelValue:l.value.details,"onUpdate:modelValue":r[0]||(r[0]=a=>l.value.details=a),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),error:(ae=(ee=u(n))==null?void 0:ee.details)==null?void 0:ae.$error,textError:(te=(le=(oe=u(n))==null?void 0:oe.details)==null?void 0:le.$errors[0])==null?void 0:te.$message},{default:h(()=>[I(m(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),_(Ke,{className:"manage__submit"},{default:h(()=>[I(m(e.$t("appButton")),1)]),_:1})],32)])])):se("",!0)}}},fa=ne(pa,[["__scopeId","data-v-90f0d3b2"]]);export{fa as default};
