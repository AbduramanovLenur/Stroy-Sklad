import{u as J,a as X,x as Y,y as k,b as Z,c as ee,r as O,z as te,d as B,e as ae,k as q,h as e,A as U,i as l,t as se,m as r,o as u,s as z,H as p}from"./index-5G4lX_kF.js";import{a as oe,u as ie}from"./generic.services-wDHkXJdP.js";import{u as ne}from"./useQuery-C9Tez9jj.js";import{g as ce,d as le}from"./crud.services-8wN-UV3w.js";import{r as re}from"./index-YXSLMsoo.js";const ue={key:0,class:"applications"},pe={class:"applications__inner"},de={key:2,class:"empty-table shadowed"},Se={__name:"index",async setup(me){let i,h;const y=oe(),H=J(),{t:Q}=X(),R=Y(),{page:d,limit:m,search:V}=k(R),x=Z(),{user:s}=k(x),I=ee(()=>{var t,a;return!!((a=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&a.includes(p.APPLICATION.READ))}),A=O(""),S=re(V,500),K=O([{id:1,label:"applicationUserName",width:12},{id:3,label:"applicationDocDate",width:14.6},{id:4,label:"applicationDedline",width:14.6},{id:5,label:"applicationObject",width:16},{id:6,label:"applicationBlock",width:16}]),{data:n,isLoading:F,isSuccess:_,isError:M}=([i,h]=te(()=>ne({queryKey:["applications",{page:d,limit:m,debouncedSearch:S,organizationId:s.value.user.organizationId,roleId:s.value.user.roleId}],queryFn:()=>ce("application",d.value,m.value,S.value),select:t=>{let a={...t};return a.applications=a==null?void 0:a.applications.map(c=>{const o={...c,name:c.userName};return delete o.userName,delete o.organizationName,delete o.state,delete o.stateId,o}),a},enabled:I})),i=await i,h(),i),{mutate:W}=ie({mutationFn:t=>le("application",t),onSuccess:t=>{t.success&&(y.invalidateQueries({queryKey:["applications"]}),y.invalidateQueries({queryKey:["applicationsById",A]}),setTimeout(()=>H.success(Q("deleteToast")),150))}}),j=async t=>{A.value=t,W(t)};return(t,a)=>{var T,b,P,w,C,g,v,E,N,f,D,L;const c=r("HeadPage"),o=r("Table"),$=r("Pagination"),G=r("Spinner");return I.value?(u(),B("section",ue,[ae("div",pe,[q(c,{title:"applicationTitle",to:e(z).CREATE_APPLICATION.path,isShowCreate:(P=(b=(T=e(s))==null?void 0:T.user)==null?void 0:b.modules)==null?void 0:P.includes(e(p).APPLICATION.CREATE)},null,8,["to","isShowCreate"]),e(_)&&((w=e(n))!=null&&w.count)?(u(),U(o,{key:0,headers:K.value,table:(C=e(n))==null?void 0:C.applications,to:e(z).VIEW_APPLICATION.name,options:{page:e(d),limit:e(m)},isShowEye:!0,isShowUpdate:(E=(v=(g=e(s))==null?void 0:g.user)==null?void 0:v.modules)==null?void 0:E.includes(e(p).APPLICATION.UPDATE),isShowDelete:(D=(f=(N=e(s))==null?void 0:N.user)==null?void 0:f.modules)==null?void 0:D.includes(e(p).APPLICATION.DELETE),onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):l("",!0),q($,{count:(L=e(n))==null?void 0:L.count,isSucces:e(_)},null,8,["count","isSucces"]),e(F)?(u(),U(G,{key:1})):l("",!0),e(_)&&!e(n).count||e(M)?(u(),B("div",de,se(t.$t("emptyTableTitle")),1)):l("",!0)])])):l("",!0)}}};export{Se as default};
