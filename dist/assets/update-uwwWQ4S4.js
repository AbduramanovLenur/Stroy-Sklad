import{u as ne,a as ie,r as i,c as K,z as y,B as V,d as N,e as B,k as E,h as l,w as le,F as P,C as M,D as O,l as de,G as ue,m as v,o as p,s as S,A as k,f as $,t as L,E as ce}from"./index-4UPdn8r5.js";import{u as me,r as s}from"./i18n-validators-rYP8hPEZ.js";import{a as ge,u as pe}from"./generic.services-suEnlNvN.js";import{u as I}from"./useQuery-J_Xc9Nln.js";import{a as he,u as ye}from"./crud.services-eNoFKDSu.js";import{m as ve,a as Ie,b as fe}from"./manual.services-sihQqlgC.js";const _e={class:"manage section-height shadowed"},be={class:"manage__inner section-padding"},we={__name:"update",async setup(ze){let o,t;const f=ge(),q=de(),D=ue();ne(),ie();const _=i(D.params.id),w=i(!1),b=i(!1),a=i({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[],stateId:[]}),R=K(()=>({id:{required:s},fullName:{required:s},inn:{required:s},address:{required:s},phoneNumber:{required:s},director:{required:s},regionId:{required:s},districtId:{required:s},stateId:{required:s}})),n=me(R,a),{data:x,isSuccess:Q,isLoading:A}=([o,t]=y(()=>I({queryKey:["regions"],queryFn:()=>ve()})),o=await o,t(),o),h=K(()=>a.value.regionId),G=K(()=>!!h.value.length);V(h,()=>{!b.value&&!w.value&&(a.value.districtId=[]),b.value=!1},{immediate:!0});const{data:H,isSuccess:U,isLoading:T}=([o,t]=y(()=>I({queryKey:["districts",{districtId:h}],queryFn:()=>Ie(h.value),enabled:G})),o=await o,t(),o),{data:W,isSuccess:j,isLoading:J}=([o,t]=y(()=>I({queryKey:["states"],queryFn:()=>fe()})),o=await o,t(),o),X=i([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",type:"number"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),Y=i([{id:1,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:x,success:Q,loading:A},{id:2,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:H,success:U,loading:T},{id:3,model:"stateId",label:"stateOrganizationLabel",placeholder:"stateOrganizationPlaceholder",errorKey:"stateId",options:W,success:j,loading:J}]),{isError:Z}=([o,t]=y(()=>I({queryKey:["companyById",_],queryFn:()=>he("organization",_.value),select:e=>{a.value.id=e.id,a.value.fullName=e.fullName,a.value.inn=e.inn,a.value.address=e.address,a.value.phoneNumber=e.phoneNumber,a.value.director=e.director,a.value.regionId=[e==null?void 0:e.regionId],a.value.districtId=[e==null?void 0:e.districtId],a.value.stateId=[e==null?void 0:e.stateId],b.value=!0}})),o=await o,t(),o);V(Z,e=>{e&&q.push(S.HOME.path)});const{mutate:ee}=pe({onMutate:e=>{w.value=!0,e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>ye("organization",e),onSuccess:async e=>{a.value=ce(a.value),f.invalidateQueries({queryKey:["companies"]}),f.invalidateQueries({queryKey:["companyById",_]}),f.invalidateQueries({queryKey:["organizations"]}),q.push(S.COMPANIES.path)}}),re=async()=>{if(n.value.$validate(),n.value.$errors.length)return;const e={...a.value};ee(e),n.value.$reset()};return(e,Ke)=>{var C,F;const ae=v("ManageHead"),oe=v("FormInput"),se=v("FormSelect"),te=v("CustomButton");return p(),N("section",_e,[B("div",be,[E(ae,{title:"editCompanyTitle",to:l(S).COMPANIES.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:le(re,["prevent"])},[(p(!0),N(P,null,M(X.value,r=>{var d,u,c,m,g;return p(),k(oe,{key:r.id,modelValue:a.value[r.model],"onUpdate:modelValue":z=>a.value[r.model]=z,width:500,placeholder:e.$t(r.placeholder),name:r.icon,error:(u=(d=l(n))==null?void 0:d[r==null?void 0:r.errorKey])==null?void 0:u.$error,type:r==null?void 0:r.type,textError:(g=(m=(c=l(n))==null?void 0:c[r==null?void 0:r.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message},{default:O(()=>[$(L(e.$t(r.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),(p(!0),N(P,null,M(Y.value,r=>{var d,u,c,m,g;return p(),k(se,{key:r.id,modelValue:a.value[r.model],"onUpdate:modelValue":z=>a.value[r.model]=z,width:500,options:r.options,error:(u=(d=l(n))==null?void 0:d[r==null?void 0:r.errorKey])==null?void 0:u.$error,placeholder:r==null?void 0:r.placeholder,textError:(g=(m=(c=l(n))==null?void 0:c[r==null?void 0:r.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message,success:r.success,loading:r.loading},{default:O(()=>[$(L(e.$t(r.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),E(te,{className:`form__submit ${(F=(C=l(n))==null?void 0:C.stateId.$errors[0])!=null&&F.$message?"centered":""}`},{default:O(()=>[$(L(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{we as default};
