import{u as ue,a as ne,b as ce,y as le,c as U,r as h,z as x,C as me,d as _,e as Q,k as D,h as r,w as de,F as H,D as pe,A as v,i as g,l as ie,G as ye,m as l,o as u,s as C,B as O,f as S,t as I,H as he,E as _e}from"./index-_sW-sQTC.js";import{u as ve,r as $}from"./i18n-validators-ha9JJgi_.js";import{u as ge}from"./generic.services-lrsWuSGG.js";import{u as A}from"./useQuery-__dxNVMJ.js";import{u as Ce}from"./useMutation-A_gT2E6W.js";import{a as Se,u as Ie}from"./crud.services-WjFvBV25.js";import{b as $e}from"./manual.services--mf3Snxn.js";const be={key:0,class:"manage section-height shadowed"},Ve={class:"manage__inner section-padding"},Ee={__name:"update",async setup(Ne){let a,n;const m=ge(),b=ie(),P=ye(),R=ue(),{t:G}=ne(),z=ce(),{user:c}=le(z),d=U(()=>{var t,i;return!!((i=(t=c==null?void 0:c.value.user)==null?void 0:t.modules)!=null&&i.includes(he.COST.UPDATE))}),p=h(P.params.id),s=h({id:"",fullName:"",stateId:[]}),W=U(()=>({id:{required:$},fullName:{required:$},stateId:{required:$}})),o=ve(W,s),{data:j,isSuccess:J,isLoading:X}=([a,n]=x(()=>A({queryKey:["states"],queryFn:()=>$e(),enabled:d})),a=await a,n(),a),Y=h([{id:1,model:"fullName",label:"nameCostsLabel",placeholder:"nameCostsPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"stateId",label:"stateCostsLabel",placeholder:"stateCostsPlaceholder",errorKey:"stateId",options:j,success:J,loading:X,select:!0}]),{isError:Z}=([a,n]=x(()=>A({queryKey:["costById",p,c.value.user.fullName],queryFn:()=>Se("cost",p.value),select:t=>{s.value.id=t.id,s.value.fullName=t.fullname,s.value.stateId=[t.stateId]},enabled:d})),a=await a,n(),a);me(Z,t=>{t&&b.push(C.COST.path)});const{mutate:f,status:ee}=Ce({onMutate:t=>{t.stateId=t.stateId[0]},mutationFn:t=>Ie("cost",t),onSuccess:t=>{t!=null&&t.success&&(s.value=_e(s.value),m.invalidateQueries({queryKey:["costs"]}),m.invalidateQueries({queryKey:["costById",p]}),m.invalidateQueries({queryKey:["costsList"]}),b.push(C.COST.path),setTimeout(()=>R.success(G("updateToast")),150))}}),te=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const t={...s.value};f(t),o.value.$reset()};return(t,i)=>{var V,N;const se=l("ManageHead"),ae=l("FormInput"),oe=l("FormSelect"),re=l("CustomButton");return d.value?(u(),_("section",be,[Q("div",Ve,[D(se,{title:"editCostsTitle",to:r(C).COST.path},null,8,["to"]),Q("form",{class:"manage__form form-manage",onSubmit:de(te,["prevent"])},[(u(!0),_(H,null,pe(Y.value,e=>{var w,B,K,T,q,F,k,E,M,L;return u(),_(H,{key:e.id},[e!=null&&e.select?g("",!0):(u(),O(ae,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":y=>s.value[e.model]=y,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(B=(w=r(o))==null?void 0:w[e==null?void 0:e.errorKey])==null?void 0:B.$error,textError:(q=(T=(K=r(o))==null?void 0:K[e==null?void 0:e.errorKey])==null?void 0:T.$errors[0])==null?void 0:q.$message},{default:v(()=>[S(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(u(),O(oe,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":y=>s.value[e.model]=y,modelModifiers:{trim:!0},width:500,options:e.options,error:(k=(F=r(o))==null?void 0:F[e==null?void 0:e.errorKey])==null?void 0:k.$error,placeholder:e==null?void 0:e.placeholder,textError:(L=(M=(E=r(o))==null?void 0:E[e==null?void 0:e.errorKey])==null?void 0:M.$errors[0])==null?void 0:L.$message,success:e.success,loading:e.loading},{default:v(()=>[S(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):g("",!0)],64)}),128)),D(re,{className:`form__submit ${(N=(V=r(o))==null?void 0:V.stateId.$errors[0])!=null&&N.$message?"centered":""}`,disabled:r(ee)==="pending"},{default:v(()=>[S(I(t.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):g("",!0)}}};export{Ee as default};
