import{_ as ne,u as ce,a as ue,r as c,c as n,A as pe,m as p,o as d,d as _,e as C,t as m,F as T,B as K,y as P,C as f,f as A,k as w,b as Ee,s as Oe,x as S,h as u,w as qe,i as ie,l as je,z as de,E as Ue}from"./index--8tqH1cI.js";import{i as Ne,g as ze,c as xe,a as X}from"./secondary-functions-ph_-mLzy.js";import{u as Re,r as L}from"./i18n-validators-ifF63VWe.js";import{a as De,u as Ge}from"./generic.services-lNDsx7jF.js";import{u as V}from"./useQuery-_ggqNrTF.js";import{c as He}from"./crud.services-U-Ys9NO0.js";import{e as Qe,f as Je,i as We,h as Xe,j as Ye,k as Ze}from"./manual.services-Zmd6WN_N.js";const eo={class:"application-form"},oo={class:"application-form__title"},ao={class:"application-form__overlay form-manage"},lo={__name:"ApplicationForm",props:["selects","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(N,{emit:o}){const r=ce(),{t:z}=ue(),k=N,x=o,s=c({floorId:[],costId:[],constructionMaterialId:[],count:"",price:""}),$=n(()=>k.buildingBlockId),B=n(()=>k==null?void 0:k.isSubmit);pe($,()=>{B.value||(s.value.floorId=[])});const E=c([{id:1,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list",type:"text"},{id:2,model:"price",label:"priceAppLabel",placeholder:"priceAppPlaceholder",icon:"money",type:"text"}]),R=()=>{if(!Ne(s.value)){r.error(z("isEmptyModal"));return}s.value=ze(s.value),x("onAddTable",s.value),s.value=xe(s.value)};return(t,Y)=>{const i=p("FormSelect"),D=p("FormInput"),G=p("CustomButton");return d(),_("div",eo,[C("h4",oo,m(t.$t("appInfo")),1),C("div",ao,[(d(!0),_(T,null,K(N.selects,a=>(d(),P(i,{key:a.id,modelValue:s.value[a.model],"onUpdate:modelValue":F=>s.value[a.model]=F,width:500,options:a.options,placeholder:a==null?void 0:a.placeholder,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple},{default:f(()=>[A(m(t.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128)),(d(!0),_(T,null,K(E.value,a=>(d(),P(D,{key:a.id,modelValue:s.value[a.model],"onUpdate:modelValue":F=>s.value[a.model]=F,width:500,placeholder:t.$t(a.placeholder),name:a.icon,type:a==null?void 0:a.type},{default:f(()=>[A(m(t.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),w(G,{className:"form__submit",type:"button",onClick:R},{default:f(()=>[A(m(t.$t("addButtonForm")),1)]),_:1})])])}}},to=ne(lo,[["__scopeId","data-v-fbdca0d1"]]),so={key:0,class:"manage section-height shadowed"},ro={class:"manage__inner section-padding"},io={class:"manage__overlay"},no={key:0,class:"error"},co={__name:"create",async setup(N){let o,r;const z=De(),k=je();ce(),ue();const x=Ee(),{user:s}=Oe(x),$=n(()=>{var l,y;return!!((y=(l=s==null?void 0:s.value.user)==null?void 0:l.modules)!=null&&y.includes(Ue.APPLICATION.CREATE))}),B=c(!1),E=c([]),R=c([{id:1,label:"appFloor",width:215},{id:2,label:"appPrice",width:275},{id:4,label:"appMaterial",width:275},{id:5,label:"appCount",width:250},{id:3,label:"appCost"}]),t=c({deadline:"",buildingObjectId:[],buildingBlockId:[],roleIds:[],createApplicationTables:[],details:""}),Y=n(()=>({deadline:{required:L},buildingObjectId:{required:L},buildingBlockId:{required:L},roleIds:{required:L},createApplicationTables:{required:L},details:{required:L}})),i=Re(Y,t),{data:D,isSuccess:G,isLoading:a}=([o,r]=S(()=>V({queryKey:["rolesList",{organizationId:s.value.user.organizationId}],queryFn:()=>Qe(),enabled:$})),o=await o,r(),o),{data:F,isSuccess:me,isLoading:be}=([o,r]=S(()=>V({queryKey:["objectsList",{organizationId:s.value.user.organizationId}],queryFn:()=>Je(),enabled:$})),o=await o,r(),o),O=n(()=>t.value.buildingObjectId),he=n(()=>!!O.value.length);pe(O,()=>{B.value||(t.value.buildingBlockId=[])},{immediate:!0});const{data:ge,isSuccess:ve,isLoading:Ie}=([o,r]=S(()=>V({queryKey:["blocksList",{blockId:O}],queryFn:()=>Ye(O.value),enabled:he})),o=await o,r(),o),H=n(()=>t.value.buildingBlockId),Q=n(()=>!!H.value.length),{data:Z,isSuccess:_e,isLoading:ye}=([o,r]=S(()=>V({queryKey:["floorsList",{floorId:H}],queryFn:()=>Ze(H.value),enabled:Q})),o=await o,r(),o),{data:ee,isSuccess:fe,isLoading:Ae}=([o,r]=S(()=>V({queryKey:["costsList",{organizationId:s.value.user.organizationId}],queryFn:()=>We(),enabled:Q})),o=await o,r(),o),{data:oe,isSuccess:ke,isLoading:Se}=([o,r]=S(()=>V({queryKey:["materialsList",{organizationId:s.value.user.organizationId}],queryFn:()=>Xe(),enabled:Q})),o=await o,r(),o),Le=c([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),Ve=c([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:F,success:me,loading:be},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:ge,success:ve,loading:Ie},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:D,success:G,loading:a,multiple:!0}]),$e=c([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",errorKey:"floorId",options:Z,success:_e,loading:ye},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",errorKey:"costId",options:ee,success:fe,loading:Ae},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",errorKey:"constructionMaterialId",options:oe,success:ke,loading:Se}]),Be=c([{id:1,model:"details",label:"appCommentLabel",placeholder:"appCommentPlaceholder",errorKey:"details"}]),Fe=n(()=>X(Z.value)),Me=n(()=>X(ee.value)),we=n(()=>X(oe.value)),Ce=l=>{var q,j,U;const y=(q=Fe.value[l.floorId])==null?void 0:q.name,J=(j=Me.value[l.costId])==null?void 0:j.name,W=(U=we.value[l.constructionMaterialId])==null?void 0:U.name;E.value.push({floorValue:y,costValue:J,constructionMaterialValue:W,count:l.count,price:l.price}),t.value.createApplicationTables.push(l)},{mutate:Te}=Ge({onMutate:l=>{B.value=!0,l.buildingObjectId=l.buildingObjectId[0],l.buildingBlockId=l.buildingBlockId[0]},mutationFn:l=>He("application",l),onSuccess:()=>{z.invalidateQueries({queryKey:["applications"]}),k.push(de.APPLICATIONS.path)}}),Ke=()=>{i.value.$validate(),!i.value.$errors.length&&(Te(t.value),i.value.$reset())};return(l,y)=>{var ae,le,te,se,re;const J=p("ManageHead"),W=p("FormInput"),q=p("FormSelect"),j=p("SubTable"),U=p("FormTextarea"),Pe=p("CustomButton");return $.value?(d(),_("section",so,[C("div",ro,[w(J,{title:"addNewApplicationTitle",to:u(de).APPLICATIONS.path},null,8,["to"]),C("form",{class:"manage__form",onSubmit:qe(Ke,["prevent"])},[C("div",io,[(d(!0),_(T,null,K(Le.value,e=>{var b,h,g,v,I;return d(),P(W,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":M=>t.value[e.model]=M,modelModifiers:{trim:!0},width:500,placeholder:l.$t(e.placeholder),name:e.icon,error:(h=(b=u(i))==null?void 0:b[e.errorKey])==null?void 0:h.$error,textError:(I=(v=(g=u(i))==null?void 0:g[e.errorKey])==null?void 0:v.$errors[0])==null?void 0:I.$message,type:e==null?void 0:e.type},{default:f(()=>[A(m(l.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(d(!0),_(T,null,K(Ve.value,e=>{var b,h,g,v,I;return d(),P(q,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":M=>t.value[e.model]=M,modelModifiers:{trim:!0},width:500,options:e.options,error:(h=(b=u(i))==null?void 0:b[e==null?void 0:e.errorKey])==null?void 0:h.$error,placeholder:e==null?void 0:e.placeholder,textError:(I=(v=(g=u(i))==null?void 0:g[e==null?void 0:e.errorKey])==null?void 0:v.$errors[0])==null?void 0:I.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:f(()=>[A(m(l.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128))]),w(to,{selects:$e.value,buildingBlockId:t.value.buildingBlockId,isSubmit:B.value,onOnAddTable:Ce},null,8,["selects","buildingBlockId","isSubmit"]),(le=(ae=u(i))==null?void 0:ae.createApplicationTables)!=null&&le.$error?(d(),_("span",no,m((re=(se=(te=u(i))==null?void 0:te.createApplicationTables)==null?void 0:se.$errors[0])==null?void 0:re.$message),1)):ie("",!0),w(j,{headers:R.value,table:E.value,onOnActionDelete:y[0]||(y[0]=e=>t.value.createApplicationTables.splice(e,1)),isShowDelete:!0},null,8,["headers","table"]),(d(!0),_(T,null,K(Be.value,e=>{var b,h,g,v,I;return d(),P(U,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":M=>t.value[e.model]=M,modelModifiers:{trim:!0},width:500,placeholder:l.$t(e.placeholder),error:(h=(b=u(i))==null?void 0:b[e.errorKey])==null?void 0:h.$error,textError:(I=(v=(g=u(i))==null?void 0:g[e.errorKey])==null?void 0:v.$errors[0])==null?void 0:I.$message},{default:f(()=>[A(m(l.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","error","textError"])}),128)),w(Pe,{className:"manage__submit"},{default:f(()=>[A(m(l.$t("appButton")),1)]),_:1})],32)])])):ie("",!0)}}},Io=ne(co,[["__scopeId","data-v-c4a71519"]]);export{Io as default};
//# sourceMappingURL=create-yZa9SmC7.js.map
