{"version":3,"file":"index-v-dookIL.js","sources":["../../src/views/products/index.vue"],"sourcesContent":["<template>\r\n    <section class=\"products section-height\">\r\n        <div class=\"products__inner section-padding\">\r\n            <HeadPage \r\n                title=\"productsTitle\" \r\n                :to=\"routes.CREATE_PRODUCTS.path\"\r\n                @onSearch=\"($event) => setSearchValue($event)\"\r\n            />\r\n            <Table \r\n                v-if=\"isSuccessProducts && products.length\"\r\n                :headers=\"headers\" \r\n                :table=\"products\"\r\n                :to=\"routes.UPDATE_PRODUCTS.name\"\r\n                @onActionDelete=\"deleteHandler\"\r\n            />\r\n            <Spinner v-if=\"isLoadingProducts\" />\r\n            <div \r\n                v-if=\"(isSuccessProducts && !products.length) || isError\" \r\n                class=\"empty-table\"\r\n            >\r\n                {{ $t(\"emptyTableTitle\") }}\r\n            </div>\r\n        </div>\r\n    </section>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from \"vue\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { useTableStore } from \"@/store/tableStore\";\r\nimport { refDebounced } from \"@vueuse/core\";\r\nimport { useQueryClient, useQuery, useMutation } from \"@tanstack/vue-query\";\r\nimport { getList, deleteWithId } from \"@/services/crud.services.js\";\r\nimport { routes } from \"@/utils/routes.js\";\r\n\r\nconst queryClient = useQueryClient();\r\n\r\nconst tableStore = useTableStore();\r\nconst { setSearchValue } = tableStore;\r\nconst { page, limit, search } = storeToRefs(tableStore);\r\n\r\nonMounted(() => {\r\n    setSearchValue(\"\");\r\n});\r\n\r\nconst productsId = ref(\"\");\r\n\r\nconst debouncedSearch = refDebounced(search, 500);\r\n\r\nconst headers = ref([\r\n    { id: 1, label: \"productsName\", width: 725 },\r\n    { id: 4, label: \"productsState\", width: 365 },\r\n    { id: 5, label: \"productsAction\", width: 440 }\r\n]);\r\n\r\nconst {\r\n    data: products,\r\n    isLoading: isLoadingProducts,\r\n    isSuccess: isSuccessProducts,\r\n    isError\r\n} = await useQuery({\r\n    queryKey: [\"products\", { page, limit, debouncedSearch }],\r\n    queryFn: () => getList(\"construction_material\", page.value, limit.value, debouncedSearch.value),\r\n    select: (data) => {\r\n        return data.map((elem) => {\r\n            const product = {\r\n                ...elem\r\n            }\r\n\r\n            delete product.organizationName;\r\n\r\n            return product;\r\n        })\r\n    }\r\n});\r\n\r\nconst { mutate: mutateDelete } = useMutation({\r\n    mutationFn: (idx) => deleteWithId(\"construction_material\", idx),\r\n    onSuccess: () => {\r\n        queryClient.invalidateQueries({ queryKey: [\"products\"] });\r\n        queryClient.invalidateQueries({ queryKey: [\"productsById\", productsId] });\r\n    }\r\n});\r\n\r\nconst deleteHandler = async (idx) => {\r\n    productsId.value = idx;\r\n    mutateDelete(idx);\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>"],"names":["queryClient","useQueryClient","tableStore","useTableStore","setSearchValue","page","limit","search","storeToRefs","onMounted","productsId","ref","debouncedSearch","refDebounced","headers","products","isLoadingProducts","isSuccessProducts","isError","__temp","__restore","_withAsyncContext","useQuery","getList","data","elem","product","mutateDelete","useMutation","idx","deleteWithId","deleteHandler"],"mappings":"2eAmCA,MAAMA,EAAcC,EAAc,EAE5BC,EAAaC,EAAa,EAC1B,CAAE,eAAAC,CAAgB,EAAGF,EACrB,CAAE,KAAAG,EAAM,MAAAC,EAAO,OAAAC,CAAQ,EAAGC,EAAYN,CAAU,EAEtDO,EAAU,IAAM,CACZL,EAAe,EAAE,CACrB,CAAC,EAED,MAAMM,EAAaC,EAAI,EAAE,EAEnBC,EAAkBC,EAAaN,EAAQ,GAAG,EAE1CO,EAAUH,EAAI,CAChB,CAAE,GAAI,EAAG,MAAO,eAAgB,MAAO,GAAK,EAC5C,CAAE,GAAI,EAAG,MAAO,gBAAiB,MAAO,GAAK,EAC7C,CAAE,GAAI,EAAG,MAAO,iBAAkB,MAAO,GAAK,CAClD,CAAC,EAEK,CACF,KAAMI,EACN,UAAWC,EACX,UAAWC,EACX,QAAAC,CACJ,GAAU,CAAAC,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACf,SAAU,CAAC,WAAY,CAAE,KAAAjB,EAAM,MAAAC,EAAO,gBAAAM,CAAe,CAAE,EACvD,QAAS,IAAMW,EAAQ,wBAAyBlB,EAAK,MAAOC,EAAM,MAAOM,EAAgB,KAAK,EAC9F,OAASY,GACEA,EAAK,IAAKC,GAAS,CACtB,MAAMC,EAAU,CACZ,GAAGD,CACN,EAED,cAAOC,EAAQ,iBAERA,CACnB,CAAS,CAET,CAAC,CAAA,mBAEK,CAAE,OAAQC,CAAc,EAAGC,EAAY,CACzC,WAAaC,GAAQC,EAAa,wBAAyBD,CAAG,EAC9D,UAAW,IAAM,CACb7B,EAAY,kBAAkB,CAAE,SAAU,CAAC,UAAU,CAAG,CAAA,EACxDA,EAAY,kBAAkB,CAAE,SAAU,CAAC,eAAgBU,CAAU,CAAC,CAAE,CAC3E,CACL,CAAC,EAEKqB,EAAgB,MAAOF,GAAQ,CACjCnB,EAAW,MAAQmB,EACnBF,EAAaE,CAAG,CACpB"}