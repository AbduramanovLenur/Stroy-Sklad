{"version":3,"file":"index-2GFkVxuX.js","sources":["../../src/views/employees/index.vue"],"sourcesContent":["<template>\r\n    <section class=\"employees\">\r\n        <div class=\"employees__inner section-padding\">\r\n            <HeadPage\r\n                title=\"employeesTitle\" \r\n                :to=\"routes.CREATE_EMPLOYEES.path\"\r\n                @onSearch=\"($event) => setSearchValue($event)\"\r\n            />\r\n            <Table \r\n                v-if=\"isSuccessEmployees && employees?.count\"\r\n                :headers=\"headers\" \r\n                :table=\"employees?.users\" \r\n                :to=\"routes.UPDATE_EMPLOYEES.name\"\r\n                :options=\"{ page, limit }\"\r\n                @onActionDelete=\"deleteHandler\"\r\n            />\r\n            <Pagination\r\n                :count=\"employees?.count\"\r\n                :isSucces=\"isSuccessEmployees\"\r\n            />\r\n            <Spinner v-if=\"isLoadingEmployees\" />\r\n            <div \r\n                v-if=\"(isSuccessEmployees && !employees?.count) || isError\" \r\n                class=\"empty-table shadowed\"\r\n            >\r\n                {{ $t(\"emptyTableTitle\") }}\r\n            </div>\r\n        </div>\r\n    </section>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch, onMounted } from \"vue\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { useTableStore } from \"@/store/tableStore\";\r\nimport { refDebounced } from \"@vueuse/core\";\r\nimport { useQueryClient, useQuery, useMutation } from \"@tanstack/vue-query\";\r\nimport { getList, deleteWithId } from \"@/services/crud.services.js\";\r\nimport { routes } from \"@/utils/routes.js\";\r\n\r\nconst queryClient = useQueryClient();\r\n\r\nconst tableStore = useTableStore();\r\nconst { setSearchValue, setPagePagination } = tableStore;\r\nconst { page, limit, search } = storeToRefs(tableStore);\r\n\r\nonMounted(() => {\r\n    setSearchValue(\"\");\r\n});\r\n\r\nwatch(search, () => {\r\n    setPagePagination(1);\r\n});\r\n\r\nconst employeesId = ref(\"\");\r\n\r\nconst debouncedSearch = refDebounced(search, 500);\r\n\r\nconst headers = ref([\r\n    { id: 1, label: \"employeesFullName\", width: 300 },\r\n    { id: 2, label: \"employeesOrganization\", width: 320 },\r\n    { id: 3, label: \"employeesPhone\", width: 255 },\r\n    { id: 4, label: \"employeesRole\", width: 195 },\r\n    { id: 5, label: \"employeesState\" },\r\n    { id: 8, label: \"employeesAction\" },\r\n]);\r\n\r\nconst {\r\n    data: employees,\r\n    isLoading: isLoadingEmployees,\r\n    isSuccess: isSuccessEmployees,\r\n    isError\r\n} = await useQuery({\r\n    queryKey: [\"employees\", { page, limit, debouncedSearch, isAdmin: true }],\r\n    queryFn: () => getList(\"user\", page.value, limit.value, debouncedSearch.value, { isAdmin: true }),\r\n    select: (data) => {\r\n        let employees = {...data};\r\n        employees.users = data?.users.map((elem) => {\r\n            const employee = {\r\n                ...elem,\r\n                phone: elem.phoneNumber,\r\n                company: elem.organizationName,\r\n                name: elem.fullName\r\n            }\r\n\r\n            delete employee.fullName;\r\n            delete employee.phoneNumber;\r\n            delete employee.organizationName;\r\n\r\n            return employee;\r\n        })\r\n\r\n        return employees;\r\n    }\r\n});\r\n\r\nconst { mutate: deleteMutate } = useMutation({\r\n    mutationFn: (idx) => deleteWithId(\"user\", idx),\r\n    onSuccess: () => {\r\n        queryClient.invalidateQueries({ queryKey: [\"employees\"] });\r\n        queryClient.invalidateQueries({ queryKey: [\"employeesById\", employeesId] });\r\n    }\r\n});\r\n\r\nconst deleteHandler = (idx) => {\r\n    employeesId.value = idx;\r\n    deleteMutate(idx);\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.employees {\r\n    &__form {\r\n        display: grid;\r\n        grid-template-columns: repeat(2, 1fr);\r\n        gap: 20px;\r\n        @media (max-width: 1024px) {\r\n            gap: 10px;\r\n        }\r\n        @media (max-width: 768px) {\r\n            grid-template-columns: repeat(1, 1fr);\r\n            gap: 20px;\r\n        }\r\n    }\r\n}\r\n</style>"],"names":["queryClient","useQueryClient","tableStore","useTableStore","setSearchValue","setPagePagination","page","limit","search","storeToRefs","onMounted","watch","employeesId","ref","debouncedSearch","refDebounced","headers","employees","isLoadingEmployees","isSuccessEmployees","isError","__temp","__restore","_withAsyncContext","useQuery","getList","data","elem","employee","deleteMutate","useMutation","idx","deleteWithId","deleteHandler"],"mappings":"wfAwCA,MAAMA,EAAcC,EAAc,EAE5BC,EAAaC,EAAa,EAC1B,CAAE,eAAAC,EAAgB,kBAAAC,CAAmB,EAAGH,EACxC,CAAE,KAAAI,EAAM,MAAAC,EAAO,OAAAC,CAAQ,EAAGC,EAAYP,CAAU,EAEtDQ,EAAU,IAAM,CACZN,EAAe,EAAE,CACrB,CAAC,EAEDO,EAAMH,EAAQ,IAAM,CAChBH,EAAkB,CAAC,CACvB,CAAC,EAED,MAAMO,EAAcC,EAAI,EAAE,EAEpBC,EAAkBC,EAAaP,EAAQ,GAAG,EAE1CQ,EAAUH,EAAI,CAChB,CAAE,GAAI,EAAG,MAAO,oBAAqB,MAAO,GAAK,EACjD,CAAE,GAAI,EAAG,MAAO,wBAAyB,MAAO,GAAK,EACrD,CAAE,GAAI,EAAG,MAAO,iBAAkB,MAAO,GAAK,EAC9C,CAAE,GAAI,EAAG,MAAO,gBAAiB,MAAO,GAAK,EAC7C,CAAE,GAAI,EAAG,MAAO,gBAAkB,EAClC,CAAE,GAAI,EAAG,MAAO,iBAAmB,CACvC,CAAC,EAEK,CACF,KAAMI,EACN,UAAWC,EACX,UAAWC,EACX,QAAAC,CACJ,GAAU,CAAAC,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACf,SAAU,CAAC,YAAa,CAAE,KAAAlB,EAAM,MAAAC,EAAO,gBAAAO,EAAiB,QAAS,GAAM,EACvE,QAAS,IAAMW,EAAQ,OAAQnB,EAAK,MAAOC,EAAM,MAAOO,EAAgB,MAAO,CAAE,QAAS,EAAI,CAAE,EAChG,OAASY,GAAS,CACd,IAAIT,EAAY,CAAC,GAAGS,CAAI,EACxB,OAAAT,EAAU,MAAQS,GAAA,YAAAA,EAAM,MAAM,IAAKC,GAAS,CACxC,MAAMC,EAAW,CACb,GAAGD,EACH,MAAOA,EAAK,YACZ,QAASA,EAAK,iBACd,KAAMA,EAAK,QACd,EAED,cAAOC,EAAS,SAChB,OAAOA,EAAS,YAChB,OAAOA,EAAS,iBAETA,CACnB,GAEeX,CACV,CACL,CAAC,CAAA,mBAEK,CAAE,OAAQY,CAAc,EAAGC,EAAY,CACzC,WAAaC,GAAQC,EAAa,OAAQD,CAAG,EAC7C,UAAW,IAAM,CACb/B,EAAY,kBAAkB,CAAE,SAAU,CAAC,WAAW,CAAG,CAAA,EACzDA,EAAY,kBAAkB,CAAE,SAAU,CAAC,gBAAiBY,CAAW,CAAC,CAAE,CAC7E,CACL,CAAC,EAEKqB,EAAiBF,GAAQ,CAC3BnB,EAAY,MAAQmB,EACpBF,EAAaE,CAAG,CACpB"}