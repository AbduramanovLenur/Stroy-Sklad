import{_ as we,m as Fe,s as Ie,r as m,c as M,n as N,q as i,o as u,d as L,e as V,k as f,x as w,g as $,t as F,i as t,y as K,j as B,F as D,f as H,w as Se}from"./index-WFLadlDb.js";import{u as qe,c as j,r,m as Le}from"./secondary-functions-JSi8_BuW.js";import{u as $e,a as T,b as I,c as Ke,d as ze,e as Ee,j as Oe,k as Me,g as Ve,h as Be,i as Te}from"./manual.services-l5GTzaNO.js";const ke={class:"employees"},Ce={class:"employees__inner"},Pe={class:"employees__head"},Ae={key:2,class:"empty-table"},Qe={__name:"employees",async setup(Re){let s,n;const S=$e(),k=Fe(),{toggleIsOpenModalForm:C}=k,{isOpenModalForm:z}=Ie(k),P=m("addNewEmployeesTitle"),c=m(""),q=m(""),A=M(()=>z),Q=M(()=>z&&c.value=="edit"),{data:W,isSuccess:J,isLoading:X}=([s,n]=N(()=>I({queryKey:["organizations"],queryFn:()=>Oe(),enabled:A})),s=await s,n(),s),{data:Y,isSuccess:Z,isLoading:ee}=([s,n]=N(()=>I({queryKey:["districts"],queryFn:()=>Me(),enabled:A})),s=await s,n(),s),{data:oe,isSuccess:ae,isLoading:se}=([s,n]=N(()=>I({queryKey:["statesEmployees"],queryFn:()=>Ve(),enabled:Q})),s=await s,n(),s),a=m({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:"",roleId:"",stateId:"",search:""}),le=M(()=>{switch(c.value){case"edit":return{fullName:{required:r},userName:{required:r},phoneNumber:{required:r},organizationId:{required:r},roleId:{required:r}};default:return{fullName:{required:r},userName:{required:r},password:{required:r,minLength:Le},phoneNumber:{required:r},organizationId:{required:r},roleId:{required:r}}}}),te=m([{id:1,label:"employeesFullName",width:300},{id:2,label:"employeesOrganization",width:320},{id:3,label:"employeesPhone",width:255},{id:4,label:"employeesRole",width:195},{id:5,label:"employeesState",width:250},{id:8,label:"employeesAction",width:190}]),re=m([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber"}]),ne=m([{id:1,model:"organizationId",label:"employeesOrganizationLabel",options:W,errorKey:"organizationId",success:J,loading:X,show:["create","edit"]},{id:2,model:"roleId",label:"employeesRoleLabel",options:Y,errorKey:"roleId",success:Z,loading:ee,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:oe,success:ae,loading:se,show:["edit"]}]),d=qe(le,a),{data:E,isLoading:de,isSuccess:R}=([s,n]=N(()=>I({queryKey:["employees"],queryFn:()=>Be("user"),select:e=>e.map(l=>{const y={...l,phone:l.phoneNumber,company:l.organizationName};return delete y.phoneNumber,delete y.organizationName,y})})),s=await s,n(),s);[s,n]=N(()=>I({queryKey:["employeesById",q],queryFn:()=>Te("user",q.value),select:e=>{a.value.id=e.id,a.value.fullName=e.fullname,a.value.userName=e.userName,a.value.phoneNumber=e.phoneNumber,a.value.organizationId=e.organizationId,a.value.roleId=e.roleId,a.value.stateId=e.stateId},enabled:Q})),s=await s,n();const{mutate:ie}=T({mutationFn:e=>Ke("user",e),onSuccess:()=>{S.invalidateQueries({queryKey:["employees"]})}}),{mutate:ue}=T({mutationFn:e=>ze("user",e),onSuccess:()=>{S.invalidateQueries({queryKey:["employees"]}),S.invalidateQueries({queryKey:["getByIdEmployees",q]})}}),{mutate:me}=T({mutationFn:e=>Ee("user",e),onSuccess:()=>{S.invalidateQueries({queryKey:["employees"]})}}),G=(e,l)=>{P.value=e,c.value=l,C(),c.value==="create"&&z.value&&(a.value=j(a.value),d.value.$reset())},U=(e,l)=>{if(e==="edit"&&l){q.value=l,G("editEmployeesTitle","edit");return}G("addNewEmployeesTitle","create")},ce=e=>{me(e)},pe=()=>{d.value.$validate(),!d.value.$errors.length&&(c.value==="create"?(delete a.value.id,delete a.value.stateId,ie(a.value)):ue(a.value),C(),a.value=j(a.value),d.value.$reset())};return(e,l)=>{const y=i("Title"),ye=i("FormSearch"),he=i("AddButton"),ge=i("Table"),ve=i("Spinner"),be=i("FormInput"),_e=i("FormSelect"),Ne=i("CustomButton"),fe=i("FormModal");return u(),L("section",ke,[V("div",Ce,[V("div",Pe,[f(y,null,{default:w(()=>[$(`\r
                    `+F(e.$t("employeesTitle"))+`\r
                `,1)]),_:1}),f(ye,{onOnSearch:l[0]||(l[0]=p=>a.value.search=p)}),f(he,{onOnOpenFormModal:l[1]||(l[1]=()=>U("create"))})]),t(R)&&t(E).length?(u(),K(ge,{key:0,headers:te.value,table:t(E),onOnActionEdit:l[2]||(l[2]=p=>U("edit",p)),onOnActionDelete:ce},null,8,["headers","table"])):B("",!0),t(de)?(u(),K(ve,{key:1})):B("",!0),t(R)&&!t(E).length?(u(),L("div",Ae,F(e.$t("emptyTableTitle")),1)):B("",!0)]),f(fe,{title:P.value},{default:w(()=>{var p,x;return[V("form",{class:"employees__form",onSubmit:Se(pe,["prevent"])},[(u(!0),L(D,null,H(re.value,o=>{var h,g,v,b,_;return u(),K(be,{key:o.id,modelValue:a.value[o.model],"onUpdate:modelValue":O=>a.value[o.model]=O,width:500,placeholder:e.$t(o.placeholder),name:o.icon,error:(g=(h=t(d))==null?void 0:h[o==null?void 0:o.errorKey])==null?void 0:g.$error,textError:(_=(b=(v=t(d))==null?void 0:v[o==null?void 0:o.errorKey])==null?void 0:b.$errors[0])==null?void 0:_.$message},{default:w(()=>[$(F(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(u(!0),L(D,null,H(ne.value,o=>{var h,g,v,b,_;return u(),K(_e,{key:o.id,modelValue:a.value[o.model],"onUpdate:modelValue":O=>a.value[o.model]=O,width:500,options:o.options,error:(g=(h=t(d))==null?void 0:h[o==null?void 0:o.errorKey])==null?void 0:g.$error,textError:(_=(b=(v=t(d))==null?void 0:v[o==null?void 0:o.errorKey])==null?void 0:b.$errors[0])==null?void 0:_.$message,success:o.success,loading:o.loading,show:o.show,requestFlag:c.value},{default:w(()=>[$(F(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),f(Ne,{className:`form__submit ${(x=(p=t(d))==null?void 0:p.roleId.$errors[0])!=null&&x.$message?"centered":""}`},{default:w(()=>[$(F(e.$t("formButton")),1)]),_:1},8,["className"])],32)]}),_:1},8,["title"])])}}},De=we(Qe,[["__scopeId","data-v-fc0d4d71"]]);export{De as default};
