import{q as X,s as B,b as Y,c as Z,G as ee,A as te,r as U,x as ae,d as V,e as se,k as z,h as e,y as Q,i as c,t as oe,m as r,o as u,z as R,E as p}from"./index--8tqH1cI.js";import{a as ie,u as ne}from"./generic.services-lNDsx7jF.js";import{u as le}from"./useQuery-_ggqNrTF.js";import{g as ce,d as re}from"./crud.services-U-Ys9NO0.js";import{r as ue}from"./index-Wjsu-XE2.js";const pe={key:0,class:"applications"},de={class:"applications__inner"},me={key:2,class:"empty-table shadowed"},Pe={__name:"index",async setup(he){let i,_;const S=ie(),y=X(),{setSearchValue:A,setPagePagination:x}=y,{page:d,limit:m,search:I}=B(y),H=Y(),{user:s}=B(H),P=Z(()=>{var t,a;return!!((a=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&a.includes(p.APPLICATION.READ))});ee(()=>{A("")}),te(I,()=>{x(1)});const b=U(""),w=ue(I,500),K=U([{id:1,label:"applicationUserName",width:190},{id:3,label:"applicationDocDate",width:310},{id:4,label:"applicationDedline",width:355},{id:5,label:"applicationObject",width:155},{id:6,label:"applicationBlock",width:140}]),{data:n,isLoading:M,isSuccess:h,isError:F}=([i,_]=ae(()=>le({queryKey:["applications",{page:d,limit:m,debouncedSearch:w,organizationId:s.value.user.organizationId,roleId:s.value.user.roleId}],queryFn:()=>ce("application",d.value,m.value,w.value),select:t=>{let a={...t};return a.applications=a==null?void 0:a.applications.map(l=>{const o={...l,name:l.userName};return delete o.userName,delete o.organizationName,delete o.state,delete o.stateId,o}),a},enabled:P})),i=await i,_(),i),{mutate:W}=ne({mutationFn:t=>re("application",t),onSuccess:()=>{S.invalidateQueries({queryKey:["applications"]}),S.invalidateQueries({queryKey:["applicationsById",b]})}}),j=async t=>{b.value=t,W(t)};return(t,a)=>{var T,g,C,v,E,N,D,f,L,k,O,q;const l=r("HeadPage"),o=r("Table"),G=r("Pagination"),$=r("Spinner");return P.value?(u(),V("section",pe,[se("div",de,[z(l,{title:"applicationTitle",to:e(R).CREATE_APPLICATIONS.path,isShowCreate:(C=(g=(T=e(s))==null?void 0:T.user)==null?void 0:g.modules)==null?void 0:C.includes(e(p).APPLICATION.CREATE),onOnSearch:a[0]||(a[0]=J=>e(A)(J))},null,8,["to","isShowCreate"]),e(h)&&((v=e(n))!=null&&v.count)?(u(),Q(o,{key:0,headers:K.value,table:(E=e(n))==null?void 0:E.applications,to:e(R).VIEW_APPLICATIONS.name,options:{page:e(d),limit:e(m)},isShowEye:!0,isShowUpdate:(f=(D=(N=e(s))==null?void 0:N.user)==null?void 0:D.modules)==null?void 0:f.includes(e(p).APPLICATION.UPDATE),isShowDelete:(O=(k=(L=e(s))==null?void 0:L.user)==null?void 0:k.modules)==null?void 0:O.includes(e(p).APPLICATION.DELETE),onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):c("",!0),z(G,{count:(q=e(n))==null?void 0:q.count,isSucces:e(h)},null,8,["count","isSucces"]),e(M)?(u(),Q($,{key:1})):c("",!0),e(h)&&!e(n).count||e(F)?(u(),V("div",me,oe(t.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}};export{Pe as default};
//# sourceMappingURL=index-8_BdfIY7.js.map
