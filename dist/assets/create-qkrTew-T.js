import{u as ee,a as oe,b as re,y as ae,c as F,r as P,z as se,d,e as U,k,h as s,w as te,F as M,C as le,D as i,i as h,l as ne,m,o as n,s as B,A as T,f as y,t as _,H as ue,E as me}from"./index-8l2LyLh8.js";import{u as ce,r as t,m as pe}from"./i18n-validators-Wkg5KBML.js";import{a as de,u as ie}from"./generic.services-yETqkf3T.js";import{u as he}from"./useQuery-tdqJaMO0.js";import{c as ye}from"./crud.services-BcMjcvoI.js";import{e as _e}from"./manual.services-Ls971AW1.js";const ge={key:0,class:"manage section-height shadowed"},be={class:"manage__inner section-padding"},Ve={__name:"create",async setup(ve){let u,g;const z=de(),q=ne(),x=ee(),{t:G}=oe(),H=re(),{user:l}=ae(H),b=F(()=>{var o,c;return!!((c=(o=l==null?void 0:l.value.user)==null?void 0:o.modules)!=null&&c.includes(ue.ORG_USER.CREATE))}),r=P({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:l.value.user.organizationId,roleId:[]}),A=F(()=>({fullName:{required:t},userName:{required:t},password:{required:t,minLength:pe},phoneNumber:{required:t},organizationId:{required:t},roleId:{required:t}})),a=ce(A,r),{data:D,isSuccess:O,isLoading:Q}=([u,g]=se(()=>he({queryKey:["rolesList",{organizationId:l.value.user.organizationId}],queryFn:()=>_e(),enabled:b})),u=await u,g(),u),j=P([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:D,success:O,loading:Q,select:!0}]),{mutate:J}=ie({onMutate:o=>{o.roleId=o.roleId[0]},mutationFn:o=>ye("user",o),onSuccess:o=>{o!=null&&o.success&&(r.value=me(r.value),z.invalidateQueries({queryKey:["orgUsers"]}),q.push(B.ORG_USER.path),setTimeout(()=>x.success(G("createToast")),150))}}),W=()=>{if(a.value.$validate(),a.value.$errors.length)return;const o={...r.value};J(o),a.value.$reset()};return(o,c)=>{var v,N;const X=m("ManageHead"),Y=m("FormInput"),Z=m("FormSelect"),f=m("CustomButton");return b.value?(n(),d("section",ge,[U("div",be,[k(X,{title:"addNewEmployeesTitle",to:s(B).ORG_USER.path},null,8,["to"]),U("form",{class:"manage__form form-manage",onSubmit:te(W,["prevent"])},[(n(!0),d(M,null,le(j.value,e=>{var w,$,I,R,S,V,E,L,K,C;return n(),d(M,{key:e.id},[e!=null&&e.select?h("",!0):(n(),T(Y,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":p=>r.value[e.model]=p,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:($=(w=s(a))==null?void 0:w[e.errorKey])==null?void 0:$.$error,type:e==null?void 0:e.type,textError:(S=(R=(I=s(a))==null?void 0:I[e.errorKey])==null?void 0:R.$errors[0])==null?void 0:S.$message},{default:i(()=>[y(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),e!=null&&e.select?(n(),T(Z,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":p=>r.value[e.model]=p,modelModifiers:{trim:!0},width:500,options:e.options,error:(E=(V=s(a))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:E.$error,placeholder:e==null?void 0:e.placeholder,textError:(C=(K=(L=s(a))==null?void 0:L[e==null?void 0:e.errorKey])==null?void 0:K.$errors[0])==null?void 0:C.$message,success:e.success,loading:e.loading},{default:i(()=>[y(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):h("",!0)],64)}),128)),k(f,{className:`form__submit ${(N=(v=s(a))==null?void 0:v.roleId.$errors[0])!=null&&N.$message?"centered":""}`},{default:i(()=>[y(_(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):h("",!0)}}};export{Ve as default};
