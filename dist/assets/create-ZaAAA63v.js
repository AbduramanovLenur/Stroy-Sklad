import{u as ue,a as ie,b as le,y as de,c as i,r as h,z as M,B as me,d as _,e as N,k as R,h as o,w as pe,F as D,C as ge,D as b,i as v,l as he,m as l,o as n,s as x,A as U,f as y,t as I,H as _e,E as be}from"./index-8l2LyLh8.js";import{u as ve,r as d}from"./i18n-validators-Wkg5KBML.js";import{a as ye,u as Ie}from"./generic.services-yETqkf3T.js";import{u as H}from"./useQuery-tdqJaMO0.js";import{c as $e}from"./crud.services-BcMjcvoI.js";import{m as Se,a as Ce}from"./manual.services-Ls971AW1.js";const Ve={key:0,class:"manage section-height shadowed"},je={class:"manage__inner section-padding"},Fe={__name:"create",async setup(we){let a,c;const $=ye(),P=he(),Q=ue(),{t:A}=ie(),J=le(),{user:m}=de(J),S=i(()=>{var t,p;return!!((p=(t=m==null?void 0:m.value.user)==null?void 0:t.modules)!=null&&p.includes(_e.OBJECT.CREATE))}),C=h(!1),s=h({name:"",address:"",regionId:[],districtId:[]}),G=i(()=>({name:{required:d},address:{required:d},regionId:{required:d},districtId:{required:d}})),r=ve(G,s),{data:z,isSuccess:W,isLoading:X}=([a,c]=M(()=>H({queryKey:["regions"],queryFn:()=>Se(),enabled:S})),a=await a,c(),a),u=i(()=>s.value.regionId[0]),Y=i(()=>!!u.value);me(u,()=>{C.value||(s.value.districtId=[])},{immediate:!0});const{data:Z,isSuccess:f,isLoading:ee}=([a,c]=M(()=>H({queryKey:["districts",{districtId:u}],queryFn:()=>Ce(u.value),enabled:Y})),a=await a,c(),a),te=h([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"},{id:3,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:z,success:W,loading:X,select:!0},{id:4,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:Z,success:f,loading:ee,select:!0}]),{mutate:se}=Ie({onMutate:t=>{C.value=!0,t.regionId=t.regionId[0],t.districtId=t.districtId[0]},mutationFn:t=>$e("building_object",t),onSuccess:t=>{t!=null&&t.success&&(s.value=be(s.value),$.invalidateQueries({queryKey:["objects"]}),$.invalidateQueries({queryKey:["objectsList"]}),P.push(x.OBJECT.path),setTimeout(()=>Q.success(A("createToast")),150))}}),ae=()=>{if(r.value.$validate(),r.value.$errors.length)return;const t={...s.value};se(t),r.value.$reset()};return(t,p)=>{var V,j;const re=l("ManageHead"),oe=l("FormInput"),ne=l("FormSelect"),ce=l("CustomButton");return S.value?(n(),_("section",Ve,[N("div",je,[R(re,{title:"addNewObjectTitle",to:o(x).OBJECT.path},null,8,["to"]),N("form",{class:"manage__form form-manage",onSubmit:pe(ae,["prevent"])},[(n(!0),_(D,null,ge(te.value,e=>{var w,E,K,O,B,L,T,F,k,q;return n(),_(D,{key:e.id},[e!=null&&e.select?v("",!0):(n(),U(oe,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":g=>s.value[e.model]=g,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(E=(w=o(r))==null?void 0:w[e.errorKey])==null?void 0:E.$error,textError:(B=(O=(K=o(r))==null?void 0:K[e.errorKey])==null?void 0:O.$errors[0])==null?void 0:B.$message},{default:b(()=>[y(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(n(),U(ne,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":g=>s.value[e.model]=g,modelModifiers:{trim:!0},width:500,options:e.options,error:(T=(L=o(r))==null?void 0:L[e==null?void 0:e.errorKey])==null?void 0:T.$error,placeholder:e==null?void 0:e.placeholder,textError:(q=(k=(F=o(r))==null?void 0:F[e==null?void 0:e.errorKey])==null?void 0:k.$errors[0])==null?void 0:q.$message,success:e.success,loading:e.loading},{default:b(()=>[y(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):v("",!0)],64)}),128)),R(ce,{className:`form__submit ${(j=(V=o(r))==null?void 0:V.districtId.$errors[0])!=null&&j.$message?"centered":""}`},{default:b(()=>[y(I(t.$t("formButton")),1)]),_:1},8,["className"])],32)])])):v("",!0)}}};export{Fe as default};
