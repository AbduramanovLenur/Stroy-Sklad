import{s as W,x as M,b as $,c as J,r as B,y as X,d as P,e as Y,k as q,h as e,z as L,i as n,t as Z,m as i,o as u,A as U,G as r}from"./index-JvbhfmnW.js";import{a as ee,u as te}from"./generic.services-nPQjChLr.js";import{u as se}from"./useQuery-83Oo_vnt.js";import{g as ae,d as oe}from"./crud.services-ysnFdDpK.js";import{r as ne}from"./index-uTbnGIef.js";const ie={key:0,class:"estimate"},ue={class:"estimate__inner"},re={key:2,class:"empty-table shadowed"},Se={__name:"index",async setup(ce){let a,p;const _=ee(),N=W(),{page:c,limit:l,search:Q}=M(N),R=$(),{user:s}=M(R),S=J(()=>{var t,m;return!!((m=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&m.includes(r.ESTIMATE.READ))}),b=B(""),E=ne(Q,500),x=B([{id:1,label:"estimateName"},{id:2,label:"estimateObject"},{id:3,label:"estimateAddress"},{id:4,label:"estimatePrice"}]),{data:o,isLoading:z,isSuccess:d,isError:H}=([a,p]=X(()=>se({queryKey:["budgets",{page:c,limit:l,debouncedSearch:E,organizationId:s.value.user.organizationId,roleId:s.value.user.roleId}],queryFn:()=>ae("budget",c.value,l.value,E.value),enabled:S})),a=await a,p(),a),{mutate:K}=te({mutationFn:t=>oe("budget",t),onSuccess:()=>{_.invalidateQueries({queryKey:["budgets"]}),_.invalidateQueries({queryKey:["budgetsById",b]})}}),V=async t=>{b.value=t,K(t)};return(t,m)=>{var T,g,y,h,A,v,I,f,w,D,C,k;const F=i("HeadPage"),O=i("Table"),j=i("Pagination"),G=i("Spinner");return S.value?(u(),P("section",ie,[Y("div",ue,[q(F,{title:"estimateTitle",to:e(U).CREATE_ESTIMATE.path,isShowCreate:(y=(g=(T=e(s))==null?void 0:T.user)==null?void 0:g.modules)==null?void 0:y.includes(e(r).ESTIMATE.CREATE)},null,8,["to","isShowCreate"]),e(d)&&((h=e(o))!=null&&h.count)?(u(),L(O,{key:0,headers:x.value,table:(A=e(o))==null?void 0:A.budgets,to:e(U).UPDATE_ESTIMATE.name,options:{page:e(c),limit:e(l)},isShowUpdate:(f=(I=(v=e(s))==null?void 0:v.user)==null?void 0:I.modules)==null?void 0:f.includes(e(r).ESTIMATE.UPDATE),isShowDelete:(C=(D=(w=e(s))==null?void 0:w.user)==null?void 0:D.modules)==null?void 0:C.includes(e(r).ESTIMATE.DELETE),onOnActionDelete:V},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q(j,{count:(k=e(o))==null?void 0:k.count,isSucces:e(d)},null,8,["count","isSucces"]),e(z)?(u(),L(G,{key:1})):n("",!0),e(d)&&!e(o).count||e(H)?(u(),P("div",re,Z(t.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{Se as default};
//# sourceMappingURL=index-33HzEjla.js.map
