import{u as oe,a as re,b as ae,y as se,c as C,r as P,z as te,d,e as U,k,h as s,w as le,F as B,D as ne,A as i,i as h,l as ue,m,o as n,s as M,B as T,f as y,t as _,H as me,E as ce}from"./index-KYHZIXyW.js";import{u as pe,r as l,m as de}from"./i18n-validators-TiKQ9SY_.js";import{u as ie}from"./generic.services-YA4lnf9v.js";import{u as he}from"./useQuery-lv7mhtLD.js";import{u as ye}from"./useMutation-7roH085H.js";import{c as _e}from"./crud.services-K83EyEdH.js";import{e as ge}from"./manual.services-6j76Y8mg.js";const be={key:0,class:"manage section-height shadowed"},ve={class:"manage__inner section-padding"},Le={__name:"create",async setup(Ne){let u,g;const z=ie(),q=ue(),x=oe(),{t:G}=re(),H=ae(),{user:t}=se(H),b=C(()=>{var o,c;return!!((c=(o=t==null?void 0:t.value.user)==null?void 0:o.modules)!=null&&c.includes(me.ORG_USER.CREATE))}),r=P({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:t.value.user.organizationId,roleId:[]}),A=C(()=>({fullName:{required:l},userName:{required:l},password:{required:l,minLength:de},phoneNumber:{required:l},organizationId:{required:l},roleId:{required:l}})),a=pe(A,r),{data:D,isSuccess:O,isLoading:Q}=([u,g]=te(()=>he({queryKey:["rolesList",{organizationId:t.value.user.organizationId,name:t.value.user.fullName}],queryFn:()=>ge(),enabled:b})),u=await u,g(),u),j=P([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:D,success:O,loading:Q,select:!0}]),{mutate:J,status:W}=ye({onMutate:o=>{o.roleId=o.roleId[0]},mutationFn:o=>_e("user",o),onSuccess:o=>{o!=null&&o.success&&(r.value=ce(r.value),z.invalidateQueries({queryKey:["orgUsers"]}),q.push(M.ORG_USER.path),setTimeout(()=>x.success(G("createToast")),150))}}),X=()=>{if(a.value.$validate(),a.value.$errors.length)return;const o={...r.value};J(o),a.value.$reset()};return(o,c)=>{var v,N;const Y=m("ManageHead"),Z=m("FormInput"),f=m("FormSelect"),ee=m("CustomButton");return b.value?(n(),d("section",be,[U("div",ve,[k(Y,{title:"addNewEmployeesTitle",to:s(M).ORG_USER.path},null,8,["to"]),U("form",{class:"manage__form form-manage",onSubmit:le(X,["prevent"])},[(n(!0),d(B,null,ne(j.value,e=>{var $,w,I,R,S,V,E,L,K,F;return n(),d(B,{key:e.id},[e!=null&&e.select?h("",!0):(n(),T(Z,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":p=>r.value[e.model]=p,placeholder:o.$t(e.placeholder),name:e.icon,error:(w=($=s(a))==null?void 0:$[e.errorKey])==null?void 0:w.$error,type:e==null?void 0:e.type,textError:(S=(R=(I=s(a))==null?void 0:I[e.errorKey])==null?void 0:R.$errors[0])==null?void 0:S.$message},{default:i(()=>[y(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),e!=null&&e.select?(n(),T(f,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":p=>r.value[e.model]=p,modelModifiers:{trim:!0},options:e.options,error:(E=(V=s(a))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:E.$error,placeholder:e==null?void 0:e.placeholder,textError:(F=(K=(L=s(a))==null?void 0:L[e==null?void 0:e.errorKey])==null?void 0:K.$errors[0])==null?void 0:F.$message,success:e.success,loading:e.loading},{default:i(()=>[y(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):h("",!0)],64)}),128)),k(ee,{className:`form__submit ${(N=(v=s(a))==null?void 0:v.roleId.$errors[0])!=null&&N.$message?"centered":""}`,disabled:s(W)==="pending"},{default:i(()=>[y(_(o.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):h("",!0)}}};export{Le as default};
