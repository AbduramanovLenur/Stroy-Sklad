import{u as ce,a as pe,r as n,y as d,c as B,x as O,b as L,d as V,f as C,k as b,w as me,F as w,e as $,B as S,g as ge,C as Ie,h as v,o as y,A,z as P,i as j,t as K}from"./index-TSEQ-eOA.js";import{u as be,r}from"./i18n-validators-JwSzG1r2.js";import{a as ye,u as he}from"./generic.services-DL6v4nvc.js";import{u}from"./useQuery-LbR7akY7.js";import{a as ve,u as fe}from"./crud.services-TcfslZre.js";import{h as _e,i as ke,g as Be,e as Le,j as Se}from"./manual.services-teOujj0Q.js";const Ae={class:"manage section-height shadowed"},je={class:"manage__inner section-padding"},$e={__name:"update",async setup(Ke){let a,l;const M=ye(),F=ge(),E=Ie();ce(),pe();const f=n(E.params.id),t=n(localStorage.getItem("organizationId")),q=n(!1),_=n(!1),s=n({userId:"",organizationId:"",deadline:"",constructionMaterialIds:[],buildingObjectId:[],buildingBlockId:[],floor:[],costId:[]}),{data:z,isSuccess:x,isLoading:N}=([a,l]=d(()=>u({queryKey:["floors",{organizationId:t}],queryFn:()=>_e(t.value)})),a=await a,l(),a),{data:T,isSuccess:G,isLoading:H}=([a,l]=d(()=>u({queryKey:["costs",{organizationId:t}],queryFn:()=>ke(t.value)})),a=await a,l(),a),{data:Q,isSuccess:U,isLoading:R}=([a,l]=d(()=>u({queryKey:["materials",{organizationId:t}],queryFn:()=>Be(t.value)})),a=await a,l(),a),{data:D,isSuccess:W,isLoading:J}=([a,l]=d(()=>u({queryKey:["objectsList",{organizationId:t}],queryFn:()=>Le(t.value)})),a=await a,l(),a),h=B(()=>s.value.buildingObjectId),X=B(()=>!!h.value.length);O(h,()=>{!_.value&&!q.value&&(s.value.buildingBlockId=[]),_.value=!1},{immediate:!0});const{data:Y,isSuccess:Z,isLoading:ee}=([a,l]=d(()=>u({queryKey:["blocksList",{blockId:h}],queryFn:()=>Se(h.value),enabled:X})),a=await a,l(),a),oe=B(()=>({userId:{required:r},organizationId:{required:r},deadline:{required:r},constructionMaterialIds:{required:r},buildingObjectId:{required:r},buildingBlockId:{required:r},floor:{required:r},costId:{required:r}})),i=be(oe,s),ae=n([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),se=n([{id:1,model:"floor",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",errorKey:"floor",options:z,success:x,loading:N,optionValue:"name"},{id:2,model:"constructionMaterialIds",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",errorKey:"constructionMaterialIds",options:Q,success:U,loading:R,multiple:!0},{id:3,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",errorKey:"costId",options:T,success:G,loading:H},{id:4,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:D,success:W,loading:J},{id:5,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:Y,success:Z,loading:ee}]),{isError:le}=([a,l]=d(()=>u({queryKey:["applicationsById",f],queryFn:()=>ve("application",f.value),select:o=>{s.value.id=o.id,s.value.userId=o.userId,s.value.organizationId=o.organizationId,s.value.deadline=o.deadline,s.value.constructionMaterialIds=[...o.constructionMaterialIds],s.value.buildingObjectId=[o.buildingObjectId],s.value.buildingBlockId=[o.buildingBlockId],s.value.floor=[o.floor],s.value.costId=[o.costId],_.value=!0}})),a=await a,l(),a);O(le,o=>{o&&F.push(A.HOME.path)});const{mutate:te}=he({onMutate:o=>{q.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.buildingBlockId=o.buildingBlockId[0],o.floor=o.floor[0],o.costId=o.costId[0]},mutationFn:o=>fe("application",o),onSuccess:()=>{M.invalidateQueries({queryKey:["applications"]}),M.invalidateQueries({queryKey:["applicationsById",f]}),F.push(A.APPLICATIONS.path)}}),re=async()=>{i.value.$validate(),!i.value.$errors.length&&(te(s.value),i.value.$reset())};return(o,Me)=>{const ie=v("ManageHead"),ne=v("FormInput"),de=v("FormSelect"),ue=v("CustomButton");return y(),L("section",Ae,[V("div",je,[C(ie,{title:"editApplicationTitle",to:b(A).APPLICATIONS.path},null,8,["to"]),V("form",{class:"manage__form form-manage",onSubmit:me(re,["prevent"])},[(y(!0),L(w,null,$(ae.value,e=>{var c,p,m,g,I;return y(),P(ne,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":k=>s.value[e.model]=k,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(p=(c=b(i))==null?void 0:c[e.errorKey])==null?void 0:p.$error,textError:(I=(g=(m=b(i))==null?void 0:m[e.errorKey])==null?void 0:g.$errors[0])==null?void 0:I.$message,type:e==null?void 0:e.type},{default:S(()=>[j(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(y(!0),L(w,null,$(se.value,e=>{var c,p,m,g,I;return y(),P(de,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":k=>s.value[e.model]=k,width:500,options:e.options,error:(p=(c=b(i))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$error,placeholder:e==null?void 0:e.placeholder,textError:(I=(g=(m=b(i))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:g.$errors[0])==null?void 0:I.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple,optionValue:e==null?void 0:e.optionValue},{default:S(()=>[j(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect","optionValue"])}),128)),C(ue,{className:"form__submit"},{default:S(()=>[j(K(o.$t("formButton")),1)]),_:1})],32)])])}}};export{$e as default};
//# sourceMappingURL=update-2Y2THyfa.js.map
