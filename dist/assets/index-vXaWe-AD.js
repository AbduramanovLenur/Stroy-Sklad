import{g as X,d as Y}from"./crud.services-WjFvBV25.js";import{u as Z,a as ee,x as te,y as k,b as se,c as ae,r as M,z as oe,d as P,e as ne,k as N,A as ie,h as e,B as q,i as n,t as L,m as i,o as u,f as ue,s as U,H as c}from"./index-_sW-sQTC.js";import{u as ce}from"./generic.services-lrsWuSGG.js";import{u as re}from"./useQuery-__dxNVMJ.js";import{u as de}from"./useMutation-A_gT2E6W.js";import{r as le}from"./index-zI2a6Eei.js";const me={key:0,class:"estimate"},_e={class:"estimate__inner"},Te={key:2,class:"empty-table shadowed"},fe={__name:"index",async setup(he){let a,_;const T=ce(),x=Z(),{t:H}=ee(),Q=te(),{page:r,limit:d,search:R}=k(Q),V=se(),{user:s}=k(V),h=ae(()=>{var t,m;return!!((m=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&m.includes(c.ESTIMATE.READ))}),p=M(""),S=le(R,500),z=M([{id:1,label:"estimateName",width:25},{id:2,label:"estimateObject",width:25},{id:3,label:"estimateAddress",width:20},{id:4,label:"estimatePrice",width:20}]),{data:o,isLoading:K,isSuccess:l,isError:F}=([a,_]=oe(()=>re({queryKey:["budgets",{page:r,limit:d,debouncedSearch:S,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>X("budget",r.value,d.value,S.value),enabled:h})),a=await a,_(),a),{mutate:O}=de({mutationFn:t=>Y("budget",t),onSuccess:t=>{t!=null&&t.success&&(T.invalidateQueries({queryKey:["budgets"]}),T.invalidateQueries({queryKey:["budgetById",p]}),setTimeout(()=>x.success(H("deleteToast")),150))}}),$=async t=>{p.value=t,O(t)};return(t,m)=>{var b,E,g,y,f,w,A,v,I,C,D,B;const j=i("HeadPage"),W=i("Table"),G=i("Pagination"),J=i("Spinner");return h.value?(u(),P("section",me,[ne("div",_e,[N(j,{title:"estimateTitle",to:e(U).CREATE_ESTIMATE.path,isShowCreate:(g=(E=(b=e(s))==null?void 0:b.user)==null?void 0:E.modules)==null?void 0:g.includes(e(c).ESTIMATE.CREATE)},{default:ie(()=>[ue(L(t.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),e(l)&&((y=e(o))!=null&&y.count)?(u(),q(W,{key:0,headers:z.value,table:(f=e(o))==null?void 0:f.budgets,to:e(U).UPDATE_ESTIMATE.name,options:{page:e(r),limit:e(d)},isShowUpdate:(v=(A=(w=e(s))==null?void 0:w.user)==null?void 0:A.modules)==null?void 0:v.includes(e(c).ESTIMATE.UPDATE),isShowDelete:(D=(C=(I=e(s))==null?void 0:I.user)==null?void 0:C.modules)==null?void 0:D.includes(e(c).ESTIMATE.DELETE),onOnActionDelete:$},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),N(G,{count:(B=e(o))==null?void 0:B.count,isSucces:e(l)},null,8,["count","isSucces"]),e(K)?(u(),q(J,{key:1})):n("",!0),e(l)&&!e(o).count||e(F)?(u(),P("div",Te,L(t.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{fe as default};
