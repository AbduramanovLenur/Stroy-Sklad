import{u as ke,a as _e,r as c,b as Fe,y as Oe,c as p,z as i,B as x,d as F,e as A,k as G,h as n,w as Le,F as Q,C as Be,D as O,i as L,l as Ke,G as Se,m as I,o as d,s as B,A as H,f as K,t as S,H as $e,E as qe}from"./index-qYaOSAk5.js";import{a as we,u as Ce}from"./crud.services-6H1cbtzh.js";import{f as je,m as Ve,a as Ne,b as Ee}from"./manual.services-e5QN_9-o.js";import{u as Pe,r}from"./i18n-validators-FA-njMbI.js";import{a as Re,u as Me}from"./generic.services-uSp9rJcx.js";import{u as m}from"./useQuery-3KlBkAoQ.js";const De={key:0,class:"manage section-height shadowed"},Te={class:"manage__inner section-padding"},We={__name:"update",async setup(Ue){let o,a;const h=Re(),$=Ke(),z=Se(),W=ke(),{t:J}=_e(),v=c(z.params.id),X=Fe(),{user:b}=Oe(X),u=p(()=>{var e,k;return!!((k=(e=b==null?void 0:b.value.user)==null?void 0:e.modules)!=null&&k.includes($e.BLOCK.UPDATE))}),q=c(!1),y=c(!1),t=c({id:"",fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[],stateId:[]}),Y=p(()=>({id:{required:r},fullname:{required:r},numberOfFloors:{required:r},roomsOnFloor:{required:r},address:{required:r},buildingObjectId:{required:r},regionId:{required:r},districtId:{required:r},stateId:{required:r}})),l=Pe(Y,t),{data:Z,isSuccess:f,isLoading:ee}=([o,a]=i(()=>m({queryKey:["regions"],queryFn:()=>Ve(),enabled:u})),o=await o,a(),o),g=p(()=>t.value.regionId[0]),se=p(()=>!!g.value);x(g,()=>{!y.value&&!q.value&&(t.value.districtId=[]),y.value=!1},{immediate:!0});const{data:oe,isSuccess:te,isLoading:ae}=([o,a]=i(()=>m({queryKey:["districts",{districtId:g}],queryFn:()=>Ne(g.value),enabled:se})),o=await o,a(),o),{data:re,isSuccess:le,isLoading:ne}=([o,a]=i(()=>m({queryKey:["objectsList",{organizationId:b.value.user.organizationId}],queryFn:()=>je(),enabled:u})),o=await o,a(),o),{data:ue,isSuccess:ce,isLoading:ie}=([o,a]=i(()=>m({queryKey:["states"],queryFn:()=>Ee(),enabled:u})),o=await o,a(),o),de=c([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"},{id:5,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:re,success:le,loading:ne,select:!0},{id:6,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:Z,success:f,loading:ee,select:!0},{id:7,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:oe,success:te,loading:ae,select:!0},{id:8,model:"stateId",label:"stateBlocksLabel",placeholder:"stateBlocksPlaceholder",errorKey:"stateId",options:ue,success:ce,loading:ie,select:!0}]),{isError:me}=([o,a]=i(()=>m({queryKey:["blocksById",v],queryFn:()=>we("building_block",v.value),select:e=>{t.value.id=e.id,t.value.fullname=e.fullName,t.value.numberOfFloors=e.numberOfFloors,t.value.roomsOnFloor=e.roomsOnFloor,t.value.address=e.address,t.value.buildingObjectId=[e.buildingObjectId],t.value.regionId=[e.regionId],t.value.districtId=[e.districtId],t.value.stateId=[e.stateId],y.value=!0},enabled:u})),o=await o,a(),o);x(me,e=>{e&&$.push(B.BLOCK.path)});const{mutate:be,status:ge}=Me({onMutate:e=>{q.value=!0,e.buildingObjectId=e.buildingObjectId[0],e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>Ce("building_block",e),onSuccess:e=>{e!=null&&e.success&&(t.value=qe(t.value),h.invalidateQueries({queryKey:["blocks"]}),h.invalidateQueries({queryKey:["blocksById",v]}),h.invalidateQueries({queryKey:["blocksList"]}),$.push(B.BLOCK.path),setTimeout(()=>W.success(J("updateToast")),150))}}),pe=async()=>{if(l.value.$validate(),l.value.$errors.length)return;const e={...t.value};be(e),l.value.$reset()};return(e,k)=>{var w,C;const Ie=I("ManageHead"),he=I("FormInput"),ve=I("FormSelect"),ye=I("CustomButton");return u.value?(d(),F("section",De,[A("div",Te,[G(Ie,{title:"editBlocksTitle",to:n(B).BLOCK.path},null,8,["to"]),A("form",{class:"manage__form form-manage",onSubmit:Le(pe,["prevent"])},[(d(!0),F(Q,null,Be(de.value,s=>{var j,V,N,E,P,R,M,D,T,U;return d(),F(Q,{key:s.id},[s!=null&&s.select?L("",!0):(d(),H(he,{key:0,modelValue:t.value[s.model],"onUpdate:modelValue":_=>t.value[s.model]=_,width:500,placeholder:e.$t(s.placeholder),name:s.icon,error:(V=(j=n(l))==null?void 0:j[s==null?void 0:s.errorKey])==null?void 0:V.$error,textError:(P=(E=(N=n(l))==null?void 0:N[s==null?void 0:s.errorKey])==null?void 0:E.$errors[0])==null?void 0:P.$message},{default:O(()=>[K(S(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),s!=null&&s.select?(d(),H(ve,{key:1,modelValue:t.value[s.model],"onUpdate:modelValue":_=>t.value[s.model]=_,modelModifiers:{trim:!0},width:500,options:s.options,error:(M=(R=n(l))==null?void 0:R[s==null?void 0:s.errorKey])==null?void 0:M.$error,placeholder:s==null?void 0:s.placeholder,textError:(U=(T=(D=n(l))==null?void 0:D[s==null?void 0:s.errorKey])==null?void 0:T.$errors[0])==null?void 0:U.$message,success:s.success,loading:s.loading},{default:O(()=>[K(S(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):L("",!0)],64)}),128)),G(ye,{className:`form__submit ${(C=(w=n(l))==null?void 0:w.stateId.$errors[0])!=null&&C.$message?"centered":""}`,disabled:n(ge)==="pending"},{default:O(()=>[K(S(e.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):L("",!0)}}};export{We as default};
