import{_ as _e,n as Ne,s as fe,r as u,c as $,q as f,d as m,o as i,e as I,f as H,l as E,j as t,x as F,k as O,t as S,y as q,F as A,g as U,h as M,w as we}from"./index-lIBmWoQk.js";import{d as Ie,u as Fe,a as V,c as G,b as r,m as Se}from"./generic.services-wyHkLZNP.js";import{u as w,c as qe,a as Ke,d as Le,h as ze,i as $e,e as Ee,g as Oe,f as Me}from"./manual.services-hDEKQQqT.js";const Ve={class:"employees"},Be={class:"employees__inner section-padding"},Pe={key:2,class:"empty-table"},Te={__name:"employees",async setup(ke){let s,n;const p=Ie(),B=Ne(),{toggleIsOpenModalForm:P}=B,{isOpenModalForm:K}=fe(B),T=u("addNewEmployeesTitle"),c=u(""),y=u(""),a=u({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:"",roleId:"",stateId:"",search:""}),k=$(()=>K),C=$(()=>K&&c.value==="edit"),{data:D,isSuccess:W,isLoading:j}=([s,n]=f(()=>w({queryKey:["organizations"],queryFn:()=>ze(),enabled:k})),s=await s,n(),s),{data:J,isSuccess:X,isLoading:Y}=([s,n]=f(()=>w({queryKey:["roles"],queryFn:()=>$e(),enabled:k})),s=await s,n(),s),{data:Z,isSuccess:ee,isLoading:oe}=([s,n]=f(()=>w({queryKey:["states"],queryFn:()=>Ee(),enabled:C})),s=await s,n(),s),ae=$(()=>{switch(c.value){case"edit":return{fullName:{required:r},userName:{required:r},phoneNumber:{required:r},organizationId:{required:r},roleId:{required:r}};default:return{fullName:{required:r},userName:{required:r},password:{required:r,minLength:Se},phoneNumber:{required:r},organizationId:{required:r},roleId:{required:r}}}}),se=u([{id:1,label:"employeesFullName",width:300},{id:2,label:"employeesOrganization",width:320},{id:3,label:"employeesPhone",width:255},{id:4,label:"employeesRole",width:195},{id:5,label:"employeesState",width:250},{id:8,label:"employeesAction",width:190}]),le=u([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber"}]),te=u([{id:1,model:"organizationId",label:"employeesOrganizationLabel",options:D,errorKey:"organizationId",success:W,loading:j,show:["create","edit"]},{id:2,model:"roleId",label:"employeesRoleLabel",options:J,errorKey:"roleId",success:X,loading:Y,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:Z,success:ee,loading:oe,show:["edit"]}]),d=Fe(ae,a),{data:L,isLoading:re,isSuccess:Q,isError:ne}=([s,n]=f(()=>w({queryKey:["employees"],queryFn:()=>Oe("user"),select:o=>o.map(l=>{const h={...l,phone:l.phoneNumber,company:l.organizationName};return delete h.phoneNumber,delete h.organizationName,h})})),s=await s,n(),s);[s,n]=f(()=>w({queryKey:["employeesById",y],queryFn:()=>Me("user",y.value),select:o=>{a.value.id=o.id,a.value.fullName=o.fullname,a.value.userName=o.userName,a.value.phoneNumber=o.phoneNumber,a.value.organizationId=o.organizationId,a.value.roleId=o.roleId,a.value.stateId=o.stateId},enabled:C})),s=await s,n();const{mutate:de}=V({mutationFn:o=>qe("user",o),onSuccess:()=>{p.invalidateQueries({queryKey:["employees"]})}}),{mutate:ie}=V({mutationFn:o=>Ke("user",o),onSuccess:()=>{p.invalidateQueries({queryKey:["employees"]}),p.invalidateQueries({queryKey:["employeesById",y]})}}),{mutate:ue}=V({mutationFn:o=>Le("user",o),onSuccess:()=>{p.invalidateQueries({queryKey:["employees"]}),p.invalidateQueries({queryKey:["employeesById",y]})}}),R=(o,l)=>{T.value=o,c.value=l,P(),c.value==="create"&&K.value&&(a.value=G(a.value),d.value.$reset())},x=(o,l)=>{if(o==="edit"&&l){y.value=l,R("editEmployeesTitle","edit");return}R("addNewEmployeesTitle","create")},me=o=>{ue(o)},ce=()=>{d.value.$validate(),!d.value.$errors.length&&(c.value==="create"?(delete a.value.id,delete a.value.stateId,delete a.value.search,de(a.value)):ie(a.value),P(),a.value=G(a.value),d.value.$reset())};return(o,l)=>{const h=m("HeadPage"),pe=m("Table"),ye=m("Spinner"),he=m("FormInput"),ge=m("FormSelect"),ve=m("CustomButton"),be=m("FormModal");return i(),I("section",Ve,[H("div",Be,[E(h,{title:"employeesTitle",onOnSearch:l[0]||(l[0]=e=>a.value.search=e),onOnOpenFormModal:l[1]||(l[1]=()=>x("create"))}),t(Q)&&t(L).length?(i(),F(pe,{key:0,headers:se.value,table:t(L),onOnActionEdit:l[2]||(l[2]=e=>x("edit",e)),onOnActionDelete:me},null,8,["headers","table"])):O("",!0),t(re)?(i(),F(ye,{key:1})):O("",!0),t(Q)&&!t(L).length||t(ne)?(i(),I("div",Pe,S(o.$t("emptyTableTitle")),1)):O("",!0)]),E(be,{title:T.value},{default:q(()=>[H("form",{class:"employees__form",onSubmit:we(ce,["prevent"])},[(i(!0),I(A,null,U(le.value,e=>{var g,v,b,_,N;return i(),F(he,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":z=>a.value[e.model]=z,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(v=(g=t(d))==null?void 0:g[e==null?void 0:e.errorKey])==null?void 0:v.$error,textError:(N=(_=(b=t(d))==null?void 0:b[e==null?void 0:e.errorKey])==null?void 0:_.$errors[0])==null?void 0:N.$message},{default:q(()=>[M(S(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(i(!0),I(A,null,U(te.value,e=>{var g,v,b,_,N;return i(),F(ge,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":z=>a.value[e.model]=z,width:500,options:e.options,error:(v=(g=t(d))==null?void 0:g[e==null?void 0:e.errorKey])==null?void 0:v.$error,textError:(N=(_=(b=t(d))==null?void 0:b[e==null?void 0:e.errorKey])==null?void 0:_.$errors[0])==null?void 0:N.$message,success:e.success,loading:e.loading,show:e.show,requestFlag:c.value},{default:q(()=>[M(S(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),E(ve,{className:"form__submit"},{default:q(()=>[M(S(o.$t("formButton")),1)]),_:1})],32)]),_:1},8,["title"])])}}},xe=_e(Te,[["__scopeId","data-v-e539f7ac"]]);export{xe as default};
//# sourceMappingURL=employees-mnCDDYf_.js.map
