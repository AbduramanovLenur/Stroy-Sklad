import{_ as U,o as u,d as p,e as i,L as Te,t as c,w as ne,I as ie,c as r,F as R,C as ue,p as Be,n as Ae,u as Fe,a as je,r as b,b as Pe,y as Ve,z as f,ai as qe,B as Ne,k as h,h as M,D as I,aj as Ke,A as L,i as _,l as ze,G as He,m as O,s as T,f as g,H as D,J as E}from"./index-Znn7x0w2.js";import{a as De,e as Ee,f as Re}from"./crud.services-oovoAPUX.js";import{f as Ue,g as Qe,h as Ge,i as We,j as Je}from"./manual.services-CtkFg6uR.js";import{a as Xe,u as oe}from"./generic.services-CuHvXiDr.js";import{u as S}from"./useQuery-n34yz_OD.js";const Ye={class:"confirmation-modal__title"},Ze={class:"confirmation-modal__triggers"},xe={__name:"ConfirmationModal",props:["isOpen"],setup(m){return(a,l)=>(u(),p("div",{class:ie(`confirmation-modal ${m.isOpen?"is-active":""}`),onClick:l[3]||(l[3]=()=>a.$emit("onNotConfirmed"))},[i("div",{class:"confirmation-modal__overlay",onClick:l[2]||(l[2]=ne(()=>{},["stop"]))},[i("h4",Ye,[Te(a.$slots,"default",{},void 0,!0)]),i("div",Ze,[i("button",{type:"button",class:"confirmation-modal__accepted",onClick:l[0]||(l[0]=()=>a.$emit("onConfirmed"))},c(a.$t("yesButton")),1),i("button",{type:"button",class:"confirmation-modal__refused",onClick:l[1]||(l[1]=()=>a.$emit("onNotConfirmed"))},c(a.$t("noButton")),1)])])],2))}},le=U(xe,[["__scopeId","data-v-c25f4d7f"]]),ea=m=>(Be("data-v-28fb4607"),m=m(),Ae(),m),aa={class:"histories"},sa={class:"histories__label"},ta={class:"histories__list"},oa={class:"histories__head"},la={class:"histories__name"},na=ea(()=>i("div",{class:"histories__divider"}," - ",-1)),ia={class:"histories__status"},ua={class:"histories__date"},ca={__name:"Histories",props:["histories"],setup(m){const a=r(()=>l=>{let v=new Date(l),t=v.toISOString().split("T")[0],B=v.toISOString().split("T")[1].split(".")[0];return`${t} ${B}`});return(l,v)=>(u(),p("div",aa,[i("div",sa,c(l.$t("historiesLabel")),1),i("ul",ta,[(u(!0),p(R,null,ue(m.histories,t=>(u(),p("li",{key:t.id,class:"histories__item"},[i("div",{class:ie(`histories__box ${(t==null?void 0:t.statusId)===1?"created":(t==null?void 0:t.statusId)===7?"accepted":(t==null?void 0:t.statusId)===20?"expected":(t==null?void 0:t.statusId)===15?"refused":""}`)},[i("div",oa,[i("div",la,c(t==null?void 0:t.userName),1),na,i("div",ia,c(t==null?void 0:t.status),1)]),i("div",ua,c(a.value(t==null?void 0:t.createdDate)),1)],2)]))),128))])]))}},da=U(ca,[["__scopeId","data-v-28fb4607"]]),ra={key:0,class:"manage section-height shadowed"},pa={class:"manage__inner section-padding"},ma={class:"manage__overlay"},va={key:0,class:"manage__triggers"},ba={__name:"view",async setup(m){let a,l;const v=Xe(),t=ze(),B=He(),Q=Fe(),{t:G}=je(),k=b(B.params.id),ce=Pe(),{user:d}=Ve(ce),A=r(()=>{var e,o;return(o=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)==null?void 0:o.includes(D.APPLICATION.READ)}),F=b(!1),j=b(!1),de=b([{id:1,label:"appFloor",width:20},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:20},{id:4,label:"appPrice",width:30}]),n=b({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],applicationTables:[],details:"",statusId:"",hasPermission:[],histories:[]}),{data:re,isSuccess:pe,isLoading:me}=([a,l]=f(()=>S({queryKey:["objectsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Ue(),enabled:A})),a=await a,l(),a),P=r(()=>n.value.buildingObjectId[0]),ve=r(()=>!!P.value),{data:be,isSuccess:_e,isLoading:Ie}=([a,l]=f(()=>S({queryKey:["blocksList",{blockId:P,organizationId:d.value.user.organizationId}],queryFn:()=>Qe(P.value),enabled:ve})),a=await a,l(),a),V=r(()=>n.value.buildingBlockId[0]),q=r(()=>!!V.value),{data:ge,isSuccess:_a,isLoading:Ia}=([a,l]=f(()=>S({queryKey:["floorsList",{floorId:V,organizationId:d.value.user.organizationId}],queryFn:()=>Ge(V.value),enabled:q})),a=await a,l(),a),{data:ke,isSuccess:ga,isLoading:ka}=([a,l]=f(()=>S({queryKey:["costsList",{organizationId:d.value.user.organizationId}],queryFn:()=>We(),enabled:q})),a=await a,l(),a),{data:Ce,isSuccess:Ca,isLoading:fa}=([a,l]=f(()=>S({queryKey:["materialsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Je(),enabled:q})),a=await a,l(),a),fe=b([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"},{id:2,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:re,success:pe,loading:me,select:!0},{id:3,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:be,success:_e,loading:Ie,select:!0}]),{isError:he}=([a,l]=f(()=>S({queryKey:["applicationsById",k],queryFn:()=>De("application",k.value),select:e=>{n.value.id=e.id,n.value.deadline=e.deadline,n.value.buildingObjectId=[e.buildingObjectId],n.value.buildingBlockId=[e.buildingBlockId],n.value.applicationTables=[...e.applicationTables],n.value.details=e.details,n.value.statusId=e.statusId,n.value.hasPermission=e.hasPermission,n.value.histories=e.applicationHistories},enabled:A})),a=await a,l(),a),W=r(()=>E(ge.value||[])),J=r(()=>E(ke.value||[])),X=r(()=>E(Ce.value||[])),Oe=e=>{var o;return(o=W.value[e.floorId])==null?void 0:o.name},Se=e=>{var o;return(o=J.value[e.costId])==null?void 0:o.name},ye=e=>{var o;return(o=X.value[e==null?void 0:e.constructionMaterialId])==null?void 0:o.name},Y=b(!1),Z=b(!0);qe(()=>{var w,$,y;const e=(w=Object.keys(W.value))==null?void 0:w.length,o=($=Object.keys(J.value))==null?void 0:$.length,N=(y=Object.keys(X.value))==null?void 0:y.length,K=n.value.applicationTables.length;e&&o&&N&&K&&(n.value.applicationTables=n.value.applicationTables.map(C=>({...C,floorValue:Oe(C),costValue:Se(C),constructionMaterialValue:ye(C)})),Y.value=!0,Z.value=!1)}),Ne(he,e=>{e&&t.push(T.HOME.path)});const{mutate:Me}=oe({mutationFn:e=>Ee("application",e),onSuccess:e=>{e!=null&&e.success&&(v.invalidateQueries({queryKey:["applications"]}),v.invalidateQueries({queryKey:["applicationsById",k]}),t.push(T.APPLICATION.path),setTimeout(()=>Q.success(G("cancelToast")),150))}}),{mutate:Le}=oe({mutationFn:e=>Re("application",e),onSuccess:e=>{e!=null&&e.success&&(v.invalidateQueries({queryKey:["applications"]}),v.invalidateQueries({queryKey:["applicationsById",k]}),t.push(T.APPLICATION.path),setTimeout(()=>Q.success(G("acceptToast")),150))}}),we=()=>{Me(k.value)},$e=()=>{Le(k.value)};return(e,o)=>{var z,x,ee,ae,se,te;const N=O("ManageHead"),K=O("FormInput"),w=O("FormSelect"),$=O("SubTable"),y=O("MyButton"),C=O("Spinner");return A.value?(u(),p("section",ra,[i("div",pa,[h(N,{title:"addNewApplicationTitle",to:M(T).APPLICATION.path},null,8,["to"]),Y.value?(u(),p("form",{key:0,class:"manage__form",onSubmit:o[3]||(o[3]=ne(()=>{},["prevent"]))},[i("div",ma,[(u(!0),p(R,null,ue(fe.value,s=>(u(),p(R,{key:s.id},[s!=null&&s.select?_("",!0):(u(),L(K,{key:0,modelValue:n.value[s.model],"onUpdate:modelValue":H=>n.value[s.model]=H,width:500,placeholder:e.$t(s.placeholder),name:s.icon,type:s==null?void 0:s.type,isDisabled:!0},{default:I(()=>[g(c(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),s!=null&&s.select?(u(),L(w,{key:1,modelValue:n.value[s.model],"onUpdate:modelValue":H=>n.value[s.model]=H,modelModifiers:{trim:!0},width:500,options:s.options,placeholder:s==null?void 0:s.placeholder,success:s.success,loading:s.loading,isMultiSelect:s==null?void 0:s.multiple,isDisabled:!0},{default:I(()=>[g(c(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"])):_("",!0)],64))),128))]),h($,{headers:de.value,table:n.value.applicationTables},null,8,["headers","table"]),h(Ke,{modelValue:n.value.details,"onUpdate:modelValue":o[0]||(o[0]=s=>n.value.details=s),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),isDisabled:!0},{default:I(()=>[g(c(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder"]),n.value.hasPermission?(u(),p("div",va,[(ee=(x=(z=M(d))==null?void 0:z.user)==null?void 0:x.modules)!=null&&ee.includes(M(D).APPLICATION.CONFIRM)?(u(),L(y,{key:0,icon:"approve",type:"submit",color:"green",width:180,onClick:o[1]||(o[1]=()=>F.value=!0)},{default:I(()=>[g(c(e.$t("acceptButton")),1)]),_:1})):_("",!0),(te=(se=(ae=M(d))==null?void 0:ae.user)==null?void 0:se.modules)!=null&&te.includes(M(D).APPLICATION.REFUSAL)?(u(),L(y,{key:1,icon:"refusal",type:"submit",color:"red",width:180,onClick:o[2]||(o[2]=()=>j.value=!0)},{default:I(()=>[g(c(e.$t("cancelButton")),1)]),_:1})):_("",!0)])):_("",!0),h(da,{histories:n.value.histories},null,8,["histories"])],32)):_("",!0),Z.value?(u(),L(C,{key:1})):_("",!0)]),h(le,{isOpen:F.value,onOnConfirmed:$e,onOnNotConfirmed:o[4]||(o[4]=()=>F.value=!1)},{default:I(()=>[g(c(e.$t("sureConfirm")),1)]),_:1},8,["isOpen"]),h(le,{isOpen:j.value,onOnConfirmed:we,onOnNotConfirmed:o[5]||(o[5]=()=>j.value=!1)},{default:I(()=>[g(c(e.$t("sureRefused")),1)]),_:1},8,["isOpen"])])):_("",!0)}}},La=U(ba,[["__scopeId","data-v-4ccff569"]]);export{La as default};
