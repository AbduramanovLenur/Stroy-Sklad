import{u as le,a as me,b as de,y as ie,c as Q,r as _,z as v,C as pe,d as g,e as N,k as R,h as r,w as ye,F as x,D as he,A as I,i as T,l as _e,G as ve,m,o as n,s as q,B as H,f as $,t as S,H as ge,E as Ie}from"./index-O2h3gL13.js";import{u as Te,r as d}from"./i18n-validators-_nt9Rrbk.js";import{u as qe}from"./generic.services-QvSdyUz0.js";import{u as b}from"./useQuery-kkjrNxK8.js";import{u as $e}from"./useMutation-05dLsYlb.js";import{a as Se,u as be}from"./crud.services-EgXNei1C.js";import{k as Pe,b as Ce}from"./manual.services-DRl-zpgW.js";const Ke={key:0,class:"manage section-height shadowed"},Ve={class:"manage__inner section-padding"},Me={__name:"update",async setup(we){let a,u;const i=qe(),P=_e(),O=ve(),A=le(),{t:G}=me(),z=de(),{user:c}=ie(z),l=Q(()=>{var t,y;return!!((y=(t=c==null?void 0:c.value.user)==null?void 0:t.modules)!=null&&y.includes(ge.PRODUCT.UPDATE))}),p=_(O.params.id),s=_({id:"",fullname:"",quantityTypeId:[],stateId:[]}),W=Q(()=>({id:{required:d},fullname:{required:d},quantityTypeId:{required:d},stateId:{required:d}})),o=Te(W,s),{data:j,isSuccess:J,isLoading:X}=([a,u]=v(()=>b({queryKey:["types"],queryFn:()=>Pe(),enabled:l})),a=await a,u(),a),{data:Y,isSuccess:Z,isLoading:f}=([a,u]=v(()=>b({queryKey:["states"],queryFn:()=>Ce(),enabled:l})),a=await a,u(),a),ee=_([{id:1,model:"fullname",label:"nameProductsLabel",placeholder:"nameProductsPlaceholder",icon:"pen",errorKey:"fullname"},{id:2,model:"quantityTypeId",label:"qunatityTypesProductsLabel",placeholder:"qunatityTypesProductsPlaceholder",errorKey:"quantityTypeId",options:j,success:J,loading:X,select:!0},{id:3,model:"stateId",label:"stateProductsLabel",placeholder:"stateProductsPlaceholder",errorKey:"stateId",options:Y,success:Z,loading:f,select:!0}]),{isError:te}=([a,u]=v(()=>b({queryKey:["productById",p,c.value.user.fullName],queryFn:()=>Se("construction_material",p.value),select:t=>{s.value.id=t.id,s.value.fullname=t.fullname,s.value.quantityTypeId=[t.quantityTypeId],s.value.stateId=[t.stateId]},enabled:l})),a=await a,u(),a);pe(te,t=>{t&&P.push(q.PRODUCT.path)});const{mutate:ae,status:se}=$e({onMutate:t=>{t.quantityTypeId=t.quantityTypeId[0],t.stateId=t.stateId[0]},mutationFn:t=>be("construction_material",t),onSuccess:t=>{t!=null&&t.success&&(s.value=Ie(s.value),i.invalidateQueries({queryKey:["products"]}),i.invalidateQueries({queryKey:["productById",p]}),i.invalidateQueries({queryKey:["materialsList"]}),P.push(q.PRODUCT.path),setTimeout(()=>A.success(G("updateToast")),150))}}),oe=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const t={...s.value};ae(t),o.value.$reset()};return(t,y)=>{var C,K;const re=m("ManageHead"),ue=m("FormInput"),ne=m("FormSelect"),ce=m("CustomButton");return l.value?(n(),g("section",Ke,[N("div",Ve,[R(re,{title:"editProductTitle",to:r(q).PRODUCT.path},null,8,["to"]),N("form",{class:"manage__form form-manage",onSubmit:ye(oe,["prevent"])},[(n(!0),g(x,null,he(ee.value,e=>{var V,w,B,F,U,k,L,D,E,M;return n(),g(x,{key:e.id},[e!=null&&e.select?T("",!0):(n(),H(ue,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(w=(V=r(o))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:w.$error,textError:(U=(F=(B=r(o))==null?void 0:B[e==null?void 0:e.errorKey])==null?void 0:F.$errors[0])==null?void 0:U.$message},{default:I(()=>[$(S(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(n(),H(ne,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,modelModifiers:{trim:!0},width:500,options:e.options,error:(L=(k=r(o))==null?void 0:k[e==null?void 0:e.errorKey])==null?void 0:L.$error,placeholder:e==null?void 0:e.placeholder,textError:(M=(E=(D=r(o))==null?void 0:D[e==null?void 0:e.errorKey])==null?void 0:E.$errors[0])==null?void 0:M.$message,success:e.success,loading:e.loading},{default:I(()=>[$(S(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):T("",!0)],64)}),128)),R(ce,{className:`form__submit ${(K=(C=r(o))==null?void 0:C.stateId.$errors[0])!=null&&K.$message?"centered":""}`,disabled:r(se)==="pending"},{default:I(()=>[$(S(t.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):T("",!0)}}};export{Me as default};
