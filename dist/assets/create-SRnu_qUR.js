import{u as de,a as me,b as be,y as ge,c as d,r as h,z as y,B as pe,d as _,e as P,k as T,h as c,w as he,F as D,C as ye,D as I,i as v,l as _e,m,o as n,s as x,A,f as k,t as L,H as Ie,E as ve}from"./index-8l2LyLh8.js";import{u as ke,r as a}from"./i18n-validators-Wkg5KBML.js";import{a as Le,u as Fe}from"./generic.services-yETqkf3T.js";import{u as F}from"./useQuery-tdqJaMO0.js";import{c as Oe}from"./crud.services-BcMjcvoI.js";import{f as Ke,m as Be,a as $e}from"./manual.services-Ls971AW1.js";const Se={key:0,class:"manage section-height shadowed"},we={class:"manage__inner section-padding"},Me={__name:"create",async setup(Ce){let s,l;const O=Le(),U=_e(),H=de(),{t:Q}=me(),z=be(),{user:u}=ge(z),b=d(()=>{var o,g;return!!((g=(o=u==null?void 0:u.value.user)==null?void 0:o.modules)!=null&&g.includes(Ie.BLOCK.CREATE))}),K=h(!1),r=h({fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[]}),G=d(()=>({fullname:{required:a},numberOfFloors:{required:a},roomsOnFloor:{required:a},address:{required:a},buildingObjectId:{required:a},regionId:{required:a},districtId:{required:a}})),t=ke(G,r),{data:J,isSuccess:W,isLoading:X}=([s,l]=y(()=>F({queryKey:["regions"],queryFn:()=>Be(),enabled:b})),s=await s,l(),s),i=d(()=>r.value.regionId[0]),Y=d(()=>!!i.value);pe(i,()=>{K.value||(r.value.districtId=[])},{immediate:!0});const{data:Z,isSuccess:f,isLoading:ee}=([s,l]=y(()=>F({queryKey:["districts",{districtId:i}],queryFn:()=>$e(i.value),enabled:Y})),s=await s,l(),s),{data:oe,isSuccess:se,isLoading:re}=([s,l]=y(()=>F({queryKey:["objectsList",{organizationId:u.value.user.organizationId}],queryFn:()=>Ke(),enabled:b})),s=await s,l(),s),te=h([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"},{id:5,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:oe,success:se,loading:re,select:!0},{id:6,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:J,success:W,loading:X,select:!0},{id:7,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:Z,success:f,loading:ee,select:!0}]),{mutate:ae}=Fe({onMutate:o=>{K.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.regionId=o.regionId[0],o.districtId=o.districtId[0]},mutationFn:o=>Oe("building_block",o),onSuccess:o=>{o!=null&&o.success&&(r.value=ve(r.value),O.invalidateQueries({queryKey:["blocks"]}),O.invalidateQueries({queryKey:["blocksList"]}),U.push(x.BLOCK.path),setTimeout(()=>H.success(Q("createToast")),150))}}),le=()=>{if(t.value.$validate(),t.value.$errors.length)return;const o={...r.value};ae(o),t.value.$reset()};return(o,g)=>{var B,$;const ce=m("ManageHead"),ne=m("FormInput"),ue=m("FormSelect"),ie=m("CustomButton");return b.value?(n(),_("section",Se,[P("div",we,[T(ce,{title:"addNewBlocksTitle",to:c(x).BLOCK.path},null,8,["to"]),P("form",{class:"manage__form form-manage",onSubmit:he(le,["prevent"])},[(n(!0),_(D,null,ye(te.value,e=>{var S,w,C,V,j,N,q,E,R,M;return n(),_(D,{key:e.id},[e!=null&&e.select?v("",!0):(n(),A(ne,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":p=>r.value[e.model]=p,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(w=(S=c(t))==null?void 0:S[e.errorKey])==null?void 0:w.$error,textError:(j=(V=(C=c(t))==null?void 0:C[e.errorKey])==null?void 0:V.$errors[0])==null?void 0:j.$message},{default:I(()=>[k(L(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(n(),A(ue,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":p=>r.value[e.model]=p,modelModifiers:{trim:!0},width:500,options:e.options,error:(q=(N=c(t))==null?void 0:N[e==null?void 0:e.errorKey])==null?void 0:q.$error,placeholder:e==null?void 0:e.placeholder,textError:(M=(R=(E=c(t))==null?void 0:E[e==null?void 0:e.errorKey])==null?void 0:R.$errors[0])==null?void 0:M.$message,success:e.success,loading:e.loading},{default:I(()=>[k(L(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):v("",!0)],64)}),128)),T(ie,{className:`form__submit ${($=(B=c(t))==null?void 0:B.districtId.$errors[0])!=null&&$.$message?"centered":""}`},{default:I(()=>[k(L(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):v("",!0)}}};export{Me as default};
