import{x as G,y as L,b as J,c as X,r as O,z as Y,d as N,e as Z,k as B,h as e,A as I,i as u,t as ee,m as i,o as l,s as M,H as d}from"./index-4UPdn8r5.js";import{a as te,u as se}from"./generic.services-suEnlNvN.js";import{u as oe}from"./useQuery-J_Xc9Nln.js";import{g as ne,d as ae}from"./crud.services-eNoFKDSu.js";import{r as re}from"./index-yMyCbQYb.js";const ce={key:0,class:"products"},ue={class:"products__inner section-padding"},ie={key:2,class:"empty-table shadowed"},he={__name:"index",async setup(le){let a,h;const p=te(),Q=G(),{page:m,limit:_,search:H}=L(Q),K=J(),{user:s}=L(K),S=X(()=>{var t,o;return!!((o=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&o.includes(d.PRODUCT.READ))}),T=O(""),D=re(H,500),x=O([{id:1,label:"productsName",width:1030}]),{data:r,isLoading:z,isSuccess:y,isError:V}=([a,h]=Y(()=>oe({queryKey:["products",{page:m,limit:_,debouncedSearch:D,organizationId:s.value.user.organizationId}],queryFn:()=>ne("construction_material",m.value,_.value,D.value),select:t=>{let o=[...t==null?void 0:t.constructionMaterial];return o=o.map(c=>{const n={...c,material:c.fullName};return delete n.fullName,delete n.quantityType,n}),{constructionMaterial:o,count:t==null?void 0:t.count}},enabled:S})),a=await a,h(),a),{mutate:F}=se({mutationFn:t=>ae("construction_material",t),onSuccess:t=>{p.invalidateQueries({queryKey:["products"]}),p.invalidateQueries({queryKey:["productById",T]}),p.invalidateQueries({queryKey:["materialsList"]})}}),W=async t=>{T.value=t,F(t)};return(t,o)=>{var C,g,v,P,b,f,E,w,U,R,k,A,q;const c=i("HeadPage"),n=i("Table"),$=i("Pagination"),j=i("Spinner");return S.value?(l(),N("section",ce,[Z("div",ue,[B(c,{title:"productsTitle",to:e(M).CREATE_PRODUCT.path,isShowCreate:(v=(g=(C=e(s))==null?void 0:C.user)==null?void 0:g.modules)==null?void 0:v.includes(e(d).PRODUCT.CREATE)},null,8,["to","isShowCreate"]),e(y)&&((P=e(r))!=null&&P.count)?(l(),I(n,{key:0,headers:x.value,table:(b=e(r))==null?void 0:b.constructionMaterial,to:e(M).UPDATE_PRODUCT.name,options:{page:e(m),limit:e(_)},isShowUpdate:(w=(E=(f=e(s))==null?void 0:f.user)==null?void 0:E.modules)==null?void 0:w.includes(e(d).PRODUCT.UPDATE),isShowDelete:(k=(R=(U=e(s))==null?void 0:U.user)==null?void 0:R.modules)==null?void 0:k.includes(e(d).PRODUCT.DELETE),onOnActionDelete:W},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):u("",!0),B($,{count:(A=e(r))==null?void 0:A.count,isSucces:e(y)},null,8,["count","isSucces"]),e(z)?(l(),I(j,{key:1})):u("",!0),e(y)&&!((q=e(r))!=null&&q.count)||e(V)?(l(),N("div",ie,ee(t.$t("emptyTableTitle")),1)):u("",!0)])])):u("",!0)}}};export{he as default};
