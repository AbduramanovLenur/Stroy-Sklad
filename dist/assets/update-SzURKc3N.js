import{u as re,a as ue,r as I,b as ne,y as le,c as B,z as q,B as ie,d as T,e as F,k as M,h as u,w as de,F as C,C as U,D as w,i as me,l as ce,E as ye,m as g,o as y,s as $,A as k,f as E,t as b,G as pe}from"./index-TakX3B4c.js";import{u as he,r as p}from"./i18n-validators-tYnxY-L_.js";import{a as Ie,u as qe}from"./generic.services-oiJN1eU2.js";import{u as _}from"./useQuery-55S82Vlm.js";import{a as ge,u as _e}from"./crud.services-Fdg32Fav.js";import{h as ve,k as fe,b as Se}from"./manual.services-nCQCTep0.js";const Te={key:0,class:"manage section-height shadowed"},we={class:"manage__inner section-padding"},Be={__name:"update",async setup($e){let t,o;const K=Ie(),V=ce(),H=ye();re(),ue();const v=I(H.params.id),Q=ne(),{user:h}=le(Q),n=B(()=>{var a,f;return!!((f=(a=h==null?void 0:h.value.user)==null?void 0:a.modules)!=null&&f.includes(pe.WAREHOUSE.UPDATE))}),s=I({id:"",materialId:[],quantity:"",quantityTypeId:[],stateId:[]}),A=B(()=>({id:{required:p},materialId:{required:p},quantity:{required:p},quantityTypeId:{required:p},stateId:{required:p}})),r=he(A,s),{data:N,isSuccess:P,isLoading:R}=([t,o]=q(()=>_({queryKey:["types"],queryFn:()=>fe(),enabled:n})),t=await t,o(),t),{data:x,isSuccess:O,isLoading:z}=([t,o]=q(()=>_({queryKey:["materialsList",{organizationId:h.value.user.organizationId}],queryFn:()=>ve(),enabled:n})),t=await t,o(),t),{data:D,isSuccess:G,isLoading:j}=([t,o]=q(()=>_({queryKey:["states"],queryFn:()=>Se(),enabled:n})),t=await t,o(),t),J=I([{id:1,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),X=I([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:x,success:O,loading:z},{id:2,model:"quantityTypeId",label:"qunatityTypesWarehouseLabel",placeholder:"qunatityTypesWarehousePlaceholder",errorKey:"quantityTypeId",options:N,success:P,loading:R},{id:3,model:"stateId",label:"stateWarehouseLabel",placeholder:"stateWarehousePlaceholder",errorKey:"stateId",options:D,success:G,loading:j}]),{isError:Y}=([t,o]=q(()=>_({queryKey:["warehouseById",v],queryFn:()=>ge("warehouse",v.value),select:a=>{s.value.id=a.id,s.value.materialId=[a.materialId],s.value.quantity=a.quantity,s.value.quantityTypeId=[a.quantityTypeId],s.value.stateId=[a.stateId]},enabled:n})),t=await t,o(),t);ie(Y,a=>{a&&V.push($.HOME.path)});const{mutate:Z}=qe({onMutate:a=>{a.materialId=a.materialId[0],a.quantityTypeId=a.quantityTypeId[0],a.stateId=a.stateId[0]},mutationFn:a=>_e("warehouse",a),onSuccess:a=>{K.invalidateQueries({queryKey:["warehouse"]}),K.invalidateQueries({queryKey:["warehouseById",v]}),V.push($.WAREHOUSE.path)}}),ee=async()=>{r.value.$validate(),!r.value.$errors.length&&(Z(s.value),r.value.$reset())};return(a,f)=>{var L,W;const ae=g("ManageHead"),te=g("FormInput"),se=g("FormSelect"),oe=g("CustomButton");return n.value?(y(),T("section",Te,[F("div",we,[M(ae,{title:"editProductTitle",to:u($).WAREHOUSE.path},null,8,["to"]),F("form",{class:"manage__form form-manage",onSubmit:de(ee,["prevent"])},[(y(!0),T(C,null,U(J.value,e=>{var l,i,d,m,c;return y(),k(te,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":S=>s.value[e.model]=S,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(i=(l=u(r))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:i.$error,textError:(c=(m=(d=u(r))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:c.$message},{default:w(()=>[E(b(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(y(!0),T(C,null,U(X.value,e=>{var l,i,d,m,c;return y(),k(se,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":S=>s.value[e.model]=S,width:500,options:e.options,error:(i=(l=u(r))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:i.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(m=(d=u(r))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:w(()=>[E(b(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),M(oe,{className:`form__submit ${(W=(L=u(r))==null?void 0:L.stateId.$errors[0])!=null&&W.$message?"centered":""}`},{default:w(()=>[E(b(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):me("",!0)}}};export{Be as default};
