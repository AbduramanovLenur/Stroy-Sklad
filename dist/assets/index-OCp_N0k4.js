import{u as X,a as Y,x as Z,y as K,b as ee,c as te,r as A,z as se,d as O,e as oe,k as q,A as ae,h as e,B as I,i as n,t as N,m as c,o as i,f as ne,s as P,H as l}from"./index-Jh8odxSe.js";import{u as ce}from"./generic.services-MgMdmGEE.js";import{u as ie}from"./useQuery-fi5W9yeG.js";import{u as le}from"./useMutation-1M3f9r5N.js";import{g as ue,d as re}from"./crud.services-hTqnJzib.js";import{r as de}from"./index-l5fO5p-P.js";const me={key:0,class:"blocks"},be={class:"blocks__inner section-padding"},_e={key:2,class:"empty-table shadowed"},we={__name:"index",async setup(he){let o,_;const u=ce(),Q=X(),{t:R}=Y(),U=Z(),{page:r,limit:d,search:x}=K(U),H=ee(),{user:s}=K(H),h=te(()=>{var t,b;return!!((b=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&b.includes(l.BLOCK.READ))}),k=A(""),p=de(x,500),V=A([{id:1,label:"blockName",width:25},{id:2,label:"blockObject",width:25},{id:4,label:"blockFloors",width:15},{id:5,label:"blockRooms",width:15},{id:6,label:"blockAddress",width:25}]),{data:a,isLoading:z,isSuccess:m,isError:F}=([o,_]=se(()=>ie({queryKey:["blocks",{page:r,limit:d,debouncedSearch:p,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>ue("building_block",r.value,d.value,p.value),enabled:h})),o=await o,_(),o),{mutate:M}=le({mutationFn:t=>re("building_block",t),onSuccess:t=>{t!=null&&t.success&&(u.invalidateQueries({queryKey:["blocks"]}),u.invalidateQueries({queryKey:["blocksById",k]}),u.invalidateQueries({queryKey:["blocksList"]}),setTimeout(()=>Q.success(R("deleteToast")),150))}}),$=async t=>{k.value=t,M(t)};return(t,b)=>{var y,S,f,g,w,C,T,v,B,E,L,D;const j=c("HeadPage"),W=c("Table"),G=c("Pagination"),J=c("Spinner");return h.value?(i(),O("section",me,[oe("div",be,[q(j,{title:"blockTitle",to:e(P).CREATE_BLOCK.path,isShowCreate:(f=(S=(y=e(s))==null?void 0:y.user)==null?void 0:S.modules)==null?void 0:f.includes(e(l).BLOCK.CREATE)},{default:ae(()=>[ne(N(t.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),e(m)&&((g=e(a))!=null&&g.count)?(i(),I(W,{key:0,headers:V.value,table:(w=e(a))==null?void 0:w.blocks,to:e(P).UPDATE_BLOCK.name,options:{page:e(r),limit:e(d)},isShowUpdate:(v=(T=(C=e(s))==null?void 0:C.user)==null?void 0:T.modules)==null?void 0:v.includes(e(l).BLOCK.UPDATE),isShowDelete:(L=(E=(B=e(s))==null?void 0:B.user)==null?void 0:E.modules)==null?void 0:L.includes(e(l).BLOCK.DELETE),onOnActionDelete:$},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q(G,{count:(D=e(a))==null?void 0:D.count,isSucces:e(m)},null,8,["count","isSucces"]),e(z)?(i(),I(J,{key:1})):n("",!0),e(m)&&!e(a).count||e(F)?(i(),O("div",_e,N(t.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{we as default};
