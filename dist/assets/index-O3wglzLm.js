import{u as X,a as Y,x as Z,y as k,b as ee,c as te,r as B,z as ae,d as O,e as se,k as q,A as oe,h as e,B as U,i as l,t as V,m as r,o as u,f as ie,s as x,H as p}from"./index-O2h3gL13.js";import{u as ne}from"./generic.services-QvSdyUz0.js";import{u as ce}from"./useQuery-kkjrNxK8.js";import{u as le}from"./useMutation-05dLsYlb.js";import{g as re,d as ue}from"./crud.services-EgXNei1C.js";import{r as pe}from"./index-ouQ1Yvgt.js";const de={key:0,class:"applications"},me={class:"applications__inner"},_e={key:2,class:"empty-table shadowed"},we={__name:"index",async setup(he){let i,h;const y=ne(),z=X(),{t:H}=Y(),Q=Z(),{page:d,limit:m,search:R}=k(Q),K=ee(),{user:s}=k(K),A=te(()=>{var t,a;return!!((a=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&a.includes(p.APPLICATION.READ))}),S=B(""),T=pe(R,500),F=B([{id:1,label:"applicationUserName",width:12},{id:3,label:"applicationDocDate",width:14.6},{id:4,label:"applicationDedline",width:14.6},{id:5,label:"applicationObject",width:16},{id:6,label:"applicationBlock",width:16}]),{data:n,isLoading:M,isSuccess:_,isError:W}=([i,h]=ae(()=>ce({queryKey:["applications",{page:d,limit:m,debouncedSearch:T,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>re("application",d.value,m.value,T.value),select:t=>{let a={...t};return a.applications=a==null?void 0:a.applications.map(c=>{const o={...c,name:c.userName};return delete o.userName,delete o.organizationName,delete o.state,delete o.stateId,o}),a},enabled:A})),i=await i,h(),i),{mutate:$}=le({mutationFn:t=>ue("application",t),onSuccess:t=>{t.success&&(y.invalidateQueries({queryKey:["applications"]}),y.invalidateQueries({queryKey:["applicationsById",S]}),setTimeout(()=>z.success(H("deleteToast")),150))}}),j=async t=>{S.value=t,$(t)};return(t,a)=>{var I,b,w,P,f,C,N,g,v,E,D,L;const c=r("HeadPage"),o=r("Table"),G=r("Pagination"),J=r("Spinner");return A.value?(u(),O("section",de,[se("div",me,[q(c,{title:"applicationTitle",to:e(x).CREATE_APPLICATION.path,isShowCreate:(w=(b=(I=e(s))==null?void 0:I.user)==null?void 0:b.modules)==null?void 0:w.includes(e(p).APPLICATION.CREATE)},{default:oe(()=>[ie(V(t.$t("createButton")),1)]),_:1},8,["to","isShowCreate"]),e(_)&&((P=e(n))!=null&&P.count)?(u(),U(o,{key:0,headers:F.value,table:(f=e(n))==null?void 0:f.applications,to:e(x).VIEW_APPLICATION.name,options:{page:e(d),limit:e(m)},isShowUpdate:(g=(N=(C=e(s))==null?void 0:C.user)==null?void 0:N.modules)==null?void 0:g.includes(e(p).APPLICATION.UPDATE),isShowDelete:(D=(E=(v=e(s))==null?void 0:v.user)==null?void 0:E.modules)==null?void 0:D.includes(e(p).APPLICATION.DELETE),isShowEye:!0,onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):l("",!0),q(G,{count:(L=e(n))==null?void 0:L.count,isSucces:e(_)},null,8,["count","isSucces"]),e(M)?(u(),U(J,{key:1})):l("",!0),e(_)&&!e(n).count||e(W)?(u(),O("div",_e,V(t.$t("emptyTableTitle")),1)):l("",!0)])])):l("",!0)}}};export{we as default};
