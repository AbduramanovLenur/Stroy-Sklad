import{u as ae,a as te,r as c,y as h,c as re,x as oe,b as w,d as F,f as L,B as I,w as se,F as b,e as W,k as y,g as ne,C as ue,h as g,o as p,i as q,t as _,z as C,A as E}from"./index-8-F5s4j3.js";import{u as ie,r as n}from"./i18n-validators-72j1n4q8.js";import{a as le,u as de}from"./generic.services-CQjHStj7.js";import{u as v}from"./useQuery-KERFi8ks.js";import{a as me,u as ce}from"./crud.services-Xs683v05.js";import{f as ye,g as pe,b as he}from"./manual.services-4pjALTqx.js";const Ie={class:"manage section-height shadowed"},ge={class:"manage__inner section-padding"},Ke={__name:"update",async setup(qe){let t,o;const S=le(),K=ne(),z=ue();ae(),te();const f=c(z.params.id),T=c(localStorage.getItem("organizationId")),{data:M,isSuccess:Q,isLoading:k}=([t,o]=h(()=>v({queryKey:["types"],queryFn:()=>ye()})),t=await t,o(),t),{data:x,isSuccess:N,isLoading:P}=([t,o]=h(()=>v({queryKey:["materials",{organizationId:T}],queryFn:()=>pe(T.value)})),t=await t,o(),t),{data:U,isSuccess:A,isLoading:H}=([t,o]=h(()=>v({queryKey:["states"],queryFn:()=>he()})),t=await t,o(),t),r=c({id:"",materialId:[],quantity:"",quantityTypeId:[],organizationId:"",stateId:[]}),R=re(()=>({id:{required:n},materialId:{required:n},quantity:{required:n},quantityTypeId:{required:n},organizationId:{required:n},stateId:{required:n}})),s=ie(R,r),O=c([{id:1,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),D=c([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:x,success:N,loading:P},{id:2,model:"quantityTypeId",label:"qunatityTypesWarehouseLabel",placeholder:"qunatityTypesWarehousePlaceholder",errorKey:"quantityTypeId",options:M,success:Q,loading:k},{id:3,model:"stateId",label:"stateWarehouseLabel",placeholder:"stateWarehousePlaceholder",errorKey:"stateId",options:U,success:A,loading:H}]),{isError:G}=([t,o]=h(()=>v({queryKey:["warehouseById",f],queryFn:()=>me("warehouse",f.value),select:a=>{r.value.id=a.id,r.value.materialId=[a.materialId],r.value.quantity=a.quantity,r.value.quantityTypeId=[a.quantityTypeId],r.value.organizationId=a.organizationId,r.value.stateId=[a.stateId]}})),t=await t,o(),t);oe(G,a=>{a&&K.push(E.HOME.path)});const{mutate:j}=de({onMutate:a=>{a.materialId=a.materialId[0],a.quantityTypeId=a.quantityTypeId[0],a.stateId=a.stateId[0]},mutationFn:a=>ce("warehouse",a),onSuccess:()=>{S.invalidateQueries({queryKey:["warehouse"]}),S.invalidateQueries({queryKey:["warehouseById",f]}),K.push(E.WAREHOUSE.path)}}),J=async()=>{r.value.organizationId=T.value,s.value.$validate(),!s.value.$errors.length&&(j(r.value),s.value.$reset())};return(a,_e)=>{var V,B;const X=g("Title"),Y=g("FormInput"),Z=g("FormSelect"),ee=g("CustomButton");return p(),w("section",Ie,[F("div",ge,[L(X,null,{default:I(()=>[q(`\r
                `+_(a.$t("editProductTitle"))+`\r
            `,1)]),_:1}),F("form",{class:"manage__form form-manage",onSubmit:se(J,["prevent"])},[(p(!0),w(b,null,W(O.value,e=>{var u,i,l,d,m;return p(),C(Y,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":$=>r.value[e.model]=$,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(i=(u=y(s))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:i.$error,textError:(m=(d=(l=y(s))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:d.$errors[0])==null?void 0:m.$message},{default:I(()=>[q(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(p(!0),w(b,null,W(D.value,e=>{var u,i,l,d,m;return p(),C(Z,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":$=>r.value[e.model]=$,width:500,options:e.options,error:(i=(u=y(s))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:i.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(d=(l=y(s))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:d.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:I(()=>[q(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(ee,{className:`form__submit ${(B=(V=y(s))==null?void 0:V.stateId.$errors[0])!=null&&B.$message?"centered":""}`},{default:I(()=>[q(_(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Ke as default};
//# sourceMappingURL=update-qqJyvenr.js.map
