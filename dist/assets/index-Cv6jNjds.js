import{g as X,d as Y}from"./crud.services-K83EyEdH.js";import{u as Z,a as ee,x as te,y as k,b as ae,c as se,r as B,z as oe,d as O,e as ie,k as q,A as ne,h as e,B as R,i as l,t as V,m as r,o as u,f as ce,s as x,H as p}from"./index-KYHZIXyW.js";import{u as le}from"./generic.services-YA4lnf9v.js";import{u as re}from"./useQuery-lv7mhtLD.js";import{u as ue}from"./useMutation-7roH085H.js";import{r as pe}from"./index-8AE77Je2.js";const de={key:0,class:"applications"},me={class:"applications__inner"},he={key:2,class:"empty-table shadowed"},we={__name:"index",async setup(_e){let i,_;const y=le(),z=Z(),{t:H}=ee(),Q=te(),{page:d,limit:m,search:U}=k(Q),K=ae(),{user:s}=k(K),S=se(()=>{var t,a;return!!((a=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&a.includes(p.APPLICATION.READ))}),b=B(""),A=pe(U,500),F=B([{id:1,label:"applicationDocNumber",width:12},{id:2,label:"applicationUserName",width:13},{id:3,label:"applicationDocDate",width:12},{id:4,label:"applicationDedline",width:12},{id:5,label:"applicationObject",width:14.6},{id:6,label:"applicationBlock",width:14.6}]),{data:n,isLoading:M,isSuccess:h,isError:W}=([i,_]=oe(()=>re({queryKey:["applications",{page:d,limit:m,debouncedSearch:A,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>X("application",d.value,m.value,A.value),select:t=>{let a={...t};return a.applications=a==null?void 0:a.applications.map(c=>{const o={...c,name:c.userName};return delete o.userName,delete o.organizationName,delete o.state,delete o.stateId,o}),a},enabled:S})),i=await i,_(),i),{mutate:$}=ue({mutationFn:t=>Y("application",t),onSuccess:t=>{t.success&&(y.invalidateQueries({queryKey:["applications"]}),y.invalidateQueries({queryKey:["applicationsById",b.value.toString()]}),setTimeout(()=>z.success(H("deleteToast")),150))}}),j=async t=>{b.value=t,$(t)};return(t,a)=>{var I,T,w,N,f,C,P,g,v,D,E,L;const c=r("HeadPage"),o=r("Table"),G=r("Pagination"),J=r("Spinner");return S.value?(u(),O("section",de,[ie("div",me,[q(c,{title:"applicationTitle",to:e(x).CREATE_APPLICATION.path,isShowCreate:(w=(T=(I=e(s))==null?void 0:I.user)==null?void 0:T.modules)==null?void 0:w.includes(e(p).APPLICATION.CREATE)},{default:ne(()=>[ce(V(t.$t("createButton")),1)]),_:1},8,["to","isShowCreate"]),e(h)&&((N=e(n))!=null&&N.count)?(u(),R(o,{key:0,headers:F.value,table:(f=e(n))==null?void 0:f.applications,to:e(x).VIEW_APPLICATION.name,options:{page:e(d),limit:e(m)},isShowUpdate:(g=(P=(C=e(s))==null?void 0:C.user)==null?void 0:P.modules)==null?void 0:g.includes(e(p).APPLICATION.READ),isShowDelete:(E=(D=(v=e(s))==null?void 0:v.user)==null?void 0:D.modules)==null?void 0:E.includes(e(p).APPLICATION.DELETE),isShowEye:!0,className:"table-action",onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):l("",!0),q(G,{count:(L=e(n))==null?void 0:L.count,isSucces:e(h)},null,8,["count","isSucces"]),e(M)?(u(),R(J,{key:1})):l("",!0),e(h)&&!e(n).count||e(W)?(u(),O("div",he,V(t.$t("emptyTableTitle")),1)):l("",!0)])])):l("",!0)}}};export{we as default};
