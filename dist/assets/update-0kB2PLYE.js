import{u as ce,a as me,b as de,y as ie,c as H,r as g,z as N,B as pe,d as M,e as Q,k as he,h as s,w as ye,F as D,C as _e,A as d,i as n,D as S,l as ve,G as ge,m as c,o as l,s as $,f as b,t as I,H as Ne,E as Me}from"./index-Znn7x0w2.js";import{u as Se,r as p}from"./i18n-validators-IvsyUnkI.js";import{a as $e,u as be}from"./generic.services-CuHvXiDr.js";import{u as V}from"./useQuery-n34yz_OD.js";import{a as Ie,u as Ve}from"./crud.services-oovoAPUX.js";import{c as Re,b as Ke}from"./manual.services-CtkFg6uR.js";const we={key:0,class:"manage section-height shadowed"},Ee={class:"manage__inner section-padding"},Ue={__name:"update",async setup(Le){let a,u;const h=$e(),R=ve(),O=ge(),P=ce(),{t:G}=me(),z=de(),{user:y}=ie(z),i=H(()=>{var t,m;return!!((m=(t=y==null?void 0:y.value.user)==null?void 0:t.modules)!=null&&m.includes(Ne.ROLE.UPDATE))}),_=g(O.params.id),o=g({id:"",shortName:"",fullName:"",roleModules:[],stateId:[]}),W=H(()=>({id:{required:p},shortName:{required:p},fullName:{required:p},stateId:{required:p}})),r=Se(W,o),{data:j,isLoading:J,isSuccess:K}=([a,u]=N(()=>V({queryKey:["modules"],queryFn:()=>Re(),enabled:i})),a=await a,u(),a),{data:X,isSuccess:Y,isLoading:Z}=([a,u]=N(()=>V({queryKey:["states"],queryFn:()=>Ke(),enabled:i})),a=await a,u(),a),f=g([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"},{id:3,model:"stateId",label:"stateRoleLabel",placeholder:"stateRolePlaceholder",errorKey:"stateId",options:X,success:Y,loading:Z,select:!0}]),{isError:ee}=([a,u]=N(()=>V({queryKey:["rolesById",_],queryFn:()=>Ie("Role",_.value),select:t=>{o.value.id=t.id,o.value.shortName=t.shortName,o.value.fullName=t.fullName,o.value.roleModules=[...t.roleModules],o.value.stateId=[t.stateId]},enabled:i})),a=await a,u(),a);pe(ee,t=>{t&&R.push($.HOME.path)});const{mutate:te}=be({onMutate:t=>{t.stateId=t.stateId[0]},mutationFn:t=>Ve("Role",t),onSuccess:t=>{t!=null&&t.success&&(o.value=Me(o.value),h.invalidateQueries({queryKey:["roles"]}),h.invalidateQueries({queryKey:["rolesById",_]}),h.invalidateQueries({queryKey:["rolesList"]}),R.push($.ROLE.path),setTimeout(()=>P.success(G("updateToast")),150))}}),oe=()=>{if(r.value.$validate(),r.value.$errors.length)return;const t={...o.value};te(t),r.value.$reset()};return(t,m)=>{var w,E;const ae=c("ManageHead"),se=c("FormInput"),re=c("FormSelect"),le=c("ActionsModules"),ue=c("CustomButton"),ne=c("Spinner");return i.value?(l(),M("section",we,[Q("div",Ee,[he(ae,{title:"editRolesTitle",to:s($).ROLE.path},null,8,["to"]),Q("form",{class:"manage__form form-manage",onSubmit:ye(oe,["prevent"])},[(l(!0),M(D,null,_e(f.value,e=>{var L,k,q,B,F,C,T,U,x,A;return l(),M(D,{key:e.id},[e!=null&&e.select?n("",!0):(l(),d(se,{key:0,modelValue:o.value[e.model],"onUpdate:modelValue":v=>o.value[e.model]=v,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(k=(L=s(r))==null?void 0:L[e.errorKey])==null?void 0:k.$error,textError:(F=(B=(q=s(r))==null?void 0:q[e.errorKey])==null?void 0:B.$errors[0])==null?void 0:F.$message},{default:S(()=>[b(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(l(),d(re,{key:1,modelValue:o.value[e.model],"onUpdate:modelValue":v=>o.value[e.model]=v,modelModifiers:{trim:!0},width:500,options:e.options,error:(T=(C=s(r))==null?void 0:C[e==null?void 0:e.errorKey])==null?void 0:T.$error,placeholder:e==null?void 0:e.placeholder,textError:(A=(x=(U=s(r))==null?void 0:U[e==null?void 0:e.errorKey])==null?void 0:x.$errors[0])==null?void 0:A.$message,success:e.success,loading:e.loading},{default:S(()=>[b(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):n("",!0)],64)}),128)),s(K)?(l(),d(le,{key:0,modelValue:o.value.roleModules,"onUpdate:modelValue":m[0]||(m[0]=e=>o.value.roleModules=e),actions:s(j)},null,8,["modelValue","actions"])):n("",!0),s(K)?(l(),d(ue,{key:1,className:`form__submit manage__submit ${(E=(w=s(r))==null?void 0:w.fullName.$errors[0])!=null&&E.$message?"centered":""}`},{default:S(()=>[b(I(t.$t("formButton")),1)]),_:1},8,["className"])):n("",!0)],32),s(J)?(l(),d(ne,{key:0})):n("",!0)])])):n("",!0)}}};export{Ue as default};
