import{u as Z,a as ee,b as ae,y as te,c as E,r as q,z as V,d as f,e as b,k as C,h as s,w as oe,F as K,C as M,D as v,i as re,l as se,m as p,o as m,s as F,A as L,f as I,t as T,G as ne}from"./index-vMPD68lu.js";import{u as ue,r as $}from"./i18n-validators-6bFMv5c_.js";import{a as le,u as ie}from"./generic.services-lYBczCwf.js";import{u as W}from"./useQuery-iPiJsYsS.js";import{c as de}from"./crud.services-Ewelvizm.js";import{h as me,k as ce}from"./manual.services-4txGHHAa.js";const ye={key:0,class:"manage section-height shadowed"},pe={class:"manage__inner section-padding"},Te={__name:"create",async setup(he){let t,c;const k=le(),U=se();Z(),ee();const B=ae(),{user:y}=te(B),h=E(()=>{var a,_;return!!((_=(a=y==null?void 0:y.value.user)==null?void 0:a.modules)!=null&&_.includes(ne.WAREHOUSE.CREATE))}),r=q({materialId:[],quantity:"",quantityTypeId:[]}),N=E(()=>({materialId:{required:$},quantity:{required:$},quantityTypeId:{required:$}})),o=ue(N,r),{data:A,isSuccess:H,isLoading:Q}=([t,c]=V(()=>W({queryKey:["types"],queryFn:()=>ce(),enabled:h})),t=await t,c(),t),{data:R,isSuccess:x,isLoading:P}=([t,c]=V(()=>W({queryKey:["materialsList",{organizationId:y.value.user.organizationId}],queryFn:()=>me(),enabled:h})),t=await t,c(),t),z=q([{id:1,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),O=q([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:R,success:x,loading:P},{id:2,model:"quantityTypeId",label:"qunatityTypesWarehouseLabel",placeholder:"qunatityTypesWarehousePlaceholder",errorKey:"quantityTypeId",options:A,success:H,loading:Q}]),{mutate:D}=ie({onMutate:a=>{a.materialId=a.materialId[0],a.quantityTypeId=a.quantityTypeId[0]},mutationFn:a=>de("warehouse",a),onSuccess:a=>{k.invalidateQueries({queryKey:["warehouse"]}),U.push(F.WAREHOUSE.path)}}),G=()=>{o.value.$validate(),!o.value.$errors.length&&(D(r.value),o.value.$reset())};return(a,_)=>{var S,w;const j=p("ManageHead"),J=p("FormInput"),X=p("FormSelect"),Y=p("CustomButton");return h.value?(m(),f("section",ye,[b("div",pe,[C(j,{title:"addNewProductTitle",to:s(F).WAREHOUSE.path},null,8,["to"]),b("form",{class:"manage__form form-manage",onSubmit:oe(G,["prevent"])},[(m(!0),f(K,null,M(z.value,e=>{var n,u,l,i,d;return m(),L(J,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":g=>r.value[e.model]=g,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(u=(n=s(o))==null?void 0:n[e.errorKey])==null?void 0:u.$error,textError:(d=(i=(l=s(o))==null?void 0:l[e.errorKey])==null?void 0:i.$errors[0])==null?void 0:d.$message},{default:v(()=>[I(T(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(m(!0),f(K,null,M(O.value,e=>{var n,u,l,i,d;return m(),L(X,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":g=>r.value[e.model]=g,width:500,options:e.options,error:(u=(n=s(o))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(d=(i=(l=s(o))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:d.$message,success:e.success,loading:e.loading},{default:v(()=>[I(T(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),C(Y,{className:`form__submit ${(w=(S=s(o))==null?void 0:S.quantityTypeId.$errors[0])!=null&&w.$message?"centered":""}`},{default:v(()=>[I(T(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):re("",!0)}}};export{Te as default};
