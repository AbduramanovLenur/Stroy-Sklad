import{_ as Ie,u as he,a as be,r as b,c as d,B as _e,m,o as c,d as v,e as $,t as g,F as T,C as ye,A as L,D as I,f as h,i as y,k as _,K as Re,q as Je,b as We,y as Xe,z as k,h as u,w as Ye,l as Ze,s as ve,H as Fe,J as U,E as ea}from"./index-qYaOSAk5.js";import{u as aa,r as V}from"./i18n-validators-FA-njMbI.js";import{a as oa,u as ta}from"./generic.services-uSp9rJcx.js";import{u as S}from"./useQuery-3KlBkAoQ.js";import{c as la}from"./crud.services-6H1cbtzh.js";import{f as sa,g as ra,h as na,i as ca,j as ia}from"./manual.services-e5QN_9-o.js";import{v as ua}from"./v4-yQnnJER4.js";const da={class:"application-form"},pa={class:"application-form__title"},ma={class:"application-form__overlay form-manage"},ga={__name:"ApplicationForm",props:["subFields","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(C,{emit:t}){const n=he(),{t:w}=be(),E=C,O=t,r=b({floorId:[],costId:[],constructionMaterialId:[],count:""}),P=d(()=>E.buildingBlockId);_e(P,()=>{r.value.floorId=[]});const i=()=>{if(!Re(r.value)){n.error(w("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count},O("onAddTable",r.value),r.value=Je(r.value)};return(p,M)=>{const q=m("FormInput"),l=m("FormSelect"),K=m("CustomButton");return c(),v("div",da,[$("h4",pa,g(p.$t("appInfo")),1),$("div",ma,[(c(!0),v(T,null,ye(C.subFields,e=>(c(),v(T,{key:e.id},[e!=null&&e.select?y("",!0):(c(),L(q,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":A=>r.value[e.model]=A,width:500,placeholder:p.$t(e.placeholder),name:e.icon,type:e==null?void 0:e.type},{default:I(()=>[h(g(p.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),e!=null&&e.select?(c(),L(l,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":A=>r.value[e.model]=A,modelModifiers:{trim:!0},width:500,options:e.options,placeholder:e==null?void 0:e.placeholder,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:I(()=>[h(g(p.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"])):y("",!0)],64))),128)),_(K,{className:"form__submit",type:"button",onClick:i},{default:I(()=>[h(g(p.$t("addButtonForm")),1)]),_:1})])])}}},va=Ie(ga,[["__scopeId","data-v-e46a2199"]]),Ia={key:0,class:"manage section-height shadowed"},ha={class:"manage__inner section-padding"},ba={class:"manage__overlay"},_a={key:0,class:"error"},ya={__name:"create",async setup(C){let t,n;const w=oa(),E=Ze(),O=he(),{t:r}=be(),P=We(),{user:i}=Xe(P),p=d(()=>{var a,s;return!!((s=(a=i==null?void 0:i.value.user)==null?void 0:a.modules)!=null&&s.includes(Fe.APPLICATION.CREATE))}),M=b(!1),q=b([{id:1,label:"appFloor",width:15},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:15},{id:4,label:"appPrice",width:20}]),l=b({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:""}),K=d(()=>({deadline:{required:V},buildingObjectId:{required:V},buildingBlockId:{required:V},createApplicationTables:{required:V},details:{required:V}})),e=aa(K,l),{data:A,isSuccess:Ae,isLoading:ke}=([t,n]=k(()=>S({queryKey:["objectsList",{organizationId:i.value.user.organizationId}],queryFn:()=>sa(),enabled:p})),t=await t,n(),t),B=d(()=>l.value.buildingObjectId),Ve=d(()=>!!B.value.length);_e(B,()=>{M.value||(l.value.buildingBlockId=[])},{immediate:!0});const{data:Se,isSuccess:$e,isLoading:Me}=([t,n]=k(()=>S({queryKey:["blocksList",{blockId:B,organizationId:i.value.user.organizationId}],queryFn:()=>ra(B.value),enabled:Ve})),t=await t,n(),t),j=d(()=>l.value.buildingBlockId),f=d(()=>!!j.value.length),{data:D,isSuccess:Be,isLoading:Te}=([t,n]=k(()=>S({queryKey:["floorsList",{floorId:j,organizationId:i.value.user.organizationId}],queryFn:()=>na(j.value),enabled:f})),t=await t,n(),t),{data:H,isSuccess:Le,isLoading:Ce}=([t,n]=k(()=>S({queryKey:["costsList",{organizationId:i.value.user.organizationId}],queryFn:()=>ca(),enabled:f})),t=await t,n(),t),{data:x,isSuccess:we,isLoading:Ee}=([t,n]=k(()=>S({queryKey:["materialsList",{organizationId:i.value.user.organizationId}],queryFn:()=>ia(),enabled:f})),t=await t,n(),t),Oe=b([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"},{id:2,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:A,success:Ae,loading:ke,select:!0},{id:3,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:Se,success:$e,loading:Me,select:!0}]),Pe=b([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:D,success:Be,loading:Te,select:!0},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:H,success:Le,loading:Ce,select:!0},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:x,success:we,loading:Ee,select:!0},{id:4,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"}]),qe=d(()=>U(D.value)),Ke=d(()=>U(H.value)),je=d(()=>U(x.value)),fe=a=>{var s;return(s=qe.value[a.floorId])==null?void 0:s.name},ze=a=>{var s;return(s=Ke.value[a.costId])==null?void 0:s.name},Ne=a=>{var s;return(s=je.value[a==null?void 0:a.constructionMaterialId])==null?void 0:s.name},Ue=a=>{l.value.createApplicationTables.push({...a,delId:ua(),floorValue:fe(a),costValue:ze(a),constructionMaterialValue:Ne(a)})},De=a=>{l.value.createApplicationTables=l.value.createApplicationTables.filter(s=>s.delId!==a)},{mutate:He,status:xe}=ta({onMutate:a=>{M.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.createApplicationTables=a.createApplicationTables.map(s=>{const{delId:G,floorValue:Q,costValue:R,constructionMaterialValue:J,...z}=s;return z})},mutationFn:a=>la("application",a),onSuccess:a=>{a!=null&&a.success&&(l.value=ea(l.value),w.invalidateQueries({queryKey:["applications"]}),E.push(ve.APPLICATION.path),setTimeout(()=>O.success(r("createToast")),150))}}),Ge=()=>{if(e.value.$validate(),e.value.$errors.length)return;const a={...l.value};He(a),e.value.$reset()};return(a,s)=>{var W,X,Y,Z,F,ee,ae,oe,te,le;const G=m("ManageHead"),Q=m("FormInput"),R=m("FormSelect"),J=m("SubTable"),z=m("FormTextarea"),Qe=m("CustomButton");return p.value?(c(),v("section",Ia,[$("div",ha,[_(G,{title:"addNewApplicationTitle",to:u(ve).APPLICATION.path},null,8,["to"]),$("form",{class:"manage__form",onSubmit:Ye(Ge,["prevent"])},[$("div",ba,[(c(!0),v(T,null,ye(Oe.value,o=>{var se,re,ne,ce,ie,ue,de,pe,me,ge;return c(),v(T,{key:o.id},[o!=null&&o.select?y("",!0):(c(),L(Q,{key:0,modelValue:l.value[o.model],"onUpdate:modelValue":N=>l.value[o.model]=N,width:500,placeholder:a.$t(o.placeholder),name:o.icon,error:(re=(se=u(e))==null?void 0:se[o.errorKey])==null?void 0:re.$error,textError:(ie=(ce=(ne=u(e))==null?void 0:ne[o.errorKey])==null?void 0:ce.$errors[0])==null?void 0:ie.$message,type:o==null?void 0:o.type},{default:I(()=>[h(g(a.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])),o!=null&&o.select?(c(),L(R,{key:1,modelValue:l.value[o.model],"onUpdate:modelValue":N=>l.value[o.model]=N,modelModifiers:{trim:!0},width:500,options:o.options,error:(de=(ue=u(e))==null?void 0:ue[o==null?void 0:o.errorKey])==null?void 0:de.$error,placeholder:o==null?void 0:o.placeholder,textError:(ge=(me=(pe=u(e))==null?void 0:pe[o==null?void 0:o.errorKey])==null?void 0:me.$errors[0])==null?void 0:ge.$message,success:o.success,loading:o.loading,isMultiSelect:o==null?void 0:o.multiple},{default:I(()=>[h(g(a.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])):y("",!0)],64)}),128))]),_(va,{subFields:Pe.value,buildingBlockId:l.value.buildingBlockId,isSubmit:M.value,onOnAddTable:Ue},null,8,["subFields","buildingBlockId","isSubmit"]),(X=(W=u(e))==null?void 0:W.createApplicationTables)!=null&&X.$error?(c(),v("span",_a,g((F=(Z=(Y=u(e))==null?void 0:Y.createApplicationTables)==null?void 0:Z.$errors[0])==null?void 0:F.$message),1)):y("",!0),_(J,{headers:q.value,table:l.value.createApplicationTables,onOnActionDelete:De,isShowDelete:!0},null,8,["headers","table"]),_(z,{modelValue:l.value.details,"onUpdate:modelValue":s[0]||(s[0]=o=>l.value.details=o),modelModifiers:{trim:!0},width:500,placeholder:a.$t("appCommentPlaceholder"),error:(ae=(ee=u(e))==null?void 0:ee.details)==null?void 0:ae.$error,textError:(le=(te=(oe=u(e))==null?void 0:oe.details)==null?void 0:te.$errors[0])==null?void 0:le.$message},{default:I(()=>[h(g(a.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),_(Qe,{className:"manage__submit",disabled:u(xe)==="pending"},{default:I(()=>[h(g(a.$t("appButton")),1)]),_:1},8,["disabled"])],32)])])):y("",!0)}}},Ta=Ie(ya,[["__scopeId","data-v-434f00e1"]]);export{Ta as default};
