{"version":3,"file":"index-9d2bpQrN.js","sources":["../../src/views/company/index.vue"],"sourcesContent":["<template>\r\n    <section class=\"company section-height\">\r\n        <div class=\"company__inner section-padding\">\r\n            <HeadPage \r\n                title=\"comapnyTitle\" \r\n                :to=\"routes.CREATE_COMPANIES.path\"\r\n            />\r\n            <Table \r\n                v-if=\"isSuccessCompanies && companies?.count\"\r\n                :headers=\"headers\" \r\n                :table=\"companies?.organizations\" \r\n                :to=\"routes.UPDATE_COMPANIES.name\"\r\n                :options=\"{ page, limit }\"\r\n                @onActionDelete=\"deleteHandler\"\r\n            />\r\n            <Pagination\r\n                :count=\"companies?.count\"\r\n                :isSucces=\"isSuccessCompanies\"\r\n            />\r\n            <Spinner v-if=\"isLoadingCompanies\" />\r\n            <div \r\n                v-if=\"(isSuccessCompanies && !companies?.count) || isError\" \r\n                class=\"empty-table shadowed\"\r\n            >\r\n                {{ $t(\"emptyTableTitle\") }}\r\n            </div>\r\n        </div>\r\n    </section>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch, onMounted } from \"vue\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { useTableStore } from \"@/store/tableStore\";\r\nimport { refDebounced } from \"@vueuse/core\";\r\nimport { \r\n    useQueryClient, \r\n    useQuery, \r\n    useMutation \r\n} from \"@tanstack/vue-query\";\r\nimport { getList, deleteWithId } from \"@/services/crud.services.js\";\r\nimport { routes } from \"@/utils/routes.js\";\r\nimport { actionModules } from \"@/utils/action-modules.js\";\r\n\r\nconst queryClient = useQueryClient();\r\n\r\nconst tableStore = useTableStore();\r\nconst { page, limit, search } = storeToRefs(tableStore);\r\n\r\nconst companyId = ref(\"\");\r\n\r\nconst debouncedSearch = refDebounced(search, 500);\r\n\r\nconst headers = ref([\r\n    { id: 1, label: \"organizationName\", width: 220 },\r\n    { id: 2, label: \"organizationInn\", width: 115 },\r\n    { id: 3, label: \"organizationRegion\", width: 200 },\r\n    { id: 4, label: \"organizationDistrict\", width: 155 },\r\n    { id: 5, label: \"organizationAddress\", width: 200 },\r\n    { id: 6, label: \"organizationPhone\", width: 170 },\r\n    { id: 7, label: \"organizationDirector\", width: 230 }\r\n]);\r\n\r\nconst {\r\n    data: companies,\r\n    isLoading: isLoadingCompanies,\r\n    isSuccess: isSuccessCompanies,\r\n    isError\r\n} = await useQuery({\r\n    queryKey: [\"companies\", { page, limit, debouncedSearch }],\r\n    queryFn: () => getList(\"organization\", page.value, limit.value, debouncedSearch.value),\r\n    select: (data) => {\r\n        let companies = {...data};\r\n\r\n        companies.organizations = data?.organizations.map((elem) => {\r\n            const company = {\r\n                ...elem,\r\n                company: elem.organizationName,\r\n            }\r\n\r\n            delete company.organizationName;\r\n\r\n            return company;\r\n        })\r\n\r\n        return companies;\r\n    }\r\n});\r\n\r\nconst { mutate: mutateDelete } = useMutation({\r\n    mutationFn: (idx) => deleteWithId(\"organization\", idx),\r\n    onSuccess: async () => {\r\n        await queryClient.invalidateQueries({ queryKey: [\"companies\"] });\r\n        await queryClient.invalidateQueries({ queryKey: [\"companiesById\", companyId] });\r\n    }\r\n});\r\n\r\nconst deleteHandler = (idx) => {\r\n    companyId.value = idx;\r\n    mutateDelete(idx);\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>"],"names":["queryClient","useQueryClient","tableStore","useTableStore","page","limit","search","storeToRefs","companyId","ref","debouncedSearch","refDebounced","headers","companies","isLoadingCompanies","isSuccessCompanies","isError","__temp","__restore","_withAsyncContext","useQuery","getList","data","elem","company","mutateDelete","useMutation","idx","deleteWithId","deleteHandler"],"mappings":"ueA4CA,MAAMA,EAAcC,EAAc,EAE5BC,EAAaC,EAAa,EAC1B,CAAE,KAAAC,EAAM,MAAAC,EAAO,OAAAC,CAAQ,EAAGC,EAAYL,CAAU,EAEhDM,EAAYC,EAAI,EAAE,EAElBC,EAAkBC,EAAaL,EAAQ,GAAG,EAE1CM,EAAUH,EAAI,CAChB,CAAE,GAAI,EAAG,MAAO,mBAAoB,MAAO,GAAK,EAChD,CAAE,GAAI,EAAG,MAAO,kBAAmB,MAAO,GAAK,EAC/C,CAAE,GAAI,EAAG,MAAO,qBAAsB,MAAO,GAAK,EAClD,CAAE,GAAI,EAAG,MAAO,uBAAwB,MAAO,GAAK,EACpD,CAAE,GAAI,EAAG,MAAO,sBAAuB,MAAO,GAAK,EACnD,CAAE,GAAI,EAAG,MAAO,oBAAqB,MAAO,GAAK,EACjD,CAAE,GAAI,EAAG,MAAO,uBAAwB,MAAO,GAAK,CACxD,CAAC,EAEK,CACF,KAAMI,EACN,UAAWC,EACX,UAAWC,EACX,QAAAC,CACJ,GAAU,CAAAC,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACf,SAAU,CAAC,YAAa,CAAE,KAAAhB,EAAM,MAAAC,EAAO,gBAAAK,CAAe,CAAE,EACxD,QAAS,IAAMW,EAAQ,eAAgBjB,EAAK,MAAOC,EAAM,MAAOK,EAAgB,KAAK,EACrF,OAASY,GAAS,CACd,IAAIT,EAAY,CAAC,GAAGS,CAAI,EAExB,OAAAT,EAAU,cAAgBS,GAAA,YAAAA,EAAM,cAAc,IAAKC,GAAS,CACxD,MAAMC,EAAU,CACZ,GAAGD,EACH,QAASA,EAAK,gBACjB,EAED,cAAOC,EAAQ,iBAERA,CACnB,GAEeX,CACV,CACL,CAAC,CAAA,mBAEK,CAAE,OAAQY,CAAc,EAAGC,EAAY,CACzC,WAAaC,GAAQC,EAAa,eAAgBD,CAAG,EACrD,UAAW,SAAY,CACnB,MAAM3B,EAAY,kBAAkB,CAAE,SAAU,CAAC,WAAW,CAAC,CAAE,EAC/D,MAAMA,EAAY,kBAAkB,CAAE,SAAU,CAAC,gBAAiBQ,CAAS,CAAC,CAAE,CACjF,CACL,CAAC,EAEKqB,EAAiBF,GAAQ,CAC3BnB,EAAU,MAAQmB,EAClBF,EAAaE,CAAG,CACpB"}