import{_ as O,u as J,a as W,b as X,x as Y,c as I,r as Z,y as M,d,e as i,k as r,D as v,h as E,w as j,F as x,C as ee,i as b,l as se,m,o as _,f as g,t as y,A as te,G as oe}from"./index-KKCGiaOF.js";import{a as ae,u as ne}from"./generic.services-xhLq1RN3.js";import{u as R}from"./useQuery-W7o1xA7A.js";import{h as le,i as ie}from"./crud.services-tsBZfuRX.js";import{e as re}from"./manual.services-1tbz_eEo.js";import{v as u}from"./v4-yQnnJER4.js";const ue={key:0,class:"management-role section-height shadowed"},ce={class:"management-role__inner section-padding"},de={class:"management-role__head"},me={class:"management-role__selects"},_e={class:"management-role__select-box"},pe={class:"management-role__actions"},ve=["onClick"],ge=["onClick"],ye={__name:"management-role",async setup(fe){let a,p;const f=ae();se();const B=J(),{t:w}=W(),N=X(),{user:c}=Y(N),h=I(()=>{var e,s;return!!((s=(e=c==null?void 0:c.value.user)==null?void 0:e.modules)!=null&&s.includes(oe.MANAGEMENT_ROLE.CREATE))}),o=Z([{id:null,uuid:u(),roleIds:[],label:"creatorApp"},{id:null,uuid:u(),roleIds:[],label:"confirmApp"}]),{data:T,isSuccess:q,isLoading:L}=([a,p]=M(()=>R({queryKey:["rolesList",{organizationId:c.value.user.organizationId}],queryFn:()=>re(),enabled:h})),a=await a,p(),a),{isSuccess:V,isLoading:F}=([a,p]=M(()=>R({queryKey:["positions",{organizationId:c.value.user.organizationId}],queryFn:()=>le("application_position"),select:e=>{e.length&&(o.value=e.map((s,t)=>{let l={};return t===0?l={id:s.id,uuid:u(),roleIds:[...s.roleIds],label:"creatorApp"}:t+1===e.length?l={id:s.id,uuid:u(),roleIds:[...s.roleIds],label:"confirmApp"}:l={id:s.id,uuid:u(),roleIds:[...s.roleIds],label:"inspectorApp"},l}))},enabled:h})),a=await a,p(),a),K=I(()=>q.value&&V.value),Q=I(()=>L.value&&F.value),z=e=>{o.value.splice(e,0,{id:null,uuid:u(),roleIds:[],label:"inspectorApp"})},G=e=>{o.value.splice(e,1)},{mutate:P}=ne({onMutate:e=>{e=e.map(s=>{const t={...s};return t==null||delete t.uuid,t==null||delete t.label,t})},mutationFn:e=>ie("application_position",e),onSuccess:()=>{f.invalidateQueries({queryKey:["positions"]}),f.invalidateQueries({queryKey:["applications"]}),f.invalidateQueries({queryKey:["applicationsById"]})}}),$=()=>{if(o.value.some(s=>!s.roleIds.length)){B.error(w("isEmptyRole"));return}P(o.value)};return(e,s)=>{const t=m("Title"),l=m("MyButton"),U=m("FormSelect"),A=m("Icon"),D=m("CustomButton");return h.value?(_(),d("section",ue,[i("div",ce,[i("div",de,[r(t,null,{default:v(()=>[g(`\r
                    `+y(e.$t("managementTitle"))+`\r
                `,1)]),_:1}),r(l,{to:E(te).MANAGEMENT.path,icon:"back",type:"link",color:"black"},{default:v(()=>[g(y(e.$t("backButton")),1)]),_:1},8,["to"])]),i("form",{class:"management-role__form",onSubmit:j($,["prevent"])},[i("div",me,[(_(!0),d(x,null,ee(o.value,(k,n)=>{var C,S;return _(),d("div",{class:"management-role__select",key:k.uuid},[i("div",_e,[r(U,{modelValue:o.value[n].roleIds,"onUpdate:modelValue":H=>o.value[n].roleIds=H,width:500,options:E(T),placeholder:"managementRolePlaceholder",success:K.value,loading:Q.value,isMultiSelect:!0},{default:v(()=>[g(y(e.$t(k.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","success","loading"])]),i("div",pe,[n+1!==((C=o.value)==null?void 0:C.length)?(_(),d("div",{key:0,class:"management-role__icon",onClick:()=>z(n+1)},[r(A,{name:"plus"})],8,ve)):b("",!0),n!==0&&n+1!==((S=o.value)==null?void 0:S.length)?(_(),d("div",{key:1,class:"management-role__icon",onClick:()=>G(n)},[r(A,{name:"delete-role"})],8,ge)):b("",!0)])])}),128))]),r(D,{className:"form__submit"},{default:v(()=>[g(y(e.$t("formButton")),1)]),_:1})],32)])])):b("",!0)}}},Se=O(ye,[["__scopeId","data-v-0b954b8f"]]);export{Se as default};
//# sourceMappingURL=management-role-m0gKCjBe.js.map
