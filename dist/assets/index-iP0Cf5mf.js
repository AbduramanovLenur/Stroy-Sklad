import{n as x,s as H,r as l,q as K,x as j,y as F,b as P,d as M,j as T,g as e,z as v,h as m,t as R,l as c,o as r,A as N}from"./index-u_2KKI46.js";import{a as U,u as W}from"./generic.services-Zkt5ZkSV.js";import{u as $}from"./useQuery-n3W-mpu_.js";import{g as G,d as J}from"./crud.services-WcX_HSPp.js";import{r as X}from"./index-qMmDNxy9.js";const Y={class:"applications"},Z={class:"applications__inner"},ee={key:2,class:"empty-table shadowed"},le={__name:"index",async setup(te){let n,_;const g=U(),h=x(),{setSearchValue:y,setPagePagination:C}=h,{page:p,limit:d,search:b}=H(h),D=l(localStorage.getItem("organizationId")),k=l(localStorage.getItem("roleId"));K(()=>{y("")}),j(b,()=>{C(1)});const S=l(""),I=X(b,500),q=l([{id:1,label:"applicationUserName",width:130},{id:2,label:"applicationOrganization",width:185},{id:3,label:"applicationDocDate",width:210},{id:4,label:"applicationDedline",width:240},{id:5,label:"applicationObject",width:100},{id:6,label:"applicationBlock",width:95},{id:7,label:"applicationCost",width:330},{id:8,label:"applicationState"},{id:9,label:"applicationAction"}]),{data:s,isLoading:z,isSuccess:u,isError:B}=([n,_]=F(()=>$({queryKey:["applications",{page:p,limit:d,debouncedSearch:I,organizationId:D,roleId:k}],queryFn:()=>G("application",p.value,d.value,I.value),select:t=>{let a={...t};return a.applications=a==null?void 0:a.applications.map(i=>{const o={...i,name:i.userName,company:i.organizationName};return delete o.userName,delete o.organizationName,delete o.state,delete o.stateId,o}),a}})),n=await n,_(),n),{mutate:O}=W({mutationFn:t=>J("application",t),onSuccess:()=>{g.invalidateQueries({queryKey:["applications"]}),g.invalidateQueries({queryKey:["applicationsById",S]})}}),E=async t=>{S.value=t,O(t)};return(t,a)=>{var w,A,f;const i=c("HeadPage"),o=c("Table"),L=c("Pagination"),Q=c("Spinner");return r(),P("section",Y,[M("div",Z,[T(i,{title:"applicationTitle",to:e(N).CREATE_APPLICATIONS.path,onOnSearch:a[0]||(a[0]=V=>e(y)(V))},null,8,["to"]),e(u)&&((w=e(s))!=null&&w.count)?(r(),v(o,{key:0,headers:q.value,table:(A=e(s))==null?void 0:A.applications,to:e(N).UPDATE_APPLICATIONS.name,options:{page:e(p),limit:e(d)},isShow:!0,onOnActionDelete:E},null,8,["headers","table","to","options"])):m("",!0),T(L,{count:(f=e(s))==null?void 0:f.count,isSucces:e(u)},null,8,["count","isSucces"]),e(z)?(r(),v(Q,{key:1})):m("",!0),e(u)&&!e(s).count||e(B)?(r(),P("div",ee,R(t.$t("emptyTableTitle")),1)):m("",!0)])])}}};export{le as default};
//# sourceMappingURL=index-iP0Cf5mf.js.map
