import{u as Y,a as Z,x as ee,y as G,b as se,c as te,r as I,z as oe,d as q,e as ae,k as L,A as ne,h as e,B as x,i as c,t as H,m as d,o as m,f as ue,s as Q,H as p}from"./index-O2h3gL13.js";import{u as re}from"./generic.services-QvSdyUz0.js";import{u as le}from"./useQuery-kkjrNxK8.js";import{u as ie}from"./useMutation-05dLsYlb.js";import{g as ce,d as de}from"./crud.services-EgXNei1C.js";import{r as me}from"./index-ouQ1Yvgt.js";const pe={key:0,class:"employees"},_e={class:"employees__inner section-padding"},ye={key:2,class:"empty-table shadowed"},Te={__name:"index",async setup(he){let r,S;const E=re(),V=Y(),{t:z}=Z(),F=ee(),{page:_,limit:y,search:K}=G(F),M=se(),{user:t}=G(M),f=te(()=>{var s,o;return!!((o=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)!=null&&o.includes(p.ORG_USER.READ))}),b=I(""),g=me(K,500),$=I([{id:1,label:"employeesFullName",width:30},{id:3,label:"employeesPhone",width:25},{id:4,label:"employeesRole",width:20}]),{data:l,isLoading:W,isSuccess:h,isError:j}=([r,S]=oe(()=>{var s,o;return le({queryKey:["orgUsers",{page:_,limit:y,debouncedSearch:g,organizationId:(o=(s=t.value)==null?void 0:s.user)==null?void 0:o.organizationId,name:t.value.user.fullName}],queryFn:()=>ce("user",_.value,y.value,g.value),select:a=>{let i={...a};return i.users=a==null?void 0:a.users.map(n=>{const u={...n,phone:n.phoneNumber,name:n.fullName};return delete u.fullName,delete u.phoneNumber,u}),i},enabled:f})}),r=await r,S(),r),{mutate:J}=ie({mutationFn:s=>de("user",s),onSuccess:s=>{s!=null&&s.success&&(E.invalidateQueries({queryKey:["orgUsers"]}),E.invalidateQueries({queryKey:["orgUserById",b]}),setTimeout(()=>V.success(z("deleteToast")),150))}}),X=s=>{b.value=s,J(s)};return(s,o)=>{var R,T,v,w,U,C,N,D,k,A,B,O,P;const a=d("HeadPage"),i=d("Table"),n=d("Pagination"),u=d("Spinner");return f.value?(m(),q("section",pe,[ae("div",_e,[L(a,{title:"employeesTitle",to:e(Q).CREATE_ORG_USER.path,isShowCreate:(v=(T=(R=e(t))==null?void 0:R.user)==null?void 0:T.modules)==null?void 0:v.includes(e(p).ORG_USER.CREATE)},{default:ne(()=>[ue(H(s.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),e(h)&&((w=e(l))!=null&&w.count)?(m(),x(i,{key:0,headers:$.value,table:(U=e(l))==null?void 0:U.users,to:e(Q).UPDATE_ORG_USER.name,options:{page:e(_),limit:e(y)},isShowUpdate:(D=(N=(C=e(t))==null?void 0:C.user)==null?void 0:N.modules)==null?void 0:D.includes(e(p).ORG_USER.UPDATE),isShowDelete:(B=(A=(k=e(t))==null?void 0:k.user)==null?void 0:A.modules)==null?void 0:B.includes(e(p).ORG_USER.DELETE),onOnActionDelete:X},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):c("",!0),L(n,{count:(O=e(l))==null?void 0:O.count,isSucces:e(h)},null,8,["count","isSucces"]),e(W)?(m(),x(u,{key:1})):c("",!0),e(h)&&!((P=e(l))!=null&&P.count)||e(j)?(m(),q("div",ye,H(s.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}};export{Te as default};
