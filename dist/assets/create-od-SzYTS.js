import{_ as Ve,u as $e,a as Me,r as h,c as p,C as x,m as v,o as d,d as I,e as b,t as m,F as E,D as Se,B as O,A as g,f as y,i as A,k as _,K as ea,q as aa,b as ta,y as oa,z as B,h as i,w as la,l as sa,s as ke,H as ra,J as H,E as na}from"./index-0sPBClUI.js";import{c as ca}from"./crud.services-BcOS3M0E.js";import{f as ua,g as ia,h as da,i as pa,j as ma}from"./manual.services-EJwfGIwS.js";import{u as va,r as V}from"./i18n-validators-q99RgDXY.js";import{u as ga}from"./generic.services-zebC7xpi.js";import{u as L}from"./useQuery-eQS1GidE.js";import{u as ya}from"./useMutation-33x-pTwH.js";import{v as Ia}from"./v4-yQnnJER4.js";const ha={class:"application-form"},_a={class:"application-form__title"},ba={class:"application-form__overlay form-manage"},Aa={key:0},Ta={__name:"ApplicationForm",props:{subFields:Array,buildingBlockId:Array,isSubmit:Boolean,quantityType:String},emits:["onAddTable","onGetQuantityType"],setup(C,{emit:l}){const c=$e(),{t:P}=Me(),N=C,f=l,r=h({floorId:[],costId:[],constructionMaterialId:[],count:""}),K=p(()=>r.value.constructionMaterialId[0]);x(K,u=>{f("onGetQuantityType",u)},{immediate:!0});const n=p(()=>N.buildingBlockId);x(n,()=>{r.value.floorId=[]},{immediate:!0});const T=()=>{if(!ea(r.value)){c.error(P("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count},f("onAddTable",r.value),r.value=aa(r.value)};return(u,R)=>{const s=v("FormInput"),q=v("FormSelect"),j=v("CustomButton");return d(),I("div",ha,[b("h4",_a,m(u.$t("appInfo")),1),b("div",ba,[(d(!0),I(E,null,Se(C.subFields,e=>(d(),I(E,{key:e.id},[e!=null&&e.select?A("",!0):(d(),O(s,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":$=>r.value[e.model]=$,placeholder:u.$t(e.placeholder),name:e.icon,type:e==null?void 0:e.type},{default:g(()=>[b("span",null,[y(m(u.$t(e.label))+" ",1),e!=null&&e.quantityType?(d(),I("span",Aa,m(C.quantityType),1)):A("",!0)])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),e!=null&&e.select?(d(),O(q,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":$=>r.value[e.model]=$,modelModifiers:{trim:!0},options:e.options,placeholder:e==null?void 0:e.placeholder,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:g(()=>[y(m(u.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"])):A("",!0)],64))),128)),_(j,{className:"form__submit",type:"button",onClick:T},{default:g(()=>[y(m(u.$t("addButtonForm")),1)]),_:1})])])}}},ka=Ve(Ta,[["__scopeId","data-v-f52e9f72"]]),Va={key:0,class:"manage section-height shadowed"},$a={class:"manage__inner section-padding"},Ma={class:"manage__overlay"},Sa={key:0,class:"error"},Ba={class:"manage__textareas"},La={__name:"create",async setup(C){let l,c;const P=ga(),N=sa(),f=$e(),{t:r}=Me(),K=ta(),{user:n}=oa(K),T=p(()=>{var a,o;return!!((o=(a=n==null?void 0:n.value.user)==null?void 0:a.modules)!=null&&o.includes(ra.APPLICATION.CREATE))}),u=h(!1),R=h([{id:1,label:"appFloor",width:15},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:15},{id:4,label:"appType",width:10},{id:5,label:"appPrice",width:20}]),s=h({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:"",comment:""}),q=h(""),j=p(()=>({deadline:{required:V},buildingObjectId:{required:V},buildingBlockId:{required:V},createApplicationTables:{required:V},details:{required:V},comment:{required:V}})),e=va(j,s),{data:$,isSuccess:Be,isLoading:Le}=([l,c]=B(()=>L({queryKey:["objectsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ua(),enabled:T})),l=await l,c(),l),w=p(()=>s.value.buildingObjectId),Ce=p(()=>!!w.value.length);x(w,()=>{u.value||(s.value.buildingBlockId=[])},{immediate:!0});const{data:fe,isSuccess:qe,isLoading:we}=([l,c]=B(()=>L({queryKey:["blocksList",{blockId:w,organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ia(w.value),enabled:Ce})),l=await l,c(),l),z=p(()=>s.value.buildingBlockId),Ee=p(()=>!!z.value.length),{data:J,isSuccess:Oe,isLoading:Pe}=([l,c]=B(()=>L({queryKey:["floorsList",{floorId:z,organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>da(z.value),enabled:Ee})),l=await l,c(),l),{data:W,isSuccess:Ne,isLoading:Ke}=([l,c]=B(()=>L({queryKey:["costsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>pa(),enabled:T})),l=await l,c(),l),{data:U,isSuccess:je,isLoading:ze}=([l,c]=B(()=>L({queryKey:["materialsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ma(),enabled:T})),l=await l,c(),l),Ue=h([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"},{id:2,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:$,success:Be,loading:Le,select:!0},{id:3,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:fe,success:qe,loading:we,select:!0}]),De=h([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:J,success:Oe,loading:Pe,select:!0},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:W,success:Ne,loading:Ke,select:!0},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:U,success:je,loading:ze,select:!0},{id:4,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list",quantityType:!0}]),Qe=p(()=>H(J.value)),Ge=p(()=>H(W.value)),He=p(()=>H(U.value)),xe=a=>{var o;return(o=Qe.value[a.floorId])==null?void 0:o.name},Re=a=>{var o;return(o=Ge.value[a.costId])==null?void 0:o.name},Je=a=>{var o;return(o=He.value[a==null?void 0:a.constructionMaterialId])==null?void 0:o.name},X=a=>{var o,M,S;return(S=(M=(o=U.value)==null?void 0:o.filter(k=>(k==null?void 0:k.id)===a))==null?void 0:M[0])==null?void 0:S.quantityType},We=a=>{s.value.createApplicationTables.push({...a,delId:Ia(),floorValue:xe(a),costValue:Re(a),constructionMaterialValue:Je(a),typeValue:X(a.constructionMaterialId)})},Xe=a=>{s.value.createApplicationTables=s.value.createApplicationTables.filter(o=>o.delId!==a)},{mutate:Ye,status:Ze}=ya({onMutate:a=>{u.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.createApplicationTables=a.createApplicationTables.map(o=>{const{delId:M,floorValue:S,costValue:k,constructionMaterialValue:Y,typeValue:D,...Q}=o;return Q})},mutationFn:a=>ca("application",a),onSuccess:a=>{a!=null&&a.success&&(s.value=na(s.value),P.invalidateQueries({queryKey:["applications"]}),N.push(ke.APPLICATION.path),setTimeout(()=>f.success(r("createToast")),150))}}),Fe=()=>{if(e.value.$validate(),e.value.$errors.length)return;const a={...s.value};Ye(a),e.value.$reset()};return(a,o)=>{var Z,F,ee,ae,te,oe,le,se,re,ne,ce,ue,ie,de,pe;const M=v("ManageHead"),S=v("FormInput"),k=v("FormSelect"),Y=v("SubTable"),D=v("FormTextarea"),Q=v("CustomButton");return T.value?(d(),I("section",Va,[b("div",$a,[_(M,{title:"addNewApplicationTitle",to:i(ke).APPLICATION.path},null,8,["to"]),b("form",{class:"manage__form",onSubmit:la(Fe,["prevent"])},[b("div",Ma,[(d(!0),I(E,null,Se(Ue.value,t=>{var me,ve,ge,ye,Ie,he,_e,be,Ae,Te;return d(),I(E,{key:t.id},[t!=null&&t.select?A("",!0):(d(),O(S,{key:0,modelValue:s.value[t.model],"onUpdate:modelValue":G=>s.value[t.model]=G,placeholder:a.$t(t.placeholder),name:t.icon,error:(ve=(me=i(e))==null?void 0:me[t.errorKey])==null?void 0:ve.$error,textError:(Ie=(ye=(ge=i(e))==null?void 0:ge[t.errorKey])==null?void 0:ye.$errors[0])==null?void 0:Ie.$message,type:t==null?void 0:t.type},{default:g(()=>[y(m(a.$t(t.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])),t!=null&&t.select?(d(),O(k,{key:1,modelValue:s.value[t.model],"onUpdate:modelValue":G=>s.value[t.model]=G,modelModifiers:{trim:!0},options:t.options,error:(_e=(he=i(e))==null?void 0:he[t==null?void 0:t.errorKey])==null?void 0:_e.$error,placeholder:t==null?void 0:t.placeholder,textError:(Te=(Ae=(be=i(e))==null?void 0:be[t==null?void 0:t.errorKey])==null?void 0:Ae.$errors[0])==null?void 0:Te.$message,success:t.success,loading:t.loading,isMultiSelect:t==null?void 0:t.multiple},{default:g(()=>[y(m(a.$t(t.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])):A("",!0)],64)}),128))]),_(ka,{subFields:De.value,buildingBlockId:s.value.buildingBlockId,isSubmit:u.value,quantityType:q.value,onOnGetQuantityType:o[0]||(o[0]=t=>q.value=X(t)),onOnAddTable:We},null,8,["subFields","buildingBlockId","isSubmit","quantityType"]),(F=(Z=i(e))==null?void 0:Z.createApplicationTables)!=null&&F.$error?(d(),I("span",Sa,m((te=(ae=(ee=i(e))==null?void 0:ee.createApplicationTables)==null?void 0:ae.$errors[0])==null?void 0:te.$message),1)):A("",!0),_(Y,{headers:R.value,table:s.value.createApplicationTables,onOnActionDelete:Xe,isShowDelete:!0},null,8,["headers","table"]),b("div",Ba,[_(D,{modelValue:s.value.details,"onUpdate:modelValue":o[1]||(o[1]=t=>s.value.details=t),modelModifiers:{trim:!0},width:500,placeholder:a.$t("appDetailsPlaceholder"),error:(le=(oe=i(e))==null?void 0:oe.details)==null?void 0:le.$error,textError:(ne=(re=(se=i(e))==null?void 0:se.details)==null?void 0:re.$errors[0])==null?void 0:ne.$message},{default:g(()=>[y(m(a.$t("appDetailsLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),_(D,{modelValue:s.value.comment,"onUpdate:modelValue":o[2]||(o[2]=t=>s.value.comment=t),modelModifiers:{trim:!0},width:500,placeholder:a.$t("appCommentPlaceholder"),error:(ue=(ce=i(e))==null?void 0:ce.comment)==null?void 0:ue.$error,textError:(pe=(de=(ie=i(e))==null?void 0:ie.comment)==null?void 0:de.$errors[0])==null?void 0:pe.$message},{default:g(()=>[y(m(a.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"])]),_(Q,{className:"manage__submit",disabled:i(Ze)==="pending"},{default:g(()=>[y(m(a.$t("appButton")),1)]),_:1},8,["disabled"])],32)])])):A("",!0)}}},Ka=Ve(La,[["__scopeId","data-v-3bc9a8f0"]]);export{Ka as default};
