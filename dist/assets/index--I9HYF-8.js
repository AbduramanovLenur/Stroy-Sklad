import{u as J,a as X,x as Y,y as K,b as Z,c as ee,r as A,z as se,d as O,e as te,k as q,h as e,A as I,i as n,t as oe,m as c,o as i,s as P,H as l}from"./index-fb-UMc5g.js";import{a as ae,u as ne}from"./generic.services-lq4JeLDX.js";import{u as ce}from"./useQuery-jIlHzI4E.js";import{g as ie,d as le}from"./crud.services-LQy_-Czz.js";import{r as ue}from"./index-BTDL36nq.js";const re={key:0,class:"blocks"},de={class:"blocks__inner section-padding"},me={key:2,class:"empty-table shadowed"},Se={__name:"index",async setup(be){let o,_;const u=ae(),Q=J(),{t:R}=X(),U=Y(),{page:r,limit:d,search:H}=K(U),N=Z(),{user:t}=K(N),k=ee(()=>{var s,b;return!!((b=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)!=null&&b.includes(l.BLOCK.READ))}),h=A(""),p=ue(H,500),x=A([{id:1,label:"blockName",width:25},{id:2,label:"blockObject",width:25},{id:4,label:"blockFloors",width:15},{id:5,label:"blockRooms",width:15},{id:6,label:"blockAddress",width:25}]),{data:a,isLoading:z,isSuccess:m,isError:F}=([o,_]=se(()=>ce({queryKey:["blocks",{page:r,limit:d,debouncedSearch:p,organizationId:t.value.user.organizationId}],queryFn:()=>ie("building_block",r.value,d.value,p.value),enabled:k})),o=await o,_(),o),{mutate:V}=ne({mutationFn:s=>le("building_block",s),onSuccess:s=>{s!=null&&s.success&&(u.invalidateQueries({queryKey:["blocks"]}),u.invalidateQueries({queryKey:["blocksById",h]}),u.invalidateQueries({queryKey:["blocksList"]}),setTimeout(()=>Q.success(R("deleteToast")),150))}}),M=async s=>{h.value=s,V(s)};return(s,b)=>{var y,S,g,w,C,T,v,B,f,E,L,D;const j=c("HeadPage"),W=c("Table"),$=c("Pagination"),G=c("Spinner");return k.value?(i(),O("section",re,[te("div",de,[q(j,{title:"blockTitle",to:e(P).CREATE_BLOCK.path,isShowCreate:(g=(S=(y=e(t))==null?void 0:y.user)==null?void 0:S.modules)==null?void 0:g.includes(e(l).BLOCK.CREATE)},null,8,["to","isShowCreate"]),e(m)&&((w=e(a))!=null&&w.count)?(i(),I(W,{key:0,headers:x.value,table:(C=e(a))==null?void 0:C.blocks,to:e(P).UPDATE_BLOCK.name,options:{page:e(r),limit:e(d)},isShowUpdate:(B=(v=(T=e(t))==null?void 0:T.user)==null?void 0:v.modules)==null?void 0:B.includes(e(l).BLOCK.UPDATE),isShowDelete:(L=(E=(f=e(t))==null?void 0:f.user)==null?void 0:E.modules)==null?void 0:L.includes(e(l).BLOCK.DELETE),onOnActionDelete:M},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q($,{count:(D=e(a))==null?void 0:D.count,isSucces:e(m)},null,8,["count","isSucces"]),e(z)?(i(),I(G,{key:1})):n("",!0),e(m)&&!e(a).count||e(F)?(i(),O("div",me,oe(s.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{Se as default};
