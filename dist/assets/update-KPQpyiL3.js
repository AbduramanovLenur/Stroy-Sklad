import{u as ce,a as de,b as ie,y as pe,c as A,r as g,z as N,C as ye,d as b,e as D,k as he,h as a,w as _e,F as H,D as ve,B as d,i as n,A as M,l as ge,G as Ne,m,o as l,s as S,f as $,t as I,H as be,E as Me}from"./index-bESyHmKb.js";import{a as Se,u as $e}from"./crud.services-z-7dMtvc.js";import{c as Ie,b as Re}from"./manual.services-XwGTQWk9.js";import{u as Ve,r as h}from"./i18n-validators-JP3nhFWN.js";import{u as Ke}from"./generic.services-WkEajj6v.js";import{u as R}from"./useQuery-1aHXDk8s.js";import{u as Le}from"./useMutation-pOycABst.js";const qe={key:0,class:"manage section-height shadowed"},Ee={class:"manage__inner section-padding"},xe={__name:"update",async setup(ke){let s,u;const i=Ke(),V=ge(),O=Ne(),P=ce(),{t:G}=de(),z=ie(),{user:p}=pe(z),y=A(()=>{var t,c;return!!((c=(t=p==null?void 0:p.value.user)==null?void 0:t.modules)!=null&&c.includes(be.ROLE.UPDATE))}),_=g(O.params.id),o=g({id:"",shortName:"",fullName:"",roleModules:[],stateId:[]}),W=A(()=>({id:{required:h},shortName:{required:h},fullName:{required:h},stateId:{required:h}})),r=Ve(W,o),{data:f,isLoading:j,isSuccess:K}=([s,u]=N(()=>R({queryKey:["modules"],queryFn:()=>Ie(),enabled:y})),s=await s,u(),s),{data:J,isSuccess:X,isLoading:Y}=([s,u]=N(()=>R({queryKey:["states"],queryFn:()=>Re(),enabled:y})),s=await s,u(),s),Z=g([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"},{id:3,model:"stateId",label:"stateRoleLabel",placeholder:"stateRolePlaceholder",errorKey:"stateId",options:J,success:X,loading:Y,select:!0}]),{isError:ee}=([s,u]=N(()=>R({queryKey:["rolesById",_,p.value.user.fullName],queryFn:()=>Se("Role",_.value),select:t=>{o.value.id=t.id,o.value.shortName=t.shortName,o.value.fullName=t.fullName,o.value.roleModules=[...t.roleModules],o.value.stateId=[t.stateId]},enabled:y})),s=await s,u(),s);ye(ee,t=>{t&&V.push(S.ROLE.path)});const{mutate:te,status:oe}=Le({onMutate:t=>{t.stateId=t.stateId[0]},mutationFn:t=>$e("Role",t),onSuccess:t=>{t!=null&&t.success&&(o.value=Me(o.value),i.invalidateQueries({queryKey:["roles"]}),i.invalidateQueries({queryKey:["rolesById",_]}),i.invalidateQueries({queryKey:["rolesList"]}),i.invalidateQueries({queryKey:["orgUsers"]}),V.push(S.ROLE.path),setTimeout(()=>P.success(G("updateToast")),150))}}),se=()=>{if(r.value.$validate(),r.value.$errors.length)return;const t={...o.value};te(t),r.value.$reset()};return(t,c)=>{var L,q;const ae=m("ManageHead"),re=m("FormInput"),le=m("FormSelect"),ue=m("ActionsModules"),ne=m("CustomButton"),me=m("Spinner");return y.value?(l(),b("section",qe,[D("div",Ee,[he(ae,{title:"editRolesTitle",to:a(S).ROLE.path},null,8,["to"]),D("form",{class:"manage__form form-manage",onSubmit:_e(se,["prevent"])},[(l(!0),b(H,null,ve(Z.value,e=>{var E,k,B,w,F,C,U,T,Q,x;return l(),b(H,{key:e.id},[e!=null&&e.select?n("",!0):(l(),d(re,{key:0,modelValue:o.value[e.model],"onUpdate:modelValue":v=>o.value[e.model]=v,placeholder:t.$t(e.placeholder),name:e.icon,error:(k=(E=a(r))==null?void 0:E[e.errorKey])==null?void 0:k.$error,textError:(F=(w=(B=a(r))==null?void 0:B[e.errorKey])==null?void 0:w.$errors[0])==null?void 0:F.$message},{default:M(()=>[$(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(l(),d(le,{key:1,modelValue:o.value[e.model],"onUpdate:modelValue":v=>o.value[e.model]=v,modelModifiers:{trim:!0},options:e.options,error:(U=(C=a(r))==null?void 0:C[e==null?void 0:e.errorKey])==null?void 0:U.$error,placeholder:e==null?void 0:e.placeholder,textError:(x=(Q=(T=a(r))==null?void 0:T[e==null?void 0:e.errorKey])==null?void 0:Q.$errors[0])==null?void 0:x.$message,success:e.success,loading:e.loading},{default:M(()=>[$(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):n("",!0)],64)}),128)),a(K)?(l(),d(ue,{key:0,modelValue:o.value.roleModules,"onUpdate:modelValue":c[0]||(c[0]=e=>o.value.roleModules=e),actions:a(f)},null,8,["modelValue","actions"])):n("",!0),a(K)?(l(),d(ne,{key:1,className:`form__submit manage__submit ${(q=(L=a(r))==null?void 0:L.fullName.$errors[0])!=null&&q.$message?"centered":""}`,disabled:a(oe)==="pending"},{default:M(()=>[$(I(t.$t("formButton")),1)]),_:1},8,["className","disabled"])):n("",!0)],32),a(j)?(l(),d(me,{key:0})):n("",!0)])])):n("",!0)}}};export{xe as default};
