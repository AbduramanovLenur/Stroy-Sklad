import{_ as we,m as Ie,s as ze,r as u,c as $,n as v,q as l,o as d,d as S,e as C,k as b,x as _,g as q,t as f,i as r,y as N,j as L,F as R,f as U,w as Se}from"./index-WFLadlDb.js";import{u as qe,c as x,r as c}from"./secondary-functions-JSi8_BuW.js";import{u as Ne,a as V,b as F,c as Oe,d as Ke,e as $e,m as Ce,f as Le,g as Ve,h as Be,i as Me}from"./manual.services-l5GTzaNO.js";const Te={class:"company"},ke={class:"company__inner"},De={class:"company__head"},Ae={key:2,class:"empty-table"},Ee={__name:"companies",async setup(Pe){let t,i;const w=Ne(),B=Ie(),{toggleIsOpenModalForm:M}=B,{isOpenModalForm:O}=ze(B),T=u("addNewCompanyTitle"),p=u(""),I=u(""),k=$(()=>O),D=$(()=>O&&p.value=="edit"),{data:H,isSuccess:W,isLoading:j}=([t,i]=v(()=>F({queryKey:["regions"],queryFn:()=>Ce(),enabled:k})),t=await t,i(),t),{data:J,isSuccess:X,isLoading:Y}=([t,i]=v(()=>F({queryKey:["districts"],queryFn:()=>Le(),enabled:k})),t=await t,i(),t),{data:Z,isSuccess:ee,isLoading:ae}=([t,i]=v(()=>F({queryKey:["statesCompany"],queryFn:()=>Ve(),enabled:D})),t=await t,i(),t),o=u({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:"",districtId:"",stateId:"",search:""}),oe=$(()=>({fullName:{required:c},inn:{required:c},address:{required:c},phoneNumber:{required:c},director:{required:c},regionId:{required:c},districtId:{required:c}})),te=u([{id:1,label:"organizationName",width:220},{id:2,label:"organizationInn",width:115},{id:3,label:"organizationRegion",width:215},{id:4,label:"organizationDistrict",width:155},{id:5,label:"organizationAddress",width:200},{id:6,label:"organizationPhone",width:170},{id:7,label:"organizationDirector",width:245},{id:7,label:"organizationState",width:100},{id:8,label:"organizationAction",width:130}]),ne=u([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),re=u([{id:1,model:"regionId",label:"regionOrganizationLabel",options:H,errorKey:"regionId",success:W,loading:j,show:["create","edit"]},{id:2,model:"districtId",label:"districtOrganizationLabel",options:J,errorKey:"districtId",success:X,loading:Y,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:Z,success:ee,loading:ae,show:"update",show:["edit"]}]),s=qe(oe,o),{data:K,isLoading:ie,isSuccess:A}=([t,i]=v(()=>F({queryKey:["companies"],queryFn:()=>Be("organization")})),t=await t,i(),t);[t,i]=v(()=>F({queryKey:["companiesById",I],queryFn:()=>Me("organization",I.value),select:e=>{o.value.id=e.id,o.value.fullName=e.fullName,o.value.inn=e.inn,o.value.address=e.address,o.value.phoneNumber=e.phoneNumber,o.value.director=e.director,o.value.regionId=e.regionId,o.value.districtId=e.districtId,o.value.stateId=e.stateId},enabled:D})),t=await t,i();const{mutate:se}=V({mutationFn:e=>Oe("organization",e),onSuccess:()=>{w.invalidateQueries({queryKey:["companies"]})}}),{mutate:le}=V({mutationFn:e=>Ke("organization",e),onSuccess:()=>{w.invalidateQueries({queryKey:["companies"]}),w.invalidateQueries({queryKey:["getByIdCompany",I]})}}),{mutate:de}=V({mutationFn:e=>$e("organization",e),onSuccess:()=>{w.invalidateQueries({queryKey:["companies"]})}}),E=(e,n)=>{T.value=e,p.value=n,M(),p.value==="create"&&O.value&&(o.value=x(o.value),s.value.$reset())},P=(e,n)=>{if(e==="edit"&&n){I.value=n,E("editCompanyTitle","edit");return}E("addNewCompanyTitle","create")},ue=async e=>{de(e)},ce=async()=>{s.value.$validate(),!s.value.$errors.length&&(p.value==="create"?(delete o.value.id,delete o.value.stateId,se(o.value)):le(o.value),M(),o.value=x(o.value),s.value.$reset())};return(e,n)=>{const me=l("Title"),pe=l("FormSearch"),ge=l("AddButton"),ye=l("Table"),he=l("Spinner"),ve=l("FormInput"),be=l("FormSelect"),_e=l("CustomButton"),fe=l("FormModal");return d(),S("section",Te,[C("div",ke,[C("div",De,[b(me,null,{default:_(()=>[q(`\r
                    `+f(e.$t("comapnyTitle"))+`\r
                `,1)]),_:1}),b(pe,{onOnSearch:n[0]||(n[0]=m=>o.value.search=m)}),b(ge,{onOnOpenFormModal:n[1]||(n[1]=()=>P("create"))})]),r(A)&&r(K).length?(d(),N(ye,{key:0,headers:te.value,table:r(K),onOnActionEdit:n[2]||(n[2]=m=>P("edit",m)),onOnActionDelete:ue},null,8,["headers","table"])):L("",!0),r(ie)?(d(),N(he,{key:1})):L("",!0),r(A)&&!r(K).length?(d(),S("div",Ae,f(e.$t("emptyTableTitle")),1)):L("",!0)]),b(fe,{title:T.value},{default:_(()=>{var m,Q;return[C("form",{class:"company__form",onSubmit:Se(ce,["prevent"])},[(d(!0),S(R,null,U(ne.value,a=>{var g,y,h;return d(),N(ve,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":z=>o.value[a.model]=z,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(g=r(s))==null?void 0:g[a.errorKey].$error,textError:(h=(y=r(s))==null?void 0:y[a.errorKey].$errors[0])==null?void 0:h.$message},{default:_(()=>[q(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(d(!0),S(R,null,U(re.value,a=>{var g,y,h,z,G;return d(),N(be,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":Fe=>o.value[a.model]=Fe,width:500,options:a.options,error:(y=(g=r(s))==null?void 0:g[a==null?void 0:a.errorKey])==null?void 0:y.$error,textError:(G=(z=(h=r(s))==null?void 0:h[a==null?void 0:a.errorKey])==null?void 0:z.$errors[0])==null?void 0:G.$message,success:a.success,loading:a.loading,show:a==null?void 0:a.show,requestFlag:p.value},{default:_(()=>[q(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),b(_e,{className:`form__submit ${(Q=(m=r(s))==null?void 0:m.districtId.$errors[0])!=null&&Q.$message?"centered":""}`},{default:_(()=>[q(f(e.$t("formButton")),1)]),_:1},8,["className"])],32)]}),_:1},8,["title"])])}}},Ue=we(Ee,[["__scopeId","data-v-4341b64c"]]);export{Ue as default};
