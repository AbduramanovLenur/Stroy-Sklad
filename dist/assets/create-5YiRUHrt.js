import{u as W,a as X,b as Y,y as Z,c as R,r as V,z as ee,d as i,e as S,k as oe,h as t,w as te,F as k,D as ae,B as c,i as u,A as w,l as se,m as n,o as s,s as C,f as E,t as L,H as re,E as le}from"./index-O2h3gL13.js";import{u as ue,r as B}from"./i18n-validators-_nt9Rrbk.js";import{u as ne}from"./generic.services-QvSdyUz0.js";import{u as me}from"./useQuery-kkjrNxK8.js";import{u as ce}from"./useMutation-05dLsYlb.js";import{c as de}from"./crud.services-EgXNei1C.js";import{c as ie}from"./manual.services-DRl-zpgW.js";const pe={key:0,class:"manage section-height shadowed"},_e={class:"manage__inner section-padding"},$e={__name:"create",async setup(he){let m,p;const _=ne(),K=se(),T=W(),{t:q}=X(),F=Y(),{user:d}=Z(F),h=R(()=>{var e,l;return!!((l=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)!=null&&l.includes(re.ROLE.CREATE))}),a=V({shortName:"",fullName:"",roleModules:[]}),A=R(()=>({shortName:{required:B},fullName:{required:B}})),r=ue(A,a),{data:x,isLoading:H,isSuccess:y}=([m,p]=ee(()=>me({queryKey:["modules"],queryFn:()=>ie(),enabled:h})),m=await m,p(),m),Q=V([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"}]),{mutate:U,status:D}=ce({mutationFn:e=>de("Role",e),onSuccess:e=>{e!=null&&e.success&&(a.value=le(a.value),_.invalidateQueries({queryKey:["roles"]}),_.invalidateQueries({queryKey:["rolesList"]}),K.push(C.ROLE.path),setTimeout(()=>T.success(q("createToast")),150))}}),I=()=>{if(r.value.$validate(),r.value.$errors.length)return;const e={...a.value};U(e),r.value.$reset()};return(e,l)=>{var f,v;const O=n("ManageHead"),P=n("FormInput"),z=n("ActionsModules"),G=n("CustomButton"),j=n("Spinner");return h.value?(s(),i("section",pe,[S("div",_e,[oe(O,{title:"addNewRolesTitle",to:t(C).ROLE.path},null,8,["to"]),S("form",{class:"manage__form form-manage",onSubmit:te(I,["prevent"])},[(s(!0),i(k,null,ae(Q.value,o=>{var N,g,M,b,$;return s(),i(k,{key:o.id},[o!=null&&o.select?u("",!0):(s(),c(P,{key:0,modelValue:a.value[o.model],"onUpdate:modelValue":J=>a.value[o.model]=J,width:500,placeholder:e.$t(o.placeholder),name:o.icon,error:(g=(N=t(r))==null?void 0:N[o.errorKey])==null?void 0:g.$error,textError:($=(b=(M=t(r))==null?void 0:M[o.errorKey])==null?void 0:b.$errors[0])==null?void 0:$.$message},{default:w(()=>[E(L(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"]))],64)}),128)),t(y)?(s(),c(z,{key:0,modelValue:a.value.roleModules,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.roleModules=o),actions:t(x)},null,8,["modelValue","actions"])):u("",!0),t(y)?(s(),c(G,{key:1,className:`form__submit manage__submit ${(v=(f=t(r))==null?void 0:f.fullName.$errors[0])!=null&&v.$message?"centered":""}`,disabled:t(D)==="pending"},{default:w(()=>[E(L(e.$t("formButton")),1)]),_:1},8,["className","disabled"])):u("",!0)],32),t(H)?(s(),c(j,{key:0})):u("",!0)])])):u("",!0)}}};export{$e as default};
