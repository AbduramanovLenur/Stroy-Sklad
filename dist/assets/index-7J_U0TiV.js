import{s as G,x as k,b as $,c as J,r as O,y as X,d as B,e as Y,k as q,h as e,z as U,i as c,t as Z,m as r,o as u,A as z,G as p}from"./index-KKCGiaOF.js";import{a as ee,u as te}from"./generic.services-xhLq1RN3.js";import{u as ae}from"./useQuery-W7o1xA7A.js";import{g as se,d as oe}from"./crud.services-tsBZfuRX.js";import{r as ie}from"./index-ctHK_S00.js";const ne={key:0,class:"applications"},le={class:"applications__inner"},ce={key:2,class:"empty-table shadowed"},he={__name:"index",async setup(re){let i,h;const y=ee(),Q=G(),{page:d,limit:m,search:R}=k(Q),V=$(),{user:s}=k(V),A=J(()=>{var t,a;return!!((a=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&a.includes(p.APPLICATION.READ))}),I=O(""),S=ie(R,500),x=O([{id:1,label:"applicationUserName",width:190},{id:3,label:"applicationDocDate",width:230},{id:4,label:"applicationDedline",width:230},{id:5,label:"applicationObject",width:250},{id:6,label:"applicationBlock",width:250}]),{data:n,isLoading:H,isSuccess:_,isError:K}=([i,h]=X(()=>ae({queryKey:["applications",{page:d,limit:m,debouncedSearch:S,organizationId:s.value.user.organizationId,roleId:s.value.user.roleId}],queryFn:()=>se("application",d.value,m.value,S.value),select:t=>{let a={...t};return a.applications=a==null?void 0:a.applications.map(l=>{const o={...l,name:l.userName};return delete o.userName,delete o.organizationName,delete o.state,delete o.stateId,o}),a},enabled:A})),i=await i,h(),i),{mutate:F}=te({mutationFn:t=>oe("application",t),onSuccess:()=>{y.invalidateQueries({queryKey:["applications"]}),y.invalidateQueries({queryKey:["applicationsById",I]})}}),M=async t=>{I.value=t,F(t)};return(t,a)=>{var b,P,T,w,C,g,v,E,N,D,f,L;const l=r("HeadPage"),o=r("Table"),W=r("Pagination"),j=r("Spinner");return A.value?(u(),B("section",ne,[Y("div",le,[q(l,{title:"applicationTitle",to:e(z).CREATE_APPLICATION.path,isShowCreate:(T=(P=(b=e(s))==null?void 0:b.user)==null?void 0:P.modules)==null?void 0:T.includes(e(p).APPLICATION.CREATE)},null,8,["to","isShowCreate"]),e(_)&&((w=e(n))!=null&&w.count)?(u(),U(o,{key:0,headers:x.value,table:(C=e(n))==null?void 0:C.applications,to:e(z).VIEW_APPLICATION.name,options:{page:e(d),limit:e(m)},isShowEye:!0,isShowUpdate:(E=(v=(g=e(s))==null?void 0:g.user)==null?void 0:v.modules)==null?void 0:E.includes(e(p).APPLICATION.UPDATE),isShowDelete:(f=(D=(N=e(s))==null?void 0:N.user)==null?void 0:D.modules)==null?void 0:f.includes(e(p).APPLICATION.DELETE),onOnActionDelete:M},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):c("",!0),q(W,{count:(L=e(n))==null?void 0:L.count,isSucces:e(_)},null,8,["count","isSucces"]),e(H)?(u(),U(j,{key:1})):c("",!0),e(_)&&!e(n).count||e(K)?(u(),B("div",ce,Z(t.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}};export{he as default};
//# sourceMappingURL=index-7J_U0TiV.js.map
