import{u as re,a as oe,b as se,y as te,c as g,r as h,z as O,B as ne,d as I,e as B,k as L,h as t,w as ie,F,C as q,D as $,i as de,l as le,m as _,o as c,s as M,A as T,f as S,t as C,H as ue,E as ce}from"./index-xaxvmeln.js";import{u as me,r as b}from"./i18n-validators-3XDN4B9m.js";import{a as pe,u as ge}from"./generic.services-fBvasRgP.js";import{u as k}from"./useQuery-5RNqZlmw.js";import{c as he}from"./crud.services-MNtnlh6b.js";import{m as _e,a as be}from"./manual.services-fmuMEGVw.js";const ve={key:0,class:"manage section-height shadowed"},fe={class:"manage__inner section-padding"},we={__name:"create",async setup(ye){let o,m;const V=pe(),N=le();re(),oe();const R=se(),{user:v}=te(R),j=g(()=>{var a,f;return!!((f=(a=v==null?void 0:v.value.user)==null?void 0:a.modules)!=null&&f.includes(ue.OBJECT.CREATE))}),w=h(!1),r=h({name:"",address:"",regionId:[],districtId:[]}),D=g(()=>({name:{required:b},address:{required:b},regionId:{required:b},districtId:{required:b}})),s=me(D,r),{data:x,isSuccess:U,isLoading:H}=([o,m]=O(()=>k({queryKey:["regions"],queryFn:()=>_e(),enabled:j})),o=await o,m(),o),p=g(()=>r.value.regionId),P=g(()=>!!p.value.length);ne(p,()=>{w.value||(r.value.districtId=[])},{immediate:!0});const{data:Q,isSuccess:A,isLoading:J}=([o,m]=O(()=>k({queryKey:["districts",{districtId:p}],queryFn:()=>be(p.value),enabled:P})),o=await o,m(),o),G=h([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"}]),z=h([{id:1,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:x,success:U,loading:H},{id:2,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:Q,success:A,loading:J}]),{mutate:W}=ge({onMutate:a=>{w.value=!0,a.regionId=a.regionId[0],a.districtId=a.districtId[0]},mutationFn:a=>he("building_object",a),onSuccess:a=>{r.value=ce(r.value),V.invalidateQueries({queryKey:["objects"]}),V.invalidateQueries({queryKey:["objectsList"]}),N.push(M.OBJECT.path)}}),X=()=>{if(s.value.$validate(),s.value.$errors.length)return;const a={...r.value};W(a),s.value.$reset()};return(a,f)=>{var E,K;const Y=_("ManageHead"),Z=_("FormInput"),ee=_("FormSelect"),ae=_("CustomButton");return j.value?(c(),I("section",ve,[B("div",fe,[L(Y,{title:"addNewObjectTitle",to:t(M).OBJECT.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:ie(X,["prevent"])},[(c(!0),I(F,null,q(G.value,e=>{var n,i,d,l,u;return c(),T(Z,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":y=>r.value[e.model]=y,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(i=(n=t(s))==null?void 0:n[e.errorKey])==null?void 0:i.$error,textError:(u=(l=(d=t(s))==null?void 0:d[e.errorKey])==null?void 0:l.$errors[0])==null?void 0:u.$message},{default:$(()=>[S(C(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(c(!0),I(F,null,q(z.value,e=>{var n,i,d,l,u;return c(),T(ee,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":y=>r.value[e.model]=y,modelModifiers:{trim:!0},width:500,options:e.options,error:(i=(n=t(s))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:i.$error,placeholder:e==null?void 0:e.placeholder,textError:(u=(l=(d=t(s))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:l.$errors[0])==null?void 0:u.$message,success:e.success,loading:e.loading},{default:$(()=>[S(C(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(ae,{className:`form__submit ${(K=(E=t(s))==null?void 0:E.districtId.$errors[0])!=null&&K.$message?"centered":""}`},{default:$(()=>[S(C(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):de("",!0)}}};export{we as default};
