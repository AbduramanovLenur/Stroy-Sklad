import{u as H,a as K,x as L,y as M,r as S,z as O,d as w,e as R,k as T,A as F,h as t,B as v,i as m,t as C,m as s,o as c,f as $,s as N}from"./index-pq3Ws-Lw.js";import{u as U}from"./generic.services-Jxa47SEI.js";import{u as W}from"./useQuery-m-uVwu1-.js";import{u as j}from"./useMutation--Rfohlpk.js";import{g as G,d as J}from"./crud.services-NB-ZHYe_.js";import{r as X}from"./index-rXmDg-2v.js";const Y={class:"company section-height"},Z={class:"company__inner section-padding"},ee={key:2,class:"empty-table shadowed"},re={__name:"index",async setup(te){let a,p;const g=U(),A=H(),{t:P}=K(),k=L(),{page:r,limit:l,search:B}=M(k),_=S(""),y=X(B,500),D=S([{id:1,label:"organizationName",width:20},{id:2,label:"organizationInn",width:10},{id:3,label:"organizationRegion",width:15},{id:4,label:"organizationDistrict",width:15},{id:5,label:"organizationAddress",width:15},{id:6,label:"organizationPhone",width:15},{id:7,label:"organizationDirector",width:20}]),{data:o,isLoading:E,isSuccess:u,isError:I}=([a,p]=O(()=>W({queryKey:["companies",{page:r,limit:l,debouncedSearch:y}],queryFn:()=>G("organization",r.value,l.value,y.value),select:e=>{let d={...e};return d.organizations=e==null?void 0:e.organizations.map(n=>{const i={...n,company:n.organizationName};return delete i.organizationName,i}),d}})),a=await a,p(),a),{mutate:q}=j({mutationFn:e=>J("organization",e),onSuccess:async e=>{e!=null&&e.success&&(await g.invalidateQueries({queryKey:["companies"]}),await g.invalidateQueries({queryKey:["companyById",_.value.toString()]}),setTimeout(()=>A.success(P("deleteToast")),150))}}),x=e=>{_.value=e,q(e)};return(e,d)=>{var h,b,f,z;const n=s("HeadPage"),i=s("Table"),Q=s("Pagination"),V=s("Spinner");return c(),w("section",Y,[R("div",Z,[T(n,{title:"comapnyTitle",to:t(N).CREATE_COMPANIES.path},{default:F(()=>[$(C(e.$t("addButton")),1)]),_:1},8,["to"]),t(u)&&((h=t(o))!=null&&h.count)?(c(),v(i,{key:0,headers:D.value,table:(b=t(o))==null?void 0:b.organizations,to:t(N).UPDATE_COMPANIES.name,options:{page:t(r),limit:t(l)},onOnActionDelete:x},null,8,["headers","table","to","options"])):m("",!0),T(Q,{count:(f=t(o))==null?void 0:f.count,isSucces:t(u)},null,8,["count","isSucces"]),t(E)?(c(),v(V,{key:1})):m("",!0),t(u)&&!((z=t(o))!=null&&z.count)||t(I)?(c(),w("div",ee,C(e.$t("emptyTableTitle")),1)):m("",!0)])])}}};export{re as default};
