import{u as ae,a as re,b as se,s as le,c as R,r as y,x as N,A as te,d as b,e as B,k as U,h as n,w as ne,F as q,B as C,C as S,i as de,l as ue,D as me,m as g,o as p,z as w,y as M,f as $,t as E,E as ie}from"./index-YWoyi3P5.js";import{u as ce,r as l}from"./i18n-validators-MvbEOnD3.js";import{a as pe,u as he}from"./generic.services-k4FTnzsm.js";import{u as L}from"./useQuery-cUByw4Jp.js";import{a as ye,u as ge}from"./crud.services-lAAT8oXP.js";import{e as Ie,b as _e}from"./manual.services-GatovLCD.js";const fe={key:0,class:"manage section-height shadowed"},ve={class:"manage__inner section-padding"},Ke={__name:"update",async setup(Ne){let r,t;const K=pe(),V=ue(),k=me();ae(),re();const z=se(),{user:I}=le(z),h=R(()=>{var o,f;return!!((f=(o=I==null?void 0:I.value.user)==null?void 0:o.modules)!=null&&f.includes(ie.EMPLOYEES.UPDATE))}),_=y(k.params.id),a=y({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:"",roleId:[],stateId:[]}),x=R(()=>({id:{required:l},fullName:{required:l},userName:{required:l},phoneNumber:{required:l},organizationId:{required:l},roleId:{required:l},stateId:{required:l}})),s=ce(x,a),{data:T,isSuccess:G,isLoading:H}=([r,t]=N(()=>L({queryKey:["rolesList",{organizationId:a.value.organizationId}],queryFn:()=>Ie(),enabled:h})),r=await r,t(),r),{data:O,isSuccess:Q,isLoading:A}=([r,t]=N(()=>L({queryKey:["states"],queryFn:()=>_e(),enabled:h})),r=await r,t(),r),D=y([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber"}]),W=y([{id:1,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:T,success:G,loading:H},{id:2,model:"stateId",label:"employeesStateLabel",placeholder:"employeesStatePlaceholder",errorKey:"stateId",options:O,success:Q,loading:A}]),{isError:Y}=([r,t]=N(()=>L({queryKey:["orgUserById",_],queryFn:()=>ye("user",_.value),select:o=>{a.value.id=o.id,a.value.fullName=o.fullName,a.value.userName=o.userName,a.value.phoneNumber=o.phoneNumber,a.value.organizationId=o.organizationId,a.value.roleId=[o.roleId],a.value.stateId=[o.stateId]},enabled:h})),r=await r,t(),r);te(Y,o=>{o&&V.push(w.HOME.path)});const{mutate:j}=he({onMutate:o=>{o.roleId=o.roleId[0],o.stateId=o.stateId[0]},mutationFn:o=>ge("user",o),onSuccess:()=>{K.invalidateQueries({queryKey:["orgUsers"]}),K.invalidateQueries({queryKey:["orgUserById",_]}),V.push(w.ORG_USER.path)}}),J=async()=>{s.value.$validate(),!s.value.$errors.length&&(j(a.value),s.value.$reset())};return(o,f)=>{var F,P;const X=g("ManageHead"),Z=g("FormInput"),ee=g("FormSelect"),oe=g("CustomButton");return h.value?(p(),b("section",fe,[B("div",ve,[U(X,{title:"editEmployeesTitle",to:n(w).ORG_USER.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:ne(J,["prevent"])},[(p(!0),b(q,null,C(D.value,e=>{var d,u,m,i,c;return p(),M(Z,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":v=>a.value[e.model]=v,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(u=(d=n(s))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:u.$error,textError:(c=(i=(m=n(s))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message},{default:S(()=>[$(E(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(p(!0),b(q,null,C(W.value,e=>{var d,u,m,i,c;return p(),M(ee,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":v=>a.value[e.model]=v,width:500,options:e.options,error:(u=(d=n(s))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(i=(m=n(s))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:S(()=>[$(E(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),U(oe,{className:`form__submit ${(P=(F=n(s))==null?void 0:F.stateId.$errors[0])!=null&&P.$message?"centered":""}`},{default:S(()=>[$(E(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):de("",!0)}}};export{Ke as default};
//# sourceMappingURL=update-yl2yn3YD.js.map
