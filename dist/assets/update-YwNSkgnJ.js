import{u as Z,a as ee,b as ae,y as se,c as K,r as p,z as q,B as oe,d as I,e as C,k as F,h as r,w as te,F as M,C as k,D as S,i as re,l as ne,G as le,m as y,o as i,s as $,A as L,f as N,t as x,H as ue,E as de}from"./index-LDvRrg0d.js";import{u as me,r as V}from"./i18n-validators-6o0ua4sm.js";import{a as ie,u as ce}from"./generic.services-jYyLWUuf.js";import{u as P}from"./useQuery-_aY9qMb-.js";import{a as pe,u as ye}from"./crud.services-mTGUrJGu.js";import{b as he}from"./manual.services-tMzhSkka.js";const fe={key:0,class:"manage section-height shadowed"},_e={class:"manage__inner section-padding"},xe={__name:"update",async setup(ve){let o,c;const h=ie(),b=ne(),U=le();Z(),ee();const H=ae(),{user:f}=se(H),_=K(()=>{var a,g;return!!((g=(a=f==null?void 0:f.value.user)==null?void 0:a.modules)!=null&&g.includes(ue.EXPENS.UPDATE))}),v=p(U.params.id),s=p({id:"",fullName:"",stateId:[]}),Q=K(()=>({id:{required:V},fullName:{required:V},stateId:{required:V}})),t=me(Q,s),{data:T,isSuccess:D,isLoading:A}=([o,c]=q(()=>P({queryKey:["states"],queryFn:()=>he(),enabled:_})),o=await o,c(),o),R=p([{id:1,model:"fullName",label:"nameExpensesLabel",placeholder:"nameExpensesPlaceholder",icon:"input-company",errorKey:"fullName"}]),X=p([{id:1,model:"stateId",label:"stateExpensesLabel",placeholder:"stateExpensesPlaceholder",errorKey:"stateId",options:T,success:D,loading:A}]),{isError:G}=([o,c]=q(()=>P({queryKey:["expensesById",v],queryFn:()=>pe("cost",v.value),select:a=>{s.value.id=a.id,s.value.fullName=a.fullname,s.value.stateId=[a.stateId]},enabled:_})),o=await o,c(),o);oe(G,a=>{a&&b.push($.HOME.path)});const{mutate:z}=ce({onMutate:a=>{a.stateId=a.stateId[0]},mutationFn:a=>ye("cost",a),onSuccess:a=>{s.value=de(s.value),h.invalidateQueries({queryKey:["expenses"]}),h.invalidateQueries({queryKey:["expensesById",v]}),h.invalidateQueries({queryKey:["costsList"]}),b.push($.EXPENS.path)}}),O=async()=>{if(t.value.$validate(),t.value.$errors.length)return;const a={...s.value};z(a),t.value.$reset()};return(a,g)=>{var w,B;const W=y("ManageHead"),j=y("FormInput"),J=y("FormSelect"),Y=y("CustomButton");return _.value?(i(),I("section",fe,[C("div",_e,[F(W,{title:"editExpensesTitle",to:r($).EXPENS.path},null,8,["to"]),C("form",{class:"manage__form form-manage",onSubmit:te(O,["prevent"])},[(i(!0),I(M,null,k(R.value,e=>{var n,l,u,d,m;return i(),L(j,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":E=>s.value[e.model]=E,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(l=(n=r(t))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,textError:(m=(d=(u=r(t))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:d.$errors[0])==null?void 0:m.$message},{default:S(()=>[N(x(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(i(!0),I(M,null,k(X.value,e=>{var n,l,u,d,m;return i(),L(J,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":E=>s.value[e.model]=E,width:500,options:e.options,error:(l=(n=r(t))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(d=(u=r(t))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:d.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:S(()=>[N(x(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),F(Y,{className:`form__submit ${(B=(w=r(t))==null?void 0:w.stateId.$errors[0])!=null&&B.$message?"centered":""}`},{default:S(()=>[N(x(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):re("",!0)}}};export{xe as default};
