import{u as te,a as le,b as ie,s as de,c as h,r as f,x as k,A as ne,d as L,e as V,k as j,h as i,w as ce,F as N,B as q,C as F,i as ue,l as me,m as y,o as b,z as E,y as R,f as O,t as K,E as be}from"./index-YWoyi3P5.js";import{u as ge,r as t}from"./i18n-validators-MvbEOnD3.js";import{a as pe,u as he}from"./generic.services-k4FTnzsm.js";import{u as B}from"./useQuery-cUByw4Jp.js";import{c as fe}from"./crud.services-lAAT8oXP.js";import{f as ye,m as _e,a as Ie}from"./manual.services-GatovLCD.js";const ve={key:0,class:"manage section-height shadowed"},ke={class:"manage__inner section-padding"},we={__name:"create",async setup(Le){let r,l;const S=pe(),M=me();te(),le();const P=ie(),{user:g}=de(P),_=h(()=>{var o,I;return!!((I=(o=g==null?void 0:g.value.user)==null?void 0:o.modules)!=null&&I.includes(be.BLOCK.CREATE))}),$=f(!1),s=f({fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[]}),x=h(()=>({fullname:{required:t},numberOfFloors:{required:t},roomsOnFloor:{required:t},address:{required:t},buildingObjectId:{required:t},regionId:{required:t},districtId:{required:t}})),a=ge(x,s),{data:A,isSuccess:T,isLoading:U}=([r,l]=k(()=>B({queryKey:["regions"],queryFn:()=>_e(),enabled:_})),r=await r,l(),r),p=h(()=>s.value.regionId),D=h(()=>!!p.value.length);ne(p,()=>{$.value||(s.value.districtId=[])},{immediate:!0});const{data:Q,isSuccess:z,isLoading:G}=([r,l]=k(()=>B({queryKey:["districts",{districtId:p}],queryFn:()=>Ie(p.value),enabled:D})),r=await r,l(),r),{data:H,isSuccess:J,isLoading:W}=([r,l]=k(()=>B({queryKey:["objectsList",{organizationId:g.value.user.organizationId}],queryFn:()=>ye(),enabled:_})),r=await r,l(),r),X=f([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),Y=f([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:H,success:J,loading:W},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:A,success:T,loading:U},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:Q,success:z,loading:G}]),{mutate:Z}=he({onMutate:o=>{$.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.regionId=o.regionId[0],o.districtId=o.districtId[0]},mutationFn:o=>fe("building_block",o),onSuccess:()=>{S.invalidateQueries({queryKey:["blocks"]}),S.invalidateQueries({queryKey:["blocksList"]}),M.push(E.BLOCKS.path)}}),ee=()=>{a.value.$validate(),!a.value.$errors.length&&(Z(s.value),a.value.$reset())};return(o,I)=>{var w,C;const oe=y("ManageHead"),re=y("FormInput"),se=y("FormSelect"),ae=y("CustomButton");return _.value?(b(),L("section",ve,[V("div",ke,[j(oe,{title:"addNewBlocksTitle",to:i(E).BLOCKS.path},null,8,["to"]),V("form",{class:"manage__form form-manage",onSubmit:ce(ee,["prevent"])},[(b(!0),L(N,null,q(X.value,e=>{var d,n,c,u,m;return b(),R(re,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":v=>s.value[e.model]=v,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(n=(d=i(a))==null?void 0:d[e.errorKey])==null?void 0:n.$error,textError:(m=(u=(c=i(a))==null?void 0:c[e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message},{default:F(()=>[O(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(b(!0),L(N,null,q(Y.value,e=>{var d,n,c,u,m;return b(),R(se,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":v=>s.value[e.model]=v,width:500,options:e.options,error:(n=(d=i(a))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(u=(c=i(a))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:F(()=>[O(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),j(ae,{className:`form__submit ${(C=(w=i(a))==null?void 0:w.districtId.$errors[0])!=null&&C.$message?"centered":""}`},{default:F(()=>[O(K(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ue("",!0)}}};export{we as default};
//# sourceMappingURL=create-J7mz6XbN.js.map
