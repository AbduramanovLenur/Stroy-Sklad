import{u as P,a as z,b as j,y as J,c as R,r as V,z as W,d as b,e as C,k as X,h as a,w as Y,F as Z,C as ee,A as m,i as c,D as S,l as oe,m as n,o as r,s as k,f as w,t as L,G as ae}from"./index-3zRY4k0K.js";import{u as se,r as E}from"./i18n-validators-Vgt2G8bu.js";import{a as te,u as re}from"./generic.services-7FkgE6Ab.js";import{u as le}from"./useQuery-Hc257fYM.js";import{c as ne}from"./crud.services-C48a2peV.js";import{c as ue}from"./manual.services-GIE66Of4.js";const me={key:0,class:"manage section-height shadowed"},ce={class:"manage__inner section-padding"},Ne={__name:"create",async setup(de){let u,i;const p=te(),B=oe();P(),z();const K=j(),{user:d}=J(K),_=R(()=>{var o,l;return!!((l=(o=d==null?void 0:d.value.user)==null?void 0:o.modules)!=null&&l.includes(ae.ROLE.CREATE))}),s=V({shortName:"",fullName:"",roleModules:[]}),q=R(()=>({shortName:{required:E},fullName:{required:E}})),t=se(q,s),{data:F,isLoading:A,isSuccess:f}=([u,i]=W(()=>le({queryKey:["modules"],queryFn:()=>ue(),enabled:_})),u=await u,i(),u),T=V([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"}]),{mutate:x}=re({mutationFn:o=>ne("Role",o),onSuccess:o=>{p.invalidateQueries({queryKey:["roles"]}),p.invalidateQueries({queryKey:["rolesList"]}),B.push(k.ROLE.path)}}),Q=()=>{t.value.$validate(),!t.value.$errors.length&&(x(s.value),t.value.$reset())};return(o,l)=>{var h,y;const U=n("ManageHead"),H=n("FormInput"),I=n("ActionsModules"),O=n("CustomButton"),D=n("Spinner");return _.value?(r(),b("section",me,[C("div",ce,[X(U,{title:"addNewRolesTitle",to:a(k).ROLE.path},null,8,["to"]),C("form",{class:"manage__form form-manage",onSubmit:Y(Q,["prevent"])},[(r(!0),b(Z,null,ee(T.value,e=>{var N,v,g,M,$;return r(),m(H,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":G=>s.value[e.model]=G,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(v=(N=a(t))==null?void 0:N[e.errorKey])==null?void 0:v.$error,textError:($=(M=(g=a(t))==null?void 0:g[e.errorKey])==null?void 0:M.$errors[0])==null?void 0:$.$message},{default:S(()=>[w(L(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),a(f)?(r(),m(I,{key:0,modelValue:s.value.roleModules,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value.roleModules=e),actions:a(F)},null,8,["modelValue","actions"])):c("",!0),a(f)?(r(),m(O,{key:1,className:`form__submit manage__submit ${(y=(h=a(t))==null?void 0:h.fullName.$errors[0])!=null&&y.$message?"centered":""}`},{default:S(()=>[w(L(o.$t("formButton")),1)]),_:1},8,["className"])):c("",!0)],32),a(A)?(r(),m(D,{key:0})):c("",!0)])])):c("",!0)}}};export{Ne as default};
