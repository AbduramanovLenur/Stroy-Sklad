import{u as te,a as oe,r as m,c as p,z as w,B as se,d as g,e as E,k as F,h as s,w as ne,F as M,C as ie,D as h,l as ce,m as u,o as i,s as P,A as q,f as y,t as _,i as B,E as le}from"./index-qYaOSAk5.js";import{c as ue}from"./crud.services-6H1cbtzh.js";import{m as de,a as me}from"./manual.services-e5QN_9-o.js";import{u as pe,r as n}from"./i18n-validators-FA-njMbI.js";import{a as ge,u as he}from"./generic.services-uSp9rJcx.js";import{u as k}from"./useQuery-3KlBkAoQ.js";const ye={class:"manage section-height shadowed"},_e={class:"manage__inner section-padding"},Se={__name:"create",async setup(be){let t,c;const b=ge(),D=ce(),x=te(),{t:R}=oe(),v=m(!1),r=m({fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[]}),T=p(()=>({fullName:{required:n},inn:{required:n},address:{required:n},phoneNumber:{required:n},director:{required:n},regionId:{required:n},districtId:{required:n}})),o=pe(T,r),{data:A,isSuccess:Q,isLoading:U}=([t,c]=w(()=>k({queryKey:["regions"],queryFn:()=>de()})),t=await t,c(),t),l=p(()=>r.value.regionId[0]),H=p(()=>!!l.value);se(l,()=>{v.value||(r.value.districtId=[])},{immediate:!0});const{data:G,isSuccess:j,isLoading:J}=([t,c]=w(()=>k({queryKey:["districts",{districtId:l}],queryFn:()=>me(l.value),enabled:H})),t=await t,c(),t),W=m([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",type:"number"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"},{id:6,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:A,success:Q,loading:U,select:!0},{id:7,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:G,success:j,loading:J,select:!0}]),{mutate:X,status:Y}=he({onMutate:a=>{v.value=!0,a.regionId=a.regionId[0],a.districtId=a.districtId[0]},mutationFn:a=>ue("organization",a),onSuccess:a=>{a!=null&&a.success&&(r.value=le(r.value),b.invalidateQueries({queryKey:["companies"]}),b.invalidateQueries({queryKey:["organizations"]}),D.push(P.COMPANIES.path),setTimeout(()=>x.success(R("createToast")),150))}}),Z=()=>{if(o.value.$validate(),o.value.$errors.length)return;const a={...r.value};X(a),o.value.$reset()};return(a,ve)=>{var I,z;const f=u("ManageHead"),ee=u("FormInput"),ae=u("FormSelect"),re=u("CustomButton");return i(),g("section",ye,[E("div",_e,[F(f,{title:"addNewCompanyTitle",to:s(P).COMPANIES.path},null,8,["to"]),E("form",{class:"manage__form form-manage",onSubmit:ne(Z,["prevent"])},[(i(!0),g(M,null,ie(W.value,e=>{var N,$,O,K,S,V,C,L;return i(),g(M,{key:e.id},[e!=null&&e.select?B("",!0):(i(),q(ee,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":d=>r.value[e.model]=d,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(N=s(o))==null?void 0:N[e.errorKey].$error,type:e==null?void 0:e.type,textError:(O=($=s(o))==null?void 0:$[e.errorKey].$errors[0])==null?void 0:O.$message},{default:h(()=>[y(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),e!=null&&e.select?(i(),q(ae,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":d=>r.value[e.model]=d,modelModifiers:{trim:!0},width:500,options:e.options,error:(S=(K=s(o))==null?void 0:K[e==null?void 0:e.errorKey])==null?void 0:S.$error,placeholder:e==null?void 0:e.placeholder,textError:(L=(C=(V=s(o))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:C.$errors[0])==null?void 0:L.$message,success:e.success,loading:e.loading},{default:h(()=>[y(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):B("",!0)],64)}),128)),F(re,{className:`form__submit ${(z=(I=s(o))==null?void 0:I.districtId.$errors[0])!=null&&z.$message?"centered":""}`,disabled:s(Y)==="pending"},{default:h(()=>[y(_(a.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])}}};export{Se as default};
