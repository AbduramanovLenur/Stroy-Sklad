import{u as te,a as le,b as ie,y as de,c as h,r as f,z as k,B as ne,d as L,e as V,k as j,h as i,w as ce,F as N,C as q,D as F,i as ue,l as me,m as y,o as b,s as E,A as R,f as O,t as K,H as be,E as ge}from"./index-xaxvmeln.js";import{u as pe,r as t}from"./i18n-validators-3XDN4B9m.js";import{a as he,u as fe}from"./generic.services-fBvasRgP.js";import{u as B}from"./useQuery-5RNqZlmw.js";import{c as ye}from"./crud.services-MNtnlh6b.js";import{f as _e,m as ve,a as Ie}from"./manual.services-fmuMEGVw.js";const ke={key:0,class:"manage section-height shadowed"},Le={class:"manage__inner section-padding"},Ce={__name:"create",async setup(Fe){let r,l;const $=he(),M=me();te(),le();const P=ie(),{user:g}=de(P),_=h(()=>{var o,v;return!!((v=(o=g==null?void 0:g.value.user)==null?void 0:o.modules)!=null&&v.includes(be.BLOCK.CREATE))}),S=f(!1),s=f({fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[]}),D=h(()=>({fullname:{required:t},numberOfFloors:{required:t},roomsOnFloor:{required:t},address:{required:t},buildingObjectId:{required:t},regionId:{required:t},districtId:{required:t}})),a=pe(D,s),{data:x,isSuccess:A,isLoading:T}=([r,l]=k(()=>B({queryKey:["regions"],queryFn:()=>ve(),enabled:_})),r=await r,l(),r),p=h(()=>s.value.regionId),U=h(()=>!!p.value.length);ne(p,()=>{S.value||(s.value.districtId=[])},{immediate:!0});const{data:H,isSuccess:Q,isLoading:z}=([r,l]=k(()=>B({queryKey:["districts",{districtId:p}],queryFn:()=>Ie(p.value),enabled:U})),r=await r,l(),r),{data:G,isSuccess:J,isLoading:W}=([r,l]=k(()=>B({queryKey:["objectsList",{organizationId:g.value.user.organizationId}],queryFn:()=>_e(),enabled:_})),r=await r,l(),r),X=f([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),Y=f([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:G,success:J,loading:W},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:x,success:A,loading:T},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:H,success:Q,loading:z}]),{mutate:Z}=fe({onMutate:o=>{S.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.regionId=o.regionId[0],o.districtId=o.districtId[0]},mutationFn:o=>ye("building_block",o),onSuccess:o=>{s.value=ge(s.value),$.invalidateQueries({queryKey:["blocks"]}),$.invalidateQueries({queryKey:["blocksList"]}),M.push(E.BLOCK.path)}}),ee=()=>{if(a.value.$validate(),a.value.$errors.length)return;const o={...s.value};Z(o),a.value.$reset()};return(o,v)=>{var w,C;const oe=y("ManageHead"),re=y("FormInput"),se=y("FormSelect"),ae=y("CustomButton");return _.value?(b(),L("section",ke,[V("div",Le,[j(oe,{title:"addNewBlocksTitle",to:i(E).BLOCK.path},null,8,["to"]),V("form",{class:"manage__form form-manage",onSubmit:ce(ee,["prevent"])},[(b(!0),L(N,null,q(X.value,e=>{var d,n,c,u,m;return b(),R(re,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":I=>s.value[e.model]=I,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(n=(d=i(a))==null?void 0:d[e.errorKey])==null?void 0:n.$error,textError:(m=(u=(c=i(a))==null?void 0:c[e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message},{default:F(()=>[O(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(b(!0),L(N,null,q(Y.value,e=>{var d,n,c,u,m;return b(),R(se,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":I=>s.value[e.model]=I,modelModifiers:{trim:!0},width:500,options:e.options,error:(n=(d=i(a))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(u=(c=i(a))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:F(()=>[O(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),j(ae,{className:`form__submit ${(C=(w=i(a))==null?void 0:w.districtId.$errors[0])!=null&&C.$message?"centered":""}`},{default:F(()=>[O(K(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ue("",!0)}}};export{Ce as default};
