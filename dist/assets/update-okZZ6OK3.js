import{u as ge,a as Ne,r as _,c as ve,z as y,C as Ie,d as b,e as H,k as _e,h as s,w as be,F as Y,D as Re,B as m,i as d,A as h,l as Se,G as $e,m as c,o as u,s as R,f as g,t as N,E as De}from"./index-bESyHmKb.js";import{a as Me,u as Ee}from"./crud.services-z-7dMtvc.js";import{d as Le,b as Ve,c as we}from"./manual.services-XwGTQWk9.js";import{u as ze,r,m as Ke}from"./i18n-validators-JP3nhFWN.js";import{u as Pe}from"./generic.services-WkEajj6v.js";import{u as v}from"./useQuery-1aHXDk8s.js";import{u as Fe}from"./useMutation-pOycABst.js";const qe={class:"manage section-height shadowed"},ke={class:"manage__inner section-padding"},Qe={__name:"update",async setup(Be){let t,n;const S=Pe(),$=Se(),W=$e(),j=ge(),{t:J}=Ne(),I=_(W.params.id),a=_({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:[],updateRoleDto:{id:0,stateId:0,fullName:"OrgAdmin",shortName:"OrgAdmin",roleModules:[]},stateId:[]}),X=ve(()=>({id:{required:r},fullName:{required:r},userName:{required:r},password:{minLength:Ke},phoneNumber:{required:r},organizationId:{required:r},updateRoleDto:{id:{required:r},stateId:{required:r},fullName:{required:r},shortName:{required:r},roleModules:{required:r}},stateId:{required:r}})),l=ze(X,a),{data:Z,isSuccess:f,isLoading:ee}=([t,n]=y(()=>v({queryKey:["organizations"],queryFn:()=>Le()})),t=await t,n(),t),{data:oe,isSuccess:ae,isLoading:te}=([t,n]=y(()=>v({queryKey:["states"],queryFn:()=>Ve()})),t=await t,n(),t),{data:se,isLoading:re,isSuccess:D}=([t,n]=y(()=>v({queryKey:["modules"],queryFn:()=>we()})),t=await t,n(),t),le=_([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"updateRoleDto.fullName"},{id:6,model:"organizationId",label:"employeesOrganizationLabel",placeholder:"employeesOrganizationPlaceholder",errorKey:"organizationId",options:Z,success:f,loading:ee,select:!0},{id:7,model:"stateId",label:"employeesStatePlaceholder",placeholder:"employeesStatePlaceholder",errorKey:"stateId",options:oe,success:ae,loading:te,select:!0}]),{isError:ue}=([t,n]=y(()=>v({queryKey:["employeeById",I],queryFn:()=>Me("user",I.value),select:o=>{a.value.id=o.id,a.value.fullName=o.fullName,a.value.userName=o.userName,a.value.phoneNumber=o.phoneNumber,a.value.organizationId=[o.organizationId],a.value.stateId=[o.stateId],a.value.updateRoleDto.id=o.role.id,a.value.updateRoleDto.stateId=o.role.stateId,a.value.updateRoleDto.shortName=o.role.shortName,a.value.updateRoleDto.fullName=o.role.fullName,a.value.updateRoleDto.roleModules=[...o.role.roleModules]}})),t=await t,n(),t);Ie(ue,o=>{o&&$.push(R.EMPLOYEES.path)});const{mutate:ne,status:me}=Fe({onMutate:o=>{o.organizationId=o.organizationId[0],o.stateId=o.stateId[0]},mutationFn:o=>Ee("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=De(a.value),S.invalidateQueries({queryKey:["employees"]}),S.invalidateQueries({queryKey:["employeeById",I]}),$.push(R.EMPLOYEES.path),setTimeout(()=>j.success(J("updateToast")),150))}}),de=async()=>{if(a.value.updateRoleDto.shortName=a.value.updateRoleDto.fullName,l.value.$validate(),l.value.$errors.length)return;const o={...a.value};ne(o),l.value.$reset()};return(o,i)=>{var E,L;const ce=c("ManageHead"),M=c("FormInput"),pe=c("FormSelect"),ie=c("ActionsModules"),ye=c("CustomButton"),he=c("Spinner");return u(),b("section",qe,[H("div",ke,[_e(ce,{title:"editEmployeesTitle",to:s(R).EMPLOYEES.path},null,8,["to"]),H("form",{class:"manage__form form-manage",onSubmit:be(de,["prevent"])},[(u(!0),b(Y,null,Re(le.value,e=>{var V,w,z,K,P,F,q,k,B,O,C,A,U,x,T,G,Q;return u(),b(Y,{key:e.id},[!(e!=null&&e.select)&&e.model!=="updateRoleDto.fullName"?(u(),m(M,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":p=>a.value[e.model]=p,placeholder:o.$t(e.placeholder),name:e.icon,error:(w=(V=s(l))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:w.$error,type:e==null?void 0:e.type,textError:(P=(K=(z=s(l))==null?void 0:z[e==null?void 0:e.errorKey])==null?void 0:K.$errors[0])==null?void 0:P.$message},{default:h(()=>[g(N(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])):d("",!0),!(e!=null&&e.select)&&e.model==="updateRoleDto.fullName"?(u(),m(M,{key:1,modelValue:a.value.updateRoleDto.fullName,"onUpdate:modelValue":i[0]||(i[0]=p=>a.value.updateRoleDto.fullName=p),placeholder:o.$t("employeesRolePlaceholder"),name:"person",error:(k=(q=(F=s(l))==null?void 0:F.updateRoleDto)==null?void 0:q.fullName)==null?void 0:k.$error,textError:(A=(C=(O=(B=s(l))==null?void 0:B.updateRoleDto)==null?void 0:O.fullName)==null?void 0:C.$errors[0])==null?void 0:A.$message},{default:h(()=>[g(N(o.$t("employeesRoleLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"])):d("",!0),e!=null&&e.select?(u(),m(pe,{key:2,modelValue:a.value[e.model],"onUpdate:modelValue":p=>a.value[e.model]=p,modelModifiers:{trim:!0},options:e.options,error:(x=(U=s(l))==null?void 0:U[e==null?void 0:e.errorKey])==null?void 0:x.$error,placeholder:e==null?void 0:e.placeholder,textError:(Q=(G=(T=s(l))==null?void 0:T[e==null?void 0:e.errorKey])==null?void 0:G.$errors[0])==null?void 0:Q.$message,success:e.success,loading:e.loading},{default:h(()=>[g(N(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):d("",!0)],64)}),128)),s(D)?(u(),m(ie,{key:0,modelValue:a.value.updateRoleDto.roleModules,"onUpdate:modelValue":i[1]||(i[1]=e=>a.value.updateRoleDto.roleModules=e),actions:s(se)},null,8,["modelValue","actions"])):d("",!0),s(D)?(u(),m(ye,{key:1,className:`form__submit ${(L=(E=s(l))==null?void 0:E.stateId.$errors[0])!=null&&L.$message?"centered":""}`,disabled:s(me)==="pending"},{default:h(()=>[g(N(o.$t("formButton")),1)]),_:1},8,["className","disabled"])):d("",!0),s(re)?(u(),m(he,{key:2})):d("",!0)],32)])])}}};export{Qe as default};
