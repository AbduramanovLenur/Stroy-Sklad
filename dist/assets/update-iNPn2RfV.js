import{u as ie,a as ce,r as f,c as pe,z as N,B as ye,d as $,e as k,k as C,h as r,w as he,F as A,C as U,D as v,A as h,i as M,l as ge,G as fe,m as n,o as d,s as S,f as I,t as _,E as Ne}from"./index-Su5VrTfH.js";import{a as ve,u as Ie}from"./crud.services-Tdi7grz4.js";import{d as _e,b as Re,c as De}from"./manual.services-1Udrc8ye.js";import{u as be,r as t}from"./i18n-validators-2NGrV2xS.js";import{a as $e,u as Me}from"./generic.services-Bjs5T0kb.js";import{u as R}from"./useQuery-TVdyHrTE.js";const Se={class:"manage section-height shadowed"},Ve={class:"manage__inner section-padding"},qe={__name:"update",async setup(we){let l,u;const V=$e(),w=ge(),x=fe(),T=ie(),{t:G}=ce(),D=f(x.params.id),a=f({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:[],updateRoleDto:{id:0,stateId:0,fullName:"OrgAdmin",shortName:"OrgAdmin",roleModules:[]},stateId:[]}),H=pe(()=>({id:{required:t},fullName:{required:t},userName:{required:t},phoneNumber:{required:t},organizationId:{required:t},updateRoleDto:{id:{required:t},stateId:{required:t},fullName:{required:t},shortName:{required:t},roleModules:{required:t}},stateId:{required:t}})),s=be(H,a),{data:Q,isSuccess:Y,isLoading:W}=([l,u]=N(()=>R({queryKey:["organizations"],queryFn:()=>_e()})),l=await l,u(),l),{data:j,isSuccess:J,isLoading:X}=([l,u]=N(()=>R({queryKey:["states"],queryFn:()=>Re()})),l=await l,u(),l),{data:Z,isLoading:ee,isSuccess:E}=([l,u]=N(()=>R({queryKey:["modules"],queryFn:()=>De()})),l=await l,u(),l),oe=f([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"}]),ae=f([{id:1,model:"organizationId",label:"employeesOrganizationLabel",placeholder:"employeesOrganizationPlaceholder",errorKey:"organizationId",options:Q,success:Y,loading:W},{id:2,model:"stateId",label:"employeesStatePlaceholder",placeholder:"employeesStatePlaceholder",errorKey:"stateId",options:j,success:J,loading:X}]),{isError:le}=([l,u]=N(()=>R({queryKey:["employeeById",D],queryFn:()=>ve("user",D.value),select:o=>{a.value.id=o.id,a.value.fullName=o.fullName,a.value.userName=o.userName,a.value.phoneNumber=o.phoneNumber,a.value.organizationId=[o.organizationId],a.value.stateId=[o.stateId],a.value.updateRoleDto.id=o.updateRoleDto.id,a.value.updateRoleDto.stateId=o.updateRoleDto.stateId,a.value.updateRoleDto.shortName=o.updateRoleDto.shortName,a.value.updateRoleDto.fullName=o.updateRoleDto.fullName,a.value.updateRoleDto.roleModules=[...o.updateRoleDto.roleModules]}})),l=await l,u(),l);ye(le,o=>{o&&w.push(S.HOME.path)});const{mutate:re}=Me({onMutate:o=>{o.organizationId=o.organizationId[0],o.stateId=o.stateId[0]},mutationFn:o=>Ie("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=Ne(a.value),V.invalidateQueries({queryKey:["employees"]}),V.invalidateQueries({queryKey:["employeeById",D]}),w.push(S.EMPLOYEES.path),setTimeout(()=>T.success(G("updateToast")),150))}}),te=async()=>{if(a.value.updateRoleDto.shortName=a.value.updateRoleDto.fullName,s.value.$validate(),s.value.$errors.length)return;const o={...a.value};re(o),s.value.$reset()};return(o,g)=>{var z,K,P,F,q,B,O;const se=n("ManageHead"),L=n("FormInput"),ue=n("FormSelect"),de=n("ActionsModules"),ne=n("CustomButton"),me=n("Spinner");return d(),$("section",Se,[k("div",Ve,[C(se,{title:"editEmployeesTitle",to:r(S).EMPLOYEES.path},null,8,["to"]),k("form",{class:"manage__form form-manage",onSubmit:he(te,["prevent"])},[(d(!0),$(A,null,U(oe.value,e=>{var m,i,c,p,y;return d(),h(L,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":b=>a.value[e.model]=b,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(i=(m=r(s))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:i.$error,type:e==null?void 0:e.type,textError:(y=(p=(c=r(s))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:y.$message},{default:v(()=>[I(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),C(L,{modelValue:a.value.createRoleDto.fullName,"onUpdate:modelValue":g[0]||(g[0]=e=>a.value.createRoleDto.fullName=e),width:500,placeholder:o.$t("employeesRolePlaceholder"),name:"person",error:(K=(z=r(s))==null?void 0:z.createRoleDto.fullName)==null?void 0:K.$error,textError:(q=(F=(P=r(s))==null?void 0:P.createRoleDto.fullName)==null?void 0:F.$errors[0])==null?void 0:q.$message},{default:v(()=>[I(_(o.$t("employeesRoleLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),(d(!0),$(A,null,U(ae.value,e=>{var m,i,c,p,y;return d(),h(ue,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":b=>a.value[e.model]=b,modelModifiers:{trim:!0},width:500,options:e.options,error:(i=(m=r(s))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:i.$error,placeholder:e==null?void 0:e.placeholder,textError:(y=(p=(c=r(s))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:y.$message,success:e.success,loading:e.loading},{default:v(()=>[I(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),r(E)?(d(),h(de,{key:0,modelValue:a.value.updateRoleDto.roleModules,"onUpdate:modelValue":g[1]||(g[1]=e=>a.value.updateRoleDto.roleModules=e),actions:r(Z)},null,8,["modelValue","actions"])):M("",!0),r(E)?(d(),h(ne,{key:1,className:`form__submit ${(O=(B=r(s))==null?void 0:B.stateId.$errors[0])!=null&&O.$message?"centered":""}`},{default:v(()=>[I(_(o.$t("formButton")),1)]),_:1},8,["className"])):M("",!0),r(ee)?(d(),h(me,{key:2})):M("",!0)],32)])])}}};export{qe as default};
