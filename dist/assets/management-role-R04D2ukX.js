import{_ as Z,u as j,a as x,b as ee,y as oe,c as g,r as se,z as w,d,e as i,k as m,A as y,h as f,w as te,F as ae,D as ne,B as le,i as h,l as ie,m as _,o as r,f as A,t as E,s as re,H as I}from"./index-td5OKsxi.js";import{u as ue}from"./generic.services-lfCsIIL0.js";import{u as V}from"./useQuery-wqCEShPl.js";import{u as ce}from"./useMutation-td-rGYVU.js";import{k as de,l as me}from"./crud.services-f6-dtRnP.js";import{e as _e}from"./manual.services-EaI1aYj6.js";import{v as u}from"./v4-yQnnJER4.js";const pe={key:0,class:"management-role section-height shadowed"},ve={class:"management-role__inner section-padding"},ge={class:"management-role__head"},ye={class:"management-role__selects"},fe={class:"management-role__select-box"},he={class:"management-role__actions"},Ae=["onClick"],Ee=["onClick"],Ie={__name:"management-role",async setup(Me){let l,p;const M=ue();ie();const T=j(),{t:b}=x(),F=ee(),{user:t}=oe(F),k=g(()=>{var e,o;return(o=(e=t==null?void 0:t.value.user)==null?void 0:e.modules)==null?void 0:o.includes(I.MANAGEMENT_ROLE.READ)}),N=g(()=>{var e,o,s,n;return((o=(e=t==null?void 0:t.value.user)==null?void 0:e.modules)==null?void 0:o.includes(I.MANAGEMENT_ROLE.CREATE))||((n=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)==null?void 0:n.includes(I.MANAGEMENT_ROLE.UPDATE))}),a=se([{uuid:u(),roleIds:[],label:"creatorApp"},{uuid:u(),roleIds:[],label:"confirmApp"}]),{data:G,isSuccess:z,isLoading:D}=([l,p]=w(()=>V({queryKey:["rolesList",{organizationId:t.value.user.organizationId}],queryFn:()=>_e(),enabled:k})),l=await l,p(),l),{data:ke,isSuccess:K,isLoading:P}=([l,p]=w(()=>V({queryKey:["positions",{organizationId:t.value.user.organizationId}],queryFn:()=>de("application_position"),select:e=>{if(e.length)return a.value=e.map((o,s)=>{let n={};return s===0?n={id:o.id,uuid:u(),roleIds:[...o.roleIds],label:"creatorApp"}:s+1===e.length?n={id:o.id,uuid:u(),roleIds:[...o.roleIds],label:"confirmApp"}:n={id:o.id,uuid:u(),roleIds:[...o.roleIds],label:"inspectorApp"},n}),e},enabled:k})),l=await l,p(),l),Q=g(()=>z.value&&K.value),O=g(()=>D.value&&P.value),U=e=>{a.value.splice(e,0,{uuid:u(),roleIds:[],label:"inspectorApp"})},$=e=>a.value.splice(e,1),{mutate:H}=ce({onMutate:e=>{e=e.map(o=>{const s={...o};return s==null||delete s.uuid,s==null||delete s.label,s})},mutationFn:e=>me("application_position",e),onSuccess:e=>{e!=null&&e.success&&(M.invalidateQueries({queryKey:["positions"]}),M.invalidateQueries({queryKey:["applications"]}),M.invalidateQueries({queryKey:["applicationsById"]}),setTimeout(()=>T.success(b("createToast")),150))}}),J=()=>{if(a.value.some(o=>!o.roleIds.length)){T.error(b("isEmptyRole"));return}console.log(a.value),H(a.value)};return(e,o)=>{const s=_("Title"),n=_("MyButton"),W=_("FormSelect"),R=_("Icon"),X=_("CustomButton");return k.value?(r(),d("section",pe,[i("div",ve,[i("div",ge,[m(s,null,{default:y(()=>[A(`\r
                    `+E(e.$t("managementTitle"))+`\r
                `,1)]),_:1}),m(n,{to:f(re).MANAGEMENT.path,icon:"back",type:"link",color:"black"},{default:y(()=>[A(E(e.$t("backButton")),1)]),_:1},8,["to"])]),i("form",{class:"management-role__form",onSubmit:te(J,["prevent"])},[i("div",ye,[(r(!0),d(ae,null,ne(a.value,(v,c)=>{var S,C,B,L,q;return r(),d("div",{class:"management-role__select",key:v.uuid},[i("div",fe,[m(W,{modelValue:v.roleIds,"onUpdate:modelValue":Y=>v.roleIds=Y,modelModifiers:{trim:!0},options:f(G),placeholder:"managementRolePlaceholder",success:Q.value,loading:O.value,isMultiSelect:!0},{default:y(()=>[A(E(e.$t(v.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","success","loading"])]),i("div",he,[c+1!==((S=a.value)==null?void 0:S.length)&&N.value?(r(),d("div",{key:0,class:"management-role__icon",onClick:()=>U(c+1)},[m(R,{name:"plus"})],8,Ae)):h("",!0),c!==0&&c+1!==((C=a.value)==null?void 0:C.length)&&((q=(L=(B=f(t))==null?void 0:B.user)==null?void 0:L.modules)!=null&&q.includes(f(I).MANAGEMENT_ROLE.DELETE))?(r(),d("div",{key:1,class:"management-role__icon",onClick:()=>$(c)},[m(R,{name:"delete-role"})],8,Ee)):h("",!0)])])}),128))]),N.value?(r(),le(X,{key:0,className:"form__submit"},{default:y(()=>[A(E(e.$t("formButton")),1)]),_:1})):h("",!0)],32)])])):h("",!0)}}},Le=Z(Ie,[["__scopeId","data-v-1406c3a6"]]);export{Le as default};
