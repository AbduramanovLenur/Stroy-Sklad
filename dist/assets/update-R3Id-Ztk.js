import{u as oe,a as se,n as te,r as p,y as h,c as ne,x as ie,b as v,d as w,j as P,g as i,w as le,F as q,B as V,C as b,k as de,D as ue,l as y,o as g,A as z,z as B,e as N,t as O}from"./index-90cmhfpq.js";import{u as ce,r as s}from"./i18n-validators-82Vw9KIo.js";import{a as me,u as ge}from"./generic.services-UXrdyhxI.js";import{u as I}from"./useQuery-7_07upSr.js";import{a as pe,u as he}from"./crud.services-IxzF5w0J.js";import{m as ye,a as Ie,b as _e}from"./manual.services-nOcwN5Y4.js";const fe={class:"manage section-height shadowed"},ve={class:"manage__inner section-padding"},we={__name:"update",async setup(be){let a,t;const K=me(),S=de(),C=ue();oe(),se();const F=te(),{setPagePagination:E,setLimitPagination:M}=F,_=p(C.params.id),{data:k,isSuccess:x,isLoading:D}=([a,t]=h(()=>I({queryKey:["regions"],queryFn:()=>ye()})),a=await a,t(),a),{data:R,isSuccess:A,isLoading:H}=([a,t]=h(()=>I({queryKey:["districts"],queryFn:()=>Ie()})),a=await a,t(),a),{data:Q,isSuccess:T,isLoading:U}=([a,t]=h(()=>I({queryKey:["states"],queryFn:()=>_e()})),a=await a,t(),a),o=p({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[],stateId:[]}),G=ne(()=>({id:{required:s},fullName:{required:s},inn:{required:s},address:{required:s},phoneNumber:{required:s},director:{required:s},regionId:{required:s},districtId:{required:s},stateId:{required:s}})),n=ce(G,o),j=p([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),W=p([{id:1,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:k,success:x,loading:D},{id:2,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:R,success:A,loading:H},{id:3,model:"stateId",label:"stateOrganizationLabel",placeholder:"stateOrganizationPlaceholder",errorKey:"stateId",options:Q,success:T,loading:U}]),{isError:J}=([a,t]=h(()=>I({queryKey:["companiesById",_],queryFn:()=>pe("organization",_.value),select:e=>{o.value.id=e.id,o.value.fullName=e.fullName,o.value.inn=e.inn,o.value.address=e.address,o.value.phoneNumber=e.phoneNumber,o.value.director=e.director,o.value.regionId=[e==null?void 0:e.regionId],o.value.districtId=[e==null?void 0:e.districtId],o.value.stateId=[e==null?void 0:e.stateId]}})),a=await a,t(),a);ie(J,e=>{e&&S.push(z.HOME.path)});const{mutate:X}=ge({onMutate:e=>{e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>he("organization",e),onSuccess:async()=>{await K.invalidateQueries({queryKey:["companies"]}),await K.invalidateQueries({queryKey:["companiesById",_]}),E(1),M(10),S.push(z.COMPANIES.path)}}),Y=async()=>{n.value.$validate(),!n.value.$errors.length&&(X(o.value),n.value.$reset())};return(e,ze)=>{var $,L;const Z=y("ManageHead"),ee=y("FormInput"),re=y("FormSelect"),ae=y("CustomButton");return g(),v("section",fe,[w("div",ve,[P(Z,{title:"editCompanyTitle",to:i(z).COMPANIES.path},null,8,["to"]),w("form",{class:"manage__form form-manage",onSubmit:le(Y,["prevent"])},[(g(!0),v(q,null,V(j.value,r=>{var l,d,u,c,m;return g(),B(ee,{key:r.id,modelValue:o.value[r.model],"onUpdate:modelValue":f=>o.value[r.model]=f,width:500,placeholder:e.$t(r.placeholder),name:r.icon,error:(d=(l=i(n))==null?void 0:l[r==null?void 0:r.errorKey])==null?void 0:d.$error,textError:(m=(c=(u=i(n))==null?void 0:u[r==null?void 0:r.errorKey])==null?void 0:c.$errors[0])==null?void 0:m.$message},{default:b(()=>[N(O(e.$t(r.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(g(!0),v(q,null,V(W.value,r=>{var l,d,u,c,m;return g(),B(re,{key:r.id,modelValue:o.value[r.model],"onUpdate:modelValue":f=>o.value[r.model]=f,width:500,options:r.options,error:(d=(l=i(n))==null?void 0:l[r==null?void 0:r.errorKey])==null?void 0:d.$error,placeholder:r==null?void 0:r.placeholder,textError:(m=(c=(u=i(n))==null?void 0:u[r==null?void 0:r.errorKey])==null?void 0:c.$errors[0])==null?void 0:m.$message,success:r.success,loading:r.loading},{default:b(()=>[N(O(e.$t(r.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),P(ae,{className:`form__submit ${(L=($=i(n))==null?void 0:$.stateId.$errors[0])!=null&&L.$message?"centered":""}`},{default:b(()=>[N(O(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{we as default};
//# sourceMappingURL=update-R3Id-Ztk.js.map
