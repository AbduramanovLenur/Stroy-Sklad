import{_ as j,u as x,a as ee,b as te,y as se,c as d,r as oe,z as V,d as m,e as r,k as _,A as y,h as b,w as ae,F as ne,D as le,B as ie,i as h,l as re,m as p,o as u,f as A,t as E,s as ue,H as I}from"./index-O2h3gL13.js";import{u as ce}from"./generic.services-QvSdyUz0.js";import{u as F}from"./useQuery-kkjrNxK8.js";import{u as de}from"./useMutation-05dLsYlb.js";import{j as me,k as _e}from"./crud.services-EgXNei1C.js";import{e as pe}from"./manual.services-DRl-zpgW.js";import{v as c}from"./v4-yQnnJER4.js";const ve={key:0,class:"management-role section-height shadowed"},fe={class:"management-role__inner section-padding"},ge={class:"management-role__head"},ye={class:"management-role__selects"},he={class:"management-role__select-box"},Ae={class:"management-role__actions"},Ee=["onClick"],Ie=["onClick"],Me={__name:"management-role",async setup(ke){let l,v;const M=ce();re();const T=x(),{t:N}=ee(),G=te(),{user:a}=se(G),k=d(()=>{var e,s;return(s=(e=a==null?void 0:a.value.user)==null?void 0:e.modules)==null?void 0:s.includes(I.MANAGEMENT_ROLE.READ)}),S=d(()=>{var e,s,t,o;return((s=(e=a==null?void 0:a.value.user)==null?void 0:e.modules)==null?void 0:s.includes(I.MANAGEMENT_ROLE.CREATE))||((o=(t=a==null?void 0:a.value.user)==null?void 0:t.modules)==null?void 0:o.includes(I.MANAGEMENT_ROLE.UPDATE))}),n=oe([{uuid:c(),roleIds:[],label:"creatorApp"},{uuid:c(),roleIds:[],label:"confirmApp"}]),{data:z,isSuccess:D,isLoading:K}=([l,v]=V(()=>F({queryKey:["rolesList",{organizationId:a.value.user.organizationId}],queryFn:()=>pe(),enabled:k})),l=await l,v(),l),{data:Re,isSuccess:P,isLoading:Q}=([l,v]=V(()=>F({queryKey:["positions",{organizationId:a.value.user.organizationId}],queryFn:()=>me("application_position"),select:e=>{if(e.length)return n.value=e.map((s,t)=>{let o={};return t===0?o={uuid:c(),roleIds:[...s.roleIds],label:"creatorApp"}:t+1===e.length?o={uuid:c(),roleIds:[...s.roleIds],label:"confirmApp"}:o={uuid:c(),roleIds:[...s.roleIds],label:"inspectorApp"},o}),e},enabled:k})),l=await l,v(),l),O=d(()=>D.value&&P.value),U=d(()=>K.value&&Q.value),$=e=>{n.value.splice(e,0,{uuid:c(),roleIds:[],label:"inspectorApp"})},H=e=>{n.value.splice(e,1)},J=d(()=>e=>{var t;const s=n.value.reduce((o,R,f)=>(f!==e&&o.push(...R.roleIds),o),[]);return(t=z.value)==null?void 0:t.filter(o=>!s.includes(o.id))}),{mutate:W}=de({onMutate:e=>{e=e.map(s=>{const t={...s};return t==null||delete t.uuid,t==null||delete t.label,t})},mutationFn:e=>_e("application_position",e),onSuccess:e=>{e!=null&&e.success&&(M.invalidateQueries({queryKey:["positions"]}),M.invalidateQueries({queryKey:["applications"]}),M.invalidateQueries({queryKey:["applicationsById"]}),setTimeout(()=>T.success(N("createToast")),150))}}),X=()=>{if(n.value.some(s=>!s.roleIds.length)){T.error(N("isEmptyRole"));return}W(n.value)};return(e,s)=>{const t=p("Title"),o=p("MyButton"),R=p("FormSelect"),f=p("Icon"),Y=p("CustomButton");return k.value?(u(),m("section",ve,[r("div",fe,[r("div",ge,[_(t,null,{default:y(()=>[A(`\r
                    `+E(e.$t("managementTitle"))+`\r
                `,1)]),_:1}),_(o,{to:b(ue).MANAGEMENT.path,icon:"back",type:"link",color:"black"},{default:y(()=>[A(E(e.$t("backButton")),1)]),_:1},8,["to"])]),r("form",{class:"management-role__form",onSubmit:ae(X,["prevent"])},[r("div",ye,[(u(!0),m(ne,null,le(n.value,(g,i)=>{var C,B,L,w,q;return u(),m("div",{class:"management-role__select",key:g.uuid},[r("div",he,[_(R,{modelValue:g.roleIds,"onUpdate:modelValue":Z=>g.roleIds=Z,modelModifiers:{trim:!0},width:500,options:J.value(i),placeholder:"managementRolePlaceholder",success:O.value,loading:U.value,isMultiSelect:!0},{default:y(()=>[A(E(e.$t(g.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","success","loading"])]),r("div",Ae,[i+1!==((C=n.value)==null?void 0:C.length)&&S.value?(u(),m("div",{key:0,class:"management-role__icon",onClick:()=>$(i+1)},[_(f,{name:"plus"})],8,Ee)):h("",!0),i!==0&&i+1!==((B=n.value)==null?void 0:B.length)&&((q=(w=(L=b(a))==null?void 0:L.user)==null?void 0:w.modules)!=null&&q.includes(b(I).MANAGEMENT_ROLE.DELETE))?(u(),m("div",{key:1,class:"management-role__icon",onClick:()=>H(i)},[_(f,{name:"delete-role"})],8,Ie)):h("",!0)])])}),128))]),S.value?(u(),ie(Y,{key:0,className:"form__submit"},{default:y(()=>[A(E(e.$t("formButton")),1)]),_:1})):h("",!0)],32)])])):h("",!0)}}},we=j(Me,[["__scopeId","data-v-7f26cfb8"]]);export{we as default};
