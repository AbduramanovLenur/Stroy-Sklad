import{u as re,a as ue,r as I,b as ne,y as le,c as B,z as q,B as ie,d as T,e as F,k as M,h as u,w as de,F as C,C as U,D as w,i as me,l as ce,G as ye,m as g,o as y,s as $,A as k,f as E,t as b,H as pe,E as he}from"./index-LDvRrg0d.js";import{u as Ie,r as p}from"./i18n-validators-6o0ua4sm.js";import{a as qe,u as ge}from"./generic.services-jYyLWUuf.js";import{u as _}from"./useQuery-_aY9qMb-.js";import{a as _e,u as ve}from"./crud.services-mTGUrJGu.js";import{h as fe,k as Se,b as Te}from"./manual.services-tMzhSkka.js";const we={key:0,class:"manage section-height shadowed"},$e={class:"manage__inner section-padding"},Fe={__name:"update",async setup(Ee){let t,o;const K=qe(),V=ce(),H=ye();re(),ue();const v=I(H.params.id),Q=ne(),{user:h}=le(Q),n=B(()=>{var a,f;return!!((f=(a=h==null?void 0:h.value.user)==null?void 0:a.modules)!=null&&f.includes(pe.WAREHOUSE.UPDATE))}),s=I({id:"",materialId:[],quantity:"",quantityTypeId:[],stateId:[]}),A=B(()=>({id:{required:p},materialId:{required:p},quantity:{required:p},quantityTypeId:{required:p},stateId:{required:p}})),r=Ie(A,s),{data:N,isSuccess:P,isLoading:R}=([t,o]=q(()=>_({queryKey:["types"],queryFn:()=>Se(),enabled:n})),t=await t,o(),t),{data:x,isSuccess:D,isLoading:O}=([t,o]=q(()=>_({queryKey:["materialsList",{organizationId:h.value.user.organizationId}],queryFn:()=>fe(),enabled:n})),t=await t,o(),t),{data:z,isSuccess:G,isLoading:j}=([t,o]=q(()=>_({queryKey:["states"],queryFn:()=>Te(),enabled:n})),t=await t,o(),t),J=I([{id:1,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),X=I([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:x,success:D,loading:O},{id:2,model:"quantityTypeId",label:"qunatityTypesWarehouseLabel",placeholder:"qunatityTypesWarehousePlaceholder",errorKey:"quantityTypeId",options:N,success:P,loading:R},{id:3,model:"stateId",label:"stateWarehouseLabel",placeholder:"stateWarehousePlaceholder",errorKey:"stateId",options:z,success:G,loading:j}]),{isError:Y}=([t,o]=q(()=>_({queryKey:["warehouseById",v],queryFn:()=>_e("warehouse",v.value),select:a=>{s.value.id=a.id,s.value.materialId=[a.materialId],s.value.quantity=a.quantity,s.value.quantityTypeId=[a.quantityTypeId],s.value.stateId=[a.stateId]},enabled:n})),t=await t,o(),t);ie(Y,a=>{a&&V.push($.HOME.path)});const{mutate:Z}=ge({onMutate:a=>{a.materialId=a.materialId[0],a.quantityTypeId=a.quantityTypeId[0],a.stateId=a.stateId[0]},mutationFn:a=>ve("warehouse",a),onSuccess:a=>{s.value=he(s.value),K.invalidateQueries({queryKey:["warehouse"]}),K.invalidateQueries({queryKey:["warehouseById",v]}),V.push($.WAREHOUSE.path)}}),ee=async()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...s.value};Z(a),r.value.$reset()};return(a,f)=>{var L,W;const ae=g("ManageHead"),te=g("FormInput"),se=g("FormSelect"),oe=g("CustomButton");return n.value?(y(),T("section",we,[F("div",$e,[M(ae,{title:"editProductTitle",to:u($).WAREHOUSE.path},null,8,["to"]),F("form",{class:"manage__form form-manage",onSubmit:de(ee,["prevent"])},[(y(!0),T(C,null,U(J.value,e=>{var l,i,d,m,c;return y(),k(te,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":S=>s.value[e.model]=S,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(i=(l=u(r))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:i.$error,textError:(c=(m=(d=u(r))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:c.$message},{default:w(()=>[E(b(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(y(!0),T(C,null,U(X.value,e=>{var l,i,d,m,c;return y(),k(se,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":S=>s.value[e.model]=S,width:500,options:e.options,error:(i=(l=u(r))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:i.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(m=(d=u(r))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:w(()=>[E(b(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),M(oe,{className:`form__submit ${(W=(L=u(r))==null?void 0:L.stateId.$errors[0])!=null&&W.$message?"centered":""}`},{default:w(()=>[E(b(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):me("",!0)}}};export{Fe as default};
