import{u as re,a as se,r as p,b as ue,y as le,c as F,z as S,B as ne,d as q,e as W,k as L,h as u,w as de,F as U,C as H,D as w,i as ie,l as me,G as ce,m as _,o as c,s as $,A as k,f as E,t as b,H as he,E as ye}from"./index-Su5VrTfH.js";import{a as pe,u as _e}from"./crud.services-Tdi7grz4.js";import{j as ge,b as ve}from"./manual.services-1Udrc8ye.js";import{u as Ie,r as g}from"./i18n-validators-2NGrV2xS.js";import{a as fe,u as Se}from"./generic.services-Bjs5T0kb.js";import{u as V}from"./useQuery-TVdyHrTE.js";const qe={key:0,class:"manage section-height shadowed"},we={class:"manage__inner section-padding"},Ce={__name:"update",async setup($e){let t,s;const K=fe(),M=me(),T=ce(),A=re(),{t:N}=se(),v=p(T.params.id),R=ue(),{user:h}=le(R),y=F(()=>{var a,I;return!!((I=(a=h==null?void 0:h.value.user)==null?void 0:a.modules)!=null&&I.includes(he.WAREHOUSE.UPDATE))}),o=p({id:"",materialId:[],quantity:"",stateId:[]}),x=F(()=>({id:{required:g},materialId:{required:g},quantity:{required:g},stateId:{required:g}})),r=Ie(x,o),{data:P,isSuccess:D,isLoading:O}=([t,s]=S(()=>V({queryKey:["materialsList",{organizationId:h.value.user.organizationId}],queryFn:()=>ge(),enabled:y})),t=await t,s(),t),{data:Q,isSuccess:z,isLoading:G}=([t,s]=S(()=>V({queryKey:["states"],queryFn:()=>ve(),enabled:y})),t=await t,s(),t),j=p([{id:1,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),J=p([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:P,success:D,loading:O},{id:3,model:"stateId",label:"stateWarehouseLabel",placeholder:"stateWarehousePlaceholder",errorKey:"stateId",options:Q,success:z,loading:G}]),{isError:X}=([t,s]=S(()=>V({queryKey:["warehouseById",v],queryFn:()=>pe("warehouse",v.value),select:a=>{o.value.id=a.id,o.value.materialId=[a.materialId],o.value.quantity=a.quantity,o.value.stateId=[a.stateId]},enabled:y})),t=await t,s(),t);ne(X,a=>{a&&M.push($.HOME.path)});const{mutate:Y}=Se({onMutate:a=>{a.materialId=a.materialId[0],a.stateId=a.stateId[0]},mutationFn:a=>_e("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(o.value=ye(o.value),K.invalidateQueries({queryKey:["warehouse"]}),K.invalidateQueries({queryKey:["warehouseById",v]}),M.push($.WAREHOUSE.path),setTimeout(()=>A.success(N("updateToast")),150))}}),Z=async()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...o.value};Y(a),r.value.$reset()};return(a,I)=>{var B,C;const ee=_("ManageHead"),ae=_("FormInput"),te=_("FormSelect"),oe=_("CustomButton");return y.value?(c(),q("section",qe,[W("div",we,[L(ee,{title:"editProductTitle",to:u($).WAREHOUSE.path},null,8,["to"]),W("form",{class:"manage__form form-manage",onSubmit:de(Z,["prevent"])},[(c(!0),q(U,null,H(j.value,e=>{var l,n,d,i,m;return c(),k(ae,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":f=>o.value[e.model]=f,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(n=(l=u(r))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:n.$error,textError:(m=(i=(d=u(r))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:m.$message},{default:w(()=>[E(b(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(c(!0),q(U,null,H(J.value,e=>{var l,n,d,i,m;return c(),k(te,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":f=>o.value[e.model]=f,modelModifiers:{trim:!0},width:500,options:e.options,error:(n=(l=u(r))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(i=(d=u(r))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:w(()=>[E(b(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(oe,{className:`form__submit ${(C=(B=u(r))==null?void 0:B.stateId.$errors[0])!=null&&C.$message?"centered":""}`},{default:w(()=>[E(b(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ie("",!0)}}};export{Ce as default};
