import{g as J,d as Y}from"./crud.services-UNG6PI8V.js";import{u as Z,a as ee,x as se,y as A,b as te,c as ae,r as I,z as ne,d as V,e as oe,k as X,A as ie,h as e,B as L,i as c,t as R,m as l,o as d,f as ue,s as H,H as p}from"./index-oRJgEnXe.js";import{u as re}from"./generic.services-2HfgHzRB.js";import{u as ce}from"./useQuery-z22EShWF.js";import{u as le}from"./useMutation-TpRbp4qq.js";import{r as de}from"./index-9R_-BKnG.js";const pe={key:0,class:"expenses"},me={class:"expenses__inner section-padding"},ye={key:2,class:"empty-table shadowed"},Te={__name:"index",async setup(he){let u,_;const S=re(),Q=Z(),{t:z}=ee(),F=se(),{page:m,limit:y,search:K}=A(F),M=te(),{user:t}=A(M),E=ae(()=>{var s,a;return!!((a=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)!=null&&a.includes(p.EXPENS.READ))}),x=I(""),b=de(K,500),U=I([{id:1,label:"expensesObjectName",width:15},{id:2,label:"expensesBlockName",width:15},{id:3,label:"expensesFloorName",width:10},{id:5,label:"expensesMaterial",width:25},{id:6,label:"expensesCount",width:10},{id:7,label:"expensesType",width:30}]),{data:r,isLoading:O,isSuccess:h,isError:W}=([u,_]=ne(()=>ce({queryKey:["expenses",{page:m,limit:y,debouncedSearch:b,organizationId:t.value.user.organizationId,name:t.value.user.fullName}],queryFn:()=>J("expense",m.value,y.value,b.value),select:({expenses:s,count:a})=>{let n=[...s];return n=n.map(o=>{const i={...o,expensPrice:o.price,quantityTypeValue:o.quantityType};return delete i.price,delete i.quantityType,i}),{expenses:n,count:a}},enabled:E})),u=await u,_(),u),{mutate:$}=le({mutationFn:s=>Y("expense",s),onSuccess:s=>{s!=null&&s.success&&(S.invalidateQueries({queryKey:["expenses"]}),S.invalidateQueries({queryKey:["expensById",x.value.toString()]}),setTimeout(()=>Q.success(z("deleteToast")),150))}}),j=async s=>{x.value=s,$(s)};return(s,a)=>{var w,T,f,g,v,N,C,P,k,D,q,B;const n=l("HeadPage"),o=l("Table"),i=l("Pagination"),G=l("Spinner");return E.value?(d(),V("section",pe,[oe("div",me,[X(n,{title:"expensesTitle",to:e(H).CREATE_EXPENS.path,isShowCreate:(f=(T=(w=e(t))==null?void 0:w.user)==null?void 0:T.modules)==null?void 0:f.includes(e(p).EXPENS.CREATE)},{default:ie(()=>[ue(R(s.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),e(h)&&((g=e(r))!=null&&g.count)?(d(),L(o,{key:0,headers:U.value,table:(v=e(r))==null?void 0:v.expenses,to:e(H).VIEW_EXPENS.name,options:{page:e(m),limit:e(y)},isShowUpdate:(P=(C=(N=e(t))==null?void 0:N.user)==null?void 0:C.modules)==null?void 0:P.includes(e(p).EXPENS.READ),isShowDelete:(q=(D=(k=e(t))==null?void 0:k.user)==null?void 0:D.modules)==null?void 0:q.includes(e(p).EXPENS.DELETE),isShowEye:!0,onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):c("",!0),X(i,{count:(B=e(r))==null?void 0:B.count,isSucces:e(h)},null,8,["count","isSucces"]),e(O)?(d(),L(G,{key:1})):c("",!0),e(h)&&!e(r).count||e(W)?(d(),V("div",ye,R(s.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}};export{Te as default};
