import{_ as fe,u as ke,a as Se,r as c,b as Le,s as we,c as n,x as r,S as Be,A as Me,d as h,e as K,k as T,h as t,w as Ve,F as P,B as z,y,i as M,C as g,l as Ce,D as Fe,m as b,o as i,z as V,f as I,t as _,T as qe,E as je}from"./index-YWoyi3P5.js";import{a as Ae,u as H}from"./generic.services-k4FTnzsm.js";import{u as p}from"./useQuery-cUByw4Jp.js";import{a as Oe,b as Ke,e as Te}from"./crud.services-lAAT8oXP.js";import{e as Pe,f as ze,i as Ee,h as Ne,j as Re,k as De}from"./manual.services-GatovLCD.js";import{a as E}from"./secondary-functions-ph_-mLzy.js";const Ue={key:0,class:"manage section-height shadowed"},$e={class:"manage__inner section-padding"},Qe={class:"manage__overlay"},Ge={key:2,class:"manage__triggers"},He={__name:"view",async setup(We){let o,s;const f=Ae(),C=Ce(),W=Fe();ke(),Se();const m=c(W.params.id),x=Le(),{user:d}=we(x),k=n(()=>{var e,u;return!!((u=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)!=null&&u.includes(je.APPLICATION.READ))}),S=c([]),J=c([{id:1,label:"appFloor",width:215},{id:2,label:"appPrice",width:275},{id:4,label:"appMaterial",width:275},{id:5,label:"appCount",width:250},{id:3,label:"appCost"}]),l=c({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],roleIds:[],applicationTables:[],details:"",statusId:""}),{data:X,isSuccess:Y,isLoading:Z}=([o,s]=r(()=>p({queryKey:["rolesList",{organizationId:d.value.user.organizationId}],queryFn:()=>Pe(),enabled:k})),o=await o,s(),o),{data:ee,isSuccess:ae,isLoading:oe}=([o,s]=r(()=>p({queryKey:["objectsList",{organizationId:d.value.user.organizationId}],queryFn:()=>ze(),enabled:k})),o=await o,s(),o),F=n(()=>l.value.buildingObjectId),le=n(()=>!!F.value.length),{data:se,isSuccess:te,isLoading:ie}=([o,s]=r(()=>p({queryKey:["blocksList",{blockId:F}],queryFn:()=>Re(F.value),enabled:le})),o=await o,s(),o),q=n(()=>l.value.buildingBlockId),j=n(()=>!!q.value.length),{data:ne,isSuccess:N,isLoading:de}=([o,s]=r(()=>p({queryKey:["floorsList",{floorId:q}],queryFn:()=>De(q.value),enabled:j})),o=await o,s(),o),{data:ue,isSuccess:R,isLoading:ce}=([o,s]=r(()=>p({queryKey:["costsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Ee(),enabled:j})),o=await o,s(),o),{data:re,isSuccess:D,isLoading:pe}=([o,s]=r(()=>p({queryKey:["materialsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Ne(),enabled:j})),o=await o,s(),o),me=c([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),be=c([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:ee,success:ae,loading:oe},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:se,success:te,loading:ie},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:X,success:Y,loading:Z,multiple:!0}]),ve=c([{id:1,model:"details",label:"appCommentLabel",placeholder:"appCommentPlaceholder",errorKey:"details"}]),{isError:he}=([o,s]=r(()=>p({queryKey:["blocksById",m],queryFn:()=>Oe("application",m.value),select:e=>{l.value.id=e.id,l.value.deadline=e.deadline,l.value.buildingObjectId=[e.buildingObjectId],l.value.buildingBlockId=[e.buildingBlockId],l.value.roleIds=[...e.roleIds],l.value.applicationTables=[...e.applicationTables],l.value.details=e.details,l.value.statusId=e.statusId},enabled:k})),o=await o,s(),o),U=n(()=>E(ne.value||[])),$=n(()=>E(ue.value||[])),Q=n(()=>E(re.value||[]));Be(()=>{Object.keys(U.value).length&&Object.keys($.value).length&&Object.keys(Q.value).length&&l.value.applicationTables.forEach(e=>{var L,w,B;const u=(L=U.value[e.floorId])==null?void 0:L.name,A=(w=$.value[e.costId])==null?void 0:w.name,O=(B=Q.value[e.constructionMaterialId])==null?void 0:B.name;S.value.push({floorValue:u,costValue:A,constructionMaterialValue:O,count:e.count,price:e.price})})}),Me(he,e=>{e&&C.push(V.HOME.path)});const{mutate:ye}=H({mutationFn:e=>Ke("application",e),onSuccess:()=>{f.invalidateQueries({queryKey:["applications"]}),f.invalidateQueries({queryKey:["applicationsById",m]}),C.push(V.APPLICATIONS.path)}}),{mutate:ge}=H({mutationFn:e=>Te("application",e),onSuccess:()=>{f.invalidateQueries({queryKey:["applications"]}),f.invalidateQueries({queryKey:["applicationsById",m]}),C.push(V.APPLICATIONS.path)}}),Ie=()=>{ye(m.value)},_e=()=>{ge(m.value)};return(e,u)=>{const A=b("ManageHead"),O=b("FormInput"),L=b("FormSelect"),w=b("SubTable"),B=b("Spinner"),G=b("MyButton");return k.value?(i(),h("section",Ue,[K("div",$e,[T(A,{title:"addNewApplicationTitle",to:t(V).APPLICATIONS.path},null,8,["to"]),K("form",{class:"manage__form",onSubmit:u[0]||(u[0]=Ve(()=>{},["prevent"]))},[K("div",Qe,[(i(!0),h(P,null,z(me.value,a=>(i(),y(O,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":v=>l.value[a.model]=v,width:500,placeholder:e.$t(a.placeholder),name:a.icon,type:a==null?void 0:a.type,isDisabled:!0},{default:g(()=>[I(_(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),(i(!0),h(P,null,z(be.value,a=>(i(),y(L,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":v=>l.value[a.model]=v,width:500,options:a.options,placeholder:a==null?void 0:a.placeholder,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple,isDisabled:!0},{default:g(()=>[I(_(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128))]),t(R)&&t(D)&&t(N)&&S.value?(i(),y(w,{key:0,headers:J.value,table:S.value},null,8,["headers","table"])):M("",!0),t(ce)||t(pe)||t(de)||!S.value.length?(i(),y(B,{key:1})):M("",!0),(i(!0),h(P,null,z(ve.value,a=>(i(),y(qe,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":v=>l.value[a.model]=v,width:500,placeholder:e.$t(a.placeholder),isDisabled:!0},{default:g(()=>[I(_(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]))),128)),t(R)&&t(D)&&t(N)&&l.value.statusId!==7&&l.value.statusId!==15?(i(),h("div",Ge,[T(G,{icon:"approve",type:"submit",color:"green",width:180,onClick:_e},{default:g(()=>[I(_(e.$t("acceptButton")),1)]),_:1}),T(G,{icon:"refusal",type:"submit",color:"red",width:180,onClick:Ie},{default:g(()=>[I(_(e.$t("cancelButton")),1)]),_:1})])):M("",!0)],32)])])):M("",!0)}}},aa=fe(He,[["__scopeId","data-v-04124e43"]]);export{aa as default};
//# sourceMappingURL=view-GJBXgY89.js.map
