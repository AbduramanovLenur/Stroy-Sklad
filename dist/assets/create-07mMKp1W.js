import{_ as Ie,u as he,a as _e,r as _,c as i,B as be,m,o as c,d as g,e as $,t as v,F as T,C as ye,A as L,D as I,f as h,i as y,k as b,K as Qe,q as Re,b as Je,y as We,z as k,h as p,w as Xe,l as Ye,s as ge,H as Ze,J as U,E as Fe}from"./index-Znn7x0w2.js";import{u as ea,r as V}from"./i18n-validators-IvsyUnkI.js";import{a as aa,u as oa}from"./generic.services-CuHvXiDr.js";import{u as S}from"./useQuery-n34yz_OD.js";import{c as ta}from"./crud.services-oovoAPUX.js";import{f as la,g as sa,h as ra,i as na,j as ca}from"./manual.services-CtkFg6uR.js";import{v as ua}from"./v4-yQnnJER4.js";const ia={class:"application-form"},da={class:"application-form__title"},pa={class:"application-form__overlay form-manage"},ma={__name:"ApplicationForm",props:["subFields","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(C,{emit:t}){const n=he(),{t:w}=_e(),E=C,O=t,r=_({floorId:[],costId:[],constructionMaterialId:[],count:""}),P=i(()=>E.buildingBlockId);be(P,()=>{r.value.floorId=[]});const u=()=>{if(!Qe(r.value)){n.error(w("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count},O("onAddTable",r.value),r.value=Re(r.value)};return(d,M)=>{const q=m("FormInput"),l=m("FormSelect"),K=m("CustomButton");return c(),g("div",ia,[$("h4",da,v(d.$t("appInfo")),1),$("div",pa,[(c(!0),g(T,null,ye(C.subFields,e=>(c(),g(T,{key:e.id},[e!=null&&e.select?y("",!0):(c(),L(q,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":A=>r.value[e.model]=A,width:500,placeholder:d.$t(e.placeholder),name:e.icon,type:e==null?void 0:e.type},{default:I(()=>[h(v(d.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),e!=null&&e.select?(c(),L(l,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":A=>r.value[e.model]=A,modelModifiers:{trim:!0},width:500,options:e.options,placeholder:e==null?void 0:e.placeholder,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:I(()=>[h(v(d.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"])):y("",!0)],64))),128)),b(K,{className:"form__submit",type:"button",onClick:u},{default:I(()=>[h(v(d.$t("addButtonForm")),1)]),_:1})])])}}},va=Ie(ma,[["__scopeId","data-v-e46a2199"]]),ga={key:0,class:"manage section-height shadowed"},Ia={class:"manage__inner section-padding"},ha={class:"manage__overlay"},_a={key:0,class:"error"},ba={__name:"create",async setup(C){let t,n;const w=aa(),E=Ye(),O=he(),{t:r}=_e(),P=Je(),{user:u}=We(P),d=i(()=>{var a,s;return!!((s=(a=u==null?void 0:u.value.user)==null?void 0:a.modules)!=null&&s.includes(Ze.APPLICATION.CREATE))}),M=_(!1),q=_([{id:1,label:"appFloor",width:15},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:15},{id:4,label:"appPrice",width:20}]),l=_({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:""}),K=i(()=>({deadline:{required:V},buildingObjectId:{required:V},buildingBlockId:{required:V},createApplicationTables:{required:V},details:{required:V}})),e=ea(K,l),{data:A,isSuccess:Ae,isLoading:ke}=([t,n]=k(()=>S({queryKey:["objectsList",{organizationId:u.value.user.organizationId}],queryFn:()=>la(),enabled:d})),t=await t,n(),t),B=i(()=>l.value.buildingObjectId),Ve=i(()=>!!B.value.length);be(B,()=>{M.value||(l.value.buildingBlockId=[])},{immediate:!0});const{data:Se,isSuccess:$e,isLoading:Me}=([t,n]=k(()=>S({queryKey:["blocksList",{blockId:B,organizationId:u.value.user.organizationId}],queryFn:()=>sa(B.value),enabled:Ve})),t=await t,n(),t),j=i(()=>l.value.buildingBlockId),z=i(()=>!!j.value.length),{data:D,isSuccess:Be,isLoading:Te}=([t,n]=k(()=>S({queryKey:["floorsList",{floorId:j,organizationId:u.value.user.organizationId}],queryFn:()=>ra(j.value),enabled:z})),t=await t,n(),t),{data:H,isSuccess:Le,isLoading:Ce}=([t,n]=k(()=>S({queryKey:["costsList",{organizationId:u.value.user.organizationId}],queryFn:()=>na(),enabled:z})),t=await t,n(),t),{data:x,isSuccess:we,isLoading:Ee}=([t,n]=k(()=>S({queryKey:["materialsList",{organizationId:u.value.user.organizationId}],queryFn:()=>ca(),enabled:z})),t=await t,n(),t),Oe=_([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"},{id:2,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:A,success:Ae,loading:ke,select:!0},{id:3,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:Se,success:$e,loading:Me,select:!0}]),Pe=_([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:D,success:Be,loading:Te,select:!0},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:H,success:Le,loading:Ce,select:!0},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:x,success:we,loading:Ee,select:!0},{id:4,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"}]),qe=i(()=>U(D.value)),Ke=i(()=>U(H.value)),je=i(()=>U(x.value)),ze=a=>{var s;return(s=qe.value[a.floorId])==null?void 0:s.name},fe=a=>{var s;return(s=Ke.value[a.costId])==null?void 0:s.name},Ne=a=>{var s;return(s=je.value[a==null?void 0:a.constructionMaterialId])==null?void 0:s.name},Ue=a=>{l.value.createApplicationTables.push({...a,delId:ua(),floorValue:ze(a),costValue:fe(a),constructionMaterialValue:Ne(a)})},De=a=>{l.value.createApplicationTables=l.value.createApplicationTables.filter(s=>s.delId!==a)},{mutate:He}=oa({onMutate:a=>{M.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.createApplicationTables=a.createApplicationTables.map(s=>{const{delId:G,floorValue:Q,costValue:R,constructionMaterialValue:J,...f}=s;return f})},mutationFn:a=>ta("application",a),onSuccess:a=>{a!=null&&a.success&&(l.value=Fe(l.value),w.invalidateQueries({queryKey:["applications"]}),E.push(ge.APPLICATION.path),setTimeout(()=>O.success(r("createToast")),150))}}),xe=()=>{if(e.value.$validate(),e.value.$errors.length)return;const a={...l.value};He(a),e.value.$reset()};return(a,s)=>{var W,X,Y,Z,F,ee,ae,oe,te,le;const G=m("ManageHead"),Q=m("FormInput"),R=m("FormSelect"),J=m("SubTable"),f=m("FormTextarea"),Ge=m("CustomButton");return d.value?(c(),g("section",ga,[$("div",Ia,[b(G,{title:"addNewApplicationTitle",to:p(ge).APPLICATION.path},null,8,["to"]),$("form",{class:"manage__form",onSubmit:Xe(xe,["prevent"])},[$("div",ha,[(c(!0),g(T,null,ye(Oe.value,o=>{var se,re,ne,ce,ue,ie,de,pe,me,ve;return c(),g(T,{key:o.id},[o!=null&&o.select?y("",!0):(c(),L(Q,{key:0,modelValue:l.value[o.model],"onUpdate:modelValue":N=>l.value[o.model]=N,width:500,placeholder:a.$t(o.placeholder),name:o.icon,error:(re=(se=p(e))==null?void 0:se[o.errorKey])==null?void 0:re.$error,textError:(ue=(ce=(ne=p(e))==null?void 0:ne[o.errorKey])==null?void 0:ce.$errors[0])==null?void 0:ue.$message,type:o==null?void 0:o.type},{default:I(()=>[h(v(a.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])),o!=null&&o.select?(c(),L(R,{key:1,modelValue:l.value[o.model],"onUpdate:modelValue":N=>l.value[o.model]=N,modelModifiers:{trim:!0},width:500,options:o.options,error:(de=(ie=p(e))==null?void 0:ie[o==null?void 0:o.errorKey])==null?void 0:de.$error,placeholder:o==null?void 0:o.placeholder,textError:(ve=(me=(pe=p(e))==null?void 0:pe[o==null?void 0:o.errorKey])==null?void 0:me.$errors[0])==null?void 0:ve.$message,success:o.success,loading:o.loading,isMultiSelect:o==null?void 0:o.multiple},{default:I(()=>[h(v(a.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])):y("",!0)],64)}),128))]),b(va,{subFields:Pe.value,buildingBlockId:l.value.buildingBlockId,isSubmit:M.value,onOnAddTable:Ue},null,8,["subFields","buildingBlockId","isSubmit"]),(X=(W=p(e))==null?void 0:W.createApplicationTables)!=null&&X.$error?(c(),g("span",_a,v((F=(Z=(Y=p(e))==null?void 0:Y.createApplicationTables)==null?void 0:Z.$errors[0])==null?void 0:F.$message),1)):y("",!0),b(J,{headers:q.value,table:l.value.createApplicationTables,onOnActionDelete:De,isShowDelete:!0},null,8,["headers","table"]),b(f,{modelValue:l.value.details,"onUpdate:modelValue":s[0]||(s[0]=o=>l.value.details=o),modelModifiers:{trim:!0},width:500,placeholder:a.$t("appCommentPlaceholder"),error:(ae=(ee=p(e))==null?void 0:ee.details)==null?void 0:ae.$error,textError:(le=(te=(oe=p(e))==null?void 0:oe.details)==null?void 0:te.$errors[0])==null?void 0:le.$message},{default:I(()=>[h(v(a.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),b(Ge,{className:"manage__submit"},{default:I(()=>[h(v(a.$t("appButton")),1)]),_:1})],32)])])):y("",!0)}}},Ba=Ie(ba,[["__scopeId","data-v-2c967280"]]);export{Ba as default};
