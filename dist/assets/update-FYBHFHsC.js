import{u as re,a as ue,b as ne,y as ce,c as L,r as h,z as P,B as le,d as _,e as U,k as H,h as r,w as me,F as Q,C as pe,D as v,i as g,l as de,G as ie,m as c,o as u,s as E,A as D,f as I,t as S,H as ye,E as he}from"./index-8l2LyLh8.js";import{u as _e,r as $}from"./i18n-validators-Wkg5KBML.js";import{a as ve,u as ge}from"./generic.services-yETqkf3T.js";import{u as A}from"./useQuery-tdqJaMO0.js";import{a as Ee,u as Ie}from"./crud.services-BcMjcvoI.js";import{b as Se}from"./manual.services-Ls971AW1.js";const $e={key:0,class:"manage section-height shadowed"},Ne={class:"manage__inner section-padding"},Ce={__name:"update",async setup(xe){let a,n;const l=ve(),N=de(),R=ie(),X=re(),{t:G}=ue(),z=ne(),{user:m}=ce(z),p=L(()=>{var t,i;return!!((i=(t=m==null?void 0:m.value.user)==null?void 0:t.modules)!=null&&i.includes(ye.EXPENS.UPDATE))}),d=h(R.params.id),s=h({id:"",fullName:"",stateId:[]}),O=L(()=>({id:{required:$},fullName:{required:$},stateId:{required:$}})),o=_e(O,s),{data:W,isSuccess:j,isLoading:J}=([a,n]=P(()=>A({queryKey:["states"],queryFn:()=>Se(),enabled:p})),a=await a,n(),a),Y=h([{id:1,model:"fullName",label:"nameExpensesLabel",placeholder:"nameExpensesPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"stateId",label:"stateExpensesLabel",placeholder:"stateExpensesPlaceholder",errorKey:"stateId",options:W,success:j,loading:J,select:!0}]),{isError:Z}=([a,n]=P(()=>A({queryKey:["expensesById",d],queryFn:()=>Ee("cost",d.value),select:t=>{s.value.id=t.id,s.value.fullName=t.fullname,s.value.stateId=[t.stateId]},enabled:p})),a=await a,n(),a);le(Z,t=>{t&&N.push(E.HOME.path)});const{mutate:f}=ge({onMutate:t=>{t.stateId=t.stateId[0]},mutationFn:t=>Ie("cost",t),onSuccess:t=>{t!=null&&t.success&&(s.value=he(s.value),l.invalidateQueries({queryKey:["expenses"]}),l.invalidateQueries({queryKey:["expensesById",d]}),l.invalidateQueries({queryKey:["costsList"]}),N.push(E.EXPENS.path),setTimeout(()=>X.success(G("updateToast")),150))}}),ee=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const t={...s.value};f(t),o.value.$reset()};return(t,i)=>{var x,V;const te=c("ManageHead"),se=c("FormInput"),ae=c("FormSelect"),oe=c("CustomButton");return p.value?(u(),_("section",$e,[U("div",Ne,[H(te,{title:"editExpensesTitle",to:r(E).EXPENS.path},null,8,["to"]),U("form",{class:"manage__form form-manage",onSubmit:me(ee,["prevent"])},[(u(!0),_(Q,null,pe(Y.value,e=>{var b,w,B,K,q,C,F,M,k,T;return u(),_(Q,{key:e.id},[e!=null&&e.select?g("",!0):(u(),D(se,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":y=>s.value[e.model]=y,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(w=(b=r(o))==null?void 0:b[e==null?void 0:e.errorKey])==null?void 0:w.$error,textError:(q=(K=(B=r(o))==null?void 0:B[e==null?void 0:e.errorKey])==null?void 0:K.$errors[0])==null?void 0:q.$message},{default:v(()=>[I(S(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(u(),D(ae,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":y=>s.value[e.model]=y,modelModifiers:{trim:!0},width:500,options:e.options,error:(F=(C=r(o))==null?void 0:C[e==null?void 0:e.errorKey])==null?void 0:F.$error,placeholder:e==null?void 0:e.placeholder,textError:(T=(k=(M=r(o))==null?void 0:M[e==null?void 0:e.errorKey])==null?void 0:k.$errors[0])==null?void 0:T.$message,success:e.success,loading:e.loading},{default:v(()=>[I(S(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):g("",!0)],64)}),128)),H(oe,{className:`form__submit ${(V=(x=r(o))==null?void 0:x.stateId.$errors[0])!=null&&V.$message?"centered":""}`},{default:v(()=>[I(S(t.$t("formButton")),1)]),_:1},8,["className"])],32)])])):g("",!0)}}};export{Ce as default};
