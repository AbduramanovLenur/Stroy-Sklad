{"version":3,"file":"management-role-s9Tw7HmX.js","sources":["../../src/views/management-role.vue"],"sourcesContent":["<template>\r\n    <section class=\"management-role section-height shadowed\" v-if=\"isShow\">\r\n        <div class=\"management-role__inner section-padding\">\r\n            <div class=\"management-role__head\">\r\n                <Title>\r\n                    {{ $t(\"managementTitle\") }}\r\n                </Title>\r\n                <MyButton \r\n                    :to=\"routes.MANAGEMENT.path\" \r\n                    icon=\"back\" \r\n                    type=\"link\" \r\n                    color=\"black\"\r\n                >\r\n                    {{ $t(\"backButton\") }}\r\n                </MyButton>\r\n            </div>\r\n            <form class=\"management-role__form\" @submit.prevent=\"submitHandler\">\r\n                <div class=\"management-role__selects\">\r\n                    <div \r\n                        class=\"management-role__select\" \r\n                        v-for=\"(select, index) in state\"\r\n                        :key=\"select.uuid\"\r\n                    >\r\n                        <div class=\"management-role__select-box\">\r\n                            <FormSelect \r\n                                v-model=\"select.roleIds\" \r\n                                :width=\"500\" \r\n                                :options=\"filteredRoles(index)\"\r\n                                placeholder=\"managementRolePlaceholder\"\r\n                                :success=\"isSuccess\"\r\n                                :loading=\"isLoading\"\r\n                                :isMultiSelect=\"true\"\r\n                            >\r\n                                {{ $t(select.label) }}\r\n                            </FormSelect>\r\n                        </div>\r\n                        <div class=\"management-role__actions\">\r\n                            <div\r\n                                v-if=\"index + 1 !== state?.length\" \r\n                                class=\"management-role__icon\"\r\n                                @click=\"() => addItem(index + 1)\"\r\n                            >\r\n                                <Icon name=\"plus\" />\r\n                            </div>\r\n                            <div\r\n                                v-if=\"index !== 0 && index + 1 !== state?.length\" \r\n                                class=\"management-role__icon\"\r\n                                @click=\"() => deleteItem(index)\"\r\n                            >\r\n                                <Icon name=\"delete-role\" />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <CustomButton className=\"form__submit\">\r\n                    {{ $t(\"formButton\") }}\r\n                </CustomButton>\r\n            </form>\r\n        </div>\r\n    </section>\r\n</template>\r\n\r\n<script setup>\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport { ref, computed, watch } from \"vue\";\r\nimport { useRouter } from \"vue-router\";\r\nimport { useToast } from \"vue-toastification\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { useUserStore } from \"@/store/userStore\";\r\nimport { useI18n } from \"vue-i18n\";\r\nimport { \r\n    useQueryClient, \r\n    useQuery, \r\n    useMutation \r\n} from \"@tanstack/vue-query\";\r\nimport { getAll, createPositionRoles } from \"@/services/crud.services.js\";\r\nimport { manualGetRoles } from \"@/services/manual.services.js\";\r\nimport { routes } from \"@/utils/routes.js\";\r\nimport { actionModules } from \"@/utils/action-modules.js\";\r\n\r\nconst queryClient = useQueryClient();\r\nconst router = useRouter();\r\nconst toast = useToast();\r\nconst { t } = useI18n();\r\n\r\nconst userStore = useUserStore();\r\nconst { user } = storeToRefs(userStore);\r\n\r\nconst isShow = computed(() => !!user?.value.user?.modules?.includes(actionModules.MANAGEMENT_ROLE.CREATE));\r\n\r\nconst state = ref([\r\n    { uuid: uuidv4(), roleIds: [], label: \"creatorApp\" },\r\n    { uuid: uuidv4(), roleIds: [], label: \"confirmApp\" }\r\n]);\r\n\r\nconst {\r\n    data: roles,\r\n    isSuccess: isSuccessRoles,\r\n    isLoading: isLoadingRoles\r\n} = await useQuery({\r\n    queryKey: [\"rolesList\", { organizationId: user.value.user.organizationId }],\r\n    queryFn: () => manualGetRoles(),\r\n    enabled: isShow\r\n});\r\n\r\nconst {\r\n    data: positions,\r\n    isSuccess: isSuccessPositions,\r\n    isLoading: isLoadingPositions\r\n} = await useQuery({\r\n    queryKey: [\"positions\", { organizationId: user.value.user.organizationId }],\r\n    queryFn: () => getAll(\"application_position\"),\r\n    select: (data) => {\r\n        if (!data.length) return;\r\n        \r\n        state.value = data.map((elem, index) => {\r\n            let object = {};\r\n\r\n            if (index === 0) {\r\n                object = { uuid: uuidv4(), roleIds: [...elem.roleIds], label: \"creatorApp\" }\r\n            } else if (index + 1 === data.length) {\r\n                object = { uuid: uuidv4(), roleIds: [...elem.roleIds], label: \"confirmApp\" }\r\n            } else {\r\n                object = { uuid: uuidv4(), roleIds: [...elem.roleIds], label: \"inspectorApp\" }\r\n            }\r\n\r\n            return object;\r\n        });\r\n\r\n        return data;\r\n    },\r\n    enabled: isShow\r\n});\r\n\r\nconst isSuccess = computed(() => isSuccessRoles.value && isSuccessPositions.value);\r\nconst isLoading = computed(() => isLoadingRoles.value && isLoadingPositions.value);\r\n\r\nconst addItem = (idx) => {\r\n    state.value.splice(idx, 0, { uuid: uuidv4(), roleIds: [], label: \"inspectorApp\" });\r\n}\r\n\r\nconst deleteItem = (idx) => {\r\n    state.value.splice(idx, 1);\r\n}\r\n\r\nconst filteredRoles = computed(() => {\r\n    return (index) => {\r\n        const usedRoles = state.value.reduce((acc, cur, idx) => {\r\n            if (idx !== index) {\r\n                acc.push(...cur.roleIds);\r\n            }\r\n            return acc;\r\n        }, []);\r\n\r\n        return roles.value?.filter(role => !usedRoles.includes(role.id));\r\n    }\r\n})\r\n\r\nconst { mutate: createMutate } = useMutation({\r\n    onMutate: (body) => {\r\n        body = body.map((elem) => {\r\n            const object = { ...elem };\r\n\r\n            delete object?.uuid;\r\n            delete object?.label;\r\n\r\n            return object;\r\n        });\r\n    },\r\n    mutationFn: (body) => createPositionRoles(\"application_position\", body),\r\n    onSuccess: () => {\r\n        queryClient.invalidateQueries({ queryKey: [\"positions\"] });\r\n        queryClient.invalidateQueries({ queryKey: [\"applications\"] });\r\n        queryClient.invalidateQueries({ queryKey: [\"applicationsById\"] });\r\n    }\r\n});\r\n\r\nconst submitHandler = () => {\r\n    const isEmptyArray = state.value.some((value) => !value.roleIds.length)\r\n\r\n    if (isEmptyArray) {\r\n        toast.error(t(\"isEmptyRole\"))\r\n        return;\r\n    }\r\n\r\n    createMutate(state.value);\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.management-role {\r\n    &__head {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        gap: 50px;\r\n        @media (max-width: 900px) {\r\n            flex-direction: column;\r\n            align-items: flex-start;\r\n            gap: 15px;\r\n        }\r\n    }\r\n    &__form {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 50px;\r\n        max-width: 585px;\r\n        width: 100%;\r\n        margin: 0 auto;\r\n        @media (max-width: 900px) {\r\n            max-width: 500px;\r\n        }\r\n    }\r\n    &__selects {\r\n        display: flex;\r\n        flex-direction: column;\r\n        width: 100%;\r\n        gap: 60px;\r\n        margin-top: 50px;\r\n    }\r\n    &__select {\r\n        display: flex;\r\n        gap: 15px;\r\n        width: 100%;\r\n        &-box {\r\n            position: relative;\r\n            max-width: 500px;\r\n            width: 100%;\r\n        }\r\n        @media (max-width: 900px) {\r\n            flex-direction: column;\r\n        }\r\n        &:not(:last-child) {\r\n            .management-role__select-box {\r\n                &::after {\r\n                    content: \"\";\r\n                    position: absolute;\r\n                    bottom: -65px;\r\n                    left: 50%;\r\n                    transform: translateX(-50%);\r\n                    background-image: url(\"@/assets/images/icons/arrow-down.svg\");\r\n                    background-position: center;\r\n                    background-repeat: no-repeat;\r\n                    background-size: cover;\r\n                    height: 50px;\r\n                    width: 30px;\r\n                    @media (max-width: 900px) {\r\n                        bottom: -95px;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    &__actions {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 15px;\r\n        @media (max-width: 900px) {\r\n            justify-content: space-between;\r\n        }\r\n    }\r\n    &__icon {\r\n        display: flex;\r\n        align-items: center;\r\n        margin-top: 30px;\r\n        @media (max-width: 900px) {\r\n            margin-top: 0;\r\n        }\r\n    }\r\n}\r\n</style>"],"names":["queryClient","useQueryClient","useRouter","toast","useToast","t","useI18n","userStore","useUserStore","user","storeToRefs","isShow","computed","_b","_a","actionModules","state","ref","uuidv4","roles","isSuccessRoles","isLoadingRoles","__temp","__restore","_withAsyncContext","useQuery","manualGetRoles","positions","isSuccessPositions","isLoadingPositions","getAll","data","elem","index","object","isSuccess","isLoading","addItem","idx","deleteItem","filteredRoles","usedRoles","acc","cur","role","createMutate","useMutation","body","createPositionRoles","submitHandler","value"],"mappings":"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"}