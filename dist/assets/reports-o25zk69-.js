import{l as q,m as A}from"./crud.services-hTqnJzib.js";import{_ as D,u as V,a as j,b as z,y as F,c as M,z as $,d as p,e as c,k as v,A as P,h as t,t as m,i as r,B as R,m as d,o as l,f as Q,H as g}from"./index-Jh8odxSe.js";import{u as W}from"./useQuery-fi5W9yeG.js";import{u as H}from"./useMutation-1M3f9r5N.js";import"./generic.services-MgMdmGEE.js";const K={key:0,class:"reports"},G={class:"reports__inner"},J={class:"reports__head shadowed"},X={class:"reports__download-icon"},Y={class:"reports__download-value"},Z={key:2,class:"empty-table shadowed"},ee={__name:"reports",async setup(te){let i,_;const x=V(),{t:B}=j(),L=z(),{user:n}=F(L),h=M(()=>{var e,o;return!!((o=(e=n==null?void 0:n.value.user)==null?void 0:e.modules)!=null&&o.includes(g.REPORTS.READ))}),C=[{id:1,label:"reportsMaterial",width:20},{id:2,label:"reportsQuantity",width:10},{id:3,label:"reportsObyekt",width:20},{id:4,label:"reportsBlock",width:20},{id:5,label:"reportsFloor",width:10},{id:6,label:"reportsBudget",width:20}],{data:u,isLoading:E,isSuccess:w,isError:O}=([i,_]=$(()=>W({queryKey:["reports",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>q(),select:e=>e.map(o=>{const s={...o,quantityTypeValue:o.quantityType};return delete s.quantityType,s}),enabled:h})),i=await i,_(),i),{mutate:y}=H({mutationFn:()=>A(),onSuccess:e=>{if(!(e!=null&&e.success))return;const o=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.setAttribute("download","filename.xlsx"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),setTimeout(()=>x.success(B("downloadToast")),150)}});return(e,o)=>{var b,f,T,k,S;const s=d("Title"),a=d("Icon"),I=d("Table"),N=d("Spinner");return h.value?(l(),p("section",K,[c("div",G,[c("div",J,[v(s,null,{default:P(()=>[Q(`\r
                    `+m(e.$t("reportsTitle"))+`\r
                `,1)]),_:1}),(T=(f=(b=t(n))==null?void 0:b.user)==null?void 0:f.modules)!=null&&T.includes(t(g).REPORTS.DOWNLOAD)?(l(),p("button",{key:0,class:"reports__download hovered",type:"button",onClick:o[0]||(o[0]=(...U)=>t(y)&&t(y)(...U))},[c("span",X,[v(a,{name:"download"})]),c("span",Y,m(e.$t("downloadLink")),1)])):r("",!0)]),t(w)&&((k=t(u))!=null&&k.length)?(l(),R(I,{key:0,headers:C,table:t(u),isShowUpdate:!1,isShowDelete:!1,isShowState:!1},null,8,["table"])):r("",!0),t(E)?(l(),R(N,{key:1})):r("",!0),t(w)&&!((S=t(u))!=null&&S.length)||t(O)?(l(),p("div",Z,m(e.$t("emptyTableTitle")),1)):r("",!0)])])):r("",!0)}}},le=D(ee,[["__scopeId","data-v-a9010123"]]);export{le as default};
