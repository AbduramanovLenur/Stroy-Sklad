import{u as re,a as te,b as le,y as ue,c as F,r as f,z as b,B as ne,d as I,e as C,k as de,h as r,w as me,F as U,C as x,A as y,i as v,D as V,l as ie,E as ce,m as n,o as l,s as R,f as K,t as w,G as pe}from"./index-3zRY4k0K.js";import{u as he,r as g}from"./i18n-validators-Vgt2G8bu.js";import{a as ye,u as _e}from"./generic.services-7FkgE6Ab.js";import{u as E}from"./useQuery-Hc257fYM.js";import{a as fe,u as ve}from"./crud.services-C48a2peV.js";import{c as ge,b as Ne}from"./manual.services-GIE66Of4.js";const Me={key:0,class:"manage section-height shadowed"},Se={class:"manage__inner section-padding"},Ee={__name:"update",async setup($e){let s,u;const N=ye(),L=ie(),A=ce();re(),te();const Q=le(),{user:M}=ue(Q),_=F(()=>{var o,d;return!!((d=(o=M==null?void 0:M.value.user)==null?void 0:o.modules)!=null&&d.includes(pe.ROLE.UPDATE))}),S=f(A.params.id),a=f({id:"",shortName:"",fullName:"",roleModules:[],stateId:[]}),T=F(()=>({id:{required:g},shortName:{required:g},fullName:{required:g},stateId:{required:g}})),t=he(T,a),{data:H,isLoading:O,isSuccess:q}=([s,u]=b(()=>E({queryKey:["modules"],queryFn:()=>ge(),enabled:_})),s=await s,u(),s),{data:P,isSuccess:D,isLoading:G}=([s,u]=b(()=>E({queryKey:["states"],queryFn:()=>Ne(),enabled:_})),s=await s,u(),s),z=f([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"}]),W=f([{id:1,model:"stateId",label:"stateRoleLabel",placeholder:"stateRolePlaceholder",errorKey:"stateId",options:P,success:D,loading:G}]),{isError:j}=([s,u]=b(()=>E({queryKey:["rolesById",S],queryFn:()=>fe("Role",S.value),select:o=>{a.value.id=o.id,a.value.shortName=o.shortName,a.value.fullName=o.fullName,a.value.roleModules=[...o.roleModules],a.value.stateId=[o.stateId]},enabled:_})),s=await s,u(),s);ne(j,o=>{o&&L.push(R.HOME.path)});const{mutate:J}=_e({onMutate:o=>{o.stateId=o.stateId[0]},mutationFn:o=>ve("Role",o),onSuccess:o=>{N.invalidateQueries({queryKey:["roles"]}),N.invalidateQueries({queryKey:["rolesById",S]}),N.invalidateQueries({queryKey:["rolesList"]}),L.push(R.ROLE.path)}}),X=()=>{t.value.$validate(),!t.value.$errors.length&&(J(a.value),t.value.$reset())};return(o,d)=>{var B,k;const Y=n("ManageHead"),Z=n("FormInput"),ee=n("FormSelect"),oe=n("ActionsModules"),ae=n("CustomButton"),se=n("Spinner");return _.value?(l(),I("section",Me,[C("div",Se,[de(Y,{title:"editRolesTitle",to:r(R).ROLE.path},null,8,["to"]),C("form",{class:"manage__form form-manage",onSubmit:me(X,["prevent"])},[(l(!0),I(U,null,x(z.value,e=>{var m,i,c,p,h;return l(),y(Z,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":$=>a.value[e.model]=$,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(i=(m=r(t))==null?void 0:m[e.errorKey])==null?void 0:i.$error,textError:(h=(p=(c=r(t))==null?void 0:c[e.errorKey])==null?void 0:p.$errors[0])==null?void 0:h.$message},{default:V(()=>[K(w(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(l(!0),I(U,null,x(W.value,e=>{var m,i,c,p,h;return l(),y(ee,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":$=>a.value[e.model]=$,width:500,options:e.options,error:(i=(m=r(t))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:i.$error,placeholder:e==null?void 0:e.placeholder,textError:(h=(p=(c=r(t))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:h.$message,success:e.success,loading:e.loading},{default:V(()=>[K(w(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),r(q)?(l(),y(oe,{key:0,modelValue:a.value.roleModules,"onUpdate:modelValue":d[0]||(d[0]=e=>a.value.roleModules=e),actions:r(H)},null,8,["modelValue","actions"])):v("",!0),r(q)?(l(),y(ae,{key:1,className:`form__submit manage__submit ${(k=(B=r(t))==null?void 0:B.fullName.$errors[0])!=null&&k.$message?"centered":""}`},{default:V(()=>[K(w(o.$t("formButton")),1)]),_:1},8,["className"])):v("",!0)],32),r(O)?(l(),y(se,{key:0})):v("",!0)])])):v("",!0)}}};export{Ee as default};
