import{u as pe,a as ge,r as i,z as d,c as b,y as F,d as S,e as j,k as q,h as I,w as be,F as w,C as M,D as B,l as Ie,m as v,o as h,B as C,A as $,f as A,t as K}from"./index-qZ69CyC7.js";import{u as he,r}from"./i18n-validators-dGSGbQKY.js";import{a as ye,u as fe}from"./generic.services-34GP1Yc8.js";import{u as n}from"./useQuery-IZNqF3Xo.js";import{c as ve}from"./crud.services-qYEmjzHd.js";import{i as _e,h as ke,d as Le,f as Se,j as Be,k as Ae}from"./manual.services-BxKPmsPu.js";const Ke={class:"manage section-height shadowed"},Fe={class:"manage__inner section-padding"},Pe={__name:"create",async setup(je){let o,s;const O=ye(),V=Ie();pe(),ge();const _=i(localStorage.getItem("organizationId")),P=i(localStorage.getItem("id")),k=i(!1),l=i({userId:P.value,deadline:"",constructionMaterialIds:[],buildingObjectId:[],buildingBlockId:[],floorId:[],costId:[],roleIds:[]}),{data:E,isSuccess:N,isLoading:R}=([o,s]=d(()=>n({queryKey:["costs",{organizationId:_}],queryFn:()=>_e()})),o=await o,s(),o),{data:x,isSuccess:G,isLoading:T}=([o,s]=d(()=>n({queryKey:["materials",{organizationId:_}],queryFn:()=>ke()})),o=await o,s(),o),{data:U,isSuccess:z,isLoading:H}=([o,s]=d(()=>n({queryKey:["roles"],queryFn:()=>Le()})),o=await o,s(),o),{data:Q,isSuccess:D,isLoading:J}=([o,s]=d(()=>n({queryKey:["objectsList",{organizationId:_}],queryFn:()=>Se()})),o=await o,s(),o),y=b(()=>l.value.buildingObjectId),W=b(()=>!!y.value.length);F(y,()=>{k.value||(l.value.buildingBlockId=[])},{immediate:!0});const{data:X,isSuccess:Y,isLoading:Z}=([o,s]=d(()=>n({queryKey:["blocksList",{blockId:y}],queryFn:()=>Be(y.value),enabled:W})),o=await o,s(),o),f=b(()=>l.value.buildingBlockId),ee=b(()=>!!f.value.length);F(f,()=>{k.value||(l.value.floorId=[])},{immediate:!0});const{data:oe,isSuccess:ae,isLoading:se}=([o,s]=d(()=>n({queryKey:["floors",{floorId:f}],queryFn:()=>Ae(f.value),enabled:ee})),o=await o,s(),o),le=b(()=>({userId:{required:r},deadline:{required:r},constructionMaterialIds:{required:r},buildingObjectId:{required:r},buildingBlockId:{required:r},floorId:{required:r},costId:{required:r},roleIds:{required:r}})),t=he(le,l),re=i([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),te=i([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:Q,success:D,loading:J},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:X,success:Y,loading:Z},{id:3,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",errorKey:"floorId",options:oe,success:ae,loading:se},{id:4,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",errorKey:"costId",options:E,success:N,loading:R},{id:5,model:"constructionMaterialIds",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",errorKey:"constructionMaterialIds",options:x,success:G,loading:T,multiple:!0},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:U,success:z,loading:H,multiple:!0}]),{mutate:ie}=fe({onMutate:a=>{k.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.floorId=a.floorId[0],a.costId=a.costId[0]},mutationFn:a=>ve("application",a),onSuccess:()=>{O.invalidateQueries({queryKey:["applications"]}),V.push(C.APPLICATIONS.path)}}),de=()=>{t.value.$validate(),!t.value.$errors.length&&(ie(l.value),t.value.$reset())};return(a,qe)=>{const ne=v("ManageHead"),ce=v("FormInput"),ue=v("FormSelect"),me=v("CustomButton");return h(),S("section",Ke,[j("div",Fe,[q(ne,{title:"addNewApplicationTitle",to:I(C).APPLICATIONS.path},null,8,["to"]),j("form",{class:"manage__form form-manage",onSubmit:be(de,["prevent"])},[(h(!0),S(w,null,M(re.value,e=>{var c,u,m,p,g;return h(),$(ce,{key:e.id,modelValue:l.value[e.model],"onUpdate:modelValue":L=>l.value[e.model]=L,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(u=(c=I(t))==null?void 0:c[e.errorKey])==null?void 0:u.$error,textError:(g=(p=(m=I(t))==null?void 0:m[e.errorKey])==null?void 0:p.$errors[0])==null?void 0:g.$message,type:e==null?void 0:e.type},{default:B(()=>[A(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(h(!0),S(w,null,M(te.value,e=>{var c,u,m,p,g;return h(),$(ue,{key:e.id,modelValue:l.value[e.model],"onUpdate:modelValue":L=>l.value[e.model]=L,width:500,options:e.options,error:(u=(c=I(t))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(g=(p=(m=I(t))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:g.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:B(()=>[A(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128)),q(me,{className:"form__submit"},{default:B(()=>[A(K(a.$t("appButton")),1)]),_:1})],32)])])}}};export{Pe as default};
//# sourceMappingURL=create-iB7FWj7_.js.map
