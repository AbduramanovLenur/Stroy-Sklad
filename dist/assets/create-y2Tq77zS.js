import{u as ae,a as te,b as re,y as oe,c as F,r as K,z as se,d as i,e as N,k as U,h as o,w as ue,F as B,C as ne,D as d,i as p,l as le,m as l,o as u,s as H,A as T,f as h,t as _,H as ce,E as me}from"./index--ASsptNz.js";import{c as ie}from"./crud.services-J6Vd6xLE.js";import{j as de}from"./manual.services-N1AdmalV.js";import{u as pe,r as W}from"./i18n-validators-hHlX57Cz.js";import{u as he}from"./generic.services-OmFX1-7T.js";import{u as _e}from"./useQuery-aJZefqwx.js";import{u as ye}from"./useMutation-KDcbY73c.js";const ge={key:0,class:"manage section-height shadowed"},ve={class:"manage__inner section-padding"},Ie={__name:"create",async setup($e){let n,y;const A=he(),L=le(),R=ae(),{t:x}=te(),z=re(),{user:s}=oe(z),g=F(()=>{var a,c;return!!((c=(a=s==null?void 0:s.value.user)==null?void 0:a.modules)!=null&&c.includes(ce.WAREHOUSE.CREATE))}),t=K({materialId:[],quantity:""}),D=F(()=>({materialId:{required:W},quantity:{required:W}})),r=pe(D,t),{data:O,isSuccess:P,isLoading:Q}=([n,y]=se(()=>_e({queryKey:["materialsList",{organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>de(),enabled:g})),n=await n,y(),n),j=K([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:O,success:P,loading:Q,select:!0},{id:2,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),{mutate:G,status:J}=ye({onMutate:a=>{a.materialId=a.materialId[0]},mutationFn:a=>ie("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(t.value=me(t.value),A.invalidateQueries({queryKey:["warehouse"]}),L.push(H.WAREHOUSE.path),setTimeout(()=>R.success(x("createToast")),150))}}),X=()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...t.value};G(a),r.value.$reset()};return(a,c)=>{var v,$;const Y=l("ManageHead"),Z=l("FormInput"),f=l("FormSelect"),ee=l("CustomButton");return g.value?(u(),i("section",ge,[N("div",ve,[U(Y,{title:"addNewProductTitle",to:o(H).WAREHOUSE.path},null,8,["to"]),N("form",{class:"manage__form form-manage",onSubmit:ue(X,["prevent"])},[(u(!0),i(B,null,ne(j.value,e=>{var E,S,V,b,q,w,C,I,M,k;return u(),i(B,{key:e.id},[e!=null&&e.select?p("",!0):(u(),T(Z,{key:0,modelValue:t.value[e.model],"onUpdate:modelValue":m=>t.value[e.model]=m,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(S=(E=o(r))==null?void 0:E[e.errorKey])==null?void 0:S.$error,textError:(q=(b=(V=o(r))==null?void 0:V[e.errorKey])==null?void 0:b.$errors[0])==null?void 0:q.$message},{default:d(()=>[h(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(u(),T(f,{key:1,modelValue:t.value[e.model],"onUpdate:modelValue":m=>t.value[e.model]=m,modelModifiers:{trim:!0},width:500,options:e.options,error:(C=(w=o(r))==null?void 0:w[e==null?void 0:e.errorKey])==null?void 0:C.$error,placeholder:e==null?void 0:e.placeholder,textError:(k=(M=(I=o(r))==null?void 0:I[e==null?void 0:e.errorKey])==null?void 0:M.$errors[0])==null?void 0:k.$message,success:e.success,loading:e.loading},{default:d(()=>[h(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):p("",!0)],64)}),128)),U(ee,{className:`form__submit ${($=(v=o(r))==null?void 0:v.quantity.$errors[0])!=null&&$.$message?"centered":""}`,disabled:o(J)==="pending"},{default:d(()=>[h(_(a.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):p("",!0)}}};export{Ie as default};
