import{u as ue,a as me,r as B,c as ce,z as C,d as N,e as q,k as de,h as r,w as pe,F as A,D as ie,B as u,i as m,A as y,l as ye,m as c,o as s,s as U,f as g,t as h,E as ge}from"./index-bESyHmKb.js";import{c as he}from"./crud.services-z-7dMtvc.js";import{c as Ne,d as _e}from"./manual.services-XwGTQWk9.js";import{u as ve,r as n,m as be}from"./i18n-validators-JP3nhFWN.js";import{u as Ve}from"./generic.services-WkEajj6v.js";import{u as x}from"./useQuery-1aHXDk8s.js";import{u as $e}from"./useMutation-pOycABst.js";const Me={class:"manage section-height shadowed"},De={class:"manage__inner section-padding"},ke={__name:"create",async setup(Le){let l,p;const T=Ve(),H=ye(),Q=ue(),{t:G}=me(),a=B({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:[],createRoleDto:{fullName:"OrgAdmin",shortName:"OrgAdmin",roleModules:[]}}),Y=ce(()=>({fullName:{required:n},userName:{required:n},password:{required:n,minLength:be},phoneNumber:{required:n},organizationId:{required:n},createRoleDto:{fullName:{required:n},shortName:{required:n},roleModules:{required:n}}})),t=ve(Y,a),{data:j,isLoading:J,isSuccess:_}=([l,p]=C(()=>x({queryKey:["modules"],queryFn:()=>Ne()})),l=await l,p(),l),{data:W,isSuccess:X,isLoading:Z}=([l,p]=C(()=>x({queryKey:["organizations"],queryFn:()=>_e()})),l=await l,p(),l),f=B([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"createRoleDto.fullName"},{id:6,model:"organizationId",label:"employeesOrganizationLabel",placeholder:"employeesOrganizationPlaceholder",errorKey:"organizationId",options:W,success:X,loading:Z,select:!0}]),{mutate:ee,status:oe}=$e({onMutate:o=>{o.organizationId=o.organizationId[0]},mutationFn:o=>he("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=ge(a.value),T.invalidateQueries({queryKey:["employees"]}),H.push(U.EMPLOYEES.path),setTimeout(()=>Q.success(G("createToast")),150))}}),ae=()=>{if(a.value.createRoleDto.shortName=a.value.createRoleDto.fullName,t.value.$validate(),t.value.$errors.length)return;const o={...a.value};ee(o),t.value.$reset()};return(o,i)=>{const re=c("ManageHead"),v=c("FormInput"),te=c("FormSelect"),se=c("ActionsModules"),le=c("CustomButton"),ne=c("Spinner");return s(),N("section",Me,[q("div",De,[de(re,{title:"addNewEmployeesTitle",to:r(U).EMPLOYEES.path},null,8,["to"]),q("form",{class:"manage__form form-manage",onSubmit:pe(ae,["prevent"])},[(s(!0),N(A,null,ie(f.value,e=>{var b,V,$,M,D,L,R,w,E,z,S,K,P,k,F,I,O;return s(),N(A,{key:e.id},[!(e!=null&&e.select)&&e.model!=="createRoleDto.fullName"?(s(),u(v,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,placeholder:o.$t(e.placeholder),name:e.icon,error:(V=(b=r(t))==null?void 0:b[e.errorKey])==null?void 0:V.$error,type:e==null?void 0:e.type,textError:(D=(M=($=r(t))==null?void 0:$[e.errorKey])==null?void 0:M.$errors[0])==null?void 0:D.$message},{default:y(()=>[g(h(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])):m("",!0),!(e!=null&&e.select)&&e.model==="createRoleDto.fullName"?(s(),u(v,{key:1,modelValue:a.value.createRoleDto.fullName,"onUpdate:modelValue":i[0]||(i[0]=d=>a.value.createRoleDto.fullName=d),placeholder:o.$t("employeesRolePlaceholder"),name:"person",error:(w=(R=(L=r(t))==null?void 0:L.createRoleDto)==null?void 0:R.fullName)==null?void 0:w.$error,textError:(K=(S=(z=(E=r(t))==null?void 0:E.createRoleDto)==null?void 0:z.fullName)==null?void 0:S.$errors[0])==null?void 0:K.$message},{default:y(()=>[g(h(o.$t("employeesRoleLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"])):m("",!0),e!=null&&e.select?(s(),u(te,{key:2,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,modelModifiers:{trim:!0},options:e.options,error:(k=(P=r(t))==null?void 0:P[e==null?void 0:e.errorKey])==null?void 0:k.$error,placeholder:e==null?void 0:e.placeholder,textError:(O=(I=(F=r(t))==null?void 0:F[e==null?void 0:e.errorKey])==null?void 0:I.$errors[0])==null?void 0:O.$message,success:e.success,loading:e.loading},{default:y(()=>[g(h(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):m("",!0)],64)}),128)),r(_)?(s(),u(se,{key:0,modelValue:a.value.createRoleDto.roleModules,"onUpdate:modelValue":i[1]||(i[1]=e=>a.value.createRoleDto.roleModules=e),actions:r(j)},null,8,["modelValue","actions"])):m("",!0),r(_)?(s(),u(le,{key:1,className:"form__submit",disabled:r(oe)==="pending"},{default:y(()=>[g(h(o.$t("formButton")),1)]),_:1},8,["disabled"])):m("",!0)],32),r(J)?(s(),u(ne,{key:0})):m("",!0)])])}}};export{ke as default};
