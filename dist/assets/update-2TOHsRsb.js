import{u as ae,a as te,r as b,y as g,c as le,x as de,b as _,d as q,f as j,k as d,w as ie,F as w,e as V,B as k,g as ne,C as ce,h,o as I,A as v,z as C,i as F,t as O}from"./index-lJf7jXP7.js";import{u as ue,r as t}from"./i18n-validators-uxPccHio.js";import{a as me,u as be}from"./generic.services-Aa1SKJf_.js";import{u as p}from"./useQuery-aSnCbYw0.js";import{a as ge,u as Ie}from"./crud.services-puo1KH10.js";import{m as pe,a as he,e as ye,b as fe}from"./manual.services-vTvsoS9S.js";const _e={class:"manage section-height shadowed"},ke={class:"manage__inner section-padding"},qe={__name:"update",async setup(ve){let s,a;const L=me(),B=ne(),N=ce();ae(),te();const y=b(N.params.id),K=b(localStorage.getItem("organizationId")),{data:P,isSuccess:E,isLoading:M}=([s,a]=g(()=>p({queryKey:["regions"],queryFn:()=>pe()})),s=await s,a(),s),{data:R,isSuccess:x,isLoading:A}=([s,a]=g(()=>p({queryKey:["districts"],queryFn:()=>he()})),s=await s,a(),s),{data:D,isSuccess:G,isLoading:H}=([s,a]=g(()=>p({queryKey:["objectsList",{organizationId:K}],queryFn:()=>ye(K.value)})),s=await s,a(),s),{data:Q,isSuccess:U,isLoading:z}=([s,a]=g(()=>p({queryKey:["states"],queryFn:()=>fe()})),s=await s,a(),s),r=b({id:"",fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[],stateId:[]}),T=le(()=>({id:{required:t},fullname:{required:t},numberOfFloors:{required:t},roomsOnFloor:{required:t},address:{required:t},buildingObjectId:{required:t},regionId:{required:t},districtId:{required:t},stateId:{required:t}})),l=ue(T,r),W=b([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),J=b([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:D,success:G,loading:H},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:P,success:E,loading:M},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:R,success:x,loading:A},{id:4,model:"stateId",label:"stateBlocksLabel",placeholder:"stateBlocksPlaceholder",errorKey:"stateId",options:Q,success:U,loading:z}]),{isError:X}=([s,a]=g(()=>p({queryKey:["blocksById",y],queryFn:()=>ge("building_block",y.value),select:o=>{r.value.id=o.id,r.value.fullname=o.fullName,r.value.numberOfFloors=o.numberOfFloors,r.value.roomsOnFloor=o.roomsOnFloor,r.value.address=o.address,r.value.buildingObjectId=[o.buildingObjectId],r.value.regionId=[o.regionId],r.value.districtId=[o.districtId],r.value.stateId=[o.stateId]}})),s=await s,a(),s);de(X,o=>{o&&B.push(v.HOME.path)});const{mutate:Y}=be({onMutate:o=>{o.buildingObjectId=o.buildingObjectId[0],o.regionId=o.regionId[0],o.districtId=o.districtId[0],o.stateId=o.stateId[0]},mutationFn:o=>Ie("building_block",o),onSuccess:()=>{L.invalidateQueries({queryKey:["blocks"]}),L.invalidateQueries({queryKey:["blocksById",y]}),B.push(v.BLOCKS.path)}}),Z=async()=>{l.value.$validate(),!l.value.$errors.length&&(Y(r.value),l.value.$reset())};return(o,Fe)=>{var S,$;const ee=h("ManageHead"),oe=h("FormInput"),se=h("FormSelect"),re=h("CustomButton");return I(),_("section",_e,[q("div",ke,[j(ee,{title:"editBlocksTitle",to:d(v).BLOCKS.path},null,8,["to"]),q("form",{class:"manage__form form-manage",onSubmit:ie(Z,["prevent"])},[(I(!0),_(w,null,V(W.value,e=>{var i,n,c,u,m;return I(),C(oe,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":f=>r.value[e.model]=f,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(n=(i=d(l))==null?void 0:i[e==null?void 0:e.errorKey])==null?void 0:n.$error,textError:(m=(u=(c=d(l))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message},{default:k(()=>[F(O(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(I(!0),_(w,null,V(J.value,e=>{var i,n,c,u,m;return I(),C(se,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":f=>r.value[e.model]=f,width:500,options:e.options,error:(n=(i=d(l))==null?void 0:i[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(u=(c=d(l))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:k(()=>[F(O(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),j(re,{className:`form__submit ${($=(S=d(l))==null?void 0:S.stateId.$errors[0])!=null&&$.$message?"centered":""}`},{default:k(()=>[F(O(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{qe as default};
//# sourceMappingURL=update-2TOHsRsb.js.map
