import{u as me,a as pe,r as u,c as I,z as d,B as D,d as _,e as R,k as x,h as i,w as ge,F as Q,C as he,D as b,l as ye,G as ve,m,o as c,s as z,A as T,f as N,t as K,i as A,E as Ie}from"./index-Znn7x0w2.js";import{a as _e,u as be}from"./crud.services-oovoAPUX.js";import{m as ze,a as Ne,b as Ke}from"./manual.services-CtkFg6uR.js";import{u as Oe,r as o}from"./i18n-validators-IvsyUnkI.js";import{a as Se,u as $e}from"./generic.services-CuHvXiDr.js";import{u as p}from"./useQuery-n34yz_OD.js";const Le={class:"manage section-height shadowed"},qe={class:"manage__inner section-padding"},ke={__name:"update",async setup(Ce){let a,s;const g=Se(),O=ye(),G=ve(),H=me(),{t:U}=pe(),h=u(G.params.id),S=u(!1),y=u(!1),r=u({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[],stateId:[]}),W=I(()=>({id:{required:o},fullName:{required:o},inn:{required:o},address:{required:o},phoneNumber:{required:o},director:{required:o},regionId:{required:o},districtId:{required:o},stateId:{required:o}})),n=Oe(W,r),{data:j,isSuccess:J,isLoading:X}=([a,s]=d(()=>p({queryKey:["regions"],queryFn:()=>ze()})),a=await a,s(),a),l=I(()=>r.value.regionId[0]),Y=I(()=>!!l.value);D(l,()=>{!y.value&&!S.value&&(r.value.districtId=[]),y.value=!1},{immediate:!0});const{data:Z,isSuccess:f,isLoading:ee}=([a,s]=d(()=>p({queryKey:["districts",{districtId:l}],queryFn:()=>Ne(l.value),enabled:Y})),a=await a,s(),a),{data:te,isSuccess:re,isLoading:ae}=([a,s]=d(()=>p({queryKey:["states"],queryFn:()=>Ke()})),a=await a,s(),a),oe=u([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",type:"number"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"},{id:6,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:j,success:J,loading:X,select:!0},{id:7,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:Z,success:f,loading:ee,select:!0},{id:8,model:"stateId",label:"stateOrganizationLabel",placeholder:"stateOrganizationPlaceholder",errorKey:"stateId",options:te,success:re,loading:ae,select:!0}]),{isError:se}=([a,s]=d(()=>p({queryKey:["companyById",h],queryFn:()=>_e("organization",h.value),select:e=>{r.value.id=e.id,r.value.fullName=e.fullName,r.value.inn=e.inn,r.value.address=e.address,r.value.phoneNumber=e.phoneNumber,r.value.director=e.director,r.value.regionId=[e==null?void 0:e.regionId],r.value.districtId=[e==null?void 0:e.districtId],r.value.stateId=[e==null?void 0:e.stateId],y.value=!0}})),a=await a,s(),a);D(se,e=>{e&&O.push(z.HOME.path)});const{mutate:ne}=$e({onMutate:e=>{S.value=!0,e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>be("organization",e),onSuccess:async e=>{e!=null&&e.success&&(r.value=Ie(r.value),g.invalidateQueries({queryKey:["companies"]}),g.invalidateQueries({queryKey:["companyById",h]}),g.invalidateQueries({queryKey:["organizations"]}),O.push(z.COMPANIES.path),setTimeout(()=>H.success(U("updateToast")),150))}}),ie=async()=>{if(n.value.$validate(),n.value.$errors.length)return;const e={...r.value};ne(e),n.value.$reset()};return(e,Ve)=>{var $,L;const ue=m("ManageHead"),ce=m("FormInput"),le=m("FormSelect"),de=m("CustomButton");return c(),_("section",Le,[R("div",qe,[x(ue,{title:"editCompanyTitle",to:i(z).COMPANIES.path},null,8,["to"]),R("form",{class:"manage__form form-manage",onSubmit:ge(ie,["prevent"])},[(c(!0),_(Q,null,he(oe.value,t=>{var q,C,V,w,F,B,E,M,P,k;return c(),_(Q,{key:t.id},[t!=null&&t.select?A("",!0):(c(),T(ce,{key:0,modelValue:r.value[t.model],"onUpdate:modelValue":v=>r.value[t.model]=v,width:500,placeholder:e.$t(t.placeholder),name:t.icon,error:(C=(q=i(n))==null?void 0:q[t==null?void 0:t.errorKey])==null?void 0:C.$error,type:t==null?void 0:t.type,textError:(F=(w=(V=i(n))==null?void 0:V[t==null?void 0:t.errorKey])==null?void 0:w.$errors[0])==null?void 0:F.$message},{default:b(()=>[N(K(e.$t(t.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),t!=null&&t.select?(c(),T(le,{key:1,modelValue:r.value[t.model],"onUpdate:modelValue":v=>r.value[t.model]=v,modelModifiers:{trim:!0},width:500,options:t.options,error:(E=(B=i(n))==null?void 0:B[t==null?void 0:t.errorKey])==null?void 0:E.$error,placeholder:t==null?void 0:t.placeholder,textError:(k=(P=(M=i(n))==null?void 0:M[t==null?void 0:t.errorKey])==null?void 0:P.$errors[0])==null?void 0:k.$message,success:t.success,loading:t.loading},{default:b(()=>[N(K(e.$t(t.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):A("",!0)],64)}),128)),x(de,{className:`form__submit ${(L=($=i(n))==null?void 0:$.stateId.$errors[0])!=null&&L.$message?"centered":""}`},{default:b(()=>[N(K(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{ke as default};
