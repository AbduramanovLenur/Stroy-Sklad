import{u as ne,a as ie,r as i,c as z,z as y,B as V,d as N,e as B,k as E,h as l,w as le,F as P,C as M,D as O,l as de,E as ue,m as I,o as p,s as K,A as k,f as S,t as $}from"./index-3zRY4k0K.js";import{u as ce,r as s}from"./i18n-validators-Vgt2G8bu.js";import{a as me,u as ge}from"./generic.services-7FkgE6Ab.js";import{u as v}from"./useQuery-Hc257fYM.js";import{a as pe,u as he}from"./crud.services-C48a2peV.js";import{m as ye,a as Ie,b as ve}from"./manual.services-GIE66Of4.js";const fe={class:"manage section-height shadowed"},_e={class:"manage__inner section-padding"},qe={__name:"update",async setup(be){let o,t;const L=me(),q=de(),R=ue();ne(),ie();const f=i(R.params.id),w=i(!1),_=i(!1),a=i({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[],stateId:[]}),x=z(()=>({id:{required:s},fullName:{required:s},inn:{required:s},address:{required:s},phoneNumber:{required:s},director:{required:s},regionId:{required:s},districtId:{required:s},stateId:{required:s}})),n=ce(x,a),{data:D,isSuccess:A,isLoading:H}=([o,t]=y(()=>v({queryKey:["regions"],queryFn:()=>ye()})),o=await o,t(),o),h=z(()=>a.value.regionId),Q=z(()=>!!h.value.length);V(h,()=>{!_.value&&!w.value&&(a.value.districtId=[]),_.value=!1},{immediate:!0});const{data:U,isSuccess:G,isLoading:T}=([o,t]=y(()=>v({queryKey:["districts",{districtId:h}],queryFn:()=>Ie(h.value),enabled:Q})),o=await o,t(),o),{data:W,isSuccess:j,isLoading:J}=([o,t]=y(()=>v({queryKey:["states"],queryFn:()=>ve()})),o=await o,t(),o),X=i([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),Y=i([{id:1,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:D,success:A,loading:H},{id:2,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:U,success:G,loading:T},{id:3,model:"stateId",label:"stateOrganizationLabel",placeholder:"stateOrganizationPlaceholder",errorKey:"stateId",options:W,success:j,loading:J}]),{isError:Z}=([o,t]=y(()=>v({queryKey:["companyById",f],queryFn:()=>pe("organization",f.value),select:e=>{a.value.id=e.id,a.value.fullName=e.fullName,a.value.inn=e.inn,a.value.address=e.address,a.value.phoneNumber=e.phoneNumber,a.value.director=e.director,a.value.regionId=[e==null?void 0:e.regionId],a.value.districtId=[e==null?void 0:e.districtId],a.value.stateId=[e==null?void 0:e.stateId],_.value=!0}})),o=await o,t(),o);V(Z,e=>{e&&q.push(K.HOME.path)});const{mutate:ee}=ge({onMutate:e=>{w.value=!0,e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>he("organization",e),onSuccess:async e=>{L.invalidateQueries({queryKey:["companies"]}),L.invalidateQueries({queryKey:["companyById",f]}),q.push(K.COMPANIES.path)}}),re=async()=>{n.value.$validate(),!n.value.$errors.length&&(ee(a.value),n.value.$reset())};return(e,ze)=>{var C,F;const ae=I("ManageHead"),oe=I("FormInput"),se=I("FormSelect"),te=I("CustomButton");return p(),N("section",fe,[B("div",_e,[E(ae,{title:"editCompanyTitle",to:l(K).COMPANIES.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:le(re,["prevent"])},[(p(!0),N(P,null,M(X.value,r=>{var d,u,c,m,g;return p(),k(oe,{key:r.id,modelValue:a.value[r.model],"onUpdate:modelValue":b=>a.value[r.model]=b,width:500,placeholder:e.$t(r.placeholder),name:r.icon,error:(u=(d=l(n))==null?void 0:d[r==null?void 0:r.errorKey])==null?void 0:u.$error,textError:(g=(m=(c=l(n))==null?void 0:c[r==null?void 0:r.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message},{default:O(()=>[S($(e.$t(r.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(p(!0),N(P,null,M(Y.value,r=>{var d,u,c,m,g;return p(),k(se,{key:r.id,modelValue:a.value[r.model],"onUpdate:modelValue":b=>a.value[r.model]=b,width:500,options:r.options,error:(u=(d=l(n))==null?void 0:d[r==null?void 0:r.errorKey])==null?void 0:u.$error,placeholder:r==null?void 0:r.placeholder,textError:(g=(m=(c=l(n))==null?void 0:c[r==null?void 0:r.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message,success:r.success,loading:r.loading},{default:O(()=>[S($(e.$t(r.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),E(te,{className:`form__submit ${(F=(C=l(n))==null?void 0:C.stateId.$errors[0])!=null&&F.$message?"centered":""}`},{default:O(()=>[S($(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{qe as default};
