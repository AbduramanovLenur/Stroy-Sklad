import{u as ae,a as te,b as re,y as oe,c as B,r as F,z as se,d as i,e as N,k as U,h as o,w as ue,F as H,D as ne,A as d,i as p,l as le,m as l,o as u,s as T,B as W,f as h,t as y,H as ce,E as me}from"./index-zJOFZS3J.js";import{c as ie}from"./crud.services-Eo6zCu9X.js";import{j as de}from"./manual.services-lJTOI63O.js";import{u as pe,r as A}from"./i18n-validators-gi_US3Zu.js";import{u as he}from"./generic.services-5LadNNBD.js";import{u as ye}from"./useQuery-F462u6z4.js";import{u as _e}from"./useMutation-WxfEVhVn.js";const ge={key:0,class:"manage section-height shadowed"},ve={class:"manage__inner section-padding"},Me={__name:"create",async setup($e){let n,_;const g=he(),L=le(),R=ae(),{t:x}=te(),Q=re(),{user:s}=oe(Q),v=B(()=>{var a,c;return!!((c=(a=s==null?void 0:s.value.user)==null?void 0:a.modules)!=null&&c.includes(ce.WAREHOUSE.CREATE))}),t=F({materialId:[],quantity:""}),z=B(()=>({materialId:{required:A},quantity:{required:A}})),r=pe(z,t),{data:D,isSuccess:O,isLoading:P}=([n,_]=se(()=>ye({queryKey:["materialsList",{organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>de(),enabled:v})),n=await n,_(),n),j=F([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:D,success:O,loading:P,select:!0},{id:2,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),{mutate:G,status:J}=_e({onMutate:a=>{a.materialId=a.materialId[0]},mutationFn:a=>ie("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(t.value=me(t.value),g.invalidateQueries({queryKey:["warehouse"]}),g.invalidateQueries({queryKey:["reports","warehouse"]}),L.push(T.WAREHOUSE.path),setTimeout(()=>R.success(x("createToast")),150))}}),X=()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...t.value};G(a),r.value.$reset()};return(a,c)=>{var $,E;const Y=l("ManageHead"),Z=l("FormInput"),f=l("FormSelect"),ee=l("CustomButton");return v.value?(u(),i("section",ge,[N("div",ve,[U(Y,{title:"addNewProductTitle",to:o(T).WAREHOUSE.path},null,8,["to"]),N("form",{class:"manage__form form-manage",onSubmit:ue(X,["prevent"])},[(u(!0),i(H,null,ne(j.value,e=>{var S,q,w,V,b,I,M,C,K,k;return u(),i(H,{key:e.id},[e!=null&&e.select?p("",!0):(u(),W(Z,{key:0,modelValue:t.value[e.model],"onUpdate:modelValue":m=>t.value[e.model]=m,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(q=(S=o(r))==null?void 0:S[e.errorKey])==null?void 0:q.$error,textError:(b=(V=(w=o(r))==null?void 0:w[e.errorKey])==null?void 0:V.$errors[0])==null?void 0:b.$message},{default:d(()=>[h(y(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(u(),W(f,{key:1,modelValue:t.value[e.model],"onUpdate:modelValue":m=>t.value[e.model]=m,modelModifiers:{trim:!0},width:500,options:e.options,error:(M=(I=o(r))==null?void 0:I[e==null?void 0:e.errorKey])==null?void 0:M.$error,placeholder:e==null?void 0:e.placeholder,textError:(k=(K=(C=o(r))==null?void 0:C[e==null?void 0:e.errorKey])==null?void 0:K.$errors[0])==null?void 0:k.$message,success:e.success,loading:e.loading},{default:d(()=>[h(y(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):p("",!0)],64)}),128)),U(ee,{className:`form__submit ${(E=($=o(r))==null?void 0:$.quantity.$errors[0])!=null&&E.$message?"centered":""}`,disabled:o(J)==="pending"},{default:d(()=>[h(y(a.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):p("",!0)}}};export{Me as default};
