import{u as te,a as se,b as oe,s as re,c as F,r as p,x as T,A as ue,d as S,e as E,k as L,h as u,w as ne,F as U,B as M,C as $,i as le,l as de,D as ie,m as h,o as m,z as P,y as Q,f as b,t as K,E as ce}from"./index-YWoyi3P5.js";import{u as me,r as _}from"./i18n-validators-MvbEOnD3.js";import{a as ye,u as pe}from"./generic.services-k4FTnzsm.js";import{u as V}from"./useQuery-cUByw4Jp.js";import{a as he,u as _e}from"./crud.services-lAAT8oXP.js";import{g as fe,b as ge}from"./manual.services-GatovLCD.js";const ve={key:0,class:"manage section-height shadowed"},Ie={class:"manage__inner section-padding"},Ve={__name:"update",async setup(qe){let t,r;const f=ye(),w=de(),k=ie();te(),se();const x=oe(),{user:g}=re(x),y=F(()=>{var a,I;return!!((I=(a=g==null?void 0:g.value.user)==null?void 0:a.modules)!=null&&I.includes(ce.PRODUCT.UPDATE))}),v=p(k.params.id),s=p({id:"",fullname:"",quantityTypeId:[],stateId:[]}),D=F(()=>({id:{required:_},fullname:{required:_},quantityTypeId:{required:_},stateId:{required:_}})),o=me(D,s),{data:N,isSuccess:R,isLoading:H}=([t,r]=T(()=>V({queryKey:["types"],queryFn:()=>fe(),enabled:y})),t=await t,r(),t),{data:O,isSuccess:A,isLoading:z}=([t,r]=T(()=>V({queryKey:["states"],queryFn:()=>ge(),enabled:y})),t=await t,r(),t),G=p([{id:1,model:"fullname",label:"nameProductsLabel",placeholder:"nameProductsPlaceholder",icon:"pen",errorKey:"fullname"}]),W=p([{id:1,model:"quantityTypeId",label:"qunatityTypesProductsLabel",placeholder:"qunatityTypesProductsPlaceholder",errorKey:"quantityTypeId",options:N,success:R,loading:H},{id:2,model:"stateId",label:"stateProductsLabel",placeholder:"stateProductsPlaceholder",errorKey:"stateId",options:O,success:A,loading:z}]),{isError:j}=([t,r]=T(()=>V({queryKey:["productsById",v],queryFn:()=>he("construction_material",v.value),select:a=>{s.value.id=a.id,s.value.fullname=a.fullname,s.value.quantityTypeId=[a.quantityTypeId],s.value.stateId=[a.stateId]},enabled:y})),t=await t,r(),t);ue(j,a=>{a&&w.push(P.HOME.path)});const{mutate:J}=pe({onMutate:a=>{a.quantityTypeId=a.quantityTypeId[0],a.stateId=a.stateId[0]},mutationFn:a=>_e("construction_material",a),onSuccess:()=>{f.invalidateQueries({queryKey:["products"]}),f.invalidateQueries({queryKey:["productsById",v]}),f.invalidateQueries({queryKey:["materialsList"]}),w.push(P.PRODUCTS.path)}}),X=async()=>{o.value.$validate(),!o.value.$errors.length&&(J(s.value),o.value.$reset())};return(a,I)=>{var C,B;const Y=h("ManageHead"),Z=h("FormInput"),ee=h("FormSelect"),ae=h("CustomButton");return y.value?(m(),S("section",ve,[E("div",Ie,[L(Y,{title:"editProductTitle",to:u(P).PRODUCTS.path},null,8,["to"]),E("form",{class:"manage__form form-manage",onSubmit:ne(X,["prevent"])},[(m(!0),S(U,null,M(G.value,e=>{var n,l,d,i,c;return m(),Q(Z,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":q=>s.value[e.model]=q,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(l=(n=u(o))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,textError:(c=(i=(d=u(o))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message},{default:$(()=>[b(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(m(!0),S(U,null,M(W.value,e=>{var n,l,d,i,c;return m(),Q(ee,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":q=>s.value[e.model]=q,width:500,options:e.options,error:(l=(n=u(o))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(i=(d=u(o))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:$(()=>[b(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(ae,{className:`form__submit ${(B=(C=u(o))==null?void 0:C.stateId.$errors[0])!=null&&B.$message?"centered":""}`},{default:$(()=>[b(K(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):le("",!0)}}};export{Ve as default};
//# sourceMappingURL=update-yz8mrjDu.js.map
