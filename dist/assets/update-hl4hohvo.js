import{u as ye,a as he,b as Ie,y as _e,c as g,r as c,z as b,C as x,d as j,e as P,k as G,h as n,w as Se,F as H,D as je,A as K,i as $,l as Ke,G as $e,m as v,o as i,s as B,B as J,f as O,t as q,H as Be,E as Oe}from"./index-Bee0eIFu.js";import{u as qe,r as u}from"./i18n-validators-ULboWM6n.js";import{u as Ce}from"./generic.services-G3ATixRD.js";import{u as y}from"./useQuery-wCvH6pxH.js";import{u as Le}from"./useMutation-uVamgMOE.js";import{a as we,u as Ee}from"./crud.services-wQgdXoj4.js";import{m as Ve,a as Fe,b as Te}from"./manual.services-YOtkPLe4.js";const ke={key:0,class:"manage section-height shadowed"},Me={class:"manage__inner section-padding"},He={__name:"update",async setup(Ne){let s,r;const l=Ce(),C=Ke(),A=$e(),z=ye(),{t:W}=he(),X=Ie(),{user:d}=_e(X),m=g(()=>{var t,_;return!!((_=(t=d==null?void 0:d.value.user)==null?void 0:t.modules)!=null&&_.includes(Be.OBJECT.UPDATE))}),h=c(A.params.id),L=c(!1),I=c(!1),a=c({id:"",name:"",address:"",regionId:[],districtId:[],stateId:[]}),Y=g(()=>({id:{required:u},name:{required:u},address:{required:u},regionId:{required:u},districtId:{required:u},stateId:{required:u}})),o=qe(Y,a),{data:Z,isSuccess:f,isLoading:ee}=([s,r]=b(()=>y({queryKey:["regions"],queryFn:()=>Ve(),enabled:m})),s=await s,r(),s),p=g(()=>a.value.regionId[0]),te=g(()=>!!p.value);x(p,()=>{!I.value&&!L.value&&(a.value.districtId=[]),I.value=!1},{immediate:!0});const{data:se,isSuccess:ae,isLoading:re}=([s,r]=b(()=>y({queryKey:["districts",{districtId:p}],queryFn:()=>Fe(p.value),enabled:te})),s=await s,r(),s),{data:oe,isSuccess:ne,isLoading:ue}=([s,r]=b(()=>y({queryKey:["states"],queryFn:()=>Te(),enabled:m})),s=await s,r(),s),ce=c([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"},{id:3,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:Z,success:f,loading:ee,select:!0},{id:4,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:se,success:ae,loading:re,select:!0},{id:5,model:"stateId",label:"stateObjectLabel",placeholder:"stateObjectLabel",errorKey:"stateId",options:oe,success:ne,loading:ue,select:!0}]),{isError:ie}=([s,r]=b(()=>y({queryKey:["objectById",h,d.value.user.fullName],queryFn:()=>we("building_object",h.value),select:t=>{a.value.id=t.id,a.value.name=t.fullName,a.value.address=t.address,a.value.regionId=[t.regionId],a.value.districtId=[t.districtId],a.value.stateId=[t.stateId],I.value=!0},enabled:m})),s=await s,r(),s);x(ie,t=>{t&&C.push(B.OBJECT.path)});const{mutate:le,status:de}=Le({onMutate:t=>{L.value=!0,t.regionId=t.regionId[0],t.districtId=t.districtId[0],t.stateId=t.stateId[0]},mutationFn:t=>Ee("building_object",t),onSuccess:t=>{t!=null&&t.success&&(a.value=Oe(a.value),l.invalidateQueries({queryKey:["objects"]}),l.invalidateQueries({queryKey:["objectById",h]}),l.invalidateQueries({queryKey:["objectsList"]}),l.invalidateQueries({queryKey:["blocks"]}),C.push(B.OBJECT.path),setTimeout(()=>z.success(W("updateToast")),150))}}),me=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const t={...a.value};le(t),o.value.$reset()};return(t,_)=>{var w,E;const pe=v("ManageHead"),ge=v("FormInput"),be=v("FormSelect"),ve=v("CustomButton");return m.value?(i(),j("section",ke,[P("div",Me,[G(pe,{title:"editObjectTitle",to:n(B).OBJECT.path},null,8,["to"]),P("form",{class:"manage__form form-manage",onSubmit:Se(me,["prevent"])},[(i(!0),j(H,null,je(ce.value,e=>{var V,F,T,k,M,N,D,R,Q,U;return i(),j(H,{key:e.id},[e!=null&&e.select?$("",!0):(i(),J(ge,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":S=>a.value[e.model]=S,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(F=(V=n(o))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:F.$error,textError:(M=(k=(T=n(o))==null?void 0:T[e==null?void 0:e.errorKey])==null?void 0:k.$errors[0])==null?void 0:M.$message},{default:K(()=>[O(q(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(i(),J(be,{key:1,modelValue:a.value[e.model],"onUpdate:modelValue":S=>a.value[e.model]=S,modelModifiers:{trim:!0},width:500,options:e.options,error:(D=(N=n(o))==null?void 0:N[e==null?void 0:e.errorKey])==null?void 0:D.$error,placeholder:e==null?void 0:e.placeholder,textError:(U=(Q=(R=n(o))==null?void 0:R[e==null?void 0:e.errorKey])==null?void 0:Q.$errors[0])==null?void 0:U.$message,success:e.success,loading:e.loading},{default:K(()=>[O(q(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):$("",!0)],64)}),128)),G(ve,{className:`form__submit ${(E=(w=n(o))==null?void 0:w.stateId.$errors[0])!=null&&E.$message?"centered":""}`,disabled:n(de)==="pending"},{default:K(()=>[O(q(t.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):$("",!0)}}};export{He as default};
