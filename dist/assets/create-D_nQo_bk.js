import{u as ae,a as re,r as _,c as se,z as f,d as N,e as z,k as le,h as s,w as te,F as K,C as E,A as g,i as v,D as b,l as ne,m as d,o as t,s as F,f as w,t as L,E as de}from"./index-OVII3y0P.js";import{u as ue,r as u,m as ie}from"./i18n-validators-2JY7RdOE.js";import{a as me,u as ce}from"./generic.services-XQd1T_L7.js";import{u as M}from"./useQuery-Vw29GMwA.js";import{c as pe}from"./crud.services-xzSCaXGM.js";import{c as ye,d as ge,e as he}from"./manual.services-pDWFwgQU.js";const _e={class:"manage section-height shadowed"},fe={class:"manage__inner section-padding"},Ie={__name:"create",async setup(Ne){let a,n;const P=me(),k=ne(),q=ae(),{t:C}=re(),r=_({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:[],roleId:[],roleModules:[]}),B=se(()=>({fullName:{required:u},userName:{required:u},password:{required:u,minLength:ie},phoneNumber:{required:u},organizationId:{required:u},roleId:{required:u}})),l=ue(B,r),{data:O,isLoading:R,isSuccess:$}=([a,n]=f(()=>M({queryKey:["modules"],queryFn:()=>ye()})),a=await a,n(),a),{data:x,isSuccess:T,isLoading:U}=([a,n]=f(()=>M({queryKey:["organizations"],queryFn:()=>ge()})),a=await a,n(),a),{data:A,isSuccess:D,isLoading:G}=([a,n]=f(()=>M({queryKey:["adminRoles"],queryFn:()=>he()})),a=await a,n(),a),H=_([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"}]),Q=_([{id:1,model:"organizationId",label:"employeesOrganizationLabel",placeholder:"employeesOrganizationPlaceholder",errorKey:"organizationId",options:x,success:T,loading:U},{id:2,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:A,success:D,loading:G}]),{mutate:Y}=ce({onMutate:o=>{o.organizationId=o.organizationId[0],o.roleId=o.roleId[0]},mutationFn:o=>pe("user",o),onSuccess:o=>{o!=null&&o.success&&(r.value=de(r.value),P.invalidateQueries({queryKey:["employees"]}),k.push(F.EMPLOYEES.path),setTimeout(()=>q.success(C("createToast")),150))}}),j=()=>{if(l.value.$validate(),l.value.$errors.length)return;const o={...r.value};Y(o),l.value.$reset()};return(o,I)=>{var S,V;const J=d("ManageHead"),W=d("FormInput"),X=d("FormSelect"),Z=d("ActionsModules"),ee=d("CustomButton"),oe=d("Spinner");return t(),N("section",_e,[z("div",fe,[le(J,{title:"addNewEmployeesTitle",to:s(F).EMPLOYEES.path},null,8,["to"]),z("form",{class:"manage__form form-manage",onSubmit:te(j,["prevent"])},[(t(!0),N(K,null,E(H.value,e=>{var i,m,c,p,y;return t(),g(W,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":h=>r.value[e.model]=h,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(m=(i=s(l))==null?void 0:i[e.errorKey])==null?void 0:m.$error,type:e==null?void 0:e.type,textError:(y=(p=(c=s(l))==null?void 0:c[e.errorKey])==null?void 0:p.$errors[0])==null?void 0:y.$message},{default:b(()=>[w(L(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),(t(!0),N(K,null,E(Q.value,e=>{var i,m,c,p,y;return t(),g(X,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":h=>r.value[e.model]=h,modelModifiers:{trim:!0},width:500,options:e.options,error:(m=(i=s(l))==null?void 0:i[e==null?void 0:e.errorKey])==null?void 0:m.$error,placeholder:e==null?void 0:e.placeholder,textError:(y=(p=(c=s(l))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:y.$message,success:e.success,loading:e.loading},{default:b(()=>[w(L(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),s($)?(t(),g(Z,{key:0,modelValue:r.value.roleModules,"onUpdate:modelValue":I[0]||(I[0]=e=>r.value.roleModules=e),actions:s(O)},null,8,["modelValue","actions"])):v("",!0),s($)?(t(),g(ee,{key:1,className:`form__submit ${(V=(S=s(l))==null?void 0:S.roleId.$errors[0])!=null&&V.$message?"centered":""}`},{default:b(()=>[w(L(o.$t("formButton")),1)]),_:1},8,["className"])):v("",!0)],32),s(R)?(t(),g(oe,{key:0})):v("",!0)])])}}};export{Ie as default};
