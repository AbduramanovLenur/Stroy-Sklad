import{u as z,a as G,b as j,y as J,c as R,r as V,z as W,d as b,e as S,k as X,h as s,w as Y,F as Z,C as ee,A as m,i as c,D as C,l as oe,m as n,o as r,s as k,f as w,t as E,H as ae,E as se}from"./index-zkjpq5my.js";import{u as te,r as L}from"./i18n-validators-UGKONhRL.js";import{a as re,u as le}from"./generic.services-wx_DtCHh.js";import{u as ne}from"./useQuery-copJlXh0.js";import{c as ue}from"./crud.services-8TgOaY3n.js";import{c as me}from"./manual.services-LRvKoYix.js";const ce={key:0,class:"manage section-height shadowed"},de={class:"manage__inner section-padding"},Ne={__name:"create",async setup(ie){let u,i;const p=re(),B=oe();z(),G();const K=j(),{user:d}=J(K),_=R(()=>{var e,l;return!!((l=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)!=null&&l.includes(ae.ROLE.CREATE))}),a=V({shortName:"",fullName:"",roleModules:[]}),q=R(()=>({shortName:{required:L},fullName:{required:L}})),t=te(q,a),{data:F,isLoading:A,isSuccess:f}=([u,i]=W(()=>ne({queryKey:["modules"],queryFn:()=>me(),enabled:_})),u=await u,i(),u),T=V([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"}]),{mutate:x}=le({mutationFn:e=>ue("Role",e),onSuccess:e=>{a.value=se(a.value),p.invalidateQueries({queryKey:["roles"]}),p.invalidateQueries({queryKey:["rolesList"]}),B.push(k.ROLE.path)}}),H=()=>{if(t.value.$validate(),t.value.$errors.length)return;const e={...a.value};x(e),t.value.$reset()};return(e,l)=>{var h,y;const Q=n("ManageHead"),U=n("FormInput"),D=n("ActionsModules"),I=n("CustomButton"),O=n("Spinner");return _.value?(r(),b("section",ce,[S("div",de,[X(Q,{title:"addNewRolesTitle",to:s(k).ROLE.path},null,8,["to"]),S("form",{class:"manage__form form-manage",onSubmit:Y(H,["prevent"])},[(r(!0),b(Z,null,ee(T.value,o=>{var v,N,g,M,$;return r(),m(U,{key:o.id,modelValue:a.value[o.model],"onUpdate:modelValue":P=>a.value[o.model]=P,width:500,placeholder:e.$t(o.placeholder),name:o.icon,error:(N=(v=s(t))==null?void 0:v[o.errorKey])==null?void 0:N.$error,textError:($=(M=(g=s(t))==null?void 0:g[o.errorKey])==null?void 0:M.$errors[0])==null?void 0:$.$message},{default:C(()=>[w(E(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),s(f)?(r(),m(D,{key:0,modelValue:a.value.roleModules,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.roleModules=o),actions:s(F)},null,8,["modelValue","actions"])):c("",!0),s(f)?(r(),m(I,{key:1,className:`form__submit manage__submit ${(y=(h=s(t))==null?void 0:h.fullName.$errors[0])!=null&&y.$message?"centered":""}`},{default:C(()=>[w(E(e.$t("formButton")),1)]),_:1},8,["className"])):c("",!0)],32),s(A)?(r(),m(O,{key:0})):c("",!0)])])):c("",!0)}}};export{Ne as default};
