import{u as ue,a as de,r as f,c as ie,z as g,B as me,d as N,e as F,k as ce,h as l,w as pe,F as P,C as B,A as h,i as S,D as b,l as ye,G as ge,m as d,o as n,s as M,f as L,t as w,E as he}from"./index-BTOQ0EkA.js";import{u as Ie,r as u}from"./i18n-validators-LB3B5oqw.js";import{a as fe,u as _e}from"./generic.services-aA1xp-Zb.js";import{u as I}from"./useQuery-0j72TF6v.js";import{a as ve,u as Ne}from"./crud.services-omo8rLXB.js";import{d as Se,e as be,b as Me,c as Le}from"./manual.services-9NlZIeU2.js";const we={class:"manage section-height shadowed"},Ke={class:"manage__inner section-padding"},Be={__name:"update",async setup($e){let a,r;const K=fe(),$=ye(),k=ge(),C=ue(),{t:O}=de(),_=f(k.params.id),s=f({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:[],roleId:[],stateId:[],roleModules:[]}),R=ie(()=>({id:{required:u},fullName:{required:u},userName:{required:u},phoneNumber:{required:u},organizationId:{required:u},roleId:{required:u},stateId:{required:u}})),t=Ie(R,s),{data:x,isSuccess:G,isLoading:T}=([a,r]=g(()=>I({queryKey:["organizations"],queryFn:()=>Se()})),a=await a,r(),a),{data:U,isSuccess:A,isLoading:H}=([a,r]=g(()=>I({queryKey:["adminRoles"],queryFn:()=>be()})),a=await a,r(),a),{data:Q,isSuccess:D,isLoading:Y}=([a,r]=g(()=>I({queryKey:["states"],queryFn:()=>Me()})),a=await a,r(),a),{data:W,isLoading:j,isSuccess:z}=([a,r]=g(()=>I({queryKey:["modules"],queryFn:()=>Le()})),a=await a,r(),a),J=f([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"}]),X=f([{id:1,model:"organizationId",label:"employeesOrganizationLabel",placeholder:"employeesOrganizationPlaceholder",errorKey:"organizationId",options:x,success:G,loading:T},{id:2,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:U,success:A,loading:H},{id:3,model:"stateId",label:"employeesStatePlaceholder",placeholder:"employeesStatePlaceholder",errorKey:"stateId",options:Q,success:D,loading:Y}]),{isError:Z}=([a,r]=g(()=>I({queryKey:["employeeById",_],queryFn:()=>ve("user",_.value),select:o=>{s.value.id=o.id,s.value.fullName=o.fullName,s.value.userName=o.userName,s.value.phoneNumber=o.phoneNumber,s.value.organizationId=[o.organizationId],s.value.roleId=[o.roleId],s.value.stateId=[o.stateId],s.value.roleModules=[...o.roleModules]}})),a=await a,r(),a);me(Z,o=>{o&&$.push(M.HOME.path)});const{mutate:ee}=_e({onMutate:o=>{o.organizationId=o.organizationId[0],o.roleId=o.roleId[0],o.stateId=o.stateId[0]},mutationFn:o=>Ne("user",o),onSuccess:o=>{o!=null&&o.success&&(s.value=he(s.value),K.invalidateQueries({queryKey:["employees"]}),K.invalidateQueries({queryKey:["employeeById",_]}),$.push(M.EMPLOYEES.path),setTimeout(()=>C.success(O("updateToast")),150))}}),oe=async()=>{if(t.value.$validate(),t.value.$errors.length)return;const o={...s.value};ee(o),t.value.$reset()};return(o,V)=>{var E,q;const ae=d("ManageHead"),se=d("FormInput"),re=d("FormSelect"),le=d("ActionsModules"),te=d("CustomButton"),ne=d("Spinner");return n(),N("section",we,[F("div",Ke,[ce(ae,{title:"editEmployeesTitle",to:l(M).EMPLOYEES.path},null,8,["to"]),F("form",{class:"manage__form form-manage",onSubmit:pe(oe,["prevent"])},[(n(!0),N(P,null,B(J.value,e=>{var i,m,c,p,y;return n(),h(se,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":v=>s.value[e.model]=v,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(m=(i=l(t))==null?void 0:i[e==null?void 0:e.errorKey])==null?void 0:m.$error,type:e==null?void 0:e.type,textError:(y=(p=(c=l(t))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:y.$message},{default:b(()=>[L(w(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),(n(!0),N(P,null,B(X.value,e=>{var i,m,c,p,y;return n(),h(re,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":v=>s.value[e.model]=v,modelModifiers:{trim:!0},width:500,options:e.options,error:(m=(i=l(t))==null?void 0:i[e==null?void 0:e.errorKey])==null?void 0:m.$error,placeholder:e==null?void 0:e.placeholder,textError:(y=(p=(c=l(t))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:y.$message,success:e.success,loading:e.loading},{default:b(()=>[L(w(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),l(z)?(n(),h(le,{key:0,modelValue:s.value.roleModules,"onUpdate:modelValue":V[0]||(V[0]=e=>s.value.roleModules=e),actions:l(W)},null,8,["modelValue","actions"])):S("",!0),l(z)?(n(),h(te,{key:1,className:`form__submit ${(q=(E=l(t))==null?void 0:E.stateId.$errors[0])!=null&&q.$message?"centered":""}`},{default:b(()=>[L(w(o.$t("formButton")),1)]),_:1},8,["className"])):S("",!0),l(j)?(n(),h(ne,{key:2})):S("",!0)],32)])])}}};export{Be as default};
