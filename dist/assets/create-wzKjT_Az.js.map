{"version":3,"file":"create-wzKjT_Az.js","sources":["../../src/views/company/create.vue"],"sourcesContent":["<template>\r\n    <section class=\"manage section-height shadowed\">\r\n        <div class=\"manage__inner section-padding\">\r\n            <ManageHead \r\n                title=\"addNewCompanyTitle\" \r\n                :to=\"routes.COMPANIES.path\"\r\n            />\r\n            <form class=\"manage__form form-manage\" @submit.prevent=\"submitHandler\">\r\n                <FormInput \r\n                    v-for=\"input in inputs\"\r\n                    :key=\"input.id\"\r\n                    v-model=\"state[input.model]\"\r\n                    :width=\"500\" \r\n                    :placeholder=\"$t(input.placeholder)\"\r\n                    :name=\"input.icon\"\r\n                    :error=\"v$?.[input.errorKey].$error\" \r\n                    :textError=\"v$?.[input.errorKey].$errors[0]?.$message\"\r\n                >\r\n                    {{ $t(input.label) }}\r\n                </FormInput>\r\n                <FormSelect \r\n                    v-for=\"select in selects\"\r\n                    :key=\"select.id\"\r\n                    v-model=\"state[select.model]\"\r\n                    :width=\"500\" \r\n                    :options=\"select.options\"\r\n                    :error=\"v$?.[select?.errorKey]?.$error\" \r\n                    :placeholder=\"select?.placeholder\"\r\n                    :textError=\"v$?.[select?.errorKey]?.$errors[0]?.$message\"\r\n                    :success=\"select.success\"\r\n                    :loading=\"select.loading\"\r\n                >\r\n                    {{ $t(select.label) }}\r\n                </FormSelect>\r\n                <CustomButton \r\n                    :className=\"`form__submit ${v$?.districtId.$errors[0]?.$message ? 'centered' : ''}`\"\r\n                >\r\n                    {{ $t(\"formButton\") }}\r\n                </CustomButton>\r\n            </form>\r\n        </div>\r\n    </section>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch } from \"vue\";\r\nimport { useRouter } from \"vue-router\";\r\nimport { useVuelidate } from \"@vuelidate/core\";\r\nimport { useToast } from \"vue-toastification\";\r\nimport { useI18n } from \"vue-i18n\";\r\nimport { required } from \"@/utils/i18n-validators.js\";\r\nimport { \r\n    useQueryClient, \r\n    useQuery, \r\n    useMutation \r\n} from \"@tanstack/vue-query\";\r\nimport { create } from \"@/services/crud.services.js\";\r\nimport { manualGetRegions, manualGetDistricts } from \"@/services/manual.services.js\";\r\nimport { routes } from \"@/utils/routes.js\";\r\nimport { actionModules } from \"@/utils/action-modules.js\";\r\n\r\nconst queryClient = useQueryClient();\r\nconst router = useRouter();\r\nconst toast = useToast();\r\nconst { t } = useI18n();\r\n\r\nconst isSubmit = ref(false);\r\n\r\nconst state = ref({\r\n    fullName: \"\",\r\n    inn: \"\",\r\n    address: \"\",\r\n    phoneNumber: \"\",\r\n    director: \"\",\r\n    regionId: [],\r\n    districtId: []\r\n});\r\n\r\nconst rules = computed(() => ({\r\n    fullName: { required },\r\n    inn: { required },\r\n    address: { required },\r\n    phoneNumber: { required },\r\n    director: { required },\r\n    regionId: { required },\r\n    districtId: { required },\r\n}));\r\n\r\nconst v$ = useVuelidate(rules, state);\r\n\r\nconst {\r\n    data: regions,\r\n    isSuccess: isSuccessRegions,\r\n    isLoading: isLoadingRegions\r\n} = await useQuery({\r\n    queryKey: [\"regions\"],\r\n    queryFn: () => manualGetRegions(),\r\n});\r\n\r\nconst valueRegion = computed(() => state.value.regionId);\r\n\r\nconst isEnabled = computed(() => !!valueRegion.value.length);\r\n\r\nwatch(valueRegion, () => {\r\n    if (!isSubmit.value) {\r\n        state.value.districtId = [];\r\n    }\r\n}, { immediate: true });\r\n\r\nconst {\r\n    data: districts,\r\n    isSuccess: isSuccessDistricts,\r\n    isLoading: isLoadingDistricts\r\n} = await useQuery({\r\n    queryKey: [\"districts\", { districtId: valueRegion }],\r\n    queryFn: () => manualGetDistricts(valueRegion.value),\r\n    enabled: isEnabled\r\n});\r\n\r\nconst inputs = ref([\r\n    { \r\n        id: 1, \r\n        model: \"fullName\", \r\n        label: \"nameOrganizationLabel\", \r\n        placeholder: \"nameOrganizationPlaceholder\", \r\n        icon: \"input-company\",\r\n        errorKey: \"fullName\",\r\n    },\r\n    { \r\n        id: 2, \r\n        model: \"inn\", \r\n        label: \"innOrganizationLabel\", \r\n        placeholder: \"innOrganizationPlaceholder\", \r\n        icon: \"tin\",\r\n        errorKey: \"inn\",\r\n    },\r\n    { \r\n        id: 3, \r\n        model: \"address\", \r\n        label: \"addressOrganizationLabel\", \r\n        placeholder: \"addressOrganizationPlaceholder\", \r\n        icon: \"address\",\r\n        errorKey: \"address\",\r\n    },\r\n    { \r\n        id: 4, \r\n        model: \"phoneNumber\", \r\n        label: \"phoneOrganizationLabel\", \r\n        placeholder: \"phoneOrganizationPlaceholder\", \r\n        icon: \"phone\",\r\n        errorKey: \"phoneNumber\",\r\n    },\r\n    { \r\n        id: 5, \r\n        model: \"director\", \r\n        label: \"directorOrganizationLabel\", \r\n        placeholder: \"directorOrganizationPlaceholder\", \r\n        icon: \"person\",\r\n        errorKey: \"director\",\r\n    }\r\n]);\r\n\r\nconst selects = ref([\r\n    { \r\n        id: 1, \r\n        model: \"regionId\", \r\n        label: \"regionOrganizationLabel\", \r\n        placeholder: \"regionOrganizationPlaceholder\",\r\n        errorKey: \"regionId\",\r\n        options: regions,\r\n        success: isSuccessRegions,\r\n        loading: isLoadingRegions\r\n    },\r\n    { \r\n        id: 2, \r\n        model: \"districtId\", \r\n        label: \"districtOrganizationLabel\", \r\n        placeholder: \"districtOrganizationPlaceholder\",\r\n        errorKey: \"districtId\",\r\n        options: districts,\r\n        success: isSuccessDistricts,\r\n        loading: isLoadingDistricts\r\n    }\r\n]);\r\n\r\nconst { mutate: createMutate } = useMutation({\r\n    onMutate: (body) => {\r\n        isSubmit.value = true;\r\n        \r\n        body.regionId = body.regionId[0];\r\n        body.districtId = body.districtId[0];\r\n    },\r\n    mutationFn: (body) => create(\"organization\", body),\r\n    onSuccess: () => {\r\n        queryClient.invalidateQueries({ queryKey: [\"companies\"] });\r\n        \r\n        router.push(routes.COMPANIES.path);\r\n        // setTimeout(() => toast.success(t(\"createToast\")), 1000);\r\n    }\r\n});\r\n\r\nconst submitHandler = () => {\r\n    v$.value.$validate();\r\n\r\n    if (v$.value.$errors.length) {\r\n        return;\r\n    }\r\n\r\n    createMutate(state.value);\r\n    v$.value.$reset();\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>"],"names":["queryClient","useQueryClient","router","useRouter","useToast","useI18n","isSubmit","ref","state","rules","computed","required","v$","useVuelidate","regions","isSuccessRegions","isLoadingRegions","__temp","__restore","_withAsyncContext","useQuery","manualGetRegions","valueRegion","isEnabled","watch","districts","isSuccessDistricts","isLoadingDistricts","manualGetDistricts","inputs","selects","createMutate","useMutation","body","create","routes","submitHandler"],"mappings":"6kBA6DA,MAAMA,EAAcC,GAAc,EAC5BC,EAASC,GAAS,EACVC,EAAW,EACXC,EAAU,EAExB,MAAMC,EAAWC,EAAI,EAAK,EAEpBC,EAAQD,EAAI,CACd,SAAU,GACV,IAAK,GACL,QAAS,GACT,YAAa,GACb,SAAU,GACV,SAAU,CAAE,EACZ,WAAY,CAAE,CAClB,CAAC,EAEKE,EAAQC,EAAS,KAAO,CAC1B,SAAU,CAAE,SAAAC,CAAU,EACtB,IAAK,CAAE,SAAAA,CAAU,EACjB,QAAS,CAAE,SAAAA,CAAU,EACrB,YAAa,CAAE,SAAAA,CAAU,EACzB,SAAU,CAAE,SAAAA,CAAU,EACtB,SAAU,CAAE,SAAAA,CAAU,EACtB,WAAY,CAAE,SAAAA,CAAU,CAC5B,EAAE,EAEIC,EAAKC,GAAaJ,EAAOD,CAAK,EAE9B,CACF,KAAMM,EACN,UAAWC,EACX,UAAWC,CACf,GAAU,CAAAC,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACf,SAAU,CAAC,SAAS,EACpB,QAAS,IAAMC,GAAkB,CACrC,CAAC,CAAA,mBAEKC,EAAcZ,EAAS,IAAMF,EAAM,MAAM,QAAQ,EAEjDe,EAAYb,EAAS,IAAM,CAAC,CAACY,EAAY,MAAM,MAAM,EAE3DE,GAAMF,EAAa,IAAM,CAChBhB,EAAS,QACVE,EAAM,MAAM,WAAa,GAEjC,EAAG,CAAE,UAAW,EAAI,CAAE,EAEtB,KAAM,CACF,KAAMiB,EACN,UAAWC,EACX,UAAWC,CACf,GAAU,CAAAV,EAAAC,CAAA,EAAAC,EAAA,IAAAC,EAAS,CACf,SAAU,CAAC,YAAa,CAAE,WAAYE,CAAW,CAAE,EACnD,QAAS,IAAMM,GAAmBN,EAAY,KAAK,EACnD,QAASC,CACb,CAAC,CAAA,mBAEKM,EAAStB,EAAI,CACf,CACI,GAAI,EACJ,MAAO,WACP,MAAO,wBACP,YAAa,8BACb,KAAM,gBACN,SAAU,UACb,EACD,CACI,GAAI,EACJ,MAAO,MACP,MAAO,uBACP,YAAa,6BACb,KAAM,MACN,SAAU,KACb,EACD,CACI,GAAI,EACJ,MAAO,UACP,MAAO,2BACP,YAAa,iCACb,KAAM,UACN,SAAU,SACb,EACD,CACI,GAAI,EACJ,MAAO,cACP,MAAO,yBACP,YAAa,+BACb,KAAM,QACN,SAAU,aACb,EACD,CACI,GAAI,EACJ,MAAO,WACP,MAAO,4BACP,YAAa,kCACb,KAAM,SACN,SAAU,UACb,CACL,CAAC,EAEKuB,EAAUvB,EAAI,CAChB,CACI,GAAI,EACJ,MAAO,WACP,MAAO,0BACP,YAAa,gCACb,SAAU,WACV,QAASO,EACT,QAASC,EACT,QAASC,CACZ,EACD,CACI,GAAI,EACJ,MAAO,aACP,MAAO,4BACP,YAAa,kCACb,SAAU,aACV,QAASS,EACT,QAASC,EACT,QAASC,CACZ,CACL,CAAC,EAEK,CAAE,OAAQI,CAAc,EAAGC,GAAY,CACzC,SAAWC,GAAS,CAChB3B,EAAS,MAAQ,GAEjB2B,EAAK,SAAWA,EAAK,SAAS,CAAC,EAC/BA,EAAK,WAAaA,EAAK,WAAW,CAAC,CACtC,EACD,WAAaA,GAASC,GAAO,eAAgBD,CAAI,EACjD,UAAW,IAAM,CACbjC,EAAY,kBAAkB,CAAE,SAAU,CAAC,WAAW,CAAG,CAAA,EAEzDE,EAAO,KAAKiC,EAAO,UAAU,IAAI,CAEpC,CACL,CAAC,EAEKC,EAAgB,IAAM,CACxBxB,EAAG,MAAM,YAEL,CAAAA,EAAG,MAAM,QAAQ,SAIrBmB,EAAavB,EAAM,KAAK,EACxBI,EAAG,MAAM,SACb"}