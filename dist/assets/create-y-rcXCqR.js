import{u as Z,a as ee,b as ae,y as te,c as w,r as f,z as V,d as q,e as b,k as C,h as s,w as oe,F as K,C as M,D as v,i as re,l as se,m as p,o as m,s as F,A as L,f as I,t as T,H as ne,E as ue}from"./index-4UPdn8r5.js";import{u as le,r as $}from"./i18n-validators-rYP8hPEZ.js";import{a as ie,u as de}from"./generic.services-suEnlNvN.js";import{u as W}from"./useQuery-J_Xc9Nln.js";import{c as me}from"./crud.services-eNoFKDSu.js";import{h as ce,k as ye}from"./manual.services-sihQqlgC.js";const pe={key:0,class:"manage section-height shadowed"},he={class:"manage__inner section-padding"},$e={__name:"create",async setup(_e){let t,c;const k=ie(),U=se();Z(),ee();const B=ae(),{user:y}=te(B),h=w(()=>{var a,_;return!!((_=(a=y==null?void 0:y.value.user)==null?void 0:a.modules)!=null&&_.includes(ne.WAREHOUSE.CREATE))}),o=f({materialId:[],quantity:"",quantityTypeId:[]}),H=w(()=>({materialId:{required:$},quantity:{required:$},quantityTypeId:{required:$}})),r=le(H,o),{data:N,isSuccess:A,isLoading:Q}=([t,c]=V(()=>W({queryKey:["types"],queryFn:()=>ye(),enabled:h})),t=await t,c(),t),{data:R,isSuccess:x,isLoading:P}=([t,c]=V(()=>W({queryKey:["materialsList",{organizationId:y.value.user.organizationId}],queryFn:()=>ce(),enabled:h})),t=await t,c(),t),z=f([{id:1,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),D=f([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:R,success:x,loading:P},{id:2,model:"quantityTypeId",label:"qunatityTypesWarehouseLabel",placeholder:"qunatityTypesWarehousePlaceholder",errorKey:"quantityTypeId",options:N,success:A,loading:Q}]),{mutate:O}=de({onMutate:a=>{a.materialId=a.materialId[0],a.quantityTypeId=a.quantityTypeId[0]},mutationFn:a=>me("warehouse",a),onSuccess:a=>{o.value=ue(o.value),k.invalidateQueries({queryKey:["warehouse"]}),U.push(F.WAREHOUSE.path)}}),j=()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...o.value};O(a),r.value.$reset()};return(a,_)=>{var S,E;const G=p("ManageHead"),J=p("FormInput"),X=p("FormSelect"),Y=p("CustomButton");return h.value?(m(),q("section",pe,[b("div",he,[C(G,{title:"addNewProductTitle",to:s(F).WAREHOUSE.path},null,8,["to"]),b("form",{class:"manage__form form-manage",onSubmit:oe(j,["prevent"])},[(m(!0),q(K,null,M(z.value,e=>{var n,u,l,i,d;return m(),L(J,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":g=>o.value[e.model]=g,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(u=(n=s(r))==null?void 0:n[e.errorKey])==null?void 0:u.$error,textError:(d=(i=(l=s(r))==null?void 0:l[e.errorKey])==null?void 0:i.$errors[0])==null?void 0:d.$message},{default:v(()=>[I(T(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(m(!0),q(K,null,M(D.value,e=>{var n,u,l,i,d;return m(),L(X,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":g=>o.value[e.model]=g,width:500,options:e.options,error:(u=(n=s(r))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(d=(i=(l=s(r))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:d.$message,success:e.success,loading:e.loading},{default:v(()=>[I(T(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),C(Y,{className:`form__submit ${(E=(S=s(r))==null?void 0:S.quantityTypeId.$errors[0])!=null&&E.$message?"centered":""}`},{default:v(()=>[I(T(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):re("",!0)}}};export{$e as default};
