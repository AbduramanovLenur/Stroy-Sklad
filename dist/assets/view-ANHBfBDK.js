import{_ as Ve,u as Oe,a as Te,r as b,b as je,x as qe,c as u,y as c,B as W,d as I,e as B,k as Pe,h as i,w as Ke,F,C as V,z as r,i as y,D as h,l as Ne,E as Re,m as g,o as n,A as S,f as _,t as k,ae as ze,G as O,I as T}from"./index-sKMtYVf1.js";import{a as Ee,u as x}from"./generic.services-Y9l1kbCB.js";import{u as p}from"./useQuery-oNoZrsai.js";import{a as Ue,b as De,e as $e}from"./crud.services-OfzCCZDD.js";import{e as Ge,f as Qe,g as He,h as We,i as xe,j as Je}from"./manual.services-XDT6etPx.js";const Xe={key:0,class:"manage section-height shadowed"},Ye={class:"manage__inner section-padding"},Ze={class:"manage__overlay"},ea={key:2,class:"manage__triggers"},aa={__name:"view",async setup(oa){let o,t;const L=Ee(),w=Ne(),J=Re();Oe(),Te();const m=b(J.params.id),X=je(),{user:d}=qe(X),f=u(()=>{var e,s;return!!((s=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)!=null&&s.includes(O.APPLICATION.READ))}),Y=b([{id:1,label:"appFloor",width:215},{id:2,label:"appMaterial",width:290},{id:3,label:"appCount",width:250},{id:4,label:"appPrice",width:300},{id:5,label:"appCost"}]),l=b({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],roleIds:[],applicationTables:[],details:"",statusId:""}),{data:Z,isSuccess:ee,isLoading:ae}=([o,t]=c(()=>p({queryKey:["rolesList",{organizationId:d.value.user.organizationId}],queryFn:()=>Ge(),enabled:f})),o=await o,t(),o),{data:oe,isSuccess:le,isLoading:se}=([o,t]=c(()=>p({queryKey:["objectsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Qe(),enabled:f})),o=await o,t(),o),C=u(()=>l.value.buildingObjectId),te=u(()=>!!C.value.length),{data:ie,isSuccess:ne,isLoading:de}=([o,t]=c(()=>p({queryKey:["blocksList",{blockId:C}],queryFn:()=>xe(C.value),enabled:te})),o=await o,t(),o),A=u(()=>l.value.buildingBlockId),M=u(()=>!!A.value.length),{data:ue,isSuccess:j,isLoading:ce}=([o,t]=c(()=>p({queryKey:["floorsList",{floorId:A}],queryFn:()=>Je(A.value),enabled:M})),o=await o,t(),o),{data:re,isSuccess:q,isLoading:pe}=([o,t]=c(()=>p({queryKey:["costsList",{organizationId:d.value.user.organizationId}],queryFn:()=>He(),enabled:M})),o=await o,t(),o),{data:me,isSuccess:P,isLoading:be}=([o,t]=c(()=>p({queryKey:["materialsList",{organizationId:d.value.user.organizationId}],queryFn:()=>We(),enabled:M})),o=await o,t(),o),ye=b([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),ge=b([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:oe,success:le,loading:se},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:ie,success:ne,loading:de},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:Z,success:ee,loading:ae,multiple:!0}]),ve=b([{id:1,model:"details",label:"appCommentLabel",placeholder:"appCommentPlaceholder",errorKey:"details"}]),{isError:Ie}=([o,t]=c(()=>p({queryKey:["applicationsById",m],queryFn:()=>Ue("application",m.value),select:e=>{l.value.id=e.id,l.value.deadline=e.deadline,l.value.buildingObjectId=[e.buildingObjectId],l.value.buildingBlockId=[e.buildingBlockId],l.value.roleIds=[...e.roleIds],l.value.applicationTables=[...e.applicationTables],l.value.details=e.details,l.value.statusId=e.statusId},enabled:f})),o=await o,t(),o),K=u(()=>T(ue.value||[])),N=u(()=>T(re.value||[])),R=u(()=>T(me.value||[])),he=e=>{var s;return(s=K.value[e.floorId])==null?void 0:s.name},_e=e=>{var s;return(s=N.value[e.costId])==null?void 0:s.name},ke=e=>{var s;return(s=R.value[e==null?void 0:e.constructionMaterialId])==null?void 0:s.name},Le=u(()=>Object.keys(K.value).length&&Object.keys(N.value).length&&Object.keys(R.value).length);W(Le,e=>{e&&(l.value.applicationTables=l.value.applicationTables.map(s=>({...s,floorValue:he(s),costValue:_e(s),constructionMaterialValue:ke(s)})))},{immediate:!0}),W(Ie,e=>{e&&w.push(S.HOME.path)});const{mutate:fe}=x({mutationFn:e=>De("application",e),onSuccess:()=>{L.invalidateQueries({queryKey:["applications"]}),L.invalidateQueries({queryKey:["applicationsById",m]}),w.push(S.APPLICATION.path)}}),{mutate:Se}=x({mutationFn:e=>$e("application",e),onSuccess:()=>{L.invalidateQueries({queryKey:["applications"]}),L.invalidateQueries({queryKey:["applicationsById",m]}),w.push(S.APPLICATION.path)}}),we=()=>{fe(m.value)},Ce=()=>{Se(m.value)};return(e,s)=>{var U,D,$,G,Q,H;const z=g("ManageHead"),Ae=g("FormInput"),Me=g("FormSelect"),Be=g("SubTable"),Fe=g("Spinner"),E=g("MyButton");return f.value?(n(),I("section",Xe,[B("div",Ye,[Pe(z,{title:"addNewApplicationTitle",to:i(S).APPLICATION.path},null,8,["to"]),B("form",{class:"manage__form",onSubmit:s[0]||(s[0]=Ke(()=>{},["prevent"]))},[B("div",Ze,[(n(!0),I(F,null,V(ye.value,a=>(n(),r(Ae,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":v=>l.value[a.model]=v,width:500,placeholder:e.$t(a.placeholder),name:a.icon,type:a==null?void 0:a.type,isDisabled:!0},{default:h(()=>[_(k(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),(n(!0),I(F,null,V(ge.value,a=>(n(),r(Me,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":v=>l.value[a.model]=v,width:500,options:a.options,placeholder:a==null?void 0:a.placeholder,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple,isDisabled:!0},{default:h(()=>[_(k(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128))]),i(q)&&i(P)&&i(j)&&l.value.applicationTables.length?(n(),r(Be,{key:0,headers:Y.value,table:l.value.applicationTables},null,8,["headers","table"])):y("",!0),i(pe)||i(be)||i(ce)||!l.value.applicationTables.length?(n(),r(Fe,{key:1})):y("",!0),(n(!0),I(F,null,V(ve.value,a=>(n(),r(ze,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":v=>l.value[a.model]=v,width:500,placeholder:e.$t(a.placeholder),isDisabled:!0},{default:h(()=>[_(k(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]))),128)),i(q)&&i(P)&&i(j)&&l.value.statusId!==7&&l.value.statusId!==15?(n(),I("div",ea,[($=(D=(U=i(d))==null?void 0:U.user)==null?void 0:D.modules)!=null&&$.includes(i(O).APPLICATION.CONFIRM)?(n(),r(E,{key:0,icon:"approve",type:"submit",color:"green",width:180,onClick:Ce},{default:h(()=>[_(k(e.$t("acceptButton")),1)]),_:1})):y("",!0),(H=(Q=(G=i(d))==null?void 0:G.user)==null?void 0:Q.modules)!=null&&H.includes(i(O).APPLICATION.REFUSAL)?(n(),r(E,{key:1,icon:"refusal",type:"submit",color:"red",width:180,onClick:we},{default:h(()=>[_(k(e.$t("cancelButton")),1)]),_:1})):y("",!0)])):y("",!0)],32)])])):y("",!0)}}},da=Ve(aa,[["__scopeId","data-v-17049b45"]]);export{da as default};
//# sourceMappingURL=view-ANHBfBDK.js.map
