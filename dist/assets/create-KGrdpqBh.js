import{u as oe,a as ae,b as re,y as se,c as F,r as P,z as te,d as p,e as U,k,h as s,w as le,F as M,C as ne,D as i,i as h,l as ue,m,o as n,s as B,A as T,f as y,t as _,H as me,E as ce}from"./index-qYaOSAk5.js";import{u as de,r as t,m as pe}from"./i18n-validators-FA-njMbI.js";import{a as ie,u as he}from"./generic.services-uSp9rJcx.js";import{u as ye}from"./useQuery-3KlBkAoQ.js";import{c as _e}from"./crud.services-6H1cbtzh.js";import{e as ge}from"./manual.services-e5QN_9-o.js";const be={key:0,class:"manage section-height shadowed"},ve={class:"manage__inner section-padding"},Ee={__name:"create",async setup(Ne){let u,g;const z=ie(),q=ue(),x=oe(),{t:G}=ae(),H=re(),{user:l}=se(H),b=F(()=>{var o,c;return!!((c=(o=l==null?void 0:l.value.user)==null?void 0:o.modules)!=null&&c.includes(me.ORG_USER.CREATE))}),a=P({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:l.value.user.organizationId,roleId:[]}),A=F(()=>({fullName:{required:t},userName:{required:t},password:{required:t,minLength:pe},phoneNumber:{required:t},organizationId:{required:t},roleId:{required:t}})),r=de(A,a),{data:D,isSuccess:O,isLoading:Q}=([u,g]=te(()=>ye({queryKey:["rolesList",{organizationId:l.value.user.organizationId}],queryFn:()=>ge(),enabled:b})),u=await u,g(),u),j=P([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:D,success:O,loading:Q,select:!0}]),{mutate:J,status:W}=he({onMutate:o=>{o.roleId=o.roleId[0]},mutationFn:o=>_e("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=ce(a.value),z.invalidateQueries({queryKey:["orgUsers"]}),q.push(B.ORG_USER.path),setTimeout(()=>x.success(G("createToast")),150))}}),X=()=>{if(r.value.$validate(),r.value.$errors.length)return;const o={...a.value};J(o),r.value.$reset()};return(o,c)=>{var v,N;const Y=m("ManageHead"),Z=m("FormInput"),f=m("FormSelect"),ee=m("CustomButton");return b.value?(n(),p("section",be,[U("div",ve,[k(Y,{title:"addNewEmployeesTitle",to:s(B).ORG_USER.path},null,8,["to"]),U("form",{class:"manage__form form-manage",onSubmit:le(X,["prevent"])},[(n(!0),p(M,null,ne(j.value,e=>{var w,$,I,R,S,V,E,L,K,C;return n(),p(M,{key:e.id},[e!=null&&e.select?h("",!0):(n(),T(Z,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:($=(w=s(r))==null?void 0:w[e.errorKey])==null?void 0:$.$error,type:e==null?void 0:e.type,textError:(S=(R=(I=s(r))==null?void 0:I[e.errorKey])==null?void 0:R.$errors[0])==null?void 0:S.$message},{default:i(()=>[y(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),e!=null&&e.select?(n(),T(f,{key:1,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,modelModifiers:{trim:!0},width:500,options:e.options,error:(E=(V=s(r))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:E.$error,placeholder:e==null?void 0:e.placeholder,textError:(C=(K=(L=s(r))==null?void 0:L[e==null?void 0:e.errorKey])==null?void 0:K.$errors[0])==null?void 0:C.$message,success:e.success,loading:e.loading},{default:i(()=>[y(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):h("",!0)],64)}),128)),k(ee,{className:`form__submit ${(N=(v=s(r))==null?void 0:v.roleId.$errors[0])!=null&&N.$message?"centered":""}`,disabled:s(W)==="pending"},{default:i(()=>[y(_(o.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):h("",!0)}}};export{Ee as default};
