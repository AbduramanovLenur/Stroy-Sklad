import{u as te,a as oe,r as m,c as p,z as w,C as se,d as g,e as E,k as F,h as s,w as ne,F as M,D as ie,A as h,l as ce,m as u,o as i,s as P,B as q,f as y,t as _,i as B,E as le}from"./index-MC-ZGS-B.js";import{c as ue}from"./crud.services-6pM_UmBK.js";import{m as de,a as me}from"./manual.services-A3PttgtW.js";import{u as pe,r as n}from"./i18n-validators-kzZnUJdY.js";import{u as ge}from"./generic.services-iK8gJFXy.js";import{u as k}from"./useQuery-Q5uFjRao.js";import{u as he}from"./useMutation-FykAeqRT.js";const ye={class:"manage section-height shadowed"},_e={class:"manage__inner section-padding"},Ve={__name:"create",async setup(be){let t,c;const b=ge(),D=ce(),x=te(),{t:R}=oe(),v=m(!1),a=m({fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[]}),T=p(()=>({fullName:{required:n},inn:{required:n},address:{required:n},phoneNumber:{required:n},director:{required:n},regionId:{required:n},districtId:{required:n}})),o=pe(T,a),{data:A,isSuccess:Q,isLoading:U}=([t,c]=w(()=>k({queryKey:["regions"],queryFn:()=>de()})),t=await t,c(),t),l=p(()=>a.value.regionId[0]),H=p(()=>!!l.value);se(l,()=>{v.value||(a.value.districtId=[])},{immediate:!0});const{data:G,isSuccess:j,isLoading:J}=([t,c]=w(()=>k({queryKey:["districts",{districtId:l}],queryFn:()=>me(l.value),enabled:H})),t=await t,c(),t),W=m([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",type:"number"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"},{id:6,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:A,success:Q,loading:U,select:!0},{id:7,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:G,success:j,loading:J,select:!0}]),{mutate:X,status:Y}=he({onMutate:r=>{v.value=!0,r.regionId=r.regionId[0],r.districtId=r.districtId[0]},mutationFn:r=>ue("organization",r),onSuccess:r=>{r!=null&&r.success&&(a.value=le(a.value),b.invalidateQueries({queryKey:["companies"]}),b.invalidateQueries({queryKey:["organizations"]}),D.push(P.COMPANIES.path),setTimeout(()=>x.success(R("createToast")),150))}}),Z=()=>{if(o.value.$validate(),o.value.$errors.length)return;const r={...a.value};X(r),o.value.$reset()};return(r,ve)=>{var I,z;const f=u("ManageHead"),ee=u("FormInput"),re=u("FormSelect"),ae=u("CustomButton");return i(),g("section",ye,[E("div",_e,[F(f,{title:"addNewCompanyTitle",to:s(P).COMPANIES.path},null,8,["to"]),E("form",{class:"manage__form form-manage",onSubmit:ne(Z,["prevent"])},[(i(!0),g(M,null,ie(W.value,e=>{var N,$,O,K,S,V,C,L;return i(),g(M,{key:e.id},[e!=null&&e.select?B("",!0):(i(),q(ee,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,width:500,placeholder:r.$t(e.placeholder),name:e.icon,error:(N=s(o))==null?void 0:N[e.errorKey].$error,type:e==null?void 0:e.type,textError:(O=($=s(o))==null?void 0:$[e.errorKey].$errors[0])==null?void 0:O.$message},{default:h(()=>[y(_(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),e!=null&&e.select?(i(),q(re,{key:1,modelValue:a.value[e.model],"onUpdate:modelValue":d=>a.value[e.model]=d,modelModifiers:{trim:!0},width:500,options:e.options,error:(S=(K=s(o))==null?void 0:K[e==null?void 0:e.errorKey])==null?void 0:S.$error,placeholder:e==null?void 0:e.placeholder,textError:(L=(C=(V=s(o))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:C.$errors[0])==null?void 0:L.$message,success:e.success,loading:e.loading},{default:h(()=>[y(_(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):B("",!0)],64)}),128)),F(ae,{className:`form__submit ${(z=(I=s(o))==null?void 0:I.districtId.$errors[0])!=null&&z.$message?"centered":""}`,disabled:s(Y)==="pending"},{default:h(()=>[y(_(r.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])}}};export{Ve as default};
