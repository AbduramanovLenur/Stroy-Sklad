import{_ as Me,u as Be,a as Fe,r as m,b as Oe,x as Te,c as n,y as b,B as Q,d as k,e as F,k as Ve,h as d,w as je,F as R,C as G,z as c,i as r,D as g,ag as Pe,l as qe,E as Ke,m as v,o as i,A as f,f as h,t as I,G as O,I as T}from"./index-KKCGiaOF.js";import{a as Ne,u as H}from"./generic.services-xhLq1RN3.js";import{u as y}from"./useQuery-W7o1xA7A.js";import{a as Ee,e as De,f as ze}from"./crud.services-tsBZfuRX.js";import{f as Ue,g as $e,h as Qe,i as Re,j as Ge}from"./manual.services-1tbz_eEo.js";const He={key:0,class:"manage section-height shadowed"},We={class:"manage__inner section-padding"},xe={class:"manage__overlay"},Je={key:3,class:"manage__triggers"},Xe={__name:"view",async setup(Ye){let t,s;const _=Ne(),L=qe(),W=Ke();Be(),Fe();const p=m(W.params.id),x=Oe(),{user:u}=Te(x),C=n(()=>{var e,l;return!!((l=(e=u==null?void 0:u.value.user)==null?void 0:e.modules)!=null&&l.includes(O.APPLICATION.READ))}),J=m([{id:1,label:"appFloor",width:350},{id:2,label:"appMaterial",width:370},{id:3,label:"appCount",width:260},{id:4,label:"appPrice",width:350}]),o=m({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],applicationTables:[],details:"",statusId:""}),{data:X,isSuccess:Y,isLoading:Z}=([t,s]=b(()=>y({queryKey:["objectsList",{organizationId:u.value.user.organizationId}],queryFn:()=>Ue(),enabled:C})),t=await t,s(),t),S=n(()=>o.value.buildingObjectId),ee=n(()=>!!S.value.length),{data:ae,isSuccess:te,isLoading:oe}=([t,s]=b(()=>y({queryKey:["blocksList",{blockId:S}],queryFn:()=>Re(S.value),enabled:ee})),t=await t,s(),t),w=n(()=>o.value.buildingBlockId),A=n(()=>!!w.value.length),{data:le,isSuccess:se,isLoading:ie}=([t,s]=b(()=>y({queryKey:["floorsList",{floorId:w}],queryFn:()=>Ge(w.value),enabled:A})),t=await t,s(),t),{data:ne,isSuccess:ue,isLoading:de}=([t,s]=b(()=>y({queryKey:["costsList",{organizationId:u.value.user.organizationId}],queryFn:()=>$e(),enabled:A})),t=await t,s(),t),{data:ce,isSuccess:re,isLoading:pe}=([t,s]=b(()=>y({queryKey:["materialsList",{organizationId:u.value.user.organizationId}],queryFn:()=>Qe(),enabled:A})),t=await t,s(),t),M=n(()=>!!(ue&&re&&se&&o.applicationTables.length)),me=m([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),be=m([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:X,success:Y,loading:Z},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:ae,success:te,loading:oe}]);m([{id:1,model:"details",label:"appCommentLabel",placeholder:"appCommentPlaceholder",errorKey:"details"}]);const{isError:ve}=([t,s]=b(()=>y({queryKey:["applicationsById",p],queryFn:()=>Ee("application",p.value),select:e=>{o.value.id=e.id,o.value.deadline=e.deadline,o.value.buildingObjectId=[e.buildingObjectId],o.value.buildingBlockId=[e.buildingBlockId],o.value.applicationTables=[...e.applicationTables],o.value.details=e.details,o.value.statusId=e.statusId},enabled:C})),t=await t,s(),t),V=n(()=>T(le.value||[])),j=n(()=>T(ne.value||[])),P=n(()=>T(ce.value||[])),ye=e=>{var l;return(l=V.value[e.floorId])==null?void 0:l.name},ge=e=>{var l;return(l=j.value[e.costId])==null?void 0:l.name},he=e=>{var l;return(l=P.value[e==null?void 0:e.constructionMaterialId])==null?void 0:l.name},Ie=n(()=>Object.keys(V.value).length&&Object.keys(j.value).length&&Object.keys(P.value).length);Q(Ie,e=>{e&&(o.value.applicationTables=o.value.applicationTables.map(l=>({...l,floorValue:ye(l),costValue:ge(l),constructionMaterialValue:he(l)})))},{immediate:!0}),Q(ve,e=>{e&&L.push(f.HOME.path)});const{mutate:_e}=H({mutationFn:e=>De("application",e),onSuccess:()=>{_.invalidateQueries({queryKey:["applications"]}),_.invalidateQueries({queryKey:["applicationsById",p]}),L.push(f.APPLICATION.path)}}),{mutate:ke}=H({mutationFn:e=>ze("application",e),onSuccess:()=>{_.invalidateQueries({queryKey:["applications"]}),_.invalidateQueries({queryKey:["applicationsById",p]}),L.push(f.APPLICATION.path)}}),fe=()=>{_e(p.value)},Le=()=>{ke(p.value)};return(e,l)=>{var N,E,D,z,U,$;const q=v("ManageHead"),Ce=v("FormInput"),Se=v("FormSelect"),we=v("SubTable"),Ae=v("Spinner"),K=v("MyButton");return C.value?(i(),k("section",He,[F("div",We,[Ve(q,{title:"addNewApplicationTitle",to:d(f).APPLICATION.path},null,8,["to"]),F("form",{class:"manage__form",onSubmit:l[1]||(l[1]=je(()=>{},["prevent"]))},[F("div",xe,[(i(!0),k(R,null,G(me.value,a=>(i(),c(Ce,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":B=>o.value[a.model]=B,width:500,placeholder:e.$t(a.placeholder),name:a.icon,type:a==null?void 0:a.type,isDisabled:!0},{default:g(()=>[h(I(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),(i(!0),k(R,null,G(be.value,a=>(i(),c(Se,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":B=>o.value[a.model]=B,width:500,options:a.options,placeholder:a==null?void 0:a.placeholder,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple,isDisabled:!0},{default:g(()=>[h(I(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128))]),M.value?(i(),c(we,{key:0,headers:J.value,table:o.value.applicationTables},null,8,["headers","table"])):r("",!0),d(de)||d(pe)||d(ie)||!o.value.applicationTables.length?(i(),c(Ae,{key:1})):r("",!0),M.value?(i(),c(Pe,{key:2,modelValue:o.value.details,"onUpdate:modelValue":l[0]||(l[0]=a=>o.value.details=a),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),isDisabled:!0},{default:g(()=>[h(I(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder"])):r("",!0),M.value&&o.value.statusId!==7&&o.value.statusId!==15?(i(),k("div",Je,[(D=(E=(N=d(u))==null?void 0:N.user)==null?void 0:E.modules)!=null&&D.includes(d(O).APPLICATION.CONFIRM)?(i(),c(K,{key:0,icon:"approve",type:"submit",color:"green",width:180,onClick:Le},{default:g(()=>[h(I(e.$t("acceptButton")),1)]),_:1})):r("",!0),($=(U=(z=d(u))==null?void 0:z.user)==null?void 0:U.modules)!=null&&$.includes(d(O).APPLICATION.REFUSAL)?(i(),c(K,{key:1,icon:"refusal",type:"submit",color:"red",width:180,onClick:fe},{default:g(()=>[h(I(e.$t("cancelButton")),1)]),_:1})):r("",!0)])):r("",!0)],32)])])):r("",!0)}}},la=Me(Xe,[["__scopeId","data-v-f1573b7a"]]);export{la as default};
//# sourceMappingURL=view-FLMdQ6aF.js.map
