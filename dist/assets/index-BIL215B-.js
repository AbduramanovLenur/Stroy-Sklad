import{u as J,a as X,x as Y,y as M,b as Z,c as ee,r as B,z as te,d as P,e as se,k as q,h as e,A as L,i as n,t as ae,m as i,o as u,s as U,H as c}from"./index-BTOQ0EkA.js";import{a as oe,u as ne}from"./generic.services-aA1xp-Zb.js";import{u as ie}from"./useQuery-0j72TF6v.js";import{g as ue,d as ce}from"./crud.services-omo8rLXB.js";import{r as re}from"./index-jSmiWUHg.js";const le={key:0,class:"estimate"},de={class:"estimate__inner"},me={key:2,class:"empty-table shadowed"},Ee={__name:"index",async setup(_e){let a,_;const T=oe(),H=J(),{t:N}=X(),Q=Y(),{page:r,limit:l,search:R}=M(Q),x=Z(),{user:s}=M(x),S=ee(()=>{var t,m;return!!((m=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&m.includes(c.ESTIMATE.READ))}),b=B(""),h=re(R,500),z=B([{id:1,label:"estimateName",width:25},{id:2,label:"estimateObject",width:25},{id:3,label:"estimateAddress",width:20},{id:4,label:"estimatePrice",width:20}]),{data:o,isLoading:K,isSuccess:d,isError:V}=([a,_]=te(()=>ie({queryKey:["budgets",{page:r,limit:l,debouncedSearch:h,organizationId:s.value.user.organizationId,roleId:s.value.user.roleId}],queryFn:()=>ue("budget",r.value,l.value,h.value),enabled:S})),a=await a,_(),a),{mutate:F}=ne({mutationFn:t=>ce("budget",t),onSuccess:t=>{t!=null&&t.success&&(T.invalidateQueries({queryKey:["budgets"]}),T.invalidateQueries({queryKey:["budgetById",b]}),setTimeout(()=>H.success(N("deleteToast")),150))}}),O=async t=>{b.value=t,F(t)};return(t,m)=>{var p,E,g,y,A,v,w,I,f,D,C,k;const j=i("HeadPage"),W=i("Table"),$=i("Pagination"),G=i("Spinner");return S.value?(u(),P("section",le,[se("div",de,[q(j,{title:"estimateTitle",to:e(U).CREATE_ESTIMATE.path,isShowCreate:(g=(E=(p=e(s))==null?void 0:p.user)==null?void 0:E.modules)==null?void 0:g.includes(e(c).ESTIMATE.CREATE)},null,8,["to","isShowCreate"]),e(d)&&((y=e(o))!=null&&y.count)?(u(),L(W,{key:0,headers:z.value,table:(A=e(o))==null?void 0:A.budgets,to:e(U).UPDATE_ESTIMATE.name,options:{page:e(r),limit:e(l)},isShowUpdate:(I=(w=(v=e(s))==null?void 0:v.user)==null?void 0:w.modules)==null?void 0:I.includes(e(c).ESTIMATE.UPDATE),isShowDelete:(C=(D=(f=e(s))==null?void 0:f.user)==null?void 0:D.modules)==null?void 0:C.includes(e(c).ESTIMATE.DELETE),onOnActionDelete:O},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q($,{count:(k=e(o))==null?void 0:k.count,isSucces:e(d)},null,8,["count","isSucces"]),e(K)?(u(),L(G,{key:1})):n("",!0),e(d)&&!e(o).count||e(V)?(u(),P("div",me,ae(t.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{Ee as default};
