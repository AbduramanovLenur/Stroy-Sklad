import{_ as O,u as J,a as W,b as X,y as Y,c as f,r as Z,z as M,d,e as i,k as r,D as y,h as j,w as x,F as ee,C as se,i as C,l as te,m,o as p,f as h,t as I,s as oe,G as ae}from"./index-dfDRnHVv.js";import{a as ne,u as le}from"./generic.services-RbGpw9-f.js";import{u as E}from"./useQuery-dYILSx3_.js";import{h as ie,i as re}from"./crud.services-ogW4KK8c.js";import{e as ue}from"./manual.services-h1vsqTf4.js";import{v as u}from"./v4-yQnnJER4.js";const ce={key:0,class:"management-role section-height shadowed"},de={class:"management-role__inner section-padding"},me={class:"management-role__head"},pe={class:"management-role__selects"},_e={class:"management-role__select-box"},ve={class:"management-role__actions"},ge=["onClick"],fe=["onClick"],ye={__name:"management-role",async setup(he){let n,_;const b=ne();te();const B=J(),{t:w}=W(),N=X(),{user:c}=Y(N),k=f(()=>{var e,t;return!!((t=(e=c==null?void 0:c.value.user)==null?void 0:e.modules)!=null&&t.includes(ae.MANAGEMENT_ROLE.CREATE))}),a=Z([{uuid:u(),roleIds:[],label:"creatorApp"},{uuid:u(),roleIds:[],label:"confirmApp"}]),{data:T,isSuccess:q,isLoading:L}=([n,_]=M(()=>E({queryKey:["rolesList",{organizationId:c.value.user.organizationId}],queryFn:()=>ue(),enabled:k})),n=await n,_(),n),{data:Ie,isSuccess:V,isLoading:F}=([n,_]=M(()=>E({queryKey:["positions",{organizationId:c.value.user.organizationId}],queryFn:()=>ie("application_position"),select:e=>{if(e.length)return a.value=e.map((t,s)=>{let o={};return s===0?o={uuid:u(),roleIds:[...t.roleIds],label:"creatorApp"}:s+1===e.length?o={uuid:u(),roleIds:[...t.roleIds],label:"confirmApp"}:o={uuid:u(),roleIds:[...t.roleIds],label:"inspectorApp"},o}),e},enabled:k})),n=await n,_(),n),z=f(()=>q.value&&V.value),K=f(()=>L.value&&F.value),Q=e=>{a.value.splice(e,0,{uuid:u(),roleIds:[],label:"inspectorApp"})},G=e=>{a.value.splice(e,1)},P=f(()=>e=>{var s;const t=a.value.reduce((o,A,v)=>(v!==e&&o.push(...A.roleIds),o),[]);return(s=T.value)==null?void 0:s.filter(o=>!t.includes(o.id))}),{mutate:$}=le({onMutate:e=>{e=e.map(t=>{const s={...t};return s==null||delete s.uuid,s==null||delete s.label,s})},mutationFn:e=>re("application_position",e),onSuccess:e=>{b.invalidateQueries({queryKey:["positions"]}),b.invalidateQueries({queryKey:["applications"]}),b.invalidateQueries({queryKey:["applicationsById"]})}}),U=()=>{if(a.value.some(t=>!t.roleIds.length)){B.error(w("isEmptyRole"));return}$(a.value)};return(e,t)=>{const s=m("Title"),o=m("MyButton"),A=m("FormSelect"),v=m("Icon"),D=m("CustomButton");return k.value?(p(),d("section",ce,[i("div",de,[i("div",me,[r(s,null,{default:y(()=>[h(`\r
                    `+I(e.$t("managementTitle"))+`\r
                `,1)]),_:1}),r(o,{to:j(oe).MANAGEMENT.path,icon:"back",type:"link",color:"black"},{default:y(()=>[h(I(e.$t("backButton")),1)]),_:1},8,["to"])]),i("form",{class:"management-role__form",onSubmit:x(U,["prevent"])},[i("div",pe,[(p(!0),d(ee,null,se(a.value,(g,l)=>{var S,R;return p(),d("div",{class:"management-role__select",key:g.uuid},[i("div",_e,[r(A,{modelValue:g.roleIds,"onUpdate:modelValue":H=>g.roleIds=H,width:500,options:P.value(l),placeholder:"managementRolePlaceholder",success:z.value,loading:K.value,isMultiSelect:!0},{default:y(()=>[h(I(e.$t(g.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","success","loading"])]),i("div",ve,[l+1!==((S=a.value)==null?void 0:S.length)?(p(),d("div",{key:0,class:"management-role__icon",onClick:()=>Q(l+1)},[r(v,{name:"plus"})],8,ge)):C("",!0),l!==0&&l+1!==((R=a.value)==null?void 0:R.length)?(p(),d("div",{key:1,class:"management-role__icon",onClick:()=>G(l)},[r(v,{name:"delete-role"})],8,fe)):C("",!0)])])}),128))]),r(D,{className:"form__submit"},{default:y(()=>[h(I(e.$t("formButton")),1)]),_:1})],32)])])):C("",!0)}}},Me=O(ye,[["__scopeId","data-v-19e246ab"]]);export{Me as default};
