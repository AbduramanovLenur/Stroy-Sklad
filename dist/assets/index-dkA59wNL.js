import{g as G,d as J}from"./crud.services-n7kB94wy.js";import{u as Y,a as Z,x as ee,y as B,b as se,c as te,r as X,z as ae,d as q,e as ne,k as L,h as e,A as R,i as u,t as oe,m as l,o as d,s as H,H as p}from"./index-6Y00dUwo.js";import{u as ie}from"./generic.services-DBqHHnAA.js";import{u as re}from"./useQuery-4Ev4vRio.js";import{u as ce}from"./useMutation-ixZ1w3o_.js";import{r as ue}from"./index-C_FfflJ0.js";const le={key:0,class:"expenses"},de={class:"expenses__inner section-padding"},pe={key:2,class:"empty-table shadowed"},be={__name:"index",async setup(me){let o,S;const x=ie(),Q=Y(),{t:V}=Z(),z=ee(),{page:m,limit:_,search:F}=B(z),K=se(),{user:t}=B(K),y=te(()=>{var s,a;return!!((a=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)!=null&&a.includes(p.EXPENS.READ))}),h=X(""),b=ue(F,500),M=X([{id:1,label:"expensesObjectName"},{id:2,label:"expensesBlockName"},{id:3,label:"expensesFloorName"},{id:5,label:"expensesMaterial"},{id:6,label:"expensesCount"},{id:7,label:"expensesType"}]),{data:i,isLoading:U,isSuccess:E,isError:O}=([o,S]=ae(()=>re({queryKey:["expenses",{page:m,limit:_,debouncedSearch:b,organizationId:t.value.user.organizationId,name:t.value.user.fullName}],queryFn:()=>G("expense",m.value,_.value,b.value),select:({expenses:s,count:a})=>{let n=[...s];return n=n.map(r=>{const c={...r,expensPrice:r.price};return delete c.price,c}),{expenses:n,count:a}},enabled:y})),o=await o,S(),o),{mutate:W}=ce({mutationFn:s=>J("expense",s),onSuccess:s=>{s!=null&&s.success&&(x.invalidateQueries({queryKey:["expenses"]}),x.invalidateQueries({queryKey:["expensById",h]}),setTimeout(()=>Q.success(V("deleteToast")),150))}}),j=async s=>{h.value=s,W(s)};return(s,a)=>{var f,g,v,T,N,w,P,C,k,D,A,I;const n=l("HeadPage"),r=l("Table"),c=l("Pagination"),$=l("Spinner");return y.value?(d(),q("section",le,[ne("div",de,[L(n,{title:"expensesTitle",to:e(H).CREATE_EXPENS.path,isShowCreate:(v=(g=(f=e(t))==null?void 0:f.user)==null?void 0:g.modules)==null?void 0:v.includes(e(p).EXPENS.CREATE)},null,8,["to","isShowCreate"]),e(E)&&((T=e(i))!=null&&T.count)?(d(),R(r,{key:0,headers:M.value,table:(N=e(i))==null?void 0:N.expenses,to:e(H).VIEW_EXPENS.name,options:{page:e(m),limit:e(_)},isShowUpdate:(C=(P=(w=e(t))==null?void 0:w.user)==null?void 0:P.modules)==null?void 0:C.includes(e(p).EXPENS.READ),isShowDelete:(A=(D=(k=e(t))==null?void 0:k.user)==null?void 0:D.modules)==null?void 0:A.includes(e(p).EXPENS.DELETE),isShowEye:!0,onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):u("",!0),L(c,{count:(I=e(i))==null?void 0:I.count,isSucces:e(E)},null,8,["count","isSucces"]),e(U)?(d(),R($,{key:1})):u("",!0),e(E)&&!e(i).count||e(O)?(d(),q("div",pe,oe(s.$t("emptyTableTitle")),1)):u("",!0)])])):u("",!0)}}};export{be as default};
