import{u as ye,a as ke,r as c,b as _e,y as Fe,c as p,z as i,B as x,d as F,e as A,k as G,h as n,w as Oe,F as H,C as Le,D as O,i as L,l as Be,G as Ke,m as I,o as d,s as B,A as Q,f as K,t as S,H as Se,E as $e}from"./index-8l2LyLh8.js";import{a as qe,u as we}from"./crud.services-BcMjcvoI.js";import{f as je,m as Ce,a as Ve,b as Ne}from"./manual.services-Ls971AW1.js";import{u as Ee,r}from"./i18n-validators-Wkg5KBML.js";import{a as Me,u as Pe}from"./generic.services-yETqkf3T.js";import{u as m}from"./useQuery-tdqJaMO0.js";const Re={key:0,class:"manage section-height shadowed"},De={class:"manage__inner section-padding"},ze={__name:"update",async setup(Te){let o,a;const h=Me(),$=Be(),z=Ke(),W=ye(),{t:J}=ke(),v=c(z.params.id),X=_e(),{user:b}=Fe(X),u=p(()=>{var e,k;return!!((k=(e=b==null?void 0:b.value.user)==null?void 0:e.modules)!=null&&k.includes(Se.BLOCK.UPDATE))}),q=c(!1),y=c(!1),t=c({id:"",fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[],stateId:[]}),Y=p(()=>({id:{required:r},fullname:{required:r},numberOfFloors:{required:r},roomsOnFloor:{required:r},address:{required:r},buildingObjectId:{required:r},regionId:{required:r},districtId:{required:r},stateId:{required:r}})),l=Ee(Y,t),{data:Z,isSuccess:f,isLoading:ee}=([o,a]=i(()=>m({queryKey:["regions"],queryFn:()=>Ce(),enabled:u})),o=await o,a(),o),g=p(()=>t.value.regionId[0]),se=p(()=>!!g.value);x(g,()=>{!y.value&&!q.value&&(t.value.districtId=[]),y.value=!1},{immediate:!0});const{data:oe,isSuccess:te,isLoading:ae}=([o,a]=i(()=>m({queryKey:["districts",{districtId:g}],queryFn:()=>Ve(g.value),enabled:se})),o=await o,a(),o),{data:re,isSuccess:le,isLoading:ne}=([o,a]=i(()=>m({queryKey:["objectsList",{organizationId:b.value.user.organizationId}],queryFn:()=>je(),enabled:u})),o=await o,a(),o),{data:ue,isSuccess:ce,isLoading:ie}=([o,a]=i(()=>m({queryKey:["states"],queryFn:()=>Ne(),enabled:u})),o=await o,a(),o),de=c([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"},{id:5,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:re,success:le,loading:ne,select:!0},{id:6,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:Z,success:f,loading:ee,select:!0},{id:7,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:oe,success:te,loading:ae,select:!0},{id:8,model:"stateId",label:"stateBlocksLabel",placeholder:"stateBlocksPlaceholder",errorKey:"stateId",options:ue,success:ce,loading:ie,select:!0}]),{isError:me}=([o,a]=i(()=>m({queryKey:["blocksById",v],queryFn:()=>qe("building_block",v.value),select:e=>{t.value.id=e.id,t.value.fullname=e.fullName,t.value.numberOfFloors=e.numberOfFloors,t.value.roomsOnFloor=e.roomsOnFloor,t.value.address=e.address,t.value.buildingObjectId=[e.buildingObjectId],t.value.regionId=[e.regionId],t.value.districtId=[e.districtId],t.value.stateId=[e.stateId],y.value=!0},enabled:u})),o=await o,a(),o);x(me,e=>{e&&$.push(B.HOME.path)});const{mutate:be}=Pe({onMutate:e=>{q.value=!0,e.buildingObjectId=e.buildingObjectId[0],e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>we("building_block",e),onSuccess:e=>{e!=null&&e.success&&(t.value=$e(t.value),h.invalidateQueries({queryKey:["blocks"]}),h.invalidateQueries({queryKey:["blocksById",v]}),h.invalidateQueries({queryKey:["blocksList"]}),$.push(B.BLOCK.path),setTimeout(()=>W.success(J("updateToast")),150))}}),ge=async()=>{if(l.value.$validate(),l.value.$errors.length)return;const e={...t.value};be(e),l.value.$reset()};return(e,k)=>{var w,j;const pe=I("ManageHead"),Ie=I("FormInput"),he=I("FormSelect"),ve=I("CustomButton");return u.value?(d(),F("section",Re,[A("div",De,[G(pe,{title:"editBlocksTitle",to:n(B).BLOCK.path},null,8,["to"]),A("form",{class:"manage__form form-manage",onSubmit:Oe(ge,["prevent"])},[(d(!0),F(H,null,Le(de.value,s=>{var C,V,N,E,M,P,R,D,T,U;return d(),F(H,{key:s.id},[s!=null&&s.select?L("",!0):(d(),Q(Ie,{key:0,modelValue:t.value[s.model],"onUpdate:modelValue":_=>t.value[s.model]=_,width:500,placeholder:e.$t(s.placeholder),name:s.icon,error:(V=(C=n(l))==null?void 0:C[s==null?void 0:s.errorKey])==null?void 0:V.$error,textError:(M=(E=(N=n(l))==null?void 0:N[s==null?void 0:s.errorKey])==null?void 0:E.$errors[0])==null?void 0:M.$message},{default:O(()=>[K(S(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),s!=null&&s.select?(d(),Q(he,{key:1,modelValue:t.value[s.model],"onUpdate:modelValue":_=>t.value[s.model]=_,modelModifiers:{trim:!0},width:500,options:s.options,error:(R=(P=n(l))==null?void 0:P[s==null?void 0:s.errorKey])==null?void 0:R.$error,placeholder:s==null?void 0:s.placeholder,textError:(U=(T=(D=n(l))==null?void 0:D[s==null?void 0:s.errorKey])==null?void 0:T.$errors[0])==null?void 0:U.$message,success:s.success,loading:s.loading},{default:O(()=>[K(S(e.$t(s.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):L("",!0)],64)}),128)),G(ve,{className:`form__submit ${(j=(w=n(l))==null?void 0:w.stateId.$errors[0])!=null&&j.$message?"centered":""}`},{default:O(()=>[K(S(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])):L("",!0)}}};export{ze as default};
