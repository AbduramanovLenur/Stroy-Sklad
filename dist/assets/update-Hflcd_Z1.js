import{u as be,a as ve,b as he,y as Ie,c as p,r as u,z as g,B as x,d as j,e as H,k as P,h as n,w as _e,F as G,C as Se,D as K,i as $,l as je,G as Ke,m as y,o as i,s as O,A,f as q,t as B,H as $e,E as Oe}from"./index-8l2LyLh8.js";import{u as qe,r as c}from"./i18n-validators-Wkg5KBML.js";import{a as Be,u as Le}from"./generic.services-yETqkf3T.js";import{u as b}from"./useQuery-tdqJaMO0.js";import{a as we,u as Ce}from"./crud.services-BcMjcvoI.js";import{m as Ee,a as Ve,b as Fe}from"./manual.services-Ls971AW1.js";const Te={key:0,class:"manage section-height shadowed"},ke={class:"manage__inner section-padding"},He={__name:"update",async setup(Me){let s,r;const l=Be(),L=je(),J=Ke(),z=be(),{t:W}=ve(),X=he(),{user:v}=Ie(X),d=p(()=>{var t,_;return!!((_=(t=v==null?void 0:v.value.user)==null?void 0:t.modules)!=null&&_.includes($e.OBJECT.UPDATE))}),h=u(J.params.id),w=u(!1),I=u(!1),a=u({id:"",name:"",address:"",regionId:[],districtId:[],stateId:[]}),Y=p(()=>({id:{required:c},name:{required:c},address:{required:c},regionId:{required:c},districtId:{required:c},stateId:{required:c}})),o=qe(Y,a),{data:Z,isSuccess:f,isLoading:ee}=([s,r]=g(()=>b({queryKey:["regions"],queryFn:()=>Ee(),enabled:d})),s=await s,r(),s),m=p(()=>a.value.regionId[0]),te=p(()=>!!m.value);x(m,()=>{!I.value&&!w.value&&(a.value.districtId=[]),I.value=!1},{immediate:!0});const{data:se,isSuccess:ae,isLoading:re}=([s,r]=g(()=>b({queryKey:["districts",{districtId:m}],queryFn:()=>Ve(m.value),enabled:te})),s=await s,r(),s),{data:oe,isSuccess:ne,isLoading:ce}=([s,r]=g(()=>b({queryKey:["states"],queryFn:()=>Fe(),enabled:d})),s=await s,r(),s),ue=u([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"},{id:3,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:Z,success:f,loading:ee,select:!0},{id:4,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:se,success:ae,loading:re,select:!0},{id:5,model:"stateId",label:"stateObjectLabel",placeholder:"stateObjectLabel",errorKey:"stateId",options:oe,success:ne,loading:ce,select:!0}]),{isError:ie}=([s,r]=g(()=>b({queryKey:["objectById",h],queryFn:()=>we("building_object",h.value),select:t=>{a.value.id=t.id,a.value.name=t.fullName,a.value.address=t.address,a.value.regionId=[t.regionId],a.value.districtId=[t.districtId],a.value.stateId=[t.stateId],I.value=!0},enabled:d})),s=await s,r(),s);x(ie,t=>{t&&L.push(O.HOME.path)});const{mutate:le}=Le({onMutate:t=>{w.value=!0,t.regionId=t.regionId[0],t.districtId=t.districtId[0],t.stateId=t.stateId[0]},mutationFn:t=>Ce("building_object",t),onSuccess:t=>{t!=null&&t.success&&(a.value=Oe(a.value),l.invalidateQueries({queryKey:["objects"]}),l.invalidateQueries({queryKey:["objectById",h]}),l.invalidateQueries({queryKey:["objectsList"]}),l.invalidateQueries({queryKey:["blocks"]}),L.push(O.OBJECT.path),setTimeout(()=>z.success(W("updateToast")),150))}}),de=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const t={...a.value};le(t),o.value.$reset()};return(t,_)=>{var C,E;const me=y("ManageHead"),pe=y("FormInput"),ge=y("FormSelect"),ye=y("CustomButton");return d.value?(i(),j("section",Te,[H("div",ke,[P(me,{title:"editObjectTitle",to:n(O).OBJECT.path},null,8,["to"]),H("form",{class:"manage__form form-manage",onSubmit:_e(de,["prevent"])},[(i(!0),j(G,null,Se(ue.value,e=>{var V,F,T,k,M,D,N,R,Q,U;return i(),j(G,{key:e.id},[e!=null&&e.select?$("",!0):(i(),A(pe,{key:0,modelValue:a.value[e.model],"onUpdate:modelValue":S=>a.value[e.model]=S,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(F=(V=n(o))==null?void 0:V[e==null?void 0:e.errorKey])==null?void 0:F.$error,textError:(M=(k=(T=n(o))==null?void 0:T[e==null?void 0:e.errorKey])==null?void 0:k.$errors[0])==null?void 0:M.$message},{default:K(()=>[q(B(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(i(),A(ge,{key:1,modelValue:a.value[e.model],"onUpdate:modelValue":S=>a.value[e.model]=S,modelModifiers:{trim:!0},width:500,options:e.options,error:(N=(D=n(o))==null?void 0:D[e==null?void 0:e.errorKey])==null?void 0:N.$error,placeholder:e==null?void 0:e.placeholder,textError:(U=(Q=(R=n(o))==null?void 0:R[e==null?void 0:e.errorKey])==null?void 0:Q.$errors[0])==null?void 0:U.$message,success:e.success,loading:e.loading},{default:K(()=>[q(B(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):$("",!0)],64)}),128)),P(ye,{className:`form__submit ${(E=(C=n(o))==null?void 0:C.stateId.$errors[0])!=null&&E.$message?"centered":""}`},{default:K(()=>[q(B(t.$t("formButton")),1)]),_:1},8,["className"])],32)])])):$("",!0)}}};export{He as default};
