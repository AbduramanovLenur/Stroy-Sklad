import{u as ee,a as re,r as p,c as y,z as K,B as ae,d as f,e as S,k as L,h as n,w as oe,F as V,C as w,D as _,l as te,m as h,o as c,s as C,A as E,f as v,t as b,E as se}from"./index-VvwCHRy_.js";import{c as ne}from"./crud.services-ZvwlaCdN.js";import{m as ie,a as le}from"./manual.services-5bif1yIy.js";import{u as de,r as s}from"./i18n-validators-iXaO_C5g.js";import{a as ce,u as ue}from"./generic.services-v9zpRyzJ.js";import{u as F}from"./useQuery-DRGK6FOf.js";const me={class:"manage section-height shadowed"},ge={class:"manage__inner section-padding"},ze={__name:"create",async setup(pe){let o,u;const I=ce(),M=te(),P=ee(),{t:q}=re(),z=p(!1),a=p({fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[]}),B=y(()=>({fullName:{required:s},inn:{required:s},address:{required:s},phoneNumber:{required:s},director:{required:s},regionId:{required:s},districtId:{required:s}})),t=de(B,a),{data:k,isSuccess:D,isLoading:x}=([o,u]=K(()=>F({queryKey:["regions"],queryFn:()=>ie()})),o=await o,u(),o),m=y(()=>a.value.regionId[0]),R=y(()=>!!m.value);ae(m,()=>{z.value||(a.value.districtId=[])},{immediate:!0});const{data:T,isSuccess:A,isLoading:Q}=([o,u]=K(()=>F({queryKey:["districts",{districtId:m}],queryFn:()=>le(m.value),enabled:R})),o=await o,u(),o),U=p([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",type:"number"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),H=p([{id:1,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:k,success:D,loading:x},{id:2,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:T,success:A,loading:Q}]),{mutate:G}=ue({onMutate:r=>{z.value=!0,r.regionId=r.regionId[0],r.districtId=r.districtId[0]},mutationFn:r=>ne("organization",r),onSuccess:r=>{r!=null&&r.success&&(a.value=se(a.value),I.invalidateQueries({queryKey:["companies"]}),I.invalidateQueries({queryKey:["organizations"]}),M.push(C.COMPANIES.path),setTimeout(()=>P.success(q("createToast")),150))}}),j=()=>{if(t.value.$validate(),t.value.$errors.length)return;const r={...a.value};G(r),t.value.$reset()};return(r,he)=>{var $,N;const J=h("ManageHead"),W=h("FormInput"),X=h("FormSelect"),Y=h("CustomButton");return c(),f("section",me,[S("div",ge,[L(J,{title:"addNewCompanyTitle",to:n(C).COMPANIES.path},null,8,["to"]),S("form",{class:"manage__form form-manage",onSubmit:oe(j,["prevent"])},[(c(!0),f(V,null,w(U.value,e=>{var i,l,d;return c(),E(W,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":g=>a.value[e.model]=g,width:500,placeholder:r.$t(e.placeholder),name:e.icon,error:(i=n(t))==null?void 0:i[e.errorKey].$error,type:e==null?void 0:e.type,textError:(d=(l=n(t))==null?void 0:l[e.errorKey].$errors[0])==null?void 0:d.$message},{default:_(()=>[v(b(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),(c(!0),f(V,null,w(H.value,e=>{var i,l,d,g,O;return c(),E(X,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":Z=>a.value[e.model]=Z,modelModifiers:{trim:!0},width:500,options:e.options,error:(l=(i=n(t))==null?void 0:i[e==null?void 0:e.errorKey])==null?void 0:l.$error,placeholder:e==null?void 0:e.placeholder,textError:(O=(g=(d=n(t))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:g.$errors[0])==null?void 0:O.$message,success:e.success,loading:e.loading},{default:_(()=>[v(b(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(Y,{className:`form__submit ${(N=($=n(t))==null?void 0:$.districtId.$errors[0])!=null&&N.$message?"centered":""}`},{default:_(()=>[v(b(r.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{ze as default};
