import{n as x,s as H,r as l,q as K,x as j,y as F,b as T,d as M,j as N,g as e,z as C,h as m,t as R,l as c,o as r,A as D}from"./index-90cmhfpq.js";import{a as U,u as W}from"./generic.services-UXrdyhxI.js";import{u as $}from"./useQuery-7_07upSr.js";import{g as G,d as J}from"./crud.services-IxzF5w0J.js";import{r as X}from"./index-fOfPrRnA.js";const Y={class:"applications"},Z={class:"applications__inner"},ee={key:2,class:"empty-table shadowed"},le={__name:"index",async setup(te){let n,_;const g=U(),h=x(),{setSearchValue:y,setPagePagination:k}=h,{page:p,limit:d,search:b}=H(h),S=l(localStorage.getItem("organizationId")),I=l(localStorage.getItem("roleId"));K(()=>{y("")}),j(b,()=>{k(1)});const v=l(""),w=X(b,500),z=l([{id:1,label:"applicationUserName",width:130},{id:2,label:"applicationOrganization",width:185},{id:3,label:"applicationDocDate",width:210},{id:4,label:"applicationDedline",width:240},{id:5,label:"applicationObject",width:100},{id:6,label:"applicationBlock",width:95},{id:7,label:"applicationCost",width:330},{id:8,label:"applicationState"},{id:9,label:"applicationAction"}]),{data:s,isLoading:q,isSuccess:u,isError:B}=([n,_]=F(()=>$({queryKey:["applications",{page:p,limit:d,debouncedSearch:w,organizationId:S,roleId:I}],queryFn:()=>G("application",p.value,d.value,w.value,{organizationId:S.value,roleId:I.value}),select:t=>{let a={...t};return a.applications=a==null?void 0:a.applications.map(i=>{const o={...i,name:i.userName,company:i.organizationName};return delete o.userName,delete o.organizationName,delete o.state,delete o.stateId,o}),a}})),n=await n,_(),n),{mutate:O}=W({mutationFn:t=>J("application",t),onSuccess:()=>{g.invalidateQueries({queryKey:["applications"]}),g.invalidateQueries({queryKey:["applicationsById",v]})}}),E=async t=>{v.value=t,O(t)};return(t,a)=>{var A,f,P;const i=c("HeadPage"),o=c("Table"),L=c("Pagination"),Q=c("Spinner");return r(),T("section",Y,[M("div",Z,[N(i,{title:"applicationTitle",to:e(D).CREATE_APPLICATIONS.path,onOnSearch:a[0]||(a[0]=V=>e(y)(V))},null,8,["to"]),e(u)&&((A=e(s))!=null&&A.count)?(r(),C(o,{key:0,headers:z.value,table:(f=e(s))==null?void 0:f.applications,to:e(D).UPDATE_APPLICATIONS.name,options:{page:e(p),limit:e(d)},isShow:!0,onOnActionDelete:E},null,8,["headers","table","to","options"])):m("",!0),N(L,{count:(P=e(s))==null?void 0:P.count,isSucces:e(u)},null,8,["count","isSucces"]),e(q)?(r(),C(Q,{key:1})):m("",!0),e(u)&&!e(s).count||e(B)?(r(),T("div",ee,R(t.$t("emptyTableTitle")),1)):m("",!0)])])}}};export{le as default};
//# sourceMappingURL=index-LflAOO0p.js.map
