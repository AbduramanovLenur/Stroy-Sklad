import{_ as pe,s as ge,r as l,c as K,k as g,o as s,a as F,b as $,i as y,l as h,e as S,t as v,g as r,m as N,h as C,F as Q,d as G,w as ye}from"./index-GPu3ycXY.js";import{u as he,c as R,r as d}from"./secondary-functions-7D58TPs_.js";import{u as ve,a as be,b as L,T as we,F as _e,A as fe,c as Ie,d as ze,e as Fe,C as Se,f as Ne,g as b,S as Oe,h as qe,i as Ke,j as $e,m as Ce,k as Le,l as Ve,n as Me,o as Te}from"./Spinner-jnvZGIDj.js";const ke={class:"company"},Be={class:"company__inner"},De={class:"company__head"},Ae={key:2,class:"empty-table"},Ee={__name:"company",async setup(Pe){let t,i;const w=ve(),V=be(),{toggleIsOpenModalForm:M}=V,{isOpenModalForm:O}=ge(V),T=l("addNewCompanyTitle"),u=l(""),_=l(""),k=K(()=>O),B=K(()=>O&&u.value=="edit"),{data:U,isSuccess:x,isLoading:H}=([t,i]=g(()=>b({queryKey:["regions"],queryFn:()=>Ce(),enabled:k})),t=await t,i(),t),{data:W,isSuccess:j,isLoading:J}=([t,i]=g(()=>b({queryKey:["districts"],queryFn:()=>Le(),enabled:k})),t=await t,i(),t),{data:X,isSuccess:Y,isLoading:Z}=([t,i]=g(()=>b({queryKey:["statesCompany"],queryFn:()=>Ve(),enabled:B})),t=await t,i(),t),o=l({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:"",districtId:"",stateId:"",search:""}),ee=K(()=>({fullName:{required:d},inn:{required:d},address:{required:d},phoneNumber:{required:d},director:{required:d},regionId:{required:d},districtId:{required:d}})),ae=l([{id:1,label:"organizationName",width:220},{id:2,label:"organizationInn",width:115},{id:3,label:"organizationRegion",width:215},{id:4,label:"organizationDistrict",width:155},{id:5,label:"organizationAddress",width:200},{id:6,label:"organizationPhone",width:170},{id:7,label:"organizationDirector",width:245},{id:7,label:"organizationState",width:100},{id:8,label:"organizationAction",width:130}]),oe=l([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),te=l([{id:1,model:"regionId",label:"regionOrganizationLabel",options:U,errorKey:"regionId",success:x,loading:H,show:["create","edit"]},{id:2,model:"districtId",label:"districtOrganizationLabel",options:W,errorKey:"districtId",success:j,loading:J,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:X,success:Y,loading:Z,show:"update",show:["edit"]}]),n=he(ee,o),{data:q,isLoading:re,isSuccess:D}=([t,i]=g(()=>b({queryKey:["companies"],queryFn:()=>Me("organization")})),t=await t,i(),t);[t,i]=g(()=>b({queryKey:["companiesById",_],queryFn:()=>Te("organization",_.value),select:e=>{o.value.id=e.id,o.value.fullName=e.fullName,o.value.inn=e.inn,o.value.address=e.address,o.value.phoneNumber=e.phoneNumber,o.value.director=e.director,o.value.regionId=e.regionId,o.value.districtId=e.districtId,o.value.stateId=e.stateId},enabled:B})),t=await t,i();const{mutate:ie}=L({mutationFn:e=>qe("organization",e),onSuccess:()=>{w.invalidateQueries({queryKey:["companies"]})}}),{mutate:ne}=L({mutationFn:e=>Ke("organization",e),onSuccess:()=>{w.invalidateQueries({queryKey:["companies"]}),w.invalidateQueries({queryKey:["getByIdCompany",_]})}}),{mutate:se}=L({mutationFn:e=>$e("organization",e),onSuccess:()=>{w.invalidateQueries({queryKey:["companies"]})}}),A=(e,f)=>{T.value=e,u.value=f,M(),u.value==="create"&&O.value&&(o.value=R(o.value),n.value.$reset())},le=()=>{A("addNewCompanyTitle","create")},de=e=>{_.value=e,A("editCompanyTitle","edit")},ue=async e=>{se(e)},ce=async()=>{n.value.$validate(),!n.value.$errors.length&&(u.value==="create"?(delete o.value.id,delete o.value.stateId,ie(o.value)):ne(o.value),M(),o.value=R(o.value),n.value.$reset())};return(e,f)=>(s(),F("section",ke,[$("div",Be,[$("div",De,[y(we,null,{default:h(()=>[S(`\r
                    `+v(e.$t("comapnyTitle"))+`\r
                `,1)]),_:1}),y(_e,{onOnSearch:f[0]||(f[0]=I=>o.value.search=I)}),y(fe,{onOnOpenFormModal:le})]),r(D)&&r(q).length?(s(),N(Ie,{key:0,headers:ae.value,table:r(q),onOnActionEdit:de,onOnActionDelete:ue},null,8,["headers","table"])):C("",!0),r(re)?(s(),N(Oe,{key:1})):C("",!0),r(D)&&!r(q).length?(s(),F("div",Ae,v(e.$t("emptyTableTitle")),1)):C("",!0)]),y(Ne,{title:T.value},{default:h(()=>{var I,E;return[$("form",{class:"company__form",onSubmit:ye(ce,["prevent"])},[(s(!0),F(Q,null,G(oe.value,a=>{var c,m,p;return s(),N(ze,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":z=>o.value[a.model]=z,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(c=r(n))==null?void 0:c[a.errorKey].$error,textError:(p=(m=r(n))==null?void 0:m[a.errorKey].$errors[0])==null?void 0:p.$message},{default:h(()=>[S(v(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(s(!0),F(Q,null,G(te.value,a=>{var c,m,p,z,P;return s(),N(Fe,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":me=>o.value[a.model]=me,width:500,options:a.options,error:(m=(c=r(n))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:m.$error,textError:(P=(z=(p=r(n))==null?void 0:p[a==null?void 0:a.errorKey])==null?void 0:z.$errors[0])==null?void 0:P.$message,success:a.success,loading:a.loading,show:a==null?void 0:a.show,requestFlag:u.value},{default:h(()=>[S(v(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),y(Se,{className:`form__submit ${(E=(I=r(n))==null?void 0:I.districtId.$errors[0])!=null&&E.$message?"centered":""}`},{default:h(()=>[S(v(e.$t("formButton")),1)]),_:1},8,["className"])],32)]}),_:1},8,["title"])]))}},Ue=pe(Ee,[["__scopeId","data-v-2a2eab5c"]]);export{Ue as default};
