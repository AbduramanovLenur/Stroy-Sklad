{"version":3,"file":"index-mlHRCqZT.js","sources":["../../src/views/application/index.vue"],"sourcesContent":["<template>\r\n    <section class=\"applications\" v-if=\"isShowList\">\r\n        <div class=\"applications__inner\">\r\n            <HeadPage \r\n                title=\"applicationTitle\" \r\n                :to=\"routes.CREATE_APPLICATION.path\"\r\n                :isShowCreate=\"user?.user?.modules?.includes(actionModules.APPLICATION.CREATE)\"\r\n            />\r\n            <Table \r\n                v-if=\"isSuccessApplications && applications?.count\"\r\n                :headers=\"headers\" \r\n                :table=\"applications?.applications\"\r\n                :to=\"routes.VIEW_APPLICATION.name\"\r\n                :options=\"{ page, limit }\"\r\n                :isShowEye=\"true\"\r\n                :isShowUpdate=\"user?.user?.modules?.includes(actionModules.APPLICATION.UPDATE)\"\r\n                :isShowDelete=\"user?.user?.modules?.includes(actionModules.APPLICATION.DELETE)\"\r\n                @onActionDelete=\"deleteHandler\"\r\n            />\r\n            <Pagination\r\n                :count=\"applications?.count\"\r\n                :isSucces=\"isSuccessApplications\"\r\n            />\r\n            <Spinner v-if=\"isLoadingApplications\" />\r\n            <div \r\n                v-if=\"(isSuccessApplications && !applications.count) || isError\"\r\n                class=\"empty-table shadowed\"\r\n            >\r\n                {{ $t(\"emptyTableTitle\") }}\r\n            </div>\r\n        </div>\r\n    </section>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from \"vue\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { useTableStore } from \"@/store/tableStore\";\r\nimport { useUserStore } from \"@/store/userStore\";\r\nimport { refDebounced } from \"@vueuse/core\";\r\nimport { \r\n    useQueryClient, \r\n    useQuery, \r\n    useMutation \r\n} from \"@tanstack/vue-query\";\r\nimport { getList, deleteWithId } from \"@/services/crud.services.js\";\r\nimport { routes } from \"@/utils/routes.js\";\r\nimport { actionModules } from \"@/utils/action-modules.js\";\r\n\r\nconst queryClient = useQueryClient();\r\n\r\nconst tableStore = useTableStore();\r\nconst { page, limit, search } = storeToRefs(tableStore);\r\n\r\nconst userStore = useUserStore();\r\nconst { user } = storeToRefs(userStore);\r\n\r\nconst isShowList = computed(() => !!user?.value.user?.modules?.includes(actionModules.APPLICATION.READ));\r\n\r\nconst applicationId = ref(\"\");\r\n\r\nconst debouncedSearch = refDebounced(search, 500);\r\n\r\nconst headers = ref([\r\n    { id: 1, label: \"applicationUserName\", width: 190 },\r\n    { id: 3, label: \"applicationDocDate\", width: 230 },\r\n    { id: 4, label: \"applicationDedline\", width: 230 },\r\n    { id: 5, label: \"applicationObject\", width: 250 },\r\n    { id: 6, label: \"applicationBlock\", width: 250 }\r\n]);\r\n\r\nconst {\r\n    data: applications,\r\n    isLoading: isLoadingApplications,\r\n    isSuccess: isSuccessApplications,\r\n    isError\r\n} = await useQuery({\r\n    queryKey: [\"applications\", { page, limit, debouncedSearch, organizationId: user.value.user.organizationId, roleId: user.value.user.roleId }],\r\n    queryFn: () => getList(\"application\", page.value, limit.value, debouncedSearch.value),\r\n    select: (data) => {\r\n        let applications = {...data};\r\n\r\n        applications.applications = applications?.applications.map((elem) => {\r\n            const application = {\r\n                ...elem,\r\n                name: elem.userName,\r\n            }\r\n\r\n            delete application.userName;\r\n            delete application.organizationName;\r\n            delete application.state;\r\n            delete application.stateId;\r\n\r\n            return application;\r\n        })\r\n\r\n        return applications;\r\n    },\r\n    enabled: isShowList\r\n});\r\n\r\nconst { mutate: mutateDelete } = useMutation({\r\n    mutationFn: (idx) => deleteWithId(\"application\", idx),\r\n    onSuccess: () => {\r\n        queryClient.invalidateQueries({ queryKey: [\"applications\"] });\r\n        queryClient.invalidateQueries({ queryKey: [\"applicationsById\", applicationId] });\r\n    }\r\n});\r\n\r\nconst deleteHandler = async (idx) => {\r\n    applicationId.value = idx;\r\n    mutateDelete(idx);\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>"],"names":["queryClient","useQueryClient","tableStore","useTableStore","page","limit","search","storeToRefs","userStore","useUserStore","user","isShowList","computed","_b","_a","actionModules","applicationId","ref","debouncedSearch","refDebounced","headers","applications","isLoadingApplications","isSuccessApplications","isError","__temp","__restore","_withAsyncContext","useQuery","getList","data","elem","application","mutateDelete","useMutation","idx","deleteWithId","deleteHandler"],"mappings":"4fAiDA,MAAMA,EAAcC,GAAc,EAE5BC,EAAaC,EAAa,EAC1B,CAAE,KAAAC,EAAM,MAAAC,EAAO,OAAAC,CAAQ,EAAGC,EAAYL,CAAU,EAEhDM,EAAYC,EAAY,EACxB,CAAE,KAAAC,CAAM,EAAGH,EAAYC,CAAS,EAEhCG,EAAaC,EAAS,IAAA,SAAM,OAAC,GAACC,GAAAC,EAAAJ,GAAA,YAAAA,EAAM,MAAM,OAAZ,YAAAI,EAAkB,UAAlB,MAAAD,EAA2B,SAASE,EAAc,YAAY,OAAK,EAEjGC,EAAgBC,EAAI,EAAE,EAEtBC,EAAkBC,GAAab,EAAQ,GAAG,EAE1Cc,EAAUH,EAAI,CAChB,CAAE,GAAI,EAAG,MAAO,sBAAuB,MAAO,GAAK,EACnD,CAAE,GAAI,EAAG,MAAO,qBAAsB,MAAO,GAAK,EAClD,CAAE,GAAI,EAAG,MAAO,qBAAsB,MAAO,GAAK,EAClD,CAAE,GAAI,EAAG,MAAO,oBAAqB,MAAO,GAAK,EACjD,CAAE,GAAI,EAAG,MAAO,mBAAoB,MAAO,GAAK,CACpD,CAAC,EAEK,CACF,KAAMI,EACN,UAAWC,EACX,UAAWC,EACX,QAAAC,CACJ,GAAU,CAAAC,EAAAC,CAAA,EAAAC,EAAA,IAAAC,GAAS,CACf,SAAU,CAAC,eAAgB,CAAE,KAAAxB,EAAM,MAAAC,EAAO,gBAAAa,EAAiB,eAAgBR,EAAK,MAAM,KAAK,eAAgB,OAAQA,EAAK,MAAM,KAAK,OAAQ,EAC3I,QAAS,IAAMmB,GAAQ,cAAezB,EAAK,MAAOC,EAAM,MAAOa,EAAgB,KAAK,EACpF,OAASY,GAAS,CACd,IAAIT,EAAe,CAAC,GAAGS,CAAI,EAE3B,OAAAT,EAAa,aAAeA,GAAA,YAAAA,EAAc,aAAa,IAAKU,GAAS,CACjE,MAAMC,EAAc,CAChB,GAAGD,EACH,KAAMA,EAAK,QACd,EAED,cAAOC,EAAY,SACnB,OAAOA,EAAY,iBACnB,OAAOA,EAAY,MACnB,OAAOA,EAAY,QAEZA,CACnB,GAEeX,CACV,EACD,QAASV,CACb,CAAC,CAAA,mBAEK,CAAE,OAAQsB,CAAc,EAAGC,GAAY,CACzC,WAAaC,GAAQC,GAAa,cAAeD,CAAG,EACpD,UAAW,IAAM,CACbnC,EAAY,kBAAkB,CAAE,SAAU,CAAC,cAAc,CAAG,CAAA,EAC5DA,EAAY,kBAAkB,CAAE,SAAU,CAAC,mBAAoBgB,CAAa,CAAC,CAAE,CAClF,CACL,CAAC,EAEKqB,EAAgB,MAAOF,GAAQ,CACjCnB,EAAc,MAAQmB,EACtBF,EAAaE,CAAG,CACpB"}