import{u as j,a as J,b as W,y as X,c as R,r as V,z as Y,d as b,e as S,k as Z,h as t,w as ee,F as oe,C as ae,A as m,i as c,D as C,l as te,m as u,o as r,s as k,f as w,t as E,H as se,E as re}from"./index-duUvqP-c.js";import{u as le,r as L}from"./i18n-validators-vfJMHImW.js";import{a as ue,u as ne}from"./generic.services-9zWUdppN.js";import{u as me}from"./useQuery-nCo--xAY.js";import{c as ce}from"./crud.services-W2EdIOzx.js";import{c as de}from"./manual.services-UeOdc-dP.js";const ie={key:0,class:"manage section-height shadowed"},_e={class:"manage__inner section-padding"},Me={__name:"create",async setup(fe){let n,i;const _=ue(),B=te(),K=j(),{t:T}=J(),q=W(),{user:d}=X(q),f=R(()=>{var e,l;return!!((l=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)!=null&&l.includes(se.ROLE.CREATE))}),a=V({shortName:"",fullName:"",roleModules:[]}),F=R(()=>({shortName:{required:L},fullName:{required:L}})),s=le(F,a),{data:A,isLoading:x,isSuccess:h}=([n,i]=Y(()=>me({queryKey:["modules"],queryFn:()=>de(),enabled:f})),n=await n,i(),n),H=V([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"}]),{mutate:Q}=ne({mutationFn:e=>ce("Role",e),onSuccess:e=>{e!=null&&e.success&&(a.value=re(a.value),_.invalidateQueries({queryKey:["roles"]}),_.invalidateQueries({queryKey:["rolesList"]}),B.push(k.ROLE.path),setTimeout(()=>K.success(T("createToast")),150))}}),U=()=>{if(s.value.$validate(),s.value.$errors.length)return;const e={...a.value};Q(e),s.value.$reset()};return(e,l)=>{var p,y;const D=u("ManageHead"),I=u("FormInput"),O=u("ActionsModules"),P=u("CustomButton"),z=u("Spinner");return f.value?(r(),b("section",ie,[S("div",_e,[Z(D,{title:"addNewRolesTitle",to:t(k).ROLE.path},null,8,["to"]),S("form",{class:"manage__form form-manage",onSubmit:ee(U,["prevent"])},[(r(!0),b(oe,null,ae(H.value,o=>{var v,N,g,M,$;return r(),m(I,{key:o.id,modelValue:a.value[o.model],"onUpdate:modelValue":G=>a.value[o.model]=G,width:500,placeholder:e.$t(o.placeholder),name:o.icon,error:(N=(v=t(s))==null?void 0:v[o.errorKey])==null?void 0:N.$error,textError:($=(M=(g=t(s))==null?void 0:g[o.errorKey])==null?void 0:M.$errors[0])==null?void 0:$.$message},{default:C(()=>[w(E(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),t(h)?(r(),m(O,{key:0,modelValue:a.value.roleModules,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.roleModules=o),actions:t(A)},null,8,["modelValue","actions"])):c("",!0),t(h)?(r(),m(P,{key:1,className:`form__submit manage__submit ${(y=(p=t(s))==null?void 0:p.fullName.$errors[0])!=null&&y.$message?"centered":""}`},{default:C(()=>[w(E(e.$t("formButton")),1)]),_:1},8,["className"])):c("",!0)],32),t(x)?(r(),m(z,{key:0})):c("",!0)])])):c("",!0)}}};export{Me as default};
