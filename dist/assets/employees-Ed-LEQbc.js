import{_ as ye,r as i,k as f,c as pe,o as d,a as S,b as z,i as v,l as w,e as q,t as N,g as l,m as L,h as E,F as T,d as C,w as he}from"./index-tguTEyM9.js";import{u as ge,c as be,r,m as fe}from"./secondary-functions-itmedAoL.js";import{u as ve,a as we,b as O,T as Ne,F as _e,A as Ie,c as Fe,d as Se,e as qe,C as Le,f as Ke,g as _,S as $e,h as ze,i as Ee,j as Oe,p as Ve,q as Be,l as Me,n as ke,o as Pe}from"./Spinner-fYZ6DMpY.js";const Te={class:"employees"},Ce={class:"employees__inner"},Ae={class:"employees__head"},Qe={key:2,class:"empty-table"},Re={__name:"employees",async setup(Ge){let o,t;const I=ve(),A=we(),{toggleIsOpenModalForm:V}=A,B=i(""),c=i(""),F=i(""),{data:Q,isSuccess:R,isLoading:G,refetch:H}=([o,t]=f(()=>_({queryKey:["organizations"],queryFn:()=>Ve(),enabled:!1})),o=await o,t(),o),{data:U,isSuccess:x,isLoading:D,refetch:W}=([o,t]=f(()=>_({queryKey:["districts"],queryFn:()=>Be(),enabled:!1})),o=await o,t(),o),{data:j,isSuccess:J,isLoading:X,refetch:Y}=([o,t]=f(()=>_({queryKey:["statesEmployees"],queryFn:()=>Me(),enabled:!1})),o=await o,t(),o),s=i({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:"",roleId:"",stateId:""}),Z=pe(()=>{switch(c.value){case"edit":return{fullName:{required:r},userName:{required:r},phoneNumber:{required:r},organizationId:{required:r},roleId:{required:r}};default:return{fullName:{required:r},userName:{required:r},password:{required:r,minLength:fe},phoneNumber:{required:r},organizationId:{required:r},roleId:{required:r}}}}),ee=i([{id:1,label:"employeesFullName",width:300},{id:2,label:"employeesOrganization",width:320},{id:3,label:"employeesPhone",width:255},{id:4,label:"employeesRole",width:195},{id:5,label:"employeesState",width:250},{id:8,label:"employeesAction",width:190}]),ae=i([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName",show:["create","edit"]},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName",show:["create","edit"]},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password",show:["create"]},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",show:["create","edit"]}]),oe=i([{id:1,model:"organizationId",label:"employeesOrganizationLabel",options:Q,errorKey:"organizationId",success:R,loading:G,show:["create","edit"]},{id:2,model:"roleId",label:"employeesRoleLabel",options:U,errorKey:"roleId",success:x,loading:D,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:j,success:J,loading:X,show:["edit"]}]),n=ge(Z,s),{data:K,isLoading:se,isSuccess:M}=([o,t]=f(()=>_({queryKey:["employees"],queryFn:()=>ke("user"),select:e=>e.map(u=>{const m={...u,phone:u.phoneNumber,company:u.organizationName};return delete m.phoneNumber,delete m.organizationName,m})})),o=await o,t(),o),{refetch:le}=([o,t]=f(()=>_({queryKey:["employeesById",F],queryFn:()=>Pe("user",F.value),select:e=>{s.value.id=e.id,s.value.fullName=e.fullname,s.value.userName=e.userName,s.value.phoneNumber=e.phoneNumber,s.value.organizationId=e.organizationId,s.value.roleId=e.roleId,s.value.stateId=e.stateId},enabled:!1})),o=await o,t(),o),{mutate:re}=O({mutationFn:e=>ze("user",e),onSuccess:()=>{I.invalidateQueries({queryKey:["employees"]})}}),{mutate:te}=O({mutationFn:e=>Ee("user",e),onSuccess:()=>{I.invalidateQueries({queryKey:["employees"]}),I.invalidateQueries({queryKey:["getByIdEmployees",F]})}}),{mutate:ne}=O({mutationFn:e=>Oe("user",e),onSuccess:()=>{I.invalidateQueries({queryKey:["employees"]})}}),de=e=>{console.log(e)},k=(e,u)=>{B.value=e,c.value=u,H(),W(),V()},ie=()=>{k("addNewEmployeesTitle","create")},ue=e=>{F.value=e,le(),Y(),k("editEmployeesTitle","edit")},me=e=>{ne(e)},ce=()=>{n.value.$validate(),!n.value.$errors.length&&(c.value==="create"?(delete s.value.id,delete s.value.stateId,re(s.value)):te(s.value),V(),s.value=be(s.value),n.value.$reset())};return(e,u)=>(d(),S("section",Te,[z("div",Ce,[z("div",Ae,[v(Ne,null,{default:w(()=>[q(`\r
                    `+N(e.$t("employeesTitle"))+`\r
                `,1)]),_:1}),v(_e,{onOnSearch:de}),v(Ie,{onOnOpenFormModal:ie})]),l(M)&&l(K).length?(d(),L(Fe,{key:0,headers:ee.value,table:l(K),onOnActionEdit:ue,onOnActionDelete:me},null,8,["headers","table"])):E("",!0),l(se)?(d(),L($e,{key:1})):E("",!0),l(M)&&!l(K).length?(d(),S("div",Qe,N(e.$t("emptyTableTitle")),1)):E("",!0)]),v(Ke,{title:B.value},{default:w(()=>{var m,P;return[z("form",{class:"employees__form",onSubmit:he(ce,["prevent"])},[(d(!0),S(T,null,C(ae.value,a=>{var y,p,h,g,b;return d(),L(Se,{key:a.id,modelValue:s.value[a.model],"onUpdate:modelValue":$=>s.value[a.model]=$,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(p=(y=l(n))==null?void 0:y[a==null?void 0:a.errorKey])==null?void 0:p.$error,textError:(b=(g=(h=l(n))==null?void 0:h[a==null?void 0:a.errorKey])==null?void 0:g.$errors[0])==null?void 0:b.$message,show:a.show,requestFlag:c.value},{default:w(()=>[q(N(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","show","requestFlag"])}),128)),(d(!0),S(T,null,C(oe.value,a=>{var y,p,h,g,b;return d(),L(qe,{key:a.id,modelValue:s.value[a.model],"onUpdate:modelValue":$=>s.value[a.model]=$,width:500,options:a.options,error:(p=(y=l(n))==null?void 0:y[a==null?void 0:a.errorKey])==null?void 0:p.$error,textError:(b=(g=(h=l(n))==null?void 0:h[a==null?void 0:a.errorKey])==null?void 0:g.$errors[0])==null?void 0:b.$message,success:a.success,loading:a.loading,show:a.show,requestFlag:c.value},{default:w(()=>[q(N(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),v(Le,{className:`form__submit ${(P=(m=l(n))==null?void 0:m.roleId.$errors[0])!=null&&P.$message?"centered":""}`},{default:w(()=>[q(N(e.$t("formButton")),1)]),_:1},8,["className"])],32)]}),_:1},8,["title"])]))}},De=ye(Re,[["__scopeId","data-v-6fa8f8e8"]]);export{De as default};
