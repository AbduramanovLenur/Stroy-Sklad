import{u as W,a as X,b as Y,y as Z,c as S,r as g,z as ee,d as f,e as V,k as E,h as s,w as oe,F as L,C as K,D as v,i as re,l as ae,m as h,o as c,s as C,A as F,f as b,t as N,H as se,E as le}from"./index-I0O1PMyv.js";import{u as te,r as l,m as ne}from"./i18n-validators-TDhqfgQ8.js";import{a as ue,u as de}from"./generic.services-tAYQOCEA.js";import{u as me}from"./useQuery-lcb-4ShK.js";import{c as ie}from"./crud.services-EfxTTgbv.js";import{e as ce}from"./manual.services-CEFxwEmr.js";const pe={key:0,class:"manage section-height shadowed"},he={class:"manage__inner section-padding"},we={__name:"create",async setup(ye){let p,w;const P=ue(),U=ae(),M=W(),{t:k}=X(),B=Y(),{user:t}=Z(B),$=S(()=>{var o,y;return!!((y=(o=t==null?void 0:t.value.user)==null?void 0:o.modules)!=null&&y.includes(se.ORG_USER.CREATE))}),r=g({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:t.value.user.organizationId,roleId:[]}),T=S(()=>({fullName:{required:l},userName:{required:l},password:{required:l,minLength:ne},phoneNumber:{required:l},organizationId:{required:l},roleId:{required:l}})),a=te(T,r),{data:z,isSuccess:q,isLoading:x}=([p,w]=ee(()=>me({queryKey:["rolesList",{organizationId:t.value.user.organizationId}],queryFn:()=>ce(),enabled:$})),p=await p,w(),p),G=g([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"}]),H=g([{id:1,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:z,success:q,loading:x}]),{mutate:A}=de({onMutate:o=>{o.roleId=o.roleId[0]},mutationFn:o=>ie("user",o),onSuccess:o=>{o!=null&&o.success&&(r.value=le(r.value),P.invalidateQueries({queryKey:["orgUsers"]}),U.push(C.ORG_USER.path),setTimeout(()=>M.success(k("createToast")),150))}}),D=()=>{if(a.value.$validate(),a.value.$errors.length)return;const o={...r.value};A(o),a.value.$reset()};return(o,y)=>{var I,R;const O=h("ManageHead"),Q=h("FormInput"),j=h("FormSelect"),J=h("CustomButton");return $.value?(c(),f("section",pe,[V("div",he,[E(O,{title:"addNewEmployeesTitle",to:s(C).ORG_USER.path},null,8,["to"]),V("form",{class:"manage__form form-manage",onSubmit:oe(D,["prevent"])},[(c(!0),f(L,null,K(G.value,e=>{var n,u,d,m,i;return c(),F(Q,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":_=>r.value[e.model]=_,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(u=(n=s(a))==null?void 0:n[e.errorKey])==null?void 0:u.$error,type:e==null?void 0:e.type,textError:(i=(m=(d=s(a))==null?void 0:d[e.errorKey])==null?void 0:m.$errors[0])==null?void 0:i.$message},{default:v(()=>[b(N(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),(c(!0),f(L,null,K(H.value,e=>{var n,u,d,m,i;return c(),F(j,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":_=>r.value[e.model]=_,modelModifiers:{trim:!0},width:500,options:e.options,error:(u=(n=s(a))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(i=(m=(d=s(a))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:i.$message,success:e.success,loading:e.loading},{default:v(()=>[b(N(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),E(J,{className:`form__submit ${(R=(I=s(a))==null?void 0:I.roleId.$errors[0])!=null&&R.$message?"centered":""}`},{default:v(()=>[b(N(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):re("",!0)}}};export{we as default};
