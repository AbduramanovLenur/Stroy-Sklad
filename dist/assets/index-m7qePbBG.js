import{u as Y,a as Z,x as ee,y as B,b as te,c as se,r as L,z as oe,d as O,e as ae,k as q,A as ne,h as t,B as I,i as c,t as M,m as i,o as l,f as ue,s as Q,H as d}from"./index-_sW-sQTC.js";import{u as re}from"./generic.services-lrsWuSGG.js";import{u as ce}from"./useQuery-__dxNVMJ.js";import{u as ie}from"./useMutation-A_gT2E6W.js";import{g as le,d as de}from"./crud.services-WjFvBV25.js";import{r as me}from"./index-zI2a6Eei.js";const pe={key:0,class:"products"},_e={class:"products__inner section-padding"},ye={key:2,class:"empty-table shadowed"},be={__name:"index",async setup(he){let a,h;const m=re(),x=Y(),{t:H}=Z(),K=ee(),{page:p,limit:_,search:V}=B(K),z=te(),{user:s}=B(z),T=se(()=>{var e,o;return!!((o=(e=s==null?void 0:s.value.user)==null?void 0:e.modules)!=null&&o.includes(d.PRODUCT.READ))}),S=L(""),f=me(V,500),F=L([{id:1,label:"productsName",width:50},{id:2,label:"productsTypeName",width:20}]),{data:n,isLoading:$,isSuccess:y,isError:W}=([a,h]=oe(()=>ce({queryKey:["products",{page:p,limit:_,debouncedSearch:f,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>le("construction_material",p.value,_.value,f.value),select:e=>{let o=[...e==null?void 0:e.constructionMaterial];return o=o.map(u=>{const r={...u,material:u.fullName};return delete r.fullName,r}),{constructionMaterial:o,count:e==null?void 0:e.count}},enabled:T})),a=await a,h(),a),{mutate:j}=ie({mutationFn:e=>de("construction_material",e),onSuccess:e=>{e!=null&&e.success&&(m.invalidateQueries({queryKey:["products"]}),m.invalidateQueries({queryKey:["productById",S]}),m.invalidateQueries({queryKey:["materialsList"]}),setTimeout(()=>x.success(H("deleteToast")),150))}}),G=async e=>{S.value=e,j(e)};return(e,o)=>{var C,D,v,b,g,P,w,E,U,R,N,k,A;const u=i("HeadPage"),r=i("Table"),J=i("Pagination"),X=i("Spinner");return T.value?(l(),O("section",pe,[ae("div",_e,[q(u,{title:"productsTitle",to:t(Q).CREATE_PRODUCT.path,isShowCreate:(v=(D=(C=t(s))==null?void 0:C.user)==null?void 0:D.modules)==null?void 0:v.includes(t(d).PRODUCT.CREATE)},{default:ne(()=>[ue(M(e.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),t(y)&&((b=t(n))!=null&&b.count)?(l(),I(r,{key:0,headers:F.value,table:(g=t(n))==null?void 0:g.constructionMaterial,to:t(Q).UPDATE_PRODUCT.name,options:{page:t(p),limit:t(_)},isShowUpdate:(E=(w=(P=t(s))==null?void 0:P.user)==null?void 0:w.modules)==null?void 0:E.includes(t(d).PRODUCT.UPDATE),isShowDelete:(N=(R=(U=t(s))==null?void 0:U.user)==null?void 0:R.modules)==null?void 0:N.includes(t(d).PRODUCT.DELETE),onOnActionDelete:G},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):c("",!0),q(J,{count:(k=t(n))==null?void 0:k.count,isSucces:t(y)},null,8,["count","isSucces"]),t($)?(l(),I(X,{key:1})):c("",!0),t(y)&&!((A=t(n))!=null&&A.count)||t(W)?(l(),O("div",ye,M(e.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}};export{be as default};
