import{_ as Oe,u as Te,a as Ve,r as m,b as je,x as Pe,c as n,y as b,B as H,d as k,e as O,k as qe,h as u,w as Ke,F as W,C as x,z as c,i as r,D as g,ag as Ne,l as Re,E as Ee,m as v,o as i,A as w,f as h,t as _,G as T,I as V}from"./index--bVPgmc9.js";import{a as De,u as J}from"./generic.services-3AZ_16v5.js";import{u as y}from"./useQuery-KWqGbv1N.js";import{a as ze,e as Ue,f as $e}from"./crud.services--2m-2OGJ.js";import{f as Qe,g as Ge,h as He,i as We,j as xe}from"./manual.services-SHxMhgMQ.js";const Je={key:0,class:"manage section-height shadowed"},Xe={class:"manage__inner section-padding"},Ye={class:"manage__overlay"},Ze={key:3,class:"manage__triggers"},ea={__name:"view",async setup(aa){let l,s;const f=De(),A=Re(),X=Ee();Te(),Ve();const p=m(X.params.id),Y=je(),{user:d}=Pe(Y),L=n(()=>{var e,t;return!!((t=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)!=null&&t.includes(T.APPLICATION.READ))}),Z=m([{id:1,label:"appFloor",width:350},{id:2,label:"appMaterial",width:370},{id:3,label:"appCount",width:260},{id:4,label:"appPrice",width:350}]),o=m({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],applicationTables:[],details:"",statusId:"",allowedActionRoleIds:[]}),{data:ee,isSuccess:ae,isLoading:le}=([l,s]=b(()=>y({queryKey:["objectsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Qe(),enabled:L})),l=await l,s(),l),C=n(()=>o.value.buildingObjectId),oe=n(()=>{var e;return!!((e=C.value)!=null&&e.length)}),{data:te,isSuccess:se,isLoading:ie}=([l,s]=b(()=>y({queryKey:["blocksList",{blockId:C}],queryFn:()=>We(C.value),enabled:oe})),l=await l,s(),l),S=n(()=>o.value.buildingBlockId),M=n(()=>{var e;return!!((e=S.value)!=null&&e.length)}),{data:ne,isSuccess:de,isLoading:ue}=([l,s]=b(()=>y({queryKey:["floorsList",{floorId:S}],queryFn:()=>xe(S.value),enabled:M})),l=await l,s(),l),{data:ce,isSuccess:re,isLoading:pe}=([l,s]=b(()=>y({queryKey:["costsList",{organizationId:d.value.user.organizationId}],queryFn:()=>Ge(),enabled:M})),l=await l,s(),l),{data:me,isSuccess:be,isLoading:ve}=([l,s]=b(()=>y({queryKey:["materialsList",{organizationId:d.value.user.organizationId}],queryFn:()=>He(),enabled:M})),l=await l,s(),l),B=n(()=>{var e;return!!(re&&be&&de&&((e=o.value.applicationTables)!=null&&e.length))}),ye=m([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),Ie=m([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:ee,success:ae,loading:le},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:te,success:se,loading:ie}]);m([{id:1,model:"details",label:"appCommentLabel",placeholder:"appCommentPlaceholder",errorKey:"details"}]);const{isError:ge}=([l,s]=b(()=>y({queryKey:["applicationsById",p],queryFn:()=>ze("application",p.value),select:e=>{o.value.id=e.id,o.value.deadline=e.deadline,o.value.buildingObjectId=[e.buildingObjectId],o.value.buildingBlockId=[e.buildingBlockId],o.value.applicationTables=[...e.applicationTables],o.value.details=e.details,o.value.statusId=e.statusId,o.value.allowedActionRoleIds=e.allowedActionRoleIds},enabled:L})),l=await l,s(),l),j=n(()=>V(ne.value||[])),P=n(()=>V(ce.value||[])),q=n(()=>V(me.value||[])),he=e=>{var t;return(t=j.value[e.floorId])==null?void 0:t.name},_e=e=>{var t;return(t=P.value[e.costId])==null?void 0:t.name},fe=e=>{var t;return(t=q.value[e==null?void 0:e.constructionMaterialId])==null?void 0:t.name},ke=n(()=>{var e,t,I;return((e=Object.keys(j.value))==null?void 0:e.length)&&((t=Object.keys(P.value))==null?void 0:t.length)&&((I=Object.keys(q.value))==null?void 0:I.length)});H(ke,e=>{e&&(o.value.applicationTables=o.value.applicationTables.map(t=>({...t,floorValue:he(t),costValue:_e(t),constructionMaterialValue:fe(t)})))},{immediate:!0}),H(ge,e=>{e&&A.push(w.HOME.path)});const{mutate:we}=J({mutationFn:e=>Ue("application",e),onSuccess:()=>{f.invalidateQueries({queryKey:["applications"]}),f.invalidateQueries({queryKey:["applicationsById",p]}),A.push(w.APPLICATION.path)}}),{mutate:Ae}=J({mutationFn:e=>$e("application",e),onSuccess:()=>{f.invalidateQueries({queryKey:["applications"]}),f.invalidateQueries({queryKey:["applicationsById",p]}),A.push(w.APPLICATION.path)}}),Le=()=>{we(p.value)},Ce=()=>{Ae(p.value)};return(e,t)=>{var N,R,E,D,z,U,$,Q,G;const I=v("ManageHead"),Se=v("FormInput"),Me=v("FormSelect"),Be=v("SubTable"),Fe=v("Spinner"),K=v("MyButton");return L.value?(i(),k("section",Je,[O("div",Xe,[qe(I,{title:"addNewApplicationTitle",to:u(w).APPLICATION.path},null,8,["to"]),O("form",{class:"manage__form",onSubmit:t[1]||(t[1]=Ke(()=>{},["prevent"]))},[O("div",Ye,[(i(!0),k(W,null,x(ye.value,a=>(i(),c(Se,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":F=>o.value[a.model]=F,width:500,placeholder:e.$t(a.placeholder),name:a.icon,type:a==null?void 0:a.type,isDisabled:!0},{default:g(()=>[h(_(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),(i(!0),k(W,null,x(Ie.value,a=>(i(),c(Me,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":F=>o.value[a.model]=F,width:500,options:a.options,placeholder:a==null?void 0:a.placeholder,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple,isDisabled:!0},{default:g(()=>[h(_(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128))]),B.value?(i(),c(Be,{key:0,headers:Z.value,table:o.value.applicationTables},null,8,["headers","table"])):r("",!0),u(pe)||u(ve)||u(ue)||!((N=o.value.applicationTables)!=null&&N.length)?(i(),c(Fe,{key:1})):r("",!0),B.value?(i(),c(Ne,{key:2,modelValue:o.value.details,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.details=a),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),isDisabled:!0},{default:g(()=>[h(_(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder"])):r("",!0),B.value&&o.value.statusId!==7&&o.value.statusId!==15&&o.value.allowedActionRoleIds.includes((E=(R=u(d))==null?void 0:R.user)==null?void 0:E.roleId)?(i(),k("div",Ze,[(U=(z=(D=u(d))==null?void 0:D.user)==null?void 0:z.modules)!=null&&U.includes(u(T).APPLICATION.CONFIRM)?(i(),c(K,{key:0,icon:"approve",type:"submit",color:"green",width:180,onClick:Ce},{default:g(()=>[h(_(e.$t("acceptButton")),1)]),_:1})):r("",!0),(G=(Q=($=u(d))==null?void 0:$.user)==null?void 0:Q.modules)!=null&&G.includes(u(T).APPLICATION.REFUSAL)?(i(),c(K,{key:1,icon:"refusal",type:"submit",color:"red",width:180,onClick:Le},{default:g(()=>[h(_(e.$t("cancelButton")),1)]),_:1})):r("",!0)])):r("",!0)],32)])])):r("",!0)}}},na=Oe(ea,[["__scopeId","data-v-79f005ff"]]);export{na as default};
//# sourceMappingURL=view-zS7VFy0Q.js.map
