import{u as ce,a as le,b as me,y as de,c as D,r as _,z as v,B as ie,d as g,e as N,k as R,h as u,w as pe,F as x,C as ye,D as I,i as T,l as he,G as _e,m as l,o as n,s as q,A as H,f as $,t as S,H as ve,E as ge}from"./index-8l2LyLh8.js";import{u as Ie,r as m}from"./i18n-validators-Wkg5KBML.js";import{a as Te,u as qe}from"./generic.services-yETqkf3T.js";import{u as P}from"./useQuery-tdqJaMO0.js";import{a as $e,u as Se}from"./crud.services-BcMjcvoI.js";import{k as Pe,b as be}from"./manual.services-Ls971AW1.js";const Ke={key:0,class:"manage section-height shadowed"},Ve={class:"manage__inner section-padding"},Me={__name:"update",async setup(we){let a,r;const d=Te(),b=he(),O=_e(),A=ce(),{t:G}=le(),z=me(),{user:i}=de(z),c=D(()=>{var t,y;return!!((y=(t=i==null?void 0:i.value.user)==null?void 0:t.modules)!=null&&y.includes(ve.PRODUCT.UPDATE))}),p=_(O.params.id),s=_({id:"",fullname:"",quantityTypeId:[],stateId:[]}),W=D(()=>({id:{required:m},fullname:{required:m},quantityTypeId:{required:m},stateId:{required:m}})),o=Ie(W,s),{data:j,isSuccess:J,isLoading:X}=([a,r]=v(()=>P({queryKey:["types"],queryFn:()=>Pe(),enabled:c})),a=await a,r(),a),{data:Y,isSuccess:Z,isLoading:f}=([a,r]=v(()=>P({queryKey:["states"],queryFn:()=>be(),enabled:c})),a=await a,r(),a),ee=_([{id:1,model:"fullname",label:"nameProductsLabel",placeholder:"nameProductsPlaceholder",icon:"pen",errorKey:"fullname"},{id:2,model:"quantityTypeId",label:"qunatityTypesProductsLabel",placeholder:"qunatityTypesProductsPlaceholder",errorKey:"quantityTypeId",options:j,success:J,loading:X,select:!0},{id:3,model:"stateId",label:"stateProductsLabel",placeholder:"stateProductsPlaceholder",errorKey:"stateId",options:Y,success:Z,loading:f,select:!0}]),{isError:te}=([a,r]=v(()=>P({queryKey:["productById",p],queryFn:()=>$e("construction_material",p.value),select:t=>{s.value.id=t.id,s.value.fullname=t.fullname,s.value.quantityTypeId=[t.quantityTypeId],s.value.stateId=[t.stateId]},enabled:c})),a=await a,r(),a);ie(te,t=>{t&&b.push(q.HOME.path)});const{mutate:ae}=qe({onMutate:t=>{t.quantityTypeId=t.quantityTypeId[0],t.stateId=t.stateId[0]},mutationFn:t=>Se("construction_material",t),onSuccess:t=>{t!=null&&t.success&&(s.value=ge(s.value),d.invalidateQueries({queryKey:["products"]}),d.invalidateQueries({queryKey:["productById",p]}),d.invalidateQueries({queryKey:["materialsList"]}),b.push(q.PRODUCT.path),setTimeout(()=>A.success(G("updateToast")),150))}}),se=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const t={...s.value};ae(t),o.value.$reset()};return(t,y)=>{var K,V;const oe=l("ManageHead"),re=l("FormInput"),ue=l("FormSelect"),ne=l("CustomButton");return c.value?(n(),g("section",Ke,[N("div",Ve,[R(oe,{title:"editProductTitle",to:u(q).PRODUCT.path},null,8,["to"]),N("form",{class:"manage__form form-manage",onSubmit:pe(se,["prevent"])},[(n(!0),g(x,null,ye(ee.value,e=>{var w,C,B,F,k,E,L,M,U,Q;return n(),g(x,{key:e.id},[e!=null&&e.select?T("",!0):(n(),H(re,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(C=(w=u(o))==null?void 0:w[e==null?void 0:e.errorKey])==null?void 0:C.$error,textError:(k=(F=(B=u(o))==null?void 0:B[e==null?void 0:e.errorKey])==null?void 0:F.$errors[0])==null?void 0:k.$message},{default:I(()=>[$(S(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(n(),H(ue,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,modelModifiers:{trim:!0},width:500,options:e.options,error:(L=(E=u(o))==null?void 0:E[e==null?void 0:e.errorKey])==null?void 0:L.$error,placeholder:e==null?void 0:e.placeholder,textError:(Q=(U=(M=u(o))==null?void 0:M[e==null?void 0:e.errorKey])==null?void 0:U.$errors[0])==null?void 0:Q.$message,success:e.success,loading:e.loading},{default:I(()=>[$(S(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):T("",!0)],64)}),128)),R(ne,{className:`form__submit ${(V=(K=u(o))==null?void 0:K.stateId.$errors[0])!=null&&V.$message?"centered":""}`},{default:I(()=>[$(S(t.$t("formButton")),1)]),_:1},8,["className"])],32)])])):T("",!0)}}};export{Me as default};
