import{u as ie,a as ne,r as n,y as g,c as _,x as de,b as S,d as j,f as K,k as b,w as ue,F as V,e as F,B as k,g as ce,h as y,o as I,A as M,z as w,i as L,t as A}from"./index-TSEQ-eOA.js";import{u as me,r as l}from"./i18n-validators-JwSzG1r2.js";import{a as pe,u as ge}from"./generic.services-DL6v4nvc.js";import{u as h}from"./useQuery-LbR7akY7.js";import{c as be}from"./crud.services-TcfslZre.js";import{h as Ie,i as he,g as fe,e as ye,j as ve}from"./manual.services-teOujj0Q.js";const _e={class:"manage section-height shadowed"},Se={class:"manage__inner section-padding"},Me={__name:"create",async setup(ke){let o,s;const $=pe(),q=ce();ie(),ne();const t=n(localStorage.getItem("organizationId")),C=n(localStorage.getItem("id")),B=n(!1),{data:O,isSuccess:P,isLoading:N}=([o,s]=g(()=>h({queryKey:["floors",{organizationId:t}],queryFn:()=>Ie(t.value)})),o=await o,s(),o),{data:x,isSuccess:E,isLoading:z}=([o,s]=g(()=>h({queryKey:["costs",{organizationId:t}],queryFn:()=>he(t.value)})),o=await o,s(),o),{data:T,isSuccess:G,isLoading:U}=([o,s]=g(()=>h({queryKey:["materials",{organizationId:t}],queryFn:()=>fe(t.value)})),o=await o,s(),o),{data:H,isSuccess:Q,isLoading:D}=([o,s]=g(()=>h({queryKey:["objectsList",{organizationId:t}],queryFn:()=>ye(t.value)})),o=await o,s(),o),r=n({userId:C.value,organizationId:t.value,deadline:"",constructionMaterialIds:[],buildingObjectId:[],buildingBlockId:[],floor:[],costId:[]}),f=_(()=>r.value.buildingObjectId),R=_(()=>!!f.value.length);de(f,()=>{B.value||(r.value.buildingBlockId=[])},{immediate:!0});const{data:J,isSuccess:W,isLoading:X}=([o,s]=g(()=>h({queryKey:["blocksList",{blockId:f}],queryFn:()=>ve(f.value),enabled:R})),o=await o,s(),o),Y=_(()=>({userId:{required:l},organizationId:{required:l},deadline:{required:l},constructionMaterialIds:{required:l},buildingObjectId:{required:l},buildingBlockId:{required:l},floor:{required:l},costId:{required:l}})),i=me(Y,r),Z=n([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),ee=n([{id:1,model:"floor",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",errorKey:"floor",options:O,success:P,loading:N,optionValue:"name"},{id:2,model:"constructionMaterialIds",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",errorKey:"constructionMaterialIds",options:T,success:G,loading:U,multiple:!0},{id:3,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",errorKey:"costId",options:x,success:E,loading:z},{id:4,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:H,success:Q,loading:D},{id:5,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:J,success:W,loading:X}]),{mutate:oe}=ge({onMutate:a=>{B.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.floor=a.floor[0],a.costId=a.costId[0]},mutationFn:a=>be("application",a),onSuccess:()=>{$.invalidateQueries({queryKey:["applications"]}),q.push(M.APPLICATIONS.path)}}),ae=()=>{i.value.$validate(),!i.value.$errors.length&&(oe(r.value),i.value.$reset())};return(a,Le)=>{const se=y("ManageHead"),te=y("FormInput"),re=y("FormSelect"),le=y("CustomButton");return I(),S("section",_e,[j("div",Se,[K(se,{title:"addNewApplicationTitle",to:b(M).APPLICATIONS.path},null,8,["to"]),j("form",{class:"manage__form form-manage",onSubmit:ue(ae,["prevent"])},[(I(!0),S(V,null,F(Z.value,e=>{var d,u,c,m,p;return I(),w(te,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":v=>r.value[e.model]=v,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(u=(d=b(i))==null?void 0:d[e.errorKey])==null?void 0:u.$error,textError:(p=(m=(c=b(i))==null?void 0:c[e.errorKey])==null?void 0:m.$errors[0])==null?void 0:p.$message,type:e==null?void 0:e.type},{default:k(()=>[L(A(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(I(!0),S(V,null,F(ee.value,e=>{var d,u,c,m,p;return I(),w(re,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":v=>r.value[e.model]=v,width:500,options:e.options,error:(u=(d=b(i))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(p=(m=(c=b(i))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:p.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple,optionValue:e==null?void 0:e.optionValue},{default:k(()=>[L(A(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect","optionValue"])}),128)),K(le,{className:"form__submit"},{default:k(()=>[L(A(a.$t("formButton")),1)]),_:1})],32)])])}}};export{Me as default};
//# sourceMappingURL=create-a_Gta0y7.js.map
