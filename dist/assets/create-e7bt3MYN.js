import{u as Y,a as Z,r as p,z as O,c as _,y as ee,d as f,e as K,k as L,h as i,w as re,F as S,C as V,D as y,l as ae,m as h,o as c,B as w,A as C,f as b,t as v}from"./index-8f2nY-tA.js";import{u as oe,r as n}from"./i18n-validators-fCwa1ZSs.js";import{a as te,u as ne}from"./generic.services-2-3LJT-B.js";import{u as F}from"./useQuery-eGcy0OjN.js";import{c as ie}from"./crud.services-swolhUoO.js";import{m as se,a as le}from"./manual.services-mSBZeXJB.js";const de={class:"manage section-height shadowed"},ce={class:"manage__inner section-padding"},be={__name:"create",async setup(ue){let a,u;const P=te(),B=ae();Y(),Z();const I=p(!1),o=p({fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[]}),{data:E,isSuccess:M,isLoading:q}=([a,u]=O(()=>F({queryKey:["regions"],queryFn:()=>se()})),a=await a,u(),a),m=_(()=>o.value.regionId),k=_(()=>!!m.value.length);ee(m,()=>{I.value||(o.value.districtId=[])},{immediate:!0});const{data:x,isSuccess:D,isLoading:R}=([a,u]=O(()=>F({queryKey:["districts",{districtId:m}],queryFn:()=>le(m.value),enabled:k})),a=await a,u(),a),A=_(()=>({fullName:{required:n},inn:{required:n},address:{required:n},phoneNumber:{required:n},director:{required:n},regionId:{required:n},districtId:{required:n}})),t=oe(A,o),U=p([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),H=p([{id:1,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:E,success:M,loading:q},{id:2,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:x,success:D,loading:R}]),{mutate:Q}=ne({onMutate:r=>{I.value=!0,r.regionId=r.regionId[0],r.districtId=r.districtId[0]},mutationFn:r=>ie("organization",r),onSuccess:()=>{P.invalidateQueries({queryKey:["companies"]}),B.push(w.COMPANIES.path)}}),T=()=>{t.value.$validate(),!t.value.$errors.length&&(Q(o.value),t.value.$reset())};return(r,me)=>{var $,z;const G=h("ManageHead"),j=h("FormInput"),J=h("FormSelect"),W=h("CustomButton");return c(),f("section",de,[K("div",ce,[L(G,{title:"addNewCompanyTitle",to:i(w).COMPANIES.path},null,8,["to"]),K("form",{class:"manage__form form-manage",onSubmit:re(T,["prevent"])},[(c(!0),f(S,null,V(U.value,e=>{var s,l,d;return c(),C(j,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":g=>o.value[e.model]=g,width:500,placeholder:r.$t(e.placeholder),name:e.icon,error:(s=i(t))==null?void 0:s[e.errorKey].$error,textError:(d=(l=i(t))==null?void 0:l[e.errorKey].$errors[0])==null?void 0:d.$message},{default:y(()=>[b(v(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(c(!0),f(S,null,V(H.value,e=>{var s,l,d,g,N;return c(),C(J,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":X=>o.value[e.model]=X,width:500,options:e.options,error:(l=(s=i(t))==null?void 0:s[e==null?void 0:e.errorKey])==null?void 0:l.$error,placeholder:e==null?void 0:e.placeholder,textError:(N=(g=(d=i(t))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:g.$errors[0])==null?void 0:N.$message,success:e.success,loading:e.loading},{default:y(()=>[b(v(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(W,{className:`form__submit ${(z=($=i(t))==null?void 0:$.districtId.$errors[0])!=null&&z.$message?"centered":""}`},{default:y(()=>[b(v(r.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{be as default};
//# sourceMappingURL=create-e7bt3MYN.js.map
