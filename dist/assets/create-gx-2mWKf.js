import{u as ae,a as te,b as oe,y as re,c as w,r as g,z as V,d as q,e as b,k as C,h as s,w as se,F as M,C as K,D as v,i as ne,l as ue,m as p,o as m,s as F,A as L,f as T,t as I,H as le,E as ie}from"./index-I0O1PMyv.js";import{u as de,r as $}from"./i18n-validators-TDhqfgQ8.js";import{a as me,u as ce}from"./generic.services-tAYQOCEA.js";import{u as W}from"./useQuery-lcb-4ShK.js";import{c as ye}from"./crud.services-EfxTTgbv.js";import{h as pe,k as he}from"./manual.services-CEFxwEmr.js";const _e={key:0,class:"manage section-height shadowed"},fe={class:"manage__inner section-padding"},Ee={__name:"create",async setup(ge){let t,c;const k=me(),U=ue(),B=ae(),{t:H}=te(),N=oe(),{user:y}=re(N),h=w(()=>{var a,_;return!!((_=(a=y==null?void 0:y.value.user)==null?void 0:a.modules)!=null&&_.includes(le.WAREHOUSE.CREATE))}),o=g({materialId:[],quantity:"",quantityTypeId:[]}),A=w(()=>({materialId:{required:$},quantity:{required:$},quantityTypeId:{required:$}})),r=de(A,o),{data:Q,isSuccess:R,isLoading:x}=([t,c]=V(()=>W({queryKey:["types"],queryFn:()=>he(),enabled:h})),t=await t,c(),t),{data:P,isSuccess:z,isLoading:D}=([t,c]=V(()=>W({queryKey:["materialsList",{organizationId:y.value.user.organizationId}],queryFn:()=>pe(),enabled:h})),t=await t,c(),t),O=g([{id:1,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),j=g([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:P,success:z,loading:D},{id:2,model:"quantityTypeId",label:"qunatityTypesWarehouseLabel",placeholder:"qunatityTypesWarehousePlaceholder",errorKey:"quantityTypeId",options:Q,success:R,loading:x}]),{mutate:G}=ce({onMutate:a=>{a.materialId=a.materialId[0],a.quantityTypeId=a.quantityTypeId[0]},mutationFn:a=>ye("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(o.value=ie(o.value),k.invalidateQueries({queryKey:["warehouse"]}),U.push(F.WAREHOUSE.path),setTimeout(()=>B.success(H("createToast")),150))}}),J=()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...o.value};G(a),r.value.$reset()};return(a,_)=>{var S,E;const X=p("ManageHead"),Y=p("FormInput"),Z=p("FormSelect"),ee=p("CustomButton");return h.value?(m(),q("section",_e,[b("div",fe,[C(X,{title:"addNewProductTitle",to:s(F).WAREHOUSE.path},null,8,["to"]),b("form",{class:"manage__form form-manage",onSubmit:se(J,["prevent"])},[(m(!0),q(M,null,K(O.value,e=>{var n,u,l,i,d;return m(),L(Y,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":f=>o.value[e.model]=f,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(u=(n=s(r))==null?void 0:n[e.errorKey])==null?void 0:u.$error,textError:(d=(i=(l=s(r))==null?void 0:l[e.errorKey])==null?void 0:i.$errors[0])==null?void 0:d.$message},{default:v(()=>[T(I(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(m(!0),q(M,null,K(j.value,e=>{var n,u,l,i,d;return m(),L(Z,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":f=>o.value[e.model]=f,modelModifiers:{trim:!0},width:500,options:e.options,error:(u=(n=s(r))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(d=(i=(l=s(r))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:d.$message,success:e.success,loading:e.loading},{default:v(()=>[T(I(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),C(ee,{className:`form__submit ${(E=(S=s(r))==null?void 0:S.quantityTypeId.$errors[0])!=null&&E.$message?"centered":""}`},{default:v(()=>[T(I(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ne("",!0)}}};export{Ee as default};
