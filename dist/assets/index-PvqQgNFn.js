import{u as Y,a as Z,x as ee,y as B,b as se,c as te,r as O,z as oe,d as q,e as ae,k as I,A as ne,h as e,B as N,i as n,t as P,m as r,o as i,f as re,s as Q,H as u}from"./index-_sW-sQTC.js";import{u as ie}from"./generic.services-lrsWuSGG.js";import{u as ue}from"./useQuery-__dxNVMJ.js";import{u as le}from"./useMutation-A_gT2E6W.js";import{g as ce,d as de}from"./crud.services-WjFvBV25.js";import{r as me}from"./index-zI2a6Eei.js";const _e={key:0,class:"roles"},pe={class:"roles__inner section-padding"},ye={key:2,class:"empty-table shadowed"},Re={__name:"index",async setup(he){let o,p;const l=ie(),U=Y(),{t:x}=Z(),H=ee(),{page:c,limit:d,search:K}=B(H),V=se(),{user:t}=B(V),y=te(()=>{var s,_;return!!((_=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)!=null&&_.includes(u.ROLE.READ))}),h=O(""),S=me(K,500),z=O([{id:1,label:"rolesName",width:70}]),{data:a,isLoading:F,isSuccess:m,isError:M}=([o,p]=oe(()=>ue({queryKey:["roles",{page:c,limit:d,debouncedSearch:S,organizationId:t.value.user.organizationId,name:t.value.user.fullName}],queryFn:()=>ce("Role",c.value,d.value,S.value),enabled:y})),o=await o,p(),o),{mutate:$}=le({mutationFn:s=>de("Role",s),onSuccess:s=>{s!=null&&s.success&&(l.invalidateQueries({queryKey:["roles"]}),l.invalidateQueries({queryKey:["rolesById",h]}),l.invalidateQueries({queryKey:["rolesList"]}),setTimeout(()=>U.success(x("deleteToast")),150))}}),W=async s=>{h.value=s,$(s)};return(s,_)=>{var E,f,T,v,g,R,b,w,L,C,D,k,A;const j=r("HeadPage"),G=r("Table"),J=r("Pagination"),X=r("Spinner");return y.value?(i(),q("section",_e,[ae("div",pe,[I(j,{title:"rolesTitle",to:e(Q).CREATE_ROLE.path,isShowCreate:(T=(f=(E=e(t))==null?void 0:E.user)==null?void 0:f.modules)==null?void 0:T.includes(e(u).ROLE.CREATE)},{default:ne(()=>[re(P(s.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),e(m)&&((v=e(a))!=null&&v.count)?(i(),N(G,{key:0,headers:z.value,table:(g=e(a))==null?void 0:g.roles,to:e(Q).UPDATE_ROLE.name,options:{page:e(c),limit:e(d)},isShowUpdate:(w=(b=(R=e(t))==null?void 0:R.user)==null?void 0:b.modules)==null?void 0:w.includes(e(u).ROLE.UPDATE),isShowDelete:(D=(C=(L=e(t))==null?void 0:L.user)==null?void 0:C.modules)==null?void 0:D.includes(e(u).ROLE.DELETE),onOnActionDelete:W},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),I(J,{count:(k=e(a))==null?void 0:k.count,isSucces:e(m)},null,8,["count","isSucces"]),e(F)?(i(),N(X,{key:1})):n("",!0),e(m)&&!((A=e(a))!=null&&A.count)||e(M)?(i(),q("div",ye,P(s.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{Re as default};
