import{u as ie,a as de,b as ne,y as ce,c as h,r as f,z as k,B as ue,d as L,e as V,k as j,h as i,w as me,F as N,C as q,D as F,i as be,l as ge,m as y,o as b,s as E,A as R,f as O,t as K,H as pe,E as he}from"./index-idz2mM86.js";import{u as fe,r as t}from"./i18n-validators-3wYqw7NZ.js";import{a as ye,u as _e}from"./generic.services-xV6yKTLp.js";import{u as B}from"./useQuery-JdKHfDoS.js";import{c as ve}from"./crud.services-UxL1e2zS.js";import{f as Ie,m as ke,a as Le}from"./manual.services-b1i2OevX.js";const Fe={key:0,class:"manage section-height shadowed"},Oe={class:"manage__inner section-padding"},je={__name:"create",async setup(Ke){let s,l;const $=ye(),M=ge(),P=ie(),{t:T}=de(),D=ne(),{user:g}=ce(D),_=h(()=>{var o,v;return!!((v=(o=g==null?void 0:g.value.user)==null?void 0:o.modules)!=null&&v.includes(pe.BLOCK.CREATE))}),S=f(!1),r=f({fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[]}),x=h(()=>({fullname:{required:t},numberOfFloors:{required:t},roomsOnFloor:{required:t},address:{required:t},buildingObjectId:{required:t},regionId:{required:t},districtId:{required:t}})),a=fe(x,r),{data:A,isSuccess:U,isLoading:H}=([s,l]=k(()=>B({queryKey:["regions"],queryFn:()=>ke(),enabled:_})),s=await s,l(),s),p=h(()=>r.value.regionId),Q=h(()=>!!p.value.length);ue(p,()=>{S.value||(r.value.districtId=[])},{immediate:!0});const{data:z,isSuccess:G,isLoading:J}=([s,l]=k(()=>B({queryKey:["districts",{districtId:p}],queryFn:()=>Le(p.value),enabled:Q})),s=await s,l(),s),{data:W,isSuccess:X,isLoading:Y}=([s,l]=k(()=>B({queryKey:["objectsList",{organizationId:g.value.user.organizationId}],queryFn:()=>Ie(),enabled:_})),s=await s,l(),s),Z=f([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),ee=f([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:W,success:X,loading:Y},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:A,success:U,loading:H},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:z,success:G,loading:J}]),{mutate:oe}=_e({onMutate:o=>{S.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.regionId=o.regionId[0],o.districtId=o.districtId[0]},mutationFn:o=>ve("building_block",o),onSuccess:o=>{o!=null&&o.success&&(r.value=he(r.value),$.invalidateQueries({queryKey:["blocks"]}),$.invalidateQueries({queryKey:["blocksList"]}),M.push(E.BLOCK.path),setTimeout(()=>P.success(T("createToast")),150))}}),se=()=>{if(a.value.$validate(),a.value.$errors.length)return;const o={...r.value};oe(o),a.value.$reset()};return(o,v)=>{var w,C;const re=y("ManageHead"),ae=y("FormInput"),te=y("FormSelect"),le=y("CustomButton");return _.value?(b(),L("section",Fe,[V("div",Oe,[j(re,{title:"addNewBlocksTitle",to:i(E).BLOCK.path},null,8,["to"]),V("form",{class:"manage__form form-manage",onSubmit:me(se,["prevent"])},[(b(!0),L(N,null,q(Z.value,e=>{var d,n,c,u,m;return b(),R(ae,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":I=>r.value[e.model]=I,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(n=(d=i(a))==null?void 0:d[e.errorKey])==null?void 0:n.$error,textError:(m=(u=(c=i(a))==null?void 0:c[e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message},{default:F(()=>[O(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(b(!0),L(N,null,q(ee.value,e=>{var d,n,c,u,m;return b(),R(te,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":I=>r.value[e.model]=I,modelModifiers:{trim:!0},width:500,options:e.options,error:(n=(d=i(a))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(u=(c=i(a))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:F(()=>[O(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),j(le,{className:`form__submit ${(C=(w=i(a))==null?void 0:w.districtId.$errors[0])!=null&&C.$message?"centered":""}`},{default:F(()=>[O(K(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):be("",!0)}}};export{je as default};
