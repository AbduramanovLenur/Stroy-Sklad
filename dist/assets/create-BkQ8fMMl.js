import{u as re,a as se,r as g,z as I,c as _,y as ae,d as y,e as $,k as S,h as i,w as te,F as w,C as V,D as k,l as le,m as h,o as b,B as j,A as C,f as v,t as F}from"./index-qZ69CyC7.js";import{u as ie,r as t}from"./i18n-validators-dGSGbQKY.js";import{a as de,u as ne}from"./generic.services-34GP1Yc8.js";import{u as L}from"./useQuery-IZNqF3Xo.js";import{c as ce}from"./crud.services-qYEmjzHd.js";import{m as ue,a as me,f as ge}from"./manual.services-BxKPmsPu.js";const be={class:"manage section-height shadowed"},pe={class:"manage__inner section-padding"},Le={__name:"create",async setup(he){let r,l;const N=de(),q=le();re(),se();const P=g(localStorage.getItem("organizationId")),O=g(!1),s=g({fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[]}),{data:R,isSuccess:E,isLoading:M}=([r,l]=I(()=>L({queryKey:["regions"],queryFn:()=>ue()})),r=await r,l(),r),p=_(()=>s.value.regionId),x=_(()=>!!p.value.length);ae(p,()=>{O.value||(s.value.districtId=[])},{immediate:!0});const{data:D,isSuccess:A,isLoading:U}=([r,l]=I(()=>L({queryKey:["districts",{districtId:p}],queryFn:()=>me(p.value),enabled:x})),r=await r,l(),r),{data:z,isSuccess:G,isLoading:H}=([r,l]=I(()=>L({queryKey:["objectsList",{organizationId:P}],queryFn:()=>ge()})),r=await r,l(),r),Q=_(()=>({fullname:{required:t},numberOfFloors:{required:t},roomsOnFloor:{required:t},address:{required:t},buildingObjectId:{required:t},regionId:{required:t},districtId:{required:t}})),a=ie(Q,s),T=g([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),J=g([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:z,success:G,loading:H},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:R,success:E,loading:M},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:D,success:A,loading:U}]),{mutate:W}=ne({onMutate:o=>{O.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.regionId=o.regionId[0],o.districtId=o.districtId[0]},mutationFn:o=>ce("building_block",o),onSuccess:()=>{N.invalidateQueries({queryKey:["blocks"]}),q.push(j.BLOCKS.path)}}),X=()=>{a.value.$validate(),!a.value.$errors.length&&(W(s.value),a.value.$reset())};return(o,fe)=>{var B,K;const Y=h("ManageHead"),Z=h("FormInput"),ee=h("FormSelect"),oe=h("CustomButton");return b(),y("section",be,[$("div",pe,[S(Y,{title:"addNewBlocksTitle",to:i(j).BLOCKS.path},null,8,["to"]),$("form",{class:"manage__form form-manage",onSubmit:te(X,["prevent"])},[(b(!0),y(w,null,V(T.value,e=>{var d,n,c,u,m;return b(),C(Z,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":f=>s.value[e.model]=f,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(n=(d=i(a))==null?void 0:d[e.errorKey])==null?void 0:n.$error,textError:(m=(u=(c=i(a))==null?void 0:c[e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message},{default:k(()=>[v(F(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(b(!0),y(w,null,V(J.value,e=>{var d,n,c,u,m;return b(),C(ee,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":f=>s.value[e.model]=f,width:500,options:e.options,error:(n=(d=i(a))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(u=(c=i(a))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:k(()=>[v(F(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),S(oe,{className:`form__submit ${(K=(B=i(a))==null?void 0:B.districtId.$errors[0])!=null&&K.$message?"centered":""}`},{default:k(()=>[v(F(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Le as default};
//# sourceMappingURL=create-BkQ8fMMl.js.map
