import{u as ce,a as ue,r as d,y as n,c as v,x as me,b as L,d as K,j,g as I,w as pe,F,B as q,C as S,k as ge,l as f,o as h,A as w,z as M,e as k,t as A}from"./index-LIAghTzt.js";import{u as be,r as t}from"./i18n-validators-Soiy62qZ.js";import{a as Ie,u as he}from"./generic.services-g7-190gM.js";import{u as c}from"./useQuery-lbUIVZoa.js";import{c as ye}from"./crud.services-v10L7FpB.js";import{h as fe,i as _e,g as ve,d as Le,e as Se,j as ke}from"./manual.services-T8eI6v5K.js";const Ae={class:"manage section-height shadowed"},Be={class:"manage__inner section-padding"},Oe={__name:"create",async setup(Ke){let o,s;const C=Ie(),$=ge();ce(),ue();const l=d(localStorage.getItem("organizationId")),O=d(localStorage.getItem("id")),B=d(!1),r=d({userId:O.value,deadline:"",constructionMaterialIds:[],buildingObjectId:[],buildingBlockId:[],floorId:[],costId:[],roleIds:[]}),{data:V,isSuccess:P,isLoading:N}=([o,s]=n(()=>c({queryKey:["floors",{organizationId:l}],queryFn:()=>fe(l.value)})),o=await o,s(),o),{data:x,isSuccess:E,isLoading:R}=([o,s]=n(()=>c({queryKey:["costs",{organizationId:l}],queryFn:()=>_e(l.value)})),o=await o,s(),o),{data:G,isSuccess:T,isLoading:U}=([o,s]=n(()=>c({queryKey:["materials",{organizationId:l}],queryFn:()=>ve(l.value)})),o=await o,s(),o),{data:z,isSuccess:H,isLoading:Q}=([o,s]=n(()=>c({queryKey:["roles"],queryFn:()=>Le()})),o=await o,s(),o),{data:D,isSuccess:J,isLoading:W}=([o,s]=n(()=>c({queryKey:["objectsList",{organizationId:l}],queryFn:()=>Se(l.value)})),o=await o,s(),o),y=v(()=>r.value.buildingObjectId),X=v(()=>!!y.value.length);me(y,()=>{B.value||(r.value.buildingBlockId=[])},{immediate:!0});const{data:Y,isSuccess:Z,isLoading:ee}=([o,s]=n(()=>c({queryKey:["blocksList",{blockId:y}],queryFn:()=>ke(y.value),enabled:X})),o=await o,s(),o),oe=v(()=>({userId:{required:t},deadline:{required:t},constructionMaterialIds:{required:t},buildingObjectId:{required:t},buildingBlockId:{required:t},floorId:{required:t},costId:{required:t},roleIds:{required:t}})),i=be(oe,r),ae=d([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),se=d([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:D,success:J,loading:W},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:Y,success:Z,loading:ee},{id:3,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",errorKey:"floorId",options:V,success:P,loading:N},{id:4,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",errorKey:"costId",options:x,success:E,loading:R},{id:5,model:"constructionMaterialIds",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",errorKey:"constructionMaterialIds",options:G,success:T,loading:U,multiple:!0},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:z,success:H,loading:Q,multiple:!0}]),{mutate:le}=he({onMutate:a=>{B.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.floorId=a.floorId[0],a.costId=a.costId[0]},mutationFn:a=>ye("application",a),onSuccess:()=>{C.invalidateQueries({queryKey:["applications"]}),$.push(w.APPLICATIONS.path)}}),re=()=>{i.value.$validate(),!i.value.$errors.length&&(le(r.value),i.value.$reset())};return(a,je)=>{const te=f("ManageHead"),ie=f("FormInput"),de=f("FormSelect"),ne=f("CustomButton");return h(),L("section",Ae,[K("div",Be,[j(te,{title:"addNewApplicationTitle",to:I(w).APPLICATIONS.path},null,8,["to"]),K("form",{class:"manage__form form-manage",onSubmit:pe(re,["prevent"])},[(h(!0),L(F,null,q(ae.value,e=>{var u,m,p,g,b;return h(),M(ie,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":_=>r.value[e.model]=_,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(m=(u=I(i))==null?void 0:u[e.errorKey])==null?void 0:m.$error,textError:(b=(g=(p=I(i))==null?void 0:p[e.errorKey])==null?void 0:g.$errors[0])==null?void 0:b.$message,type:e==null?void 0:e.type},{default:S(()=>[k(A(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(h(!0),L(F,null,q(se.value,e=>{var u,m,p,g,b;return h(),M(de,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":_=>r.value[e.model]=_,width:500,options:e.options,error:(m=(u=I(i))==null?void 0:u[e==null?void 0:e.errorKey])==null?void 0:m.$error,placeholder:e==null?void 0:e.placeholder,textError:(b=(g=(p=I(i))==null?void 0:p[e==null?void 0:e.errorKey])==null?void 0:g.$errors[0])==null?void 0:b.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:S(()=>[k(A(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128)),j(ne,{className:"form__submit"},{default:S(()=>[k(A(a.$t("appButton")),1)]),_:1})],32)])])}}};export{Oe as default};
//# sourceMappingURL=create-uEdp0QMv.js.map
