import{x as $,y as K,b as G,c as J,r as A,z as X,d as O,e as Y,k as q,h as e,A as P,i as n,t as Z,m as i,o as l,s as I,H as c}from"./index-zkjpq5my.js";import{a as ee,u as se}from"./generic.services-wx_DtCHh.js";import{u as oe}from"./useQuery-copJlXh0.js";import{g as te,d as ae}from"./crud.services-8TgOaY3n.js";import{r as ne}from"./index-A7S9AU-G.js";const ie={key:0,class:"blocks"},le={class:"blocks__inner section-padding"},ce={key:2,class:"empty-table shadowed"},_e={__name:"index",async setup(re){let t,p;const r=ee(),Q=$(),{page:u,limit:d,search:R}=K(Q),U=G(),{user:o}=K(U),_=J(()=>{var s,m;return!!((m=(s=o==null?void 0:o.value.user)==null?void 0:s.modules)!=null&&m.includes(c.BLOCK.READ))}),k=A(""),h=ne(R,500),H=A([{id:1,label:"blockName",width:25},{id:2,label:"blockObject",width:25},{id:4,label:"blockFloors",width:15},{id:5,label:"blockRooms",width:15},{id:6,label:"blockAddress",width:25}]),{data:a,isLoading:N,isSuccess:b,isError:x}=([t,p]=X(()=>oe({queryKey:["blocks",{page:u,limit:d,debouncedSearch:h,organizationId:o.value.user.organizationId}],queryFn:()=>te("building_block",u.value,d.value,h.value),enabled:_})),t=await t,p(),t),{mutate:z}=se({mutationFn:s=>ae("building_block",s),onSuccess:s=>{r.invalidateQueries({queryKey:["blocks"]}),r.invalidateQueries({queryKey:["blocksById",k]}),r.invalidateQueries({queryKey:["blocksList"]})}}),F=async s=>{k.value=s,z(s)};return(s,m)=>{var y,S,g,w,C,v,B,E,L,T,f,D;const V=i("HeadPage"),M=i("Table"),j=i("Pagination"),W=i("Spinner");return _.value?(l(),O("section",ie,[Y("div",le,[q(V,{title:"blockTitle",to:e(I).CREATE_BLOCK.path,isShowCreate:(g=(S=(y=e(o))==null?void 0:y.user)==null?void 0:S.modules)==null?void 0:g.includes(e(c).BLOCK.CREATE)},null,8,["to","isShowCreate"]),e(b)&&((w=e(a))!=null&&w.count)?(l(),P(M,{key:0,headers:H.value,table:(C=e(a))==null?void 0:C.blocks,to:e(I).UPDATE_BLOCK.name,options:{page:e(u),limit:e(d)},isShowUpdate:(E=(B=(v=e(o))==null?void 0:v.user)==null?void 0:B.modules)==null?void 0:E.includes(e(c).BLOCK.UPDATE),isShowDelete:(f=(T=(L=e(o))==null?void 0:L.user)==null?void 0:T.modules)==null?void 0:f.includes(e(c).BLOCK.DELETE),onOnActionDelete:F},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q(j,{count:(D=e(a))==null?void 0:D.count,isSucces:e(b)},null,8,["count","isSucces"]),e(N)?(l(),P(W,{key:1})):n("",!0),e(b)&&!e(a).count||e(x)?(l(),O("div",ce,Z(s.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{_e as default};
