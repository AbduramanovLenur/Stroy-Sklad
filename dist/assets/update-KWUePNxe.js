import{u as de,a as pe,r as S,b as ye,y as he,c as m,z as d,C as ve,d as b,e as A,k as R,h as n,w as ge,F as x,D as Ie,A as w,i as E,l as _e,G as qe,m as p,o as c,s as $,B as z,f as K,t as y,H as Se,E as be}from"./index-td5OKsxi.js";import{a as we,u as Ee}from"./crud.services-f6-dtRnP.js";import{j as $e,k as Ke,b as Ve}from"./manual.services-EaI1aYj6.js";import{u as Me,r as h}from"./i18n-validators-Zg_qUvB4.js";import{u as Be}from"./generic.services-lfCsIIL0.js";import{u as v}from"./useQuery-wqCEShPl.js";import{u as Fe}from"./useMutation-td-rGYVU.js";const Le={key:0,class:"manage section-height shadowed"},Te={class:"manage__inner section-padding"},ze={__name:"update",async setup(We){let t,r;const g=Be(),V=_e(),P=qe(),D=de(),{t:O}=pe(),I=S(P.params.id),G=ye(),{user:o}=he(G),i=m(()=>{var a,q;return!!((q=(a=o==null?void 0:o.value.user)==null?void 0:a.modules)!=null&&q.includes(Se.WAREHOUSE.UPDATE))}),s=S({id:"",materialId:[],quantity:"",stateId:[]}),j=m(()=>({id:{required:h},materialId:{required:h},quantity:{required:h},stateId:{required:h}})),u=Me(j,s),{data:J,isSuccess:X,isLoading:Y}=([t,r]=d(()=>v({queryKey:["materialsList",{organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>$e(),enabled:i})),t=await t,r(),t),_=m(()=>s.value.materialId[0]),Z=m(()=>!!_.value),{data:f,isSuccess:Ce,isLoading:Ue}=([t,r]=d(()=>v({queryKey:["types",_,{organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>Ke(_.value),enabled:Z})),t=await t,r(),t),{data:ee,isSuccess:ae,isLoading:te}=([t,r]=d(()=>v({queryKey:["states"],queryFn:()=>Ve(),enabled:i})),t=await t,r(),t),se=S([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:J,success:X,loading:Y,select:!0},{id:2,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"},{id:3,model:"stateId",label:"stateWarehouseLabel",placeholder:"stateWarehousePlaceholder",errorKey:"stateId",options:ee,success:ae,loading:te,select:!0}]),{isError:re}=([t,r]=d(()=>v({queryKey:["warehouseById",I,o.value.user.fullName],queryFn:()=>we("warehouse",I.value),select:a=>{s.value.id=a.id,s.value.materialId=[a.materialId],s.value.quantity=a.quantity,s.value.stateId=[a.stateId]},enabled:i})),t=await t,r(),t);ve(re,a=>{a&&V.push($.WAREHOUSE.path)});const{mutate:oe,status:ue}=Fe({onMutate:a=>{a.materialId=a.materialId[0],a.stateId=a.stateId[0]},mutationFn:a=>Ee("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(s.value=be(s.value),g.invalidateQueries({queryKey:["warehouse"]}),g.invalidateQueries({queryKey:["warehouseById",I]}),g.invalidateQueries({queryKey:["reports","warehouse"]}),V.push($.WAREHOUSE.path),setTimeout(()=>D.success(O("updateToast")),150))}}),ne=async()=>{if(u.value.$validate(),u.value.$errors.length)return;const a={...s.value};oe(a),u.value.$reset()};return(a,q)=>{var M,B;const le=p("ManageHead"),ce=p("FormInput"),ie=p("FormSelect"),me=p("CustomButton");return i.value?(c(),b("section",Le,[A("div",Te,[R(le,{title:"editProductTitle",to:n($).WAREHOUSE.path},null,8,["to"]),A("form",{class:"manage__form form-manage",onSubmit:ge(ne,["prevent"])},[(c(!0),b(x,null,Ie(se.value,e=>{var F,L,T,W,C,U,k,N,H,Q;return c(),b(x,{key:e.id},[e!=null&&e.select?E("",!0):(c(),z(ce,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":l=>s.value[e.model]=l,placeholder:a.$t(e.placeholder),name:e.icon,error:(L=(F=n(u))==null?void 0:F[e==null?void 0:e.errorKey])==null?void 0:L.$error,textError:(C=(W=(T=n(u))==null?void 0:T[e==null?void 0:e.errorKey])==null?void 0:W.$errors[0])==null?void 0:C.$message},{default:w(()=>{var l;return[K(y(a.$t(e.label))+" "+y((l=n(f))==null?void 0:l[0].name),1)]}),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(c(),z(ie,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":l=>s.value[e.model]=l,modelModifiers:{trim:!0},options:e.options,error:(k=(U=n(u))==null?void 0:U[e==null?void 0:e.errorKey])==null?void 0:k.$error,placeholder:e==null?void 0:e.placeholder,textError:(Q=(H=(N=n(u))==null?void 0:N[e==null?void 0:e.errorKey])==null?void 0:H.$errors[0])==null?void 0:Q.$message,success:e.success,loading:e.loading},{default:w(()=>[K(y(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):E("",!0)],64)}),128)),R(me,{className:`form__submit ${(B=(M=n(u))==null?void 0:M.stateId.$errors[0])!=null&&B.$message?"centered":""}`,disabled:n(ue)==="pending"},{default:w(()=>[K(y(a.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):E("",!0)}}};export{ze as default};
