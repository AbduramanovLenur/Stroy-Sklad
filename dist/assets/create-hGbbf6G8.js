import{_ as ye,u as Ae,a as ke,r as y,c as m,C as $e,m as v,o as d,d as b,e as A,t as p,F as T,D as Ve,B as C,A as g,f as h,i as k,k as I,K as Ze,q as Fe,b as ea,y as aa,z as V,h as u,w as oa,l as ta,s as _e,H as la,J as z,E as sa}from"./index-_sW-sQTC.js";import{c as ra}from"./crud.services-WjFvBV25.js";import{f as na,g as ca,h as ua,i as ia,j as da}from"./manual.services--mf3Snxn.js";import{u as ma,r as _}from"./i18n-validators-ha9JJgi_.js";import{u as pa}from"./generic.services-lrsWuSGG.js";import{u as M}from"./useQuery-__dxNVMJ.js";import{u as va}from"./useMutation-A_gT2E6W.js";import{v as ga}from"./v4-yQnnJER4.js";const ha={class:"application-form"},Ia={class:"application-form__title"},ba={class:"application-form__overlay form-manage"},_a={__name:"ApplicationForm",props:["subFields","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(w,{emit:t}){const c=Ae(),{t:f}=ke(),E=w,O=t,r=y({floorId:[],costId:[],constructionMaterialId:[],count:""}),P=m(()=>E.buildingBlockId);$e(P,()=>{r.value.floorId=[]});const n=()=>{if(!Ze(r.value)){c.error(f("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count},O("onAddTable",r.value),r.value=Fe(r.value)};return(i,S)=>{const N=v("FormInput"),l=v("FormSelect"),q=v("CustomButton");return d(),b("div",ha,[A("h4",Ia,p(i.$t("appInfo")),1),A("div",ba,[(d(!0),b(T,null,Ve(w.subFields,e=>(d(),b(T,{key:e.id},[e!=null&&e.select?k("",!0):(d(),C(N,{key:0,modelValue:r.value[e.model],"onUpdate:modelValue":$=>r.value[e.model]=$,width:500,placeholder:i.$t(e.placeholder),name:e.icon,type:e==null?void 0:e.type},{default:g(()=>[h(p(i.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),e!=null&&e.select?(d(),C(l,{key:1,modelValue:r.value[e.model],"onUpdate:modelValue":$=>r.value[e.model]=$,modelModifiers:{trim:!0},width:500,options:e.options,placeholder:e==null?void 0:e.placeholder,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple},{default:g(()=>[h(p(i.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"])):k("",!0)],64))),128)),I(q,{className:"form__submit",type:"button",onClick:n},{default:g(()=>[h(p(i.$t("addButtonForm")),1)]),_:1})])])}}},ya=ye(_a,[["__scopeId","data-v-e46a2199"]]),Aa={key:0,class:"manage section-height shadowed"},ka={class:"manage__inner section-padding"},$a={class:"manage__overlay"},Va={key:0,class:"error"},Ma={class:"manage__textareas"},Sa={__name:"create",async setup(w){let t,c;const f=pa(),E=ta(),O=Ae(),{t:r}=ke(),P=ea(),{user:n}=aa(P),i=m(()=>{var a,s;return!!((s=(a=n==null?void 0:n.value.user)==null?void 0:a.modules)!=null&&s.includes(la.APPLICATION.CREATE))}),S=y(!1),N=y([{id:1,label:"appFloor",width:15},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:15},{id:4,label:"appPrice",width:20}]),l=y({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:"",comment:""}),q=m(()=>({deadline:{required:_},buildingObjectId:{required:_},buildingBlockId:{required:_},createApplicationTables:{required:_},details:{required:_},comment:{required:_}})),e=ma(q,l),{data:$,isSuccess:Me,isLoading:Se}=([t,c]=V(()=>M({queryKey:["objectsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>na(),enabled:i})),t=await t,c(),t),B=m(()=>l.value.buildingObjectId),Be=m(()=>!!B.value.length);$e(B,()=>{S.value||(l.value.buildingBlockId=[])},{immediate:!0});const{data:Le,isSuccess:Te,isLoading:Ce}=([t,c]=V(()=>M({queryKey:["blocksList",{blockId:B,organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ca(B.value),enabled:Be})),t=await t,c(),t),K=m(()=>l.value.buildingBlockId),we=m(()=>!!K.value.length),{data:U,isSuccess:fe,isLoading:Ee}=([t,c]=V(()=>M({queryKey:["floorsList",{floorId:K,organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ua(K.value),enabled:we})),t=await t,c(),t),{data:D,isSuccess:Oe,isLoading:Pe}=([t,c]=V(()=>M({queryKey:["costsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>ia(),enabled:i})),t=await t,c(),t),{data:H,isSuccess:Ne,isLoading:qe}=([t,c]=V(()=>M({queryKey:["materialsList",{organizationId:n.value.user.organizationId,name:n.value.user.fullName}],queryFn:()=>da(),enabled:i})),t=await t,c(),t),Ke=y([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"},{id:2,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:$,success:Me,loading:Se,select:!0},{id:3,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:Le,success:Te,loading:Ce,select:!0}]),je=y([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:U,success:fe,loading:Ee,select:!0},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:D,success:Oe,loading:Pe,select:!0},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:H,success:Ne,loading:qe,select:!0},{id:4,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"}]),ze=m(()=>z(U.value)),Ue=m(()=>z(D.value)),De=m(()=>z(H.value)),He=a=>{var s;return(s=ze.value[a.floorId])==null?void 0:s.name},xe=a=>{var s;return(s=Ue.value[a.costId])==null?void 0:s.name},Ge=a=>{var s;return(s=De.value[a==null?void 0:a.constructionMaterialId])==null?void 0:s.name},Qe=a=>{l.value.createApplicationTables.push({...a,delId:ga(),floorValue:He(a),costValue:xe(a),constructionMaterialValue:Ge(a)})},Re=a=>{l.value.createApplicationTables=l.value.createApplicationTables.filter(s=>s.delId!==a)},{mutate:Je,status:We}=va({onMutate:a=>{S.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.createApplicationTables=a.createApplicationTables.map(s=>{const{delId:x,floorValue:G,costValue:Q,constructionMaterialValue:R,...L}=s;return L})},mutationFn:a=>ra("application",a),onSuccess:a=>{a!=null&&a.success&&(l.value=sa(l.value),f.invalidateQueries({queryKey:["applications"]}),E.push(_e.APPLICATION.path),setTimeout(()=>O.success(r("createToast")),150))}}),Xe=()=>{if(e.value.$validate(),e.value.$errors.length)return;const a={...l.value};Je(a),e.value.$reset()};return(a,s)=>{var J,W,X,Y,Z,F,ee,ae,oe,te,le,se,re,ne,ce;const x=v("ManageHead"),G=v("FormInput"),Q=v("FormSelect"),R=v("SubTable"),L=v("FormTextarea"),Ye=v("CustomButton");return i.value?(d(),b("section",Aa,[A("div",ka,[I(x,{title:"addNewApplicationTitle",to:u(_e).APPLICATION.path},null,8,["to"]),A("form",{class:"manage__form",onSubmit:oa(Xe,["prevent"])},[A("div",$a,[(d(!0),b(T,null,Ve(Ke.value,o=>{var ue,ie,de,me,pe,ve,ge,he,Ie,be;return d(),b(T,{key:o.id},[o!=null&&o.select?k("",!0):(d(),C(G,{key:0,modelValue:l.value[o.model],"onUpdate:modelValue":j=>l.value[o.model]=j,width:500,placeholder:a.$t(o.placeholder),name:o.icon,error:(ie=(ue=u(e))==null?void 0:ue[o.errorKey])==null?void 0:ie.$error,textError:(pe=(me=(de=u(e))==null?void 0:de[o.errorKey])==null?void 0:me.$errors[0])==null?void 0:pe.$message,type:o==null?void 0:o.type},{default:g(()=>[h(p(a.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])),o!=null&&o.select?(d(),C(Q,{key:1,modelValue:l.value[o.model],"onUpdate:modelValue":j=>l.value[o.model]=j,modelModifiers:{trim:!0},width:500,options:o.options,error:(ge=(ve=u(e))==null?void 0:ve[o==null?void 0:o.errorKey])==null?void 0:ge.$error,placeholder:o==null?void 0:o.placeholder,textError:(be=(Ie=(he=u(e))==null?void 0:he[o==null?void 0:o.errorKey])==null?void 0:Ie.$errors[0])==null?void 0:be.$message,success:o.success,loading:o.loading,isMultiSelect:o==null?void 0:o.multiple},{default:g(()=>[h(p(a.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])):k("",!0)],64)}),128))]),I(ya,{subFields:je.value,buildingBlockId:l.value.buildingBlockId,isSubmit:S.value,onOnAddTable:Qe},null,8,["subFields","buildingBlockId","isSubmit"]),(W=(J=u(e))==null?void 0:J.createApplicationTables)!=null&&W.$error?(d(),b("span",Va,p((Z=(Y=(X=u(e))==null?void 0:X.createApplicationTables)==null?void 0:Y.$errors[0])==null?void 0:Z.$message),1)):k("",!0),I(R,{headers:N.value,table:l.value.createApplicationTables,onOnActionDelete:Re,isShowDelete:!0},null,8,["headers","table"]),A("div",Ma,[I(L,{modelValue:l.value.details,"onUpdate:modelValue":s[0]||(s[0]=o=>l.value.details=o),modelModifiers:{trim:!0},width:500,placeholder:a.$t("appDetailsPlaceholder"),error:(ee=(F=u(e))==null?void 0:F.details)==null?void 0:ee.$error,textError:(te=(oe=(ae=u(e))==null?void 0:ae.details)==null?void 0:oe.$errors[0])==null?void 0:te.$message},{default:g(()=>[h(p(a.$t("appDetailsLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),I(L,{modelValue:l.value.comment,"onUpdate:modelValue":s[1]||(s[1]=o=>l.value.comment=o),modelModifiers:{trim:!0},width:500,placeholder:a.$t("appCommentPlaceholder"),error:(se=(le=u(e))==null?void 0:le.comment)==null?void 0:se.$error,textError:(ce=(ne=(re=u(e))==null?void 0:re.comment)==null?void 0:ne.$errors[0])==null?void 0:ce.$message},{default:g(()=>[h(p(a.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"])]),I(Ye,{className:"manage__submit",disabled:u(We)==="pending"},{default:g(()=>[h(p(a.$t("appButton")),1)]),_:1},8,["disabled"])],32)])])):k("",!0)}}},Pa=ye(Sa,[["__scopeId","data-v-0b77d30c"]]);export{Pa as default};
