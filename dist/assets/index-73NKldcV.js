import{x as $,y as M,b as G,c as J,r as B,z as X,d as P,e as Y,k as q,h as e,A as L,i as n,t as Z,m as i,o as u,s as U,H as r}from"./index-06fm3sAF.js";import{a as ee,u as te}from"./generic.services-BV5gm5JW.js";import{u as se}from"./useQuery-OQl0_BrA.js";import{g as ae,d as oe}from"./crud.services-ZKnEyOcy.js";import{r as ne}from"./index-VL_8naPu.js";const ie={key:0,class:"estimate"},ue={class:"estimate__inner"},re={key:2,class:"empty-table shadowed"},Se={__name:"index",async setup(ce){let a,p;const _=ee(),H=$(),{page:c,limit:l,search:N}=M(H),Q=G(),{user:s}=M(Q),S=J(()=>{var t,m;return!!((m=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&m.includes(r.ESTIMATE.READ))}),b=B(""),h=ne(N,500),R=B([{id:1,label:"estimateName",width:25},{id:2,label:"estimateObject",width:25},{id:3,label:"estimateAddress",width:20},{id:4,label:"estimatePrice",width:20}]),{data:o,isLoading:x,isSuccess:d,isError:z}=([a,p]=X(()=>se({queryKey:["budgets",{page:c,limit:l,debouncedSearch:h,organizationId:s.value.user.organizationId,roleId:s.value.user.roleId}],queryFn:()=>ae("budget",c.value,l.value,h.value),enabled:S})),a=await a,p(),a),{mutate:K}=te({mutationFn:t=>oe("budget",t),onSuccess:t=>{_.invalidateQueries({queryKey:["budgets"]}),_.invalidateQueries({queryKey:["budgetById",b]})}}),V=async t=>{b.value=t,K(t)};return(t,m)=>{var E,T,g,y,A,v,w,I,f,D,C,k;const F=i("HeadPage"),O=i("Table"),j=i("Pagination"),W=i("Spinner");return S.value?(u(),P("section",ie,[Y("div",ue,[q(F,{title:"estimateTitle",to:e(U).CREATE_ESTIMATE.path,isShowCreate:(g=(T=(E=e(s))==null?void 0:E.user)==null?void 0:T.modules)==null?void 0:g.includes(e(r).ESTIMATE.CREATE)},null,8,["to","isShowCreate"]),e(d)&&((y=e(o))!=null&&y.count)?(u(),L(O,{key:0,headers:R.value,table:(A=e(o))==null?void 0:A.budgets,to:e(U).UPDATE_ESTIMATE.name,options:{page:e(c),limit:e(l)},isShowUpdate:(I=(w=(v=e(s))==null?void 0:v.user)==null?void 0:w.modules)==null?void 0:I.includes(e(r).ESTIMATE.UPDATE),isShowDelete:(C=(D=(f=e(s))==null?void 0:f.user)==null?void 0:D.modules)==null?void 0:C.includes(e(r).ESTIMATE.DELETE),onOnActionDelete:V},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q(j,{count:(k=e(o))==null?void 0:k.count,isSucces:e(d)},null,8,["count","isSucces"]),e(x)?(u(),L(W,{key:1})):n("",!0),e(d)&&!e(o).count||e(z)?(u(),P("div",re,Z(t.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{Se as default};
