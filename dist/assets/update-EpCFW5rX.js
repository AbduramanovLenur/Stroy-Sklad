import{u as ee,a as ae,r as p,y as I,c as se,x as re,b as S,d as O,f as w,B as y,w as te,F as B,e as V,k as m,g as oe,C as ie,h,o as g,i as b,t as _,z as F,A as C}from"./index-8-F5s4j3.js";import{u as de,r as i}from"./i18n-validators-72j1n4q8.js";import{a as ne,u as le}from"./generic.services-CQjHStj7.js";import{u as v}from"./useQuery-KERFi8ks.js";import{a as ce,u as ue}from"./crud.services-Xs683v05.js";import{m as me,a as ge,b as pe}from"./manual.services-4pjALTqx.js";const Ie={class:"manage section-height shadowed"},ye={class:"manage__inner section-padding"},Ke={__name:"update",async setup(he){let s,t;const f=ne(),K=oe(),z=ie();ee(),ae();const $=p(z.params.id),{data:E,isSuccess:k,isLoading:N}=([s,t]=I(()=>v({queryKey:["regions"],queryFn:()=>me()})),s=await s,t(),s),{data:T,isSuccess:x,isLoading:M}=([s,t]=I(()=>v({queryKey:["districts"],queryFn:()=>ge()})),s=await s,t(),s),{data:Q,isSuccess:R,isLoading:D}=([s,t]=I(()=>v({queryKey:["states"],queryFn:()=>pe()})),s=await s,t(),s),r=p({id:"",name:"",address:"",organizationId:"",regionId:[],districtId:[],stateId:[]}),P=se(()=>({id:{required:i},name:{required:i},address:{required:i},organizationId:{required:i},regionId:{required:i},districtId:{required:i},stateId:{required:i}})),o=de(P,r),U=p([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"}]),G=p([{id:1,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",options:E,errorKey:"regionId",success:k,loading:N},{id:2,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",options:T,errorKey:"districtId",success:x,loading:M},{id:3,model:"stateId",label:"stateObjectLabel",placeholder:"stateObjectLabel",options:Q,success:R,loading:D}]),{isError:A}=([s,t]=I(()=>v({queryKey:["objectById",$],queryFn:()=>ce("building_object",$.value),select:a=>{r.value.id=a.id,r.value.name=a.fullName,r.value.organizationId=a.organizationId,r.value.address=a.address,r.value.regionId=[a.regionId],r.value.districtId=[a.districtId],r.value.stateId=[a.stateId]}})),s=await s,t(),s);re(A,a=>{a&&K.push(C.HOME.path)});const{mutate:H}=le({onMutate:a=>{a.regionId=a.regionId[0],a.districtId=a.districtId[0],a.stateId=a.stateId[0]},mutationFn:a=>ue("building_object",a),onSuccess:()=>{f.invalidateQueries({queryKey:["objects"]}),f.invalidateQueries({queryKey:["objectById",$]}),f.invalidateQueries({queryKey:["objectsList"]}),K.push(C.OBJECTS.path)}}),J=async()=>{const a=localStorage.getItem("organizationId");r.value.organizationId=a,o.value.$validate(),!o.value.$errors.length&&(H(r.value),o.value.$reset())};return(a,be)=>{var L,q;const W=h("Title"),X=h("FormInput"),Y=h("FormSelect"),Z=h("CustomButton");return g(),S("section",Ie,[O("div",ye,[w(W,null,{default:y(()=>[b(`\r
                `+_(a.$t("editObjectTitle"))+`\r
            `,1)]),_:1}),O("form",{class:"manage__form form-manage",onSubmit:te(J,["prevent"])},[(g(!0),S(B,null,V(U.value,e=>{var d,n,l,c,u;return g(),F(X,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":j=>r.value[e.model]=j,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(n=(d=m(o))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:n.$error,textError:(u=(c=(l=m(o))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:c.$errors[0])==null?void 0:u.$message},{default:y(()=>[b(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(g(!0),S(B,null,V(G.value,e=>{var d,n,l,c,u;return g(),F(Y,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":j=>r.value[e.model]=j,width:500,options:e.options,error:(n=(d=m(o))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(u=(c=(l=m(o))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:c.$errors[0])==null?void 0:u.$message,success:e.success,loading:e.loading},{default:y(()=>[b(_(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),w(Z,{className:`form__submit ${(q=(L=m(o))==null?void 0:L.stateId.$errors[0])!=null&&q.$message?"centered":""}`},{default:y(()=>[b(_(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Ke as default};
//# sourceMappingURL=update-EpCFW5rX.js.map
