import{_ as le,r as k,b as ne,y as ce,c,z as u,B as ue,d as b,e as m,k as re,h as ie,t as g,i as v,w as de,F as j,C as me,l as pe,G as be,m as L,o as r,s as C,A as q,D as V,f as z,H as ge}from"./index--ASsptNz.js";import{a as ve}from"./crud.services-J6Vd6xLE.js";import{l as he,f as Ie,g as _e,h as ye,i as ke}from"./manual.services-N1AdmalV.js";import{u as i}from"./useQuery-aJZefqwx.js";import"./generic.services-OmFX1-7T.js";const Le={key:0,class:"manage section-height shadowed"},Se={class:"manage__inner section-padding"},we={class:"manage__stock-warehouse"},Be={class:"manage__stock-label"},Fe={key:0,class:"manage__stock-value"},xe={class:"manage__overlay"},Me={__name:"view",async setup(Ee){let s,l;const O=pe(),P=be(),S=k(P.params.id),G=ne(),{user:o}=ce(G),d=c(()=>{var a,n;return!!((n=(a=o==null?void 0:o.value.user)==null?void 0:a.modules)!=null&&n.includes(ge.EXPENS.CREATE))}),t=k({constructionMaterialId:[],count:"",buildingObjectId:[],buildingBlockId:[],floorId:[],costId:[]}),{data:w,isSuccess:K,isLoading:H}=([s,l]=u(()=>i({queryKey:["warehouseList",{organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>he(),enabled:d})),s=await s,l(),s),h=c(()=>{var a;return(a=w.value)==null?void 0:a.filter(n=>{var p;return n.id===((p=t.value.constructionMaterialId)==null?void 0:p[0])})}),{data:U,isSuccess:$,isLoading:f}=([s,l]=u(()=>i({queryKey:["objectsList",{organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>Ie(),enabled:d})),s=await s,l(),s),I=c(()=>t.value.buildingObjectId[0]),D=c(()=>!!I.value),{data:R,isSuccess:T,isLoading:A}=([s,l]=u(()=>i({queryKey:["blocksList",{blockId:I,organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>_e(I.value),enabled:D})),s=await s,l(),s),_=c(()=>t.value.buildingBlockId[0]),X=c(()=>!!_.value),{data:W,isSuccess:Q,isLoading:J}=([s,l]=u(()=>i({queryKey:["floorsList",{floorId:_,organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>ye(_.value),enabled:X})),s=await s,l(),s),{data:Y,isSuccess:Z,isLoading:ee}=([s,l]=u(()=>i({queryKey:["costsList",{organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>ke(),enabled:d})),s=await s,l(),s),se=k([{id:1,model:"constructionMaterialId",label:"expenseMaterialLabel",placeholder:"expenseMaterialPlaceholder",options:w,success:K,loading:H,select:!0},{id:2,model:"count",label:"expenseCountLabel",placeholder:"expenseCountPlaceholder",icon:"list",type:"number"},{id:3,model:"buildingObjectId",label:"expenseObjectLabel",placeholder:"expenseObjectPlaceholder",options:U,success:$,loading:f,select:!0},{id:4,model:"buildingBlockId",label:"expenseBlockLabel",placeholder:"expenseBlockPlaceholder",options:R,success:T,loading:A,select:!0},{id:5,model:"floorId",label:"expenseFloorLabel",placeholder:"expenseFloorPlaceholder",options:W,success:Q,loading:J,select:!0},{id:6,model:"costId",label:"expenseCostLabel",placeholder:"expenseCostPlaceholder",options:Y,success:Z,loading:ee,select:!0}]),{isError:ae}=([s,l]=u(()=>i({queryKey:["expensById",S,o.value.user.fullName],queryFn:()=>ve("expense",S.value),select:a=>{t.value.constructionMaterialId=[a.constructionMaterialId],t.value.count=a.count,t.value.buildingObjectId=[a.buildingObjectId],t.value.buildingBlockId=[a.buildingBlockId],t.value.floorId=[a.floorId],t.value.costId=[a.costId]},enabled:d})),s=await s,l(),s);return ue(ae,a=>{a&&O.push(C.EXPENS.path)}),(a,n)=>{var B,F,x,M,E,N;const p=L("ManageHead"),oe=L("FormInput"),te=L("FormSelect");return d.value?(r(),b("section",Le,[m("div",Se,[re(p,{title:"addNewExpensesTitle",to:ie(C).EXPENS.path},null,8,["to"]),m("div",we,[m("div",Be,g((F=(B=h.value)==null?void 0:B[0])!=null&&F.count?a.$t("expenseStockMaterial"):a.$t("expenseSampleMaterial")),1),(M=(x=h.value)==null?void 0:x[0])!=null&&M.count?(r(),b("div",Fe,g((N=(E=h.value)==null?void 0:E[0])==null?void 0:N.count),1)):v("",!0)]),m("form",{class:"manage__form",onSubmit:n[0]||(n[0]=de((...e)=>a.submitHandler&&a.submitHandler(...e),["prevent"]))},[m("div",xe,[(r(!0),b(j,null,me(se.value,e=>(r(),b(j,{key:e.id},[e!=null&&e.select?v("",!0):(r(),q(oe,{key:0,modelValue:t.value[e.model],"onUpdate:modelValue":y=>t.value[e.model]=y,width:500,placeholder:a.$t(e.placeholder),name:e.icon,type:e==null?void 0:e.type,isDisabled:!0},{default:V(()=>[z(g(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"])),e!=null&&e.select?(r(),q(te,{key:1,modelValue:t.value[e.model],"onUpdate:modelValue":y=>t.value[e.model]=y,modelModifiers:{trim:!0},width:500,options:e.options,placeholder:e==null?void 0:e.placeholder,success:e.success,loading:e.loading,isDisabled:!0},{default:V(()=>[z(g(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading"])):v("",!0)],64))),128))])],32)])])):v("",!0)}}},ze=le(Me,[["__scopeId","data-v-11996675"]]);export{ze as default};
