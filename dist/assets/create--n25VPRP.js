import{_ as xe,u as Ke,a as Fe,b as qe,y as Ce,c,r as x,z as v,B as Ee,d as S,e as b,k as J,h as d,t as m,i as B,w as $e,F as Y,C as Ne,D as K,l as je,m as L,o as p,s as Z,A as ee,f as F,H as Ve,E as Oe}from"./index--ASsptNz.js";import{c as ze}from"./crud.services-J6Vd6xLE.js";import{u as Pe,r as g}from"./i18n-validators-hHlX57Cz.js";import{l as Te,f as Qe,g as fe,h as Ge,i as Ue}from"./manual.services-N1AdmalV.js";import{u as He}from"./generic.services-OmFX1-7T.js";import{u as I}from"./useQuery-aJZefqwx.js";import{u as Ae}from"./useMutation-KDcbY73c.js";const De={key:0,class:"manage section-height shadowed"},Re={class:"manage__inner section-padding"},Xe={class:"manage__stock-warehouse"},We={class:"manage__stock-label"},Je={key:0,class:"manage__stock-value"},Ye={class:"manage__overlay"},Ze={__name:"create",async setup(ea){let s,r;const h=He(),ae=je(),q=Ke(),{t:C}=Fe(),se=qe(),{user:o}=Ce(se),_=c(()=>{var a,n;return!!((n=(a=o==null?void 0:o.value.user)==null?void 0:a.modules)!=null&&n.includes(Ve.EXPENS.CREATE))}),oe=x(!1),t=x({constructionMaterialId:[],count:"",buildingObjectId:[],buildingBlockId:[],floorId:[],costId:[]}),te=c(()=>({constructionMaterialId:{required:g},count:{required:g},buildingObjectId:{required:g},buildingBlockId:{required:g},floorId:{required:g},costId:{required:g}})),u=Pe(te,t),{data:E,isSuccess:re,isLoading:ne}=([s,r]=v(()=>I({queryKey:["warehouseList",{organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>Te(),enabled:_})),s=await s,r(),s),i=c(()=>{var a;return(a=E.value)==null?void 0:a.filter(n=>{var l;return n.id===((l=t.value.constructionMaterialId)==null?void 0:l[0])})}),{data:le,isSuccess:ue,isLoading:ce}=([s,r]=v(()=>I({queryKey:["objectsList",{organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>Qe(),enabled:_})),s=await s,r(),s),y=c(()=>t.value.buildingObjectId[0]),ie=c(()=>!!y.value);Ee(y,()=>{oe.value||(t.value.buildingBlockId=[])},{immediate:!0});const{data:de,isSuccess:me,isLoading:pe}=([s,r]=v(()=>I({queryKey:["blocksList",{blockId:y,organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>fe(y.value),enabled:ie})),s=await s,r(),s),M=c(()=>t.value.buildingBlockId[0]),ge=c(()=>!!M.value),{data:ve,isSuccess:be,isLoading:Ie}=([s,r]=v(()=>I({queryKey:["floorsList",{floorId:M,organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>Ge(M.value),enabled:ge})),s=await s,r(),s),{data:he,isSuccess:_e,isLoading:ye}=([s,r]=v(()=>I({queryKey:["costsList",{organizationId:o.value.user.organizationId,name:o.value.user.fullName}],queryFn:()=>Ue(),enabled:_})),s=await s,r(),s),ke=x([{id:1,model:"constructionMaterialId",label:"expenseMaterialLabel",placeholder:"expenseMaterialPlaceholder",errorKey:"constructionMaterialId",options:E,success:re,loading:ne,select:!0},{id:2,model:"count",label:"expenseCountLabel",placeholder:"expenseCountPlaceholder",icon:"list",errorKey:"count",type:"number"},{id:3,model:"buildingObjectId",label:"expenseObjectLabel",placeholder:"expenseObjectPlaceholder",errorKey:"buildingObjectId",options:le,success:ue,loading:ce,select:!0},{id:4,model:"buildingBlockId",label:"expenseBlockLabel",placeholder:"expenseBlockPlaceholder",errorKey:"buildingBlockId",options:de,success:me,loading:pe,select:!0},{id:5,model:"floorId",label:"expenseFloorLabel",placeholder:"expenseFloorPlaceholder",errorKey:"floorId",options:ve,success:be,loading:Ie,select:!0},{id:6,model:"costId",label:"expenseCostLabel",placeholder:"expenseCostPlaceholder",errorKey:"costId",options:he,success:_e,loading:ye,select:!0}]),{mutate:Se,status:Be}=Ae({onMutate:a=>{a.constructionMaterialId=a.constructionMaterialId[0],a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.floorId=a.floorId[0],a.costId=a.costId[0]},mutationFn:a=>ze("expense",a),onSuccess:a=>{var n,l;a!=null&&a.success&&(h.invalidateQueries({queryKey:["expenses"]}),h.invalidateQueries({queryKey:["warehouse"]}),h.invalidateQueries({queryKey:["warehouseById",(l=(n=i.value)==null?void 0:n[0])==null?void 0:l.warehouseId.toString()]}),h.invalidateQueries({queryKey:["warehouseList"]}),t.value=Oe(t.value),ae.push(Z.EXPENS.path),setTimeout(()=>q.success(C("createToast")),150))}}),Le=()=>{var l,k;if(((k=(l=i.value)==null?void 0:l[0])==null?void 0:k.count)-t.value.count<0){q.error(C("negativeMeaningToast"));return}if(u.value.$validate(),u.value.$errors.length)return;const n={...t.value};Se(n),u.value.$reset()};return(a,n)=>{var $,N,j,V,O,z,P,T;const l=L("ManageHead"),k=L("FormInput"),Me=L("FormSelect"),we=L("CustomButton");return _.value?(p(),S("section",De,[b("div",Re,[J(l,{title:"addNewExpensesTitle",to:d(Z).EXPENS.path},null,8,["to"]),b("div",Xe,[b("div",We,m((N=($=i.value)==null?void 0:$[0])!=null&&N.count?a.$t("expenseStockMaterial"):a.$t("expenseSampleMaterial")),1),(V=(j=i.value)==null?void 0:j[0])!=null&&V.count?(p(),S("div",Je,m((z=(O=i.value)==null?void 0:O[0])==null?void 0:z.count)+" "+m((T=(P=i.value)==null?void 0:P[0])==null?void 0:T.quantityType),1)):B("",!0)]),b("form",{class:"manage__form",onSubmit:$e(Le,["prevent"])},[b("div",Ye,[(p(!0),S(Y,null,Ne(ke.value,e=>{var Q,f,G,U,H,A,D,R,X,W;return p(),S(Y,{key:e.id},[e!=null&&e.select?B("",!0):(p(),ee(k,{key:0,modelValue:t.value[e.model],"onUpdate:modelValue":w=>t.value[e.model]=w,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(f=(Q=d(u))==null?void 0:Q[e.errorKey])==null?void 0:f.$error,textError:(H=(U=(G=d(u))==null?void 0:G[e.errorKey])==null?void 0:U.$errors[0])==null?void 0:H.$message,type:e==null?void 0:e.type},{default:K(()=>[F(m(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])),e!=null&&e.select?(p(),ee(Me,{key:1,modelValue:t.value[e.model],"onUpdate:modelValue":w=>t.value[e.model]=w,modelModifiers:{trim:!0},width:500,options:e.options,error:(D=(A=d(u))==null?void 0:A[e==null?void 0:e.errorKey])==null?void 0:D.$error,placeholder:e==null?void 0:e.placeholder,textError:(W=(X=(R=d(u))==null?void 0:R[e==null?void 0:e.errorKey])==null?void 0:X.$errors[0])==null?void 0:W.$message,success:e.success,loading:e.loading},{default:K(()=>[F(m(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):B("",!0)],64)}),128))]),J(we,{className:"manage__submit",disabled:d(Be)==="pending"},{default:K(()=>[F(m(a.$t("formButton")),1)]),_:1},8,["disabled"])],32)])])):B("",!0)}}},ua=xe(Ze,[["__scopeId","data-v-a95f4fa2"]]);export{ua as default};
