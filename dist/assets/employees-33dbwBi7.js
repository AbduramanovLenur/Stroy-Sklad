import{_ as Ne,m as we,s as Fe,r as u,c as E,n as w,q as m,o as d,d as I,e as U,k as O,i as r,x as S,j as M,t as q,y as K,F as A,f as D,g as V,w as Ie}from"./index-2liaKmgz.js";import{u as Se,c as W}from"./secondary-functions-iCQIgTok.js";import{r as t,m as qe}from"./i18n-validators-fwdRIkV7.js";import{u as Ke,a as B,b as F}from"./generic.services-rEPg925p.js";import{a as Le,b as $e,c as ze,h as Ee,i as Oe,e as Me,f as Ve,g as Be}from"./manual.services-e0q0vNq6.js";const Pe={class:"employees"},Ce={class:"employees__inner section-padding"},Te={key:2,class:"empty-table"},ke={__name:"employees",async setup(Qe){let s,n;const y=Ke(),P=we(),{toggleIsOpenModalForm:C}=P,{isOpenModalForm:L}=Fe(P),T=u("addNewEmployeesTitle"),c=u(""),h=u(""),a=u({id:"",fullName:"",userName:"",password:"",phoneNumber:"",organizationId:"",roleId:"",stateId:"",search:""}),k=E(()=>L),Q=E(()=>L&&c.value=="edit"),{data:j,isSuccess:J,isLoading:X}=([s,n]=w(()=>F({queryKey:["organizations"],queryFn:()=>Ee(),enabled:k})),s=await s,n(),s),{data:Y,isSuccess:Z,isLoading:ee}=([s,n]=w(()=>F({queryKey:["roles"],queryFn:()=>Oe(),enabled:k})),s=await s,n(),s),{data:oe,isSuccess:ae,isLoading:se}=([s,n]=w(()=>F({queryKey:["states"],queryFn:()=>Me(),enabled:Q})),s=await s,n(),s),le=E(()=>{switch(c.value){case"edit":return{fullName:{required:t},userName:{required:t},phoneNumber:{required:t},organizationId:{required:t},roleId:{required:t}};default:return{fullName:{required:t},userName:{required:t},password:{required:t,minLength:qe},phoneNumber:{required:t},organizationId:{required:t},roleId:{required:t}}}}),re=u([{id:1,label:"employeesFullName",width:300},{id:2,label:"employeesOrganization",width:320},{id:3,label:"employeesPhone",width:255},{id:4,label:"employeesRole",width:195},{id:5,label:"employeesState",width:250},{id:8,label:"employeesAction",width:190}]),te=u([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber"}]),ne=u([{id:1,model:"organizationId",label:"employeesOrganizationLabel",options:j,errorKey:"organizationId",success:J,loading:X,show:["create","edit"]},{id:2,model:"roleId",label:"employeesRoleLabel",options:Y,errorKey:"roleId",success:Z,loading:ee,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:oe,success:ae,loading:se,show:["edit"]}]),i=Se(le,a),{data:$,isLoading:ie,isSuccess:R,isError:de}=([s,n]=w(()=>F({queryKey:["employees"],queryFn:()=>Ve("user"),select:e=>e.map(l=>{const g={...l,phone:l.phoneNumber,company:l.organizationName};return delete g.phoneNumber,delete g.organizationName,g})})),s=await s,n(),s);[s,n]=w(()=>F({queryKey:["employeesById",h],queryFn:()=>Be("user",h.value),select:e=>{a.value.id=e.id,a.value.fullName=e.fullname,a.value.userName=e.userName,a.value.phoneNumber=e.phoneNumber,a.value.organizationId=e.organizationId,a.value.roleId=e.roleId,a.value.stateId=e.stateId},enabled:Q})),s=await s,n();const{mutate:ue}=B({mutationFn:e=>Le("user",e),onSuccess:()=>{y.invalidateQueries({queryKey:["employees"]})}}),{mutate:me}=B({mutationFn:e=>$e("user",e),onSuccess:()=>{y.invalidateQueries({queryKey:["employees"]}),y.invalidateQueries({queryKey:["employeesById",h]})}}),{mutate:ce}=B({mutationFn:e=>ze("user",e),onSuccess:()=>{y.invalidateQueries({queryKey:["employees"]}),y.invalidateQueries({queryKey:["employeesById",h]})}}),x=(e,l)=>{T.value=e,c.value=l,C(),c.value==="create"&&L.value&&(a.value=W(a.value),i.value.$reset())},G=(e,l)=>{if(e==="edit"&&l){h.value=l,x("editEmployeesTitle","edit");return}x("addNewEmployeesTitle","create")},pe=e=>{ce(e)},ye=()=>{i.value.$validate(),!i.value.$errors.length&&(c.value==="create"?(delete a.value.id,delete a.value.stateId,ue(a.value)):me(a.value),C(),a.value=W(a.value),i.value.$reset())};return(e,l)=>{const g=m("HeadPage"),he=m("Table"),ge=m("Spinner"),ve=m("FormInput"),be=m("FormSelect"),_e=m("CustomButton"),fe=m("FormModal");return d(),I("section",Pe,[U("div",Ce,[O(g,{title:"employeesTitle",onOnSearch:l[0]||(l[0]=p=>a.value.search=p),onOnOpenFormModal:l[1]||(l[1]=()=>G("create"))}),r(R)&&r($).length?(d(),S(he,{key:0,headers:re.value,table:r($),onOnActionEdit:l[2]||(l[2]=p=>G("edit",p)),onOnActionDelete:pe},null,8,["headers","table"])):M("",!0),r(ie)?(d(),S(ge,{key:1})):M("",!0),r(R)&&!r($).length||r(de)?(d(),I("div",Te,q(e.$t("emptyTableTitle")),1)):M("",!0)]),O(fe,{title:T.value},{default:K(()=>{var p,H;return[U("form",{class:"employees__form",onSubmit:Ie(ye,["prevent"])},[(d(!0),I(A,null,D(te.value,o=>{var v,b,_,f,N;return d(),S(ve,{key:o.id,modelValue:a.value[o.model],"onUpdate:modelValue":z=>a.value[o.model]=z,width:500,placeholder:e.$t(o.placeholder),name:o.icon,error:(b=(v=r(i))==null?void 0:v[o==null?void 0:o.errorKey])==null?void 0:b.$error,textError:(N=(f=(_=r(i))==null?void 0:_[o==null?void 0:o.errorKey])==null?void 0:f.$errors[0])==null?void 0:N.$message},{default:K(()=>[V(q(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(d(!0),I(A,null,D(ne.value,o=>{var v,b,_,f,N;return d(),S(be,{key:o.id,modelValue:a.value[o.model],"onUpdate:modelValue":z=>a.value[o.model]=z,width:500,options:o.options,error:(b=(v=r(i))==null?void 0:v[o==null?void 0:o.errorKey])==null?void 0:b.$error,textError:(N=(f=(_=r(i))==null?void 0:_[o==null?void 0:o.errorKey])==null?void 0:f.$errors[0])==null?void 0:N.$message,success:o.success,loading:o.loading,show:o.show,requestFlag:c.value},{default:K(()=>[V(q(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),O(_e,{className:`form__submit ${(H=(p=r(i))==null?void 0:p.roleId.$errors[0])!=null&&H.$message?"centered":""}`},{default:K(()=>[V(q(e.$t("formButton")),1)]),_:1},8,["className"])],32)]}),_:1},8,["title"])])}}},Ae=Ne(ke,[["__scopeId","data-v-718bd28f"]]);export{Ae as default};
