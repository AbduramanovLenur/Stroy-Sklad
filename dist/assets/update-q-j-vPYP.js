import{u as le,a as ne,r as I,b as ie,y as de,c as W,z as q,B as ce,d as T,e as B,k as F,h as u,w as me,F as C,C as U,D as w,i as ye,l as pe,G as he,m as g,o as y,s as $,A as k,f as E,t as b,H as Ie,E as qe}from"./index-I0O1PMyv.js";import{u as ge,r as p}from"./i18n-validators-TDhqfgQ8.js";import{a as _e,u as ve}from"./generic.services-tAYQOCEA.js";import{u as _}from"./useQuery-lcb-4ShK.js";import{a as fe,u as Se}from"./crud.services-EfxTTgbv.js";import{h as Te,k as we,b as $e}from"./manual.services-CEFxwEmr.js";const Ee={key:0,class:"manage section-height shadowed"},be={class:"manage__inner section-padding"},Ce={__name:"update",async setup(Ke){let t,o;const K=_e(),V=pe(),H=he(),Q=le(),{t:A}=ne(),v=I(H.params.id),N=ie(),{user:h}=de(N),l=W(()=>{var e,f;return!!((f=(e=h==null?void 0:h.value.user)==null?void 0:e.modules)!=null&&f.includes(Ie.WAREHOUSE.UPDATE))}),s=I({id:"",materialId:[],quantity:"",quantityTypeId:[],stateId:[]}),P=W(()=>({id:{required:p},materialId:{required:p},quantity:{required:p},quantityTypeId:{required:p},stateId:{required:p}})),r=ge(P,s),{data:R,isSuccess:x,isLoading:D}=([t,o]=q(()=>_({queryKey:["types"],queryFn:()=>we(),enabled:l})),t=await t,o(),t),{data:O,isSuccess:z,isLoading:G}=([t,o]=q(()=>_({queryKey:["materialsList",{organizationId:h.value.user.organizationId}],queryFn:()=>Te(),enabled:l})),t=await t,o(),t),{data:j,isSuccess:J,isLoading:X}=([t,o]=q(()=>_({queryKey:["states"],queryFn:()=>$e(),enabled:l})),t=await t,o(),t),Y=I([{id:1,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"}]),Z=I([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:O,success:z,loading:G},{id:2,model:"quantityTypeId",label:"qunatityTypesWarehouseLabel",placeholder:"qunatityTypesWarehousePlaceholder",errorKey:"quantityTypeId",options:R,success:x,loading:D},{id:3,model:"stateId",label:"stateWarehouseLabel",placeholder:"stateWarehousePlaceholder",errorKey:"stateId",options:j,success:J,loading:X}]),{isError:ee}=([t,o]=q(()=>_({queryKey:["warehouseById",v],queryFn:()=>fe("warehouse",v.value),select:e=>{s.value.id=e.id,s.value.materialId=[e.materialId],s.value.quantity=e.quantity,s.value.quantityTypeId=[e.quantityTypeId],s.value.stateId=[e.stateId]},enabled:l})),t=await t,o(),t);ce(ee,e=>{e&&V.push($.HOME.path)});const{mutate:ae}=ve({onMutate:e=>{e.materialId=e.materialId[0],e.quantityTypeId=e.quantityTypeId[0],e.stateId=e.stateId[0]},mutationFn:e=>Se("warehouse",e),onSuccess:e=>{e!=null&&e.success&&(s.value=qe(s.value),K.invalidateQueries({queryKey:["warehouse"]}),K.invalidateQueries({queryKey:["warehouseById",v]}),V.push($.WAREHOUSE.path),setTimeout(()=>Q.success(A("updateToast")),150))}}),te=async()=>{if(r.value.$validate(),r.value.$errors.length)return;const e={...s.value};ae(e),r.value.$reset()};return(e,f)=>{var L,M;const se=g("ManageHead"),oe=g("FormInput"),re=g("FormSelect"),ue=g("CustomButton");return l.value?(y(),T("section",Ee,[B("div",be,[F(se,{title:"editProductTitle",to:u($).WAREHOUSE.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:me(te,["prevent"])},[(y(!0),T(C,null,U(Y.value,a=>{var n,i,d,c,m;return y(),k(oe,{key:a.id,modelValue:s.value[a.model],"onUpdate:modelValue":S=>s.value[a.model]=S,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(i=(n=u(r))==null?void 0:n[a==null?void 0:a.errorKey])==null?void 0:i.$error,textError:(m=(c=(d=u(r))==null?void 0:d[a==null?void 0:a.errorKey])==null?void 0:c.$errors[0])==null?void 0:m.$message},{default:w(()=>[E(b(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(y(!0),T(C,null,U(Z.value,a=>{var n,i,d,c,m;return y(),k(re,{key:a.id,modelValue:s.value[a.model],"onUpdate:modelValue":S=>s.value[a.model]=S,modelModifiers:{trim:!0},width:500,options:a.options,error:(i=(n=u(r))==null?void 0:n[a==null?void 0:a.errorKey])==null?void 0:i.$error,placeholder:a==null?void 0:a.placeholder,textError:(m=(c=(d=u(r))==null?void 0:d[a==null?void 0:a.errorKey])==null?void 0:c.$errors[0])==null?void 0:m.$message,success:a.success,loading:a.loading},{default:w(()=>[E(b(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),F(ue,{className:`form__submit ${(M=(L=u(r))==null?void 0:L.stateId.$errors[0])!=null&&M.$message?"centered":""}`},{default:w(()=>[E(b(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ye("",!0)}}};export{Ce as default};
