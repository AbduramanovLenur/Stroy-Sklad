import{u as de,a as ue,n as ce,r as n,y,c as z,x as F,b as N,d as V,j as B,g as l,w as me,F as E,B as M,C as O,k as ge,D as pe,l as I,o as p,A as S,z as k,e as K,t as $}from"./index-LIAghTzt.js";import{u as he,r as s}from"./i18n-validators-Soiy62qZ.js";import{a as ye,u as Ie}from"./generic.services-g7-190gM.js";import{u as v}from"./useQuery-lbUIVZoa.js";import{a as ve,u as fe}from"./crud.services-v10L7FpB.js";import{m as be,a as _e,b as ze}from"./manual.services-T8eI6v5K.js";const Ne={class:"manage section-height shadowed"},Oe={class:"manage__inner section-padding"},Fe={__name:"update",async setup(Se){let o,t;const L=ye(),w=ge(),x=pe();de(),ue();const R=ce(),{setPagePagination:D,setLimitPagination:A}=R,f=n(x.params.id),P=n(!1),b=n(!1),r=n({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[],stateId:[]}),{data:H,isSuccess:Q,isLoading:T}=([o,t]=y(()=>v({queryKey:["regions"],queryFn:()=>be()})),o=await o,t(),o),h=z(()=>r.value.regionId),U=z(()=>!!h.value.length);F(h,()=>{!b.value&&!P.value&&(r.value.districtId=[]),b.value=!1},{immediate:!0});const{data:G,isSuccess:j,isLoading:W}=([o,t]=y(()=>v({queryKey:["districts",{districtId:h}],queryFn:()=>_e(h.value),enabled:U})),o=await o,t(),o),{data:J,isSuccess:X,isLoading:Y}=([o,t]=y(()=>v({queryKey:["states"],queryFn:()=>ze()})),o=await o,t(),o),Z=z(()=>({id:{required:s},fullName:{required:s},inn:{required:s},address:{required:s},phoneNumber:{required:s},director:{required:s},regionId:{required:s},districtId:{required:s},stateId:{required:s}})),i=he(Z,r),ee=n([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),ae=n([{id:1,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:H,success:Q,loading:T},{id:2,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:G,success:j,loading:W},{id:3,model:"stateId",label:"stateOrganizationLabel",placeholder:"stateOrganizationPlaceholder",errorKey:"stateId",options:J,success:X,loading:Y}]),{isError:re}=([o,t]=y(()=>v({queryKey:["companiesById",f],queryFn:()=>ve("organization",f.value),select:e=>{r.value.id=e.id,r.value.fullName=e.fullName,r.value.inn=e.inn,r.value.address=e.address,r.value.phoneNumber=e.phoneNumber,r.value.director=e.director,r.value.regionId=[e==null?void 0:e.regionId],r.value.districtId=[e==null?void 0:e.districtId],r.value.stateId=[e==null?void 0:e.stateId],b.value=!0}})),o=await o,t(),o);F(re,e=>{e&&w.push(S.HOME.path)});const{mutate:oe}=Ie({onMutate:e=>{P.value=!0,e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>fe("organization",e),onSuccess:async()=>{await L.invalidateQueries({queryKey:["companies"]}),await L.invalidateQueries({queryKey:["companiesById",f]}),D(1),A(10),w.push(S.COMPANIES.path)}}),se=async()=>{i.value.$validate(),!i.value.$errors.length&&(oe(r.value),i.value.$reset())};return(e,Ke)=>{var q,C;const te=I("ManageHead"),ie=I("FormInput"),ne=I("FormSelect"),le=I("CustomButton");return p(),N("section",Ne,[V("div",Oe,[B(te,{title:"editCompanyTitle",to:l(S).COMPANIES.path},null,8,["to"]),V("form",{class:"manage__form form-manage",onSubmit:me(se,["prevent"])},[(p(!0),N(E,null,M(ee.value,a=>{var d,u,c,m,g;return p(),k(ie,{key:a.id,modelValue:r.value[a.model],"onUpdate:modelValue":_=>r.value[a.model]=_,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(u=(d=l(i))==null?void 0:d[a==null?void 0:a.errorKey])==null?void 0:u.$error,textError:(g=(m=(c=l(i))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message},{default:O(()=>[K($(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(p(!0),N(E,null,M(ae.value,a=>{var d,u,c,m,g;return p(),k(ne,{key:a.id,modelValue:r.value[a.model],"onUpdate:modelValue":_=>r.value[a.model]=_,width:500,options:a.options,error:(u=(d=l(i))==null?void 0:d[a==null?void 0:a.errorKey])==null?void 0:u.$error,placeholder:a==null?void 0:a.placeholder,textError:(g=(m=(c=l(i))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message,success:a.success,loading:a.loading},{default:O(()=>[K($(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),B(le,{className:`form__submit ${(C=(q=l(i))==null?void 0:q.stateId.$errors[0])!=null&&C.$message?"centered":""}`},{default:O(()=>[K($(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Fe as default};
//# sourceMappingURL=update-YN-bUDwB.js.map
