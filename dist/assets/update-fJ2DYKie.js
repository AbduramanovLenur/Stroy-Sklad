import{u as pe,a as ge,r as u,c as I,z as d,C as D,d as b,e as R,k as x,h as i,w as he,F as A,D as ye,A as _,l as ve,G as Ie,m,o as c,s as N,B as Q,f as z,t as K,i as T,E as be}from"./index-rC1JZu5l.js";import{a as _e,u as Ne}from"./crud.services-RXnC2s99.js";import{m as ze,a as Ke,b as Oe}from"./manual.services-jkM3FzjG.js";import{u as Se,r as o,m as $e}from"./i18n-validators-8hLDNWni.js";import{u as Le}from"./generic.services-N1nKRFvy.js";import{u as p}from"./useQuery-RAea3pH0.js";import{u as Ce}from"./useMutation-RUuAVq9K.js";const qe={class:"manage section-height shadowed"},Ve={class:"manage__inner section-padding"},xe={__name:"update",async setup(we){let a,s;const g=Le(),O=ve(),G=Ie(),U=pe(),{t:H}=ge(),h=u(G.params.id),S=u(!1),y=u(!1),r=u({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[],stateId:[]}),W=I(()=>({id:{required:o},fullName:{required:o},inn:{required:o,minLength:$e},address:{required:o},phoneNumber:{required:o},director:{required:o},regionId:{required:o},districtId:{required:o},stateId:{required:o}})),n=Se(W,r),{data:j,isSuccess:J,isLoading:X}=([a,s]=d(()=>p({queryKey:["regions"],queryFn:()=>ze()})),a=await a,s(),a),l=I(()=>r.value.regionId[0]),Y=I(()=>!!l.value);D(l,()=>{!y.value&&!S.value&&(r.value.districtId=[]),y.value=!1},{immediate:!0});const{data:Z,isSuccess:f,isLoading:ee}=([a,s]=d(()=>p({queryKey:["districts",{districtId:l}],queryFn:()=>Ke(l.value),enabled:Y})),a=await a,s(),a),{data:te,isSuccess:re,isLoading:ae}=([a,s]=d(()=>p({queryKey:["states"],queryFn:()=>Oe()})),a=await a,s(),a),oe=u([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",type:"number"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"},{id:6,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:j,success:J,loading:X,select:!0},{id:7,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:Z,success:f,loading:ee,select:!0},{id:8,model:"stateId",label:"stateOrganizationLabel",placeholder:"stateOrganizationPlaceholder",errorKey:"stateId",options:te,success:re,loading:ae,select:!0}]),{isError:se}=([a,s]=d(()=>p({queryKey:["companyById",h],queryFn:()=>_e("organization",h.value),select:e=>{r.value.id=e.id,r.value.fullName=e.fullName,r.value.inn=e.inn,r.value.address=e.address,r.value.phoneNumber=e.phoneNumber,r.value.director=e.director,r.value.regionId=[e==null?void 0:e.regionId],r.value.districtId=[e==null?void 0:e.districtId],r.value.stateId=[e==null?void 0:e.stateId],y.value=!0}})),a=await a,s(),a);D(se,e=>{e&&O.push(N.COMPANIES.path)});const{mutate:ne,status:ie}=Ce({onMutate:e=>{S.value=!0,e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>Ne("organization",e),onSuccess:async e=>{e!=null&&e.success&&(r.value=be(r.value),g.invalidateQueries({queryKey:["companies"]}),g.invalidateQueries({queryKey:["companyById",h]}),g.invalidateQueries({queryKey:["organizations"]}),O.push(N.COMPANIES.path),setTimeout(()=>U.success(H("updateToast")),150))}}),ue=async()=>{if(n.value.$validate(),n.value.$errors.length)return;const e={...r.value};ne(e),n.value.$reset()};return(e,Fe)=>{var $,L;const ce=m("ManageHead"),le=m("FormInput"),de=m("FormSelect"),me=m("CustomButton");return c(),b("section",qe,[R("div",Ve,[x(ce,{title:"editCompanyTitle",to:i(N).COMPANIES.path},null,8,["to"]),R("form",{class:"manage__form form-manage",onSubmit:he(ue,["prevent"])},[(c(!0),b(A,null,ye(oe.value,t=>{var C,q,V,w,F,B,E,P,M,k;return c(),b(A,{key:t.id},[t!=null&&t.select?T("",!0):(c(),Q(le,{key:0,modelValue:r.value[t.model],"onUpdate:modelValue":v=>r.value[t.model]=v,width:500,placeholder:e.$t(t.placeholder),name:t.icon,error:(q=(C=i(n))==null?void 0:C[t==null?void 0:t.errorKey])==null?void 0:q.$error,type:t==null?void 0:t.type,textError:(F=(w=(V=i(n))==null?void 0:V[t==null?void 0:t.errorKey])==null?void 0:w.$errors[0])==null?void 0:F.$message},{default:_(()=>[z(K(e.$t(t.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),t!=null&&t.select?(c(),Q(de,{key:1,modelValue:r.value[t.model],"onUpdate:modelValue":v=>r.value[t.model]=v,modelModifiers:{trim:!0},width:500,options:t.options,error:(E=(B=i(n))==null?void 0:B[t==null?void 0:t.errorKey])==null?void 0:E.$error,placeholder:t==null?void 0:t.placeholder,textError:(k=(M=(P=i(n))==null?void 0:P[t==null?void 0:t.errorKey])==null?void 0:M.$errors[0])==null?void 0:k.$message,success:t.success,loading:t.loading},{default:_(()=>[z(K(e.$t(t.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):T("",!0)],64)}),128)),x(me,{className:`form__submit ${(L=($=i(n))==null?void 0:$.stateId.$errors[0])!=null&&L.$message?"centered":""}`,disabled:i(ie)==="pending"},{default:_(()=>[z(K(e.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])}}};export{xe as default};
