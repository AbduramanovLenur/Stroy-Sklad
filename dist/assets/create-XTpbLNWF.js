import{u as j,a as J,b as W,y as X,c as S,r as g,z as Y,d as f,e as V,k as E,h as s,w as Z,F as L,C as K,D as v,i as ee,l as oe,m as h,o as c,s as C,A as F,f as N,t as b,H as re,E as ae}from"./index-4UPdn8r5.js";import{u as se,r as l,m as le}from"./i18n-validators-rYP8hPEZ.js";import{a as te,u as ne}from"./generic.services-suEnlNvN.js";import{u as ue}from"./useQuery-J_Xc9Nln.js";import{c as de}from"./crud.services-eNoFKDSu.js";import{e as me}from"./manual.services-sihQqlgC.js";const ie={key:0,class:"manage section-height shadowed"},ce={class:"manage__inner section-padding"},Ne={__name:"create",async setup(pe){let p,w;const P=te(),U=oe();j(),J();const k=W(),{user:t}=X(k),$=S(()=>{var o,y;return!!((y=(o=t==null?void 0:t.value.user)==null?void 0:o.modules)!=null&&y.includes(re.ORG_USER.CREATE))}),r=g({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:t.value.user.organizationId,roleId:[]}),B=S(()=>({fullName:{required:l},userName:{required:l},password:{required:l,minLength:le},phoneNumber:{required:l},organizationId:{required:l},roleId:{required:l}})),a=se(B,r),{data:M,isSuccess:z,isLoading:q}=([p,w]=Y(()=>ue({queryKey:["rolesList",{organizationId:t.value.user.organizationId}],queryFn:()=>me(),enabled:$})),p=await p,w(),p),x=g([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber"}]),T=g([{id:1,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:M,success:z,loading:q}]),{mutate:G}=ne({onMutate:o=>{o.roleId=o.roleId[0]},mutationFn:o=>de("user",o),onSuccess:o=>{r.value=ae(r.value),P.invalidateQueries({queryKey:["orgUsers"]}),U.push(C.ORG_USER.path)}}),H=()=>{if(a.value.$validate(),a.value.$errors.length)return;const o={...r.value};G(o),a.value.$reset()};return(o,y)=>{var I,R;const A=h("ManageHead"),D=h("FormInput"),O=h("FormSelect"),Q=h("CustomButton");return $.value?(c(),f("section",ie,[V("div",ce,[E(A,{title:"addNewEmployeesTitle",to:s(C).ORG_USER.path},null,8,["to"]),V("form",{class:"manage__form form-manage",onSubmit:Z(H,["prevent"])},[(c(!0),f(L,null,K(x.value,e=>{var n,u,d,m,i;return c(),F(D,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":_=>r.value[e.model]=_,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(u=(n=s(a))==null?void 0:n[e.errorKey])==null?void 0:u.$error,textError:(i=(m=(d=s(a))==null?void 0:d[e.errorKey])==null?void 0:m.$errors[0])==null?void 0:i.$message},{default:v(()=>[N(b(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(c(!0),f(L,null,K(T.value,e=>{var n,u,d,m,i;return c(),F(O,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":_=>r.value[e.model]=_,width:500,options:e.options,error:(u=(n=s(a))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(i=(m=(d=s(a))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:i.$message,success:e.success,loading:e.loading},{default:v(()=>[N(b(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),E(Q,{className:`form__submit ${(R=(I=s(a))==null?void 0:I.roleId.$errors[0])!=null&&R.$message?"centered":""}`},{default:v(()=>[N(b(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ee("",!0)}}};export{Ne as default};
