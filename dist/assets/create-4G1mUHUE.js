import{_ as me,u as be,a as ve,r as g,c as p,B as ge,m as b,o as d,d as I,e as T,t as v,F as w,C as E,A as O,D as h,f as _,k as f,K as Ue,q as De,b as He,y as xe,z as M,h as m,w as Ge,i as ue,l as Qe,s as pe,H as Re,J as G,E as Je}from"./index-duUvqP-c.js";import{u as We,r as B}from"./i18n-validators-vfJMHImW.js";import{a as Xe,u as Ye}from"./generic.services-9zWUdppN.js";import{u as F}from"./useQuery-nCo--xAY.js";import{c as Ze}from"./crud.services-W2EdIOzx.js";import{f as ea,g as aa,h as oa,i as la,j as ta}from"./manual.services-UeOdc-dP.js";import{v as sa}from"./v4-yQnnJER4.js";const ra={class:"application-form"},na={class:"application-form__title"},ia={class:"application-form__overlay form-manage"},da={__name:"ApplicationForm",props:["selects","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(P,{emit:l}){const i=be(),{t:q}=ve(),K=P,j=l,r=g({floorId:[],costId:[],constructionMaterialId:[],count:""}),z=p(()=>K.buildingBlockId);ge(z,()=>{r.value.floorId=[]});const c=g([{id:1,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"}]),L=()=>{if(!Ue(r.value)){i.error(q("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count},j("onAddTable",r.value),r.value=De(r.value)};return(u,Q)=>{const t=b("FormSelect"),N=b("FormInput"),n=b("CustomButton");return d(),I("div",ra,[T("h4",na,v(u.$t("appInfo")),1),T("div",ia,[(d(!0),I(w,null,E(P.selects,o=>(d(),O(t,{key:o.id,modelValue:r.value[o.model],"onUpdate:modelValue":y=>r.value[o.model]=y,modelModifiers:{trim:!0},width:500,options:o.options,placeholder:o==null?void 0:o.placeholder,success:o.success,loading:o.loading,isMultiSelect:o==null?void 0:o.multiple},{default:h(()=>[_(v(u.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128)),(d(!0),I(w,null,E(c.value,o=>(d(),O(N,{key:o.id,modelValue:r.value[o.model],"onUpdate:modelValue":y=>r.value[o.model]=y,width:500,placeholder:u.$t(o.placeholder),name:o.icon,type:o==null?void 0:o.type},{default:h(()=>[_(v(u.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),f(n,{className:"form__submit",type:"button",onClick:L},{default:h(()=>[_(v(u.$t("addButtonForm")),1)]),_:1})])])}}},ca=me(da,[["__scopeId","data-v-a56013f3"]]),ua={key:0,class:"manage section-height shadowed"},pa={class:"manage__inner section-padding"},ma={class:"manage__overlay"},ba={key:0,class:"error"},va={__name:"create",async setup(P){let l,i;const q=Xe(),K=Qe(),j=be(),{t:r}=ve(),z=He(),{user:c}=xe(z),L=p(()=>{var e,s;return!!((s=(e=c==null?void 0:c.value.user)==null?void 0:e.modules)!=null&&s.includes(Re.APPLICATION.CREATE))}),u=g(!1),Q=g([{id:1,label:"appFloor",width:15},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:15},{id:4,label:"appPrice",width:20}]),t=g({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:""}),N=p(()=>({deadline:{required:B},buildingObjectId:{required:B},buildingBlockId:{required:B},createApplicationTables:{required:B},details:{required:B}})),n=We(N,t),{data:o,isSuccess:y,isLoading:Ie}=([l,i]=M(()=>F({queryKey:["objectsList",{organizationId:c.value.user.organizationId}],queryFn:()=>ea(),enabled:L})),l=await l,i(),l),C=p(()=>t.value.buildingObjectId),he=p(()=>!!C.value.length);ge(C,()=>{u.value||(t.value.buildingBlockId=[])},{immediate:!0});const{data:_e,isSuccess:fe,isLoading:ye}=([l,i]=M(()=>F({queryKey:["blocksList",{blockId:C,organizationId:c.value.user.organizationId}],queryFn:()=>aa(C.value),enabled:he})),l=await l,i(),l),U=p(()=>t.value.buildingBlockId),D=p(()=>!!U.value.length),{data:R,isSuccess:Ae,isLoading:ke}=([l,i]=M(()=>F({queryKey:["floorsList",{floorId:U,organizationId:c.value.user.organizationId}],queryFn:()=>oa(U.value),enabled:D})),l=await l,i(),l),{data:J,isSuccess:Ve,isLoading:Se}=([l,i]=M(()=>F({queryKey:["costsList",{organizationId:c.value.user.organizationId}],queryFn:()=>la(),enabled:D})),l=await l,i(),l),{data:W,isSuccess:$e,isLoading:Me}=([l,i]=M(()=>F({queryKey:["materialsList",{organizationId:c.value.user.organizationId}],queryFn:()=>ta(),enabled:D})),l=await l,i(),l),Be=g([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),Fe=g([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:o,success:y,loading:Ie},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:_e,success:fe,loading:ye}]),Te=g([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:R,success:Ae,loading:ke},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:J,success:Ve,loading:Se},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:W,success:$e,loading:Me}]),Le=p(()=>G(R.value)),Ce=p(()=>G(J.value)),we=p(()=>G(W.value)),Ee=e=>{var s;return(s=Le.value[e.floorId])==null?void 0:s.name},Oe=e=>{var s;return(s=Ce.value[e.costId])==null?void 0:s.name},Pe=e=>{var s;return(s=we.value[e==null?void 0:e.constructionMaterialId])==null?void 0:s.name},qe=e=>{t.value.createApplicationTables.push({...e,delId:sa(),floorValue:Ee(e),costValue:Oe(e),constructionMaterialValue:Pe(e)})},Ke=e=>{t.value.createApplicationTables=t.value.createApplicationTables.filter(s=>s.delId!==e)},{mutate:je}=Ye({onMutate:e=>{u.value=!0,e.buildingObjectId=e.buildingObjectId[0],e.buildingBlockId=e.buildingBlockId[0],e.createApplicationTables=e.createApplicationTables.map(s=>{const{delId:X,floorValue:Y,costValue:Z,constructionMaterialValue:ee,...H}=s;return H})},mutationFn:e=>Ze("application",e),onSuccess:e=>{e!=null&&e.success&&(t.value=Je(t.value),q.invalidateQueries({queryKey:["applications"]}),K.push(pe.APPLICATION.path),setTimeout(()=>j.success(r("createToast")),150))}}),ze=()=>{if(n.value.$validate(),n.value.$errors.length)return;const e={...t.value};je(e),n.value.$reset()};return(e,s)=>{var ae,oe,le,te,se,re,ne,ie,de,ce;const X=b("ManageHead"),Y=b("FormInput"),Z=b("FormSelect"),ee=b("SubTable"),H=b("FormTextarea"),Ne=b("CustomButton");return L.value?(d(),I("section",ua,[T("div",pa,[f(X,{title:"addNewApplicationTitle",to:m(pe).APPLICATION.path},null,8,["to"]),T("form",{class:"manage__form",onSubmit:Ge(ze,["prevent"])},[T("div",ma,[(d(!0),I(w,null,E(Be.value,a=>{var A,k,V,S,$;return d(),O(Y,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":x=>t.value[a.model]=x,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(k=(A=m(n))==null?void 0:A[a.errorKey])==null?void 0:k.$error,textError:($=(S=(V=m(n))==null?void 0:V[a.errorKey])==null?void 0:S.$errors[0])==null?void 0:$.$message,type:a==null?void 0:a.type},{default:h(()=>[_(v(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(d(!0),I(w,null,E(Fe.value,a=>{var A,k,V,S,$;return d(),O(Z,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":x=>t.value[a.model]=x,modelModifiers:{trim:!0},width:500,options:a.options,error:(k=(A=m(n))==null?void 0:A[a==null?void 0:a.errorKey])==null?void 0:k.$error,placeholder:a==null?void 0:a.placeholder,textError:($=(S=(V=m(n))==null?void 0:V[a==null?void 0:a.errorKey])==null?void 0:S.$errors[0])==null?void 0:$.$message,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple},{default:h(()=>[_(v(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128))]),f(ca,{selects:Te.value,buildingBlockId:t.value.buildingBlockId,isSubmit:u.value,onOnAddTable:qe},null,8,["selects","buildingBlockId","isSubmit"]),(oe=(ae=m(n))==null?void 0:ae.createApplicationTables)!=null&&oe.$error?(d(),I("span",ba,v((se=(te=(le=m(n))==null?void 0:le.createApplicationTables)==null?void 0:te.$errors[0])==null?void 0:se.$message),1)):ue("",!0),f(ee,{headers:Q.value,table:t.value.createApplicationTables,onOnActionDelete:Ke,isShowDelete:!0},null,8,["headers","table"]),f(H,{modelValue:t.value.details,"onUpdate:modelValue":s[0]||(s[0]=a=>t.value.details=a),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),error:(ne=(re=m(n))==null?void 0:re.details)==null?void 0:ne.$error,textError:(ce=(de=(ie=m(n))==null?void 0:ie.details)==null?void 0:de.$errors[0])==null?void 0:ce.$message},{default:h(()=>[_(v(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),f(Ne,{className:"manage__submit"},{default:h(()=>[_(v(e.$t("appButton")),1)]),_:1})],32)])])):ue("",!0)}}},ka=me(va,[["__scopeId","data-v-07a8a2b6"]]);export{ka as default};
