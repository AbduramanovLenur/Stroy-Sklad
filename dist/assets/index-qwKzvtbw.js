import{g as J,d as X}from"./crud.services-dRS2qKm6.js";import{u as Y,a as Z,x as ee,y as M,b as te,c as se,r as B,z as ae,d as P,e as oe,k as q,h as e,A as L,i as n,t as ne,m as i,o as u,s as N,H as c}from"./index-pfgEwabb.js";import{a as ie,u as ue}from"./generic.services-pFsvETxq.js";import{u as ce}from"./useQuery-MTkSqSbf.js";import{r as re}from"./index-jaF3u23u.js";const le={key:0,class:"estimate"},de={class:"estimate__inner"},me={key:2,class:"empty-table shadowed"},Ee={__name:"index",async setup(_e){let a,_;const T=ie(),U=Y(),{t:H}=Z(),Q=ee(),{page:r,limit:l,search:R}=M(Q),x=te(),{user:s}=M(x),S=se(()=>{var t,m;return!!((m=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&m.includes(c.ESTIMATE.READ))}),b=B(""),h=re(R,500),z=B([{id:1,label:"estimateName",width:25},{id:2,label:"estimateObject",width:25},{id:3,label:"estimateAddress",width:20},{id:4,label:"estimatePrice",width:20}]),{data:o,isLoading:K,isSuccess:d,isError:V}=([a,_]=ae(()=>ce({queryKey:["budgets",{page:r,limit:l,debouncedSearch:h,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>J("budget",r.value,l.value,h.value),enabled:S})),a=await a,_(),a),{mutate:F}=ue({mutationFn:t=>X("budget",t),onSuccess:t=>{t!=null&&t.success&&(T.invalidateQueries({queryKey:["budgets"]}),T.invalidateQueries({queryKey:["budgetById",b]}),setTimeout(()=>U.success(H("deleteToast")),150))}}),O=async t=>{b.value=t,F(t)};return(t,m)=>{var p,E,g,y,A,v,w,f,I,D,C,k;const j=i("HeadPage"),W=i("Table"),$=i("Pagination"),G=i("Spinner");return S.value?(u(),P("section",le,[oe("div",de,[q(j,{title:"estimateTitle",to:e(N).CREATE_ESTIMATE.path,isShowCreate:(g=(E=(p=e(s))==null?void 0:p.user)==null?void 0:E.modules)==null?void 0:g.includes(e(c).ESTIMATE.CREATE)},null,8,["to","isShowCreate"]),e(d)&&((y=e(o))!=null&&y.count)?(u(),L(W,{key:0,headers:z.value,table:(A=e(o))==null?void 0:A.budgets,to:e(N).UPDATE_ESTIMATE.name,options:{page:e(r),limit:e(l)},isShowUpdate:(f=(w=(v=e(s))==null?void 0:v.user)==null?void 0:w.modules)==null?void 0:f.includes(e(c).ESTIMATE.UPDATE),isShowDelete:(C=(D=(I=e(s))==null?void 0:I.user)==null?void 0:D.modules)==null?void 0:C.includes(e(c).ESTIMATE.DELETE),onOnActionDelete:O},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q($,{count:(k=e(o))==null?void 0:k.count,isSucces:e(d)},null,8,["count","isSucces"]),e(K)?(u(),L(G,{key:1})):n("",!0),e(d)&&!e(o).count||e(V)?(u(),P("div",me,ne(t.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{Ee as default};
