import{u as ee,a as oe,r as _,c as ae,z as f,d as N,e as z,k as re,h as s,w as se,F as K,C as E,A as g,i as v,D as b,l as le,m as d,o as n,s as F,f as w,t as L,E as ne}from"./index-xaxvmeln.js";import{u as te,r as u,m as de}from"./i18n-validators-3XDN4B9m.js";import{a as ue,u as ie}from"./generic.services-fBvasRgP.js";import{u as M}from"./useQuery-5RNqZlmw.js";import{c as me}from"./crud.services-MNtnlh6b.js";import{c as ce,d as pe,e as ye}from"./manual.services-fmuMEGVw.js";const ge={class:"manage section-height shadowed"},he={class:"manage__inner section-padding"},Me={__name:"create",async setup(_e){let a,t;const P=ue(),k=le();ee(),oe();const r=_({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:[],roleId:[],roleModules:[]}),q=ae(()=>({fullName:{required:u},userName:{required:u},password:{required:u,minLength:de},phoneNumber:{required:u},organizationId:{required:u},roleId:{required:u}})),l=te(q,r),{data:C,isLoading:B,isSuccess:$}=([a,t]=f(()=>M({queryKey:["modules"],queryFn:()=>ce()})),a=await a,t(),a),{data:O,isSuccess:R,isLoading:x}=([a,t]=f(()=>M({queryKey:["organizations"],queryFn:()=>pe()})),a=await a,t(),a),{data:U,isSuccess:A,isLoading:D}=([a,t]=f(()=>M({queryKey:["adminRoles"],queryFn:()=>ye()})),a=await a,t(),a),G=_([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"}]),H=_([{id:1,model:"organizationId",label:"employeesOrganizationLabel",placeholder:"employeesOrganizationPlaceholder",errorKey:"organizationId",options:O,success:R,loading:x},{id:2,model:"roleId",label:"employeesRoleLabel",placeholder:"employeesRolePlaceholder",errorKey:"roleId",options:U,success:A,loading:D}]),{mutate:Q}=ie({onMutate:o=>{o.organizationId=o.organizationId[0],o.roleId=o.roleId[0]},mutationFn:o=>me("user",o),onSuccess:o=>{r.value=ne(r.value),P.invalidateQueries({queryKey:["employees"]}),k.push(F.EMPLOYEES.path)}}),T=()=>{if(l.value.$validate(),l.value.$errors.length)return;const o={...r.value};Q(o),l.value.$reset()};return(o,I)=>{var S,V;const Y=d("ManageHead"),j=d("FormInput"),J=d("FormSelect"),W=d("ActionsModules"),X=d("CustomButton"),Z=d("Spinner");return n(),N("section",ge,[z("div",he,[re(Y,{title:"addNewEmployeesTitle",to:s(F).EMPLOYEES.path},null,8,["to"]),z("form",{class:"manage__form form-manage",onSubmit:se(T,["prevent"])},[(n(!0),N(K,null,E(G.value,e=>{var i,m,c,p,y;return n(),g(j,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":h=>r.value[e.model]=h,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(m=(i=s(l))==null?void 0:i[e.errorKey])==null?void 0:m.$error,type:e==null?void 0:e.type,textError:(y=(p=(c=s(l))==null?void 0:c[e.errorKey])==null?void 0:p.$errors[0])==null?void 0:y.$message},{default:b(()=>[w(L(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),(n(!0),N(K,null,E(H.value,e=>{var i,m,c,p,y;return n(),g(J,{key:e.id,modelValue:r.value[e.model],"onUpdate:modelValue":h=>r.value[e.model]=h,modelModifiers:{trim:!0},width:500,options:e.options,error:(m=(i=s(l))==null?void 0:i[e==null?void 0:e.errorKey])==null?void 0:m.$error,placeholder:e==null?void 0:e.placeholder,textError:(y=(p=(c=s(l))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:y.$message,success:e.success,loading:e.loading},{default:b(()=>[w(L(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),s($)?(n(),g(W,{key:0,modelValue:r.value.roleModules,"onUpdate:modelValue":I[0]||(I[0]=e=>r.value.roleModules=e),actions:s(C)},null,8,["modelValue","actions"])):v("",!0),s($)?(n(),g(X,{key:1,className:`form__submit ${(V=(S=s(l))==null?void 0:S.roleId.$errors[0])!=null&&V.$message?"centered":""}`},{default:b(()=>[w(L(o.$t("formButton")),1)]),_:1},8,["className"])):v("",!0)],32),s(B)?(n(),g(Z,{key:0})):v("",!0)])])}}};export{Me as default};
