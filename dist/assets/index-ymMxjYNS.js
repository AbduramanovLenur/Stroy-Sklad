import{g as X,d as Y}from"./crud.services-5xsWAErC.js";import{u as Z,a as ee,x as te,y as k,b as ae,c as se,r as B,z as oe,d as O,e as ie,k as q,A as ne,h as e,B as R,i as l,t as V,m as r,o as u,f as ce,s as x,H as p}from"./index-6LvNiRNQ.js";import{u as le}from"./generic.services-Uat72V9U.js";import{u as re}from"./useQuery-LO3_M3QD.js";import{u as ue}from"./useMutation-luul9QM2.js";import{r as pe}from"./index-jSOApseh.js";const de={key:0,class:"applications"},me={class:"applications__inner"},_e={key:2,class:"empty-table shadowed"},we={__name:"index",async setup(he){let i,h;const y=le(),z=Z(),{t:H}=ee(),Q=te(),{page:d,limit:m,search:U}=k(Q),K=ae(),{user:s}=k(K),S=se(()=>{var t,a;return!!((a=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&a.includes(p.APPLICATION.READ))}),A=B(""),I=pe(U,500),F=B([{id:1,label:"applicationUserName",width:12},{id:3,label:"applicationDocDate",width:14.6},{id:4,label:"applicationDedline",width:14.6},{id:5,label:"applicationObject",width:16},{id:6,label:"applicationBlock",width:16}]),{data:n,isLoading:M,isSuccess:_,isError:W}=([i,h]=oe(()=>re({queryKey:["applications",{page:d,limit:m,debouncedSearch:I,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>X("application",d.value,m.value,I.value),select:t=>{let a={...t};return a.applications=a==null?void 0:a.applications.map(c=>{const o={...c,name:c.userName};return delete o.userName,delete o.organizationName,delete o.state,delete o.stateId,o}),a},enabled:S})),i=await i,h(),i),{mutate:$}=ue({mutationFn:t=>Y("application",t),onSuccess:t=>{t.success&&(y.invalidateQueries({queryKey:["applications"]}),y.invalidateQueries({queryKey:["applicationsById",A.value.toString()]}),setTimeout(()=>z.success(H("deleteToast")),150))}}),j=async t=>{A.value=t,$(t)};return(t,a)=>{var T,b,w,f,C,N,P,g,v,E,D,L;const c=r("HeadPage"),o=r("Table"),G=r("Pagination"),J=r("Spinner");return S.value?(u(),O("section",de,[ie("div",me,[q(c,{title:"applicationTitle",to:e(x).CREATE_APPLICATION.path,isShowCreate:(w=(b=(T=e(s))==null?void 0:T.user)==null?void 0:b.modules)==null?void 0:w.includes(e(p).APPLICATION.CREATE)},{default:ne(()=>[ce(V(t.$t("createButton")),1)]),_:1},8,["to","isShowCreate"]),e(_)&&((f=e(n))!=null&&f.count)?(u(),R(o,{key:0,headers:F.value,table:(C=e(n))==null?void 0:C.applications,to:e(x).VIEW_APPLICATION.name,options:{page:e(d),limit:e(m)},isShowUpdate:(g=(P=(N=e(s))==null?void 0:N.user)==null?void 0:P.modules)==null?void 0:g.includes(e(p).APPLICATION.READ),isShowDelete:(D=(E=(v=e(s))==null?void 0:v.user)==null?void 0:E.modules)==null?void 0:D.includes(e(p).APPLICATION.DELETE),isShowEye:!0,className:"table-action",onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):l("",!0),q(G,{count:(L=e(n))==null?void 0:L.count,isSucces:e(_)},null,8,["count","isSucces"]),e(M)?(u(),R(J,{key:1})):l("",!0),e(_)&&!e(n).count||e(W)?(u(),O("div",_e,V(t.$t("emptyTableTitle")),1)):l("",!0)])])):l("",!0)}}};export{we as default};
