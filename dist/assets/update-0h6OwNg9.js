import{u as pe,a as ge,r as u,c as I,z as d,B as D,d as b,e as R,k as x,h as i,w as he,F as A,C as ye,D as _,l as ve,G as Ie,m,o as c,s as N,A as Q,f as z,t as K,i as T,E as be}from"./index-pfgEwabb.js";import{a as _e,u as Ne}from"./crud.services-dRS2qKm6.js";import{m as ze,a as Ke,b as Oe}from"./manual.services-HMyLT33c.js";import{u as Se,r as s}from"./i18n-validators-vl7r2d_M.js";import{a as $e,u as Le}from"./generic.services-pFsvETxq.js";import{u as p}from"./useQuery-MTkSqSbf.js";const Ce={class:"manage section-height shadowed"},qe={class:"manage__inner section-padding"},De={__name:"update",async setup(Ve){let r,o;const g=$e(),O=ve(),G=Ie(),U=pe(),{t:H}=ge(),h=u(G.params.id),S=u(!1),y=u(!1),a=u({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[],stateId:[]}),W=I(()=>({id:{required:s},fullName:{required:s},inn:{required:s},address:{required:s},phoneNumber:{required:s},director:{required:s},regionId:{required:s},districtId:{required:s},stateId:{required:s}})),n=Se(W,a),{data:j,isSuccess:J,isLoading:X}=([r,o]=d(()=>p({queryKey:["regions"],queryFn:()=>ze()})),r=await r,o(),r),l=I(()=>a.value.regionId[0]),Y=I(()=>!!l.value);D(l,()=>{!y.value&&!S.value&&(a.value.districtId=[]),y.value=!1},{immediate:!0});const{data:Z,isSuccess:f,isLoading:ee}=([r,o]=d(()=>p({queryKey:["districts",{districtId:l}],queryFn:()=>Ke(l.value),enabled:Y})),r=await r,o(),r),{data:te,isSuccess:ae,isLoading:re}=([r,o]=d(()=>p({queryKey:["states"],queryFn:()=>Oe()})),r=await r,o(),r),se=u([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn",type:"number"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"},{id:6,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:j,success:J,loading:X,select:!0},{id:7,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:Z,success:f,loading:ee,select:!0},{id:8,model:"stateId",label:"stateOrganizationLabel",placeholder:"stateOrganizationPlaceholder",errorKey:"stateId",options:te,success:ae,loading:re,select:!0}]),{isError:oe}=([r,o]=d(()=>p({queryKey:["companyById",h],queryFn:()=>_e("organization",h.value),select:e=>{a.value.id=e.id,a.value.fullName=e.fullName,a.value.inn=e.inn,a.value.address=e.address,a.value.phoneNumber=e.phoneNumber,a.value.director=e.director,a.value.regionId=[e==null?void 0:e.regionId],a.value.districtId=[e==null?void 0:e.districtId],a.value.stateId=[e==null?void 0:e.stateId],y.value=!0}})),r=await r,o(),r);D(oe,e=>{e&&O.push(N.COMPANIES.path)});const{mutate:ne,status:ie}=Le({onMutate:e=>{S.value=!0,e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>Ne("organization",e),onSuccess:async e=>{e!=null&&e.success&&(a.value=be(a.value),g.invalidateQueries({queryKey:["companies"]}),g.invalidateQueries({queryKey:["companyById",h]}),g.invalidateQueries({queryKey:["organizations"]}),O.push(N.COMPANIES.path),setTimeout(()=>U.success(H("updateToast")),150))}}),ue=async()=>{if(n.value.$validate(),n.value.$errors.length)return;const e={...a.value};ne(e),n.value.$reset()};return(e,we)=>{var $,L;const ce=m("ManageHead"),le=m("FormInput"),de=m("FormSelect"),me=m("CustomButton");return c(),b("section",Ce,[R("div",qe,[x(ce,{title:"editCompanyTitle",to:i(N).COMPANIES.path},null,8,["to"]),R("form",{class:"manage__form form-manage",onSubmit:he(ue,["prevent"])},[(c(!0),b(A,null,ye(se.value,t=>{var C,q,V,w,F,B,E,P,M,k;return c(),b(A,{key:t.id},[t!=null&&t.select?T("",!0):(c(),Q(le,{key:0,modelValue:a.value[t.model],"onUpdate:modelValue":v=>a.value[t.model]=v,width:500,placeholder:e.$t(t.placeholder),name:t.icon,error:(q=(C=i(n))==null?void 0:C[t==null?void 0:t.errorKey])==null?void 0:q.$error,type:t==null?void 0:t.type,textError:(F=(w=(V=i(n))==null?void 0:V[t==null?void 0:t.errorKey])==null?void 0:w.$errors[0])==null?void 0:F.$message},{default:_(()=>[z(K(e.$t(t.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])),t!=null&&t.select?(c(),Q(de,{key:1,modelValue:a.value[t.model],"onUpdate:modelValue":v=>a.value[t.model]=v,modelModifiers:{trim:!0},width:500,options:t.options,error:(E=(B=i(n))==null?void 0:B[t==null?void 0:t.errorKey])==null?void 0:E.$error,placeholder:t==null?void 0:t.placeholder,textError:(k=(M=(P=i(n))==null?void 0:P[t==null?void 0:t.errorKey])==null?void 0:M.$errors[0])==null?void 0:k.$message,success:t.success,loading:t.loading},{default:_(()=>[z(K(e.$t(t.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):T("",!0)],64)}),128)),x(me,{className:`form__submit ${(L=($=i(n))==null?void 0:$.stateId.$errors[0])!=null&&L.$message?"centered":""}`,disabled:i(ie)==="pending"},{default:_(()=>[z(K(e.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])}}};export{De as default};
