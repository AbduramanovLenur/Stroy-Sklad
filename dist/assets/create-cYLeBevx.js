import{u as J,a as W,b as X,y as Y,c as V,r as b,z as Z,d as i,e as S,k as ee,h as a,w as oe,F as k,C as te,A as c,i as u,D as C,l as ae,m as n,o as s,s as w,f as E,t as L,H as se,E as re}from"./index-Znn7x0w2.js";import{u as le,r as B}from"./i18n-validators-IvsyUnkI.js";import{a as ue,u as ne}from"./generic.services-CuHvXiDr.js";import{u as me}from"./useQuery-n34yz_OD.js";import{c as ce}from"./crud.services-oovoAPUX.js";import{c as de}from"./manual.services-CtkFg6uR.js";const ie={key:0,class:"manage section-height shadowed"},pe={class:"manage__inner section-padding"},Me={__name:"create",async setup(_e){let m,p;const _=ue(),K=ae(),T=J(),{t:q}=W(),F=X(),{user:d}=Y(F),h=V(()=>{var e,l;return!!((l=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)!=null&&l.includes(se.ROLE.CREATE))}),t=b({shortName:"",fullName:"",roleModules:[]}),A=V(()=>({shortName:{required:B},fullName:{required:B}})),r=le(A,t),{data:x,isLoading:H,isSuccess:y}=([m,p]=Z(()=>me({queryKey:["modules"],queryFn:()=>de(),enabled:h})),m=await m,p(),m),Q=b([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"}]),{mutate:U}=ne({mutationFn:e=>ce("Role",e),onSuccess:e=>{e!=null&&e.success&&(t.value=re(t.value),_.invalidateQueries({queryKey:["roles"]}),_.invalidateQueries({queryKey:["rolesList"]}),K.push(w.ROLE.path),setTimeout(()=>T.success(q("createToast")),150))}}),D=()=>{if(r.value.$validate(),r.value.$errors.length)return;const e={...t.value};U(e),r.value.$reset()};return(e,l)=>{var v,N;const I=n("ManageHead"),O=n("FormInput"),P=n("ActionsModules"),z=n("CustomButton"),G=n("Spinner");return h.value?(s(),i("section",ie,[S("div",pe,[ee(I,{title:"addNewRolesTitle",to:a(w).ROLE.path},null,8,["to"]),S("form",{class:"manage__form form-manage",onSubmit:oe(D,["prevent"])},[(s(!0),i(k,null,te(Q.value,o=>{var f,g,M,$,R;return s(),i(k,{key:o.id},[o!=null&&o.select?u("",!0):(s(),c(O,{key:0,modelValue:t.value[o.model],"onUpdate:modelValue":j=>t.value[o.model]=j,width:500,placeholder:e.$t(o.placeholder),name:o.icon,error:(g=(f=a(r))==null?void 0:f[o.errorKey])==null?void 0:g.$error,textError:(R=($=(M=a(r))==null?void 0:M[o.errorKey])==null?void 0:$.$errors[0])==null?void 0:R.$message},{default:C(()=>[E(L(e.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"]))],64)}),128)),a(y)?(s(),c(P,{key:0,modelValue:t.value.roleModules,"onUpdate:modelValue":l[0]||(l[0]=o=>t.value.roleModules=o),actions:a(x)},null,8,["modelValue","actions"])):u("",!0),a(y)?(s(),c(z,{key:1,className:`form__submit manage__submit ${(N=(v=a(r))==null?void 0:v.fullName.$errors[0])!=null&&N.$message?"centered":""}`},{default:C(()=>[E(L(e.$t("formButton")),1)]),_:1},8,["className"])):u("",!0)],32),a(H)?(s(),c(G,{key:0})):u("",!0)])])):u("",!0)}}};export{Me as default};
