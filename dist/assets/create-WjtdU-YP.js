import{u as re,a as le,r as b,c as te,z as R,d as V,e as K,k as P,h as r,w as se,F,C as k,D as f,A as y,i as $,l as ne,m as u,o as s,s as C,f as N,t as _,E as ue}from"./index-Su5VrTfH.js";import{c as me}from"./crud.services-Tdi7grz4.js";import{c as de,d as ie}from"./manual.services-1Udrc8ye.js";import{u as ce,r as n,m as pe}from"./i18n-validators-2NGrV2xS.js";import{a as ye,u as he}from"./generic.services-Bjs5T0kb.js";import{u as I}from"./useQuery-TVdyHrTE.js";const ge={class:"manage section-height shadowed"},fe={class:"manage__inner section-padding"},Me={__name:"create",async setup(Ne){let t,h;const O=ye(),q=ne(),B=re(),{t:A}=le(),a=b({fullName:"",userName:"",password:"",phoneNumber:"",organizationId:[],createRoleDto:{fullName:"OrgAdmin",shortName:"OrgAdmin",roleModules:[]}}),U=te(()=>({fullName:{required:n},userName:{required:n},password:{required:n,minLength:pe},phoneNumber:{required:n},organizationId:{required:n},createRoleDto:{fullName:{required:n},shortName:{required:n},roleModules:{required:n}}})),l=ce(U,a),{data:x,isLoading:T,isSuccess:w}=([t,h]=R(()=>I({queryKey:["modules"],queryFn:()=>de()})),t=await t,h(),t),{data:H,isSuccess:Q,isLoading:G}=([t,h]=R(()=>I({queryKey:["organizations"],queryFn:()=>ie()})),t=await t,h(),t),Y=b([{id:1,model:"fullName",label:"employeesFullNameLabel",placeholder:"employeesFullNamePlaceholder",icon:"person",errorKey:"fullName"},{id:2,model:"userName",label:"employeesLoginLabel",placeholder:"employeesLoginPlaceholder",icon:"login",errorKey:"userName"},{id:3,model:"password",label:"employeesPasswordLabel",placeholder:"employeesPasswordPlaceholder",icon:"password",errorKey:"password"},{id:4,model:"phoneNumber",label:"employeesPhoneLabel",placeholder:"employeesPhonePlaceholder",icon:"phone",errorKey:"phoneNumber",type:"number"}]),j=b([{id:1,model:"organizationId",label:"employeesOrganizationLabel",placeholder:"employeesOrganizationPlaceholder",errorKey:"organizationId",options:H,success:Q,loading:G}]),{mutate:J}=he({onMutate:o=>{o.organizationId=o.organizationId[0]},mutationFn:o=>me("user",o),onSuccess:o=>{o!=null&&o.success&&(a.value=ue(a.value),O.invalidateQueries({queryKey:["employees"]}),q.push(C.EMPLOYEES.path),setTimeout(()=>B.success(A("createToast")),150))}}),W=()=>{if(a.value.createRoleDto.shortName=a.value.createRoleDto.fullName,l.value.$validate(),l.value.$errors.length)return;const o={...a.value};J(o),l.value.$reset()};return(o,g)=>{var L,E,z,S,D;const X=u("ManageHead"),M=u("FormInput"),Z=u("FormSelect"),ee=u("ActionsModules"),oe=u("CustomButton"),ae=u("Spinner");return s(),V("section",ge,[K("div",fe,[P(X,{title:"addNewEmployeesTitle",to:r(C).EMPLOYEES.path},null,8,["to"]),K("form",{class:"manage__form form-manage",onSubmit:se(W,["prevent"])},[(s(!0),V(F,null,k(Y.value,e=>{var m,d,i,c,p;return s(),y(M,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":v=>a.value[e.model]=v,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(d=(m=r(l))==null?void 0:m[e.errorKey])==null?void 0:d.$error,type:e==null?void 0:e.type,textError:(p=(c=(i=r(l))==null?void 0:i[e.errorKey])==null?void 0:c.$errors[0])==null?void 0:p.$message},{default:f(()=>[N(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","type","textError"])}),128)),P(M,{modelValue:a.value.createRoleDto.fullName,"onUpdate:modelValue":g[0]||(g[0]=e=>a.value.createRoleDto.fullName=e),width:500,placeholder:o.$t("employeesRolePlaceholder"),name:"person",error:(E=(L=r(l))==null?void 0:L.createRoleDto.fullName)==null?void 0:E.$error,textError:(D=(S=(z=r(l))==null?void 0:z.createRoleDto.fullName)==null?void 0:S.$errors[0])==null?void 0:D.$message},{default:f(()=>[N(_(o.$t("employeesRoleLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),(s(!0),V(F,null,k(j.value,e=>{var m,d,i,c,p;return s(),y(Z,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":v=>a.value[e.model]=v,modelModifiers:{trim:!0},width:500,options:e.options,error:(d=(m=r(l))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:d.$error,placeholder:e==null?void 0:e.placeholder,textError:(p=(c=(i=r(l))==null?void 0:i[e==null?void 0:e.errorKey])==null?void 0:c.$errors[0])==null?void 0:p.$message,success:e.success,loading:e.loading},{default:f(()=>[N(_(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),r(w)?(s(),y(ee,{key:0,modelValue:a.value.createRoleDto.roleModules,"onUpdate:modelValue":g[1]||(g[1]=e=>a.value.createRoleDto.roleModules=e),actions:r(x)},null,8,["modelValue","actions"])):$("",!0),r(w)?(s(),y(oe,{key:1,className:"form__submit"},{default:f(()=>[N(_(o.$t("formButton")),1)]),_:1})):$("",!0)],32),r(T)?(s(),y(ae,{key:0})):$("",!0)])])}}};export{Me as default};
