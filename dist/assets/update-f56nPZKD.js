import{u as te,a as oe,b as se,y as re,c as F,r as p,z as T,B as ue,d as $,e as E,k as L,h as u,w as ne,F as M,C as U,D as S,i as le,l as de,G as ie,m as h,o as m,s as P,A as k,f as b,t as K,H as ce,E as me}from"./index-xaxvmeln.js";import{u as ye,r as f}from"./i18n-validators-3XDN4B9m.js";import{a as pe,u as he}from"./generic.services-fBvasRgP.js";import{u as V}from"./useQuery-5RNqZlmw.js";import{a as fe,u as _e}from"./crud.services-MNtnlh6b.js";import{k as ve,b as ge}from"./manual.services-fmuMEGVw.js";const Ie={key:0,class:"manage section-height shadowed"},qe={class:"manage__inner section-padding"},we={__name:"update",async setup(Te){let t,r;const _=pe(),w=de(),Q=ie();te(),oe();const D=se(),{user:v}=re(D),y=F(()=>{var a,I;return!!((I=(a=v==null?void 0:v.value.user)==null?void 0:a.modules)!=null&&I.includes(ce.PRODUCT.UPDATE))}),g=p(Q.params.id),o=p({id:"",fullname:"",quantityTypeId:[],stateId:[]}),N=F(()=>({id:{required:f},fullname:{required:f},quantityTypeId:{required:f},stateId:{required:f}})),s=ye(N,o),{data:R,isSuccess:x,isLoading:H}=([t,r]=T(()=>V({queryKey:["types"],queryFn:()=>ve(),enabled:y})),t=await t,r(),t),{data:O,isSuccess:A,isLoading:G}=([t,r]=T(()=>V({queryKey:["states"],queryFn:()=>ge(),enabled:y})),t=await t,r(),t),z=p([{id:1,model:"fullname",label:"nameProductsLabel",placeholder:"nameProductsPlaceholder",icon:"pen",errorKey:"fullname"}]),W=p([{id:1,model:"quantityTypeId",label:"qunatityTypesProductsLabel",placeholder:"qunatityTypesProductsPlaceholder",errorKey:"quantityTypeId",options:R,success:x,loading:H},{id:2,model:"stateId",label:"stateProductsLabel",placeholder:"stateProductsPlaceholder",errorKey:"stateId",options:O,success:A,loading:G}]),{isError:j}=([t,r]=T(()=>V({queryKey:["productById",g],queryFn:()=>fe("construction_material",g.value),select:a=>{o.value.id=a.id,o.value.fullname=a.fullname,o.value.quantityTypeId=[a.quantityTypeId],o.value.stateId=[a.stateId]},enabled:y})),t=await t,r(),t);ue(j,a=>{a&&w.push(P.HOME.path)});const{mutate:J}=he({onMutate:a=>{a.quantityTypeId=a.quantityTypeId[0],a.stateId=a.stateId[0]},mutationFn:a=>_e("construction_material",a),onSuccess:a=>{o.value=me(o.value),_.invalidateQueries({queryKey:["products"]}),_.invalidateQueries({queryKey:["productById",g]}),_.invalidateQueries({queryKey:["materialsList"]}),w.push(P.PRODUCT.path)}}),X=async()=>{if(s.value.$validate(),s.value.$errors.length)return;const a={...o.value};J(a),s.value.$reset()};return(a,I)=>{var C,B;const Y=h("ManageHead"),Z=h("FormInput"),ee=h("FormSelect"),ae=h("CustomButton");return y.value?(m(),$("section",Ie,[E("div",qe,[L(Y,{title:"editProductTitle",to:u(P).PRODUCT.path},null,8,["to"]),E("form",{class:"manage__form form-manage",onSubmit:ne(X,["prevent"])},[(m(!0),$(M,null,U(z.value,e=>{var n,l,d,i,c;return m(),k(Z,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":q=>o.value[e.model]=q,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(l=(n=u(s))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,textError:(c=(i=(d=u(s))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message},{default:S(()=>[b(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(m(!0),$(M,null,U(W.value,e=>{var n,l,d,i,c;return m(),k(ee,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":q=>o.value[e.model]=q,modelModifiers:{trim:!0},width:500,options:e.options,error:(l=(n=u(s))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(i=(d=u(s))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:S(()=>[b(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(ae,{className:`form__submit ${(B=(C=u(s))==null?void 0:C.stateId.$errors[0])!=null&&B.$message?"centered":""}`},{default:S(()=>[b(K(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):le("",!0)}}};export{we as default};
