import{x as j,y as q,b as J,c as X,r as B,z as Y,d as I,e as Z,k as L,h as e,A as H,i as c,t as ee,m as d,o as m,s as Q,H as p}from"./index-zkjpq5my.js";import{a as se,u as oe}from"./generic.services-wx_DtCHh.js";import{u as te}from"./useQuery-copJlXh0.js";import{g as ne,d as ae}from"./crud.services-8TgOaY3n.js";import{r as re}from"./index-A7S9AU-G.js";const le={key:0,class:"employees"},ie={class:"employees__inner section-padding"},ue={key:2,class:"empty-table shadowed"},he={__name:"index",async setup(ce){let l,S;const E=se(),x=j(),{page:_,limit:y,search:z}=q(x),F=J(),{user:o}=q(F),b=X(()=>{var s,t;return!!((t=(s=o==null?void 0:o.value.user)==null?void 0:s.modules)!=null&&t.includes(p.ORG_USER.READ))}),g=B(""),R=re(z,500),K=B([{id:1,label:"employeesFullName",width:30},{id:3,label:"employeesPhone",width:25},{id:4,label:"employeesRole",width:20}]),{data:i,isLoading:M,isSuccess:h,isError:V}=([l,S]=Y(()=>{var s,t;return te({queryKey:["orgUsers",{page:_,limit:y,debouncedSearch:R,organizationId:(t=(s=o.value)==null?void 0:s.user)==null?void 0:t.organizationId}],queryFn:()=>ne("user",_.value,y.value,R.value),select:n=>{let u={...n};return u.users=n==null?void 0:n.users.map(a=>{const r={...a,phone:a.phoneNumber,name:a.fullName};return delete r.fullName,delete r.phoneNumber,r}),u},enabled:b})}),l=await l,S(),l),{mutate:W}=oe({mutationFn:s=>ae("user",s),onSuccess:s=>{E.invalidateQueries({queryKey:["orgUsers"]}),E.invalidateQueries({queryKey:["orgUserById",g]})}}),$=s=>{g.value=s,W(s)};return(s,t)=>{var U,f,v,w,T,C,D,k,A,N,O,P,G;const n=d("HeadPage"),u=d("Table"),a=d("Pagination"),r=d("Spinner");return b.value?(m(),I("section",le,[Z("div",ie,[L(n,{title:"employeesTitle",to:e(Q).CREATE_ORG_USER.path,isShowCreate:(v=(f=(U=e(o))==null?void 0:U.user)==null?void 0:f.modules)==null?void 0:v.includes(e(p).ORG_USER.CREATE)},null,8,["to","isShowCreate"]),e(h)&&((w=e(i))!=null&&w.count)?(m(),H(u,{key:0,headers:K.value,table:(T=e(i))==null?void 0:T.users,to:e(Q).UPDATE_ORG_USER.name,options:{page:e(_),limit:e(y)},isShowUpdate:(k=(D=(C=e(o))==null?void 0:C.user)==null?void 0:D.modules)==null?void 0:k.includes(e(p).ORG_USER.UPDATE),isShowDelete:(O=(N=(A=e(o))==null?void 0:A.user)==null?void 0:N.modules)==null?void 0:O.includes(e(p).ORG_USER.DELETE),onOnActionDelete:$},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):c("",!0),L(a,{count:(P=e(i))==null?void 0:P.count,isSucces:e(h)},null,8,["count","isSucces"]),e(M)?(m(),H(r,{key:1})):c("",!0),e(h)&&!((G=e(i))!=null&&G.count)||e(V)?(m(),I("div",ue,ee(s.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}};export{he as default};
