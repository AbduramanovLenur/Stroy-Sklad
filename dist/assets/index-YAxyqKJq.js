import{u as J,a as X,x as Y,y as K,b as Z,c as ee,r as A,z as se,d as O,e as te,k as q,h as e,A as I,i as n,t as oe,m as c,o as l,s as P,H as i}from"./index-6Y00dUwo.js";import{u as ae}from"./generic.services-DBqHHnAA.js";import{u as ne}from"./useQuery-4Ev4vRio.js";import{u as ce}from"./useMutation-ixZ1w3o_.js";import{g as le,d as ie}from"./crud.services-n7kB94wy.js";import{r as ue}from"./index-C_FfflJ0.js";const re={key:0,class:"blocks"},de={class:"blocks__inner section-padding"},me={key:2,class:"empty-table shadowed"},ge={__name:"index",async setup(be){let o,_;const u=ae(),N=J(),{t:Q}=X(),R=Y(),{page:r,limit:d,search:U}=K(R),H=Z(),{user:t}=K(H),k=ee(()=>{var s,b;return!!((b=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)!=null&&b.includes(i.BLOCK.READ))}),p=A(""),h=ue(U,500),x=A([{id:1,label:"blockName",width:25},{id:2,label:"blockObject",width:25},{id:4,label:"blockFloors",width:15},{id:5,label:"blockRooms",width:15},{id:6,label:"blockAddress",width:25}]),{data:a,isLoading:z,isSuccess:m,isError:F}=([o,_]=se(()=>ne({queryKey:["blocks",{page:r,limit:d,debouncedSearch:h,organizationId:t.value.user.organizationId,name:t.value.user.fullName}],queryFn:()=>le("building_block",r.value,d.value,h.value),enabled:k})),o=await o,_(),o),{mutate:V}=ce({mutationFn:s=>ie("building_block",s),onSuccess:s=>{s!=null&&s.success&&(u.invalidateQueries({queryKey:["blocks"]}),u.invalidateQueries({queryKey:["blocksById",p]}),u.invalidateQueries({queryKey:["blocksList"]}),setTimeout(()=>N.success(Q("deleteToast")),150))}}),M=async s=>{p.value=s,V(s)};return(s,b)=>{var y,S,g,v,w,C,T,f,B,E,L,D;const j=c("HeadPage"),W=c("Table"),$=c("Pagination"),G=c("Spinner");return k.value?(l(),O("section",re,[te("div",de,[q(j,{title:"blockTitle",to:e(P).CREATE_BLOCK.path,isShowCreate:(g=(S=(y=e(t))==null?void 0:y.user)==null?void 0:S.modules)==null?void 0:g.includes(e(i).BLOCK.CREATE)},null,8,["to","isShowCreate"]),e(m)&&((v=e(a))!=null&&v.count)?(l(),I(W,{key:0,headers:x.value,table:(w=e(a))==null?void 0:w.blocks,to:e(P).UPDATE_BLOCK.name,options:{page:e(r),limit:e(d)},isShowUpdate:(f=(T=(C=e(t))==null?void 0:C.user)==null?void 0:T.modules)==null?void 0:f.includes(e(i).BLOCK.UPDATE),isShowDelete:(L=(E=(B=e(t))==null?void 0:B.user)==null?void 0:E.modules)==null?void 0:L.includes(e(i).BLOCK.DELETE),onOnActionDelete:M},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q($,{count:(D=e(a))==null?void 0:D.count,isSucces:e(m)},null,8,["count","isSucces"]),e(z)?(l(),I(G,{key:1})):n("",!0),e(m)&&!e(a).count||e(F)?(l(),O("div",me,oe(s.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{ge as default};
