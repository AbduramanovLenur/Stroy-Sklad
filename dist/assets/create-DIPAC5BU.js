import{u as te,a as le,b as ie,x as de,c as h,r as f,y as k,B as ne,d as L,e as V,k as j,h as i,w as ce,F as N,C as q,D as F,i as ue,l as me,m as y,o as b,A as R,z as E,f as O,t as K,G as be}from"./index-sKMtYVf1.js";import{u as ge,r as t}from"./i18n-validators-UluQ0_Lr.js";import{a as pe,u as he}from"./generic.services-Y9l1kbCB.js";import{u as B}from"./useQuery-oNoZrsai.js";import{c as fe}from"./crud.services-OfzCCZDD.js";import{f as ye,m as _e,a as Ie}from"./manual.services-XDT6etPx.js";const ve={key:0,class:"manage section-height shadowed"},ke={class:"manage__inner section-padding"},we={__name:"create",async setup(Le){let r,l;const $=pe(),M=me();te(),le();const P=ie(),{user:g}=de(P),_=h(()=>{var o,I;return!!((I=(o=g==null?void 0:g.value.user)==null?void 0:o.modules)!=null&&I.includes(be.BLOCK.CREATE))}),S=f(!1),s=f({fullname:"",numberOfFloors:"",roomsOnFloor:"",address:"",buildingObjectId:[],regionId:[],districtId:[]}),x=h(()=>({fullname:{required:t},numberOfFloors:{required:t},roomsOnFloor:{required:t},address:{required:t},buildingObjectId:{required:t},regionId:{required:t},districtId:{required:t}})),a=ge(x,s),{data:A,isSuccess:D,isLoading:T}=([r,l]=k(()=>B({queryKey:["regions"],queryFn:()=>_e(),enabled:_})),r=await r,l(),r),p=h(()=>s.value.regionId),U=h(()=>!!p.value.length);ne(p,()=>{S.value||(s.value.districtId=[])},{immediate:!0});const{data:G,isSuccess:Q,isLoading:z}=([r,l]=k(()=>B({queryKey:["districts",{districtId:p}],queryFn:()=>Ie(p.value),enabled:U})),r=await r,l(),r),{data:H,isSuccess:J,isLoading:W}=([r,l]=k(()=>B({queryKey:["objectsList",{organizationId:g.value.user.organizationId}],queryFn:()=>ye(),enabled:_})),r=await r,l(),r),X=f([{id:1,model:"fullname",label:"blocksFullNameLabel",placeholder:"blocksFullNamePlaceholder",icon:"input-company",errorKey:"fullname"},{id:2,model:"numberOfFloors",label:"blocksNumberLabel",placeholder:"blocksNumberPlaceholder",icon:"signature",errorKey:"numberOfFloors"},{id:3,model:"roomsOnFloor",label:"blocksRoomsLabel",placeholder:"blocksRoomsPlaceholder",icon:"door",errorKey:"roomsOnFloor"},{id:4,model:"address",label:"blocksAddressLabel",placeholder:"blocksAddressPlaceholder",icon:"address",errorKey:"address"}]),Y=f([{id:1,model:"buildingObjectId",label:"buildIdBlocksLabel",placeholder:"buildIdBlocksPlaceholder",errorKey:"buildingObjectId",options:H,success:J,loading:W},{id:2,model:"regionId",label:"regionBlocksLabel",placeholder:"regionBlocksPlaceholder",errorKey:"regionId",options:A,success:D,loading:T},{id:3,model:"districtId",label:"districtBlocksLabel",placeholder:"districtBlocksPlaceholder",errorKey:"districtId",options:G,success:Q,loading:z}]),{mutate:Z}=he({onMutate:o=>{S.value=!0,o.buildingObjectId=o.buildingObjectId[0],o.regionId=o.regionId[0],o.districtId=o.districtId[0]},mutationFn:o=>fe("building_block",o),onSuccess:()=>{$.invalidateQueries({queryKey:["blocks"]}),$.invalidateQueries({queryKey:["blocksList"]}),M.push(R.BLOCK.path)}}),ee=()=>{a.value.$validate(),!a.value.$errors.length&&(Z(s.value),a.value.$reset())};return(o,I)=>{var w,C;const oe=y("ManageHead"),re=y("FormInput"),se=y("FormSelect"),ae=y("CustomButton");return _.value?(b(),L("section",ve,[V("div",ke,[j(oe,{title:"addNewBlocksTitle",to:i(R).BLOCK.path},null,8,["to"]),V("form",{class:"manage__form form-manage",onSubmit:ce(ee,["prevent"])},[(b(!0),L(N,null,q(X.value,e=>{var d,n,c,u,m;return b(),E(re,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":v=>s.value[e.model]=v,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(n=(d=i(a))==null?void 0:d[e.errorKey])==null?void 0:n.$error,textError:(m=(u=(c=i(a))==null?void 0:c[e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message},{default:F(()=>[O(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(b(!0),L(N,null,q(Y.value,e=>{var d,n,c,u,m;return b(),E(se,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":v=>s.value[e.model]=v,width:500,options:e.options,error:(n=(d=i(a))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:n.$error,placeholder:e==null?void 0:e.placeholder,textError:(m=(u=(c=i(a))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:u.$errors[0])==null?void 0:m.$message,success:e.success,loading:e.loading},{default:F(()=>[O(K(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),j(ae,{className:`form__submit ${(C=(w=i(a))==null?void 0:w.districtId.$errors[0])!=null&&C.$message?"centered":""}`},{default:F(()=>[O(K(o.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ue("",!0)}}};export{we as default};
//# sourceMappingURL=create-DIPAC5BU.js.map
