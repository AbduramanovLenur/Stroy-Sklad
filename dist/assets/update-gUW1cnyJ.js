import{u as te,a as re,b as le,y as ue,c as F,r as _,z as b,B as ne,d as I,e as C,k as de,h as t,w as me,F as U,C as x,A as y,i as v,D as V,l as ie,G as ce,m as n,o as l,s as R,f as K,t as w,H as pe,E as he}from"./index-zkjpq5my.js";import{u as ye,r as g}from"./i18n-validators-UGKONhRL.js";import{a as fe,u as _e}from"./generic.services-wx_DtCHh.js";import{u as E}from"./useQuery-copJlXh0.js";import{a as ve,u as ge}from"./crud.services-8TgOaY3n.js";import{c as Ne,b as Me}from"./manual.services-LRvKoYix.js";const Se={key:0,class:"manage section-height shadowed"},$e={class:"manage__inner section-padding"},Le={__name:"update",async setup(be){let s,u;const N=fe(),L=ie(),A=ce();te(),re();const H=le(),{user:M}=ue(H),f=F(()=>{var o,d;return!!((d=(o=M==null?void 0:M.value.user)==null?void 0:o.modules)!=null&&d.includes(pe.ROLE.UPDATE))}),S=_(A.params.id),a=_({id:"",shortName:"",fullName:"",roleModules:[],stateId:[]}),Q=F(()=>({id:{required:g},shortName:{required:g},fullName:{required:g},stateId:{required:g}})),r=ye(Q,a),{data:T,isLoading:D,isSuccess:q}=([s,u]=b(()=>E({queryKey:["modules"],queryFn:()=>Ne(),enabled:f})),s=await s,u(),s),{data:O,isSuccess:P,isLoading:G}=([s,u]=b(()=>E({queryKey:["states"],queryFn:()=>Me(),enabled:f})),s=await s,u(),s),z=_([{id:1,model:"fullName",label:"fullNameRoleLabel",placeholder:"fullNameRolePlaceholder",icon:"role",errorKey:"fullName"},{id:2,model:"shortName",label:"shortNameRoleLabel",placeholder:"shortNameRolePlaceholder",icon:"role",errorKey:"shortName"}]),W=_([{id:1,model:"stateId",label:"stateRoleLabel",placeholder:"stateRolePlaceholder",errorKey:"stateId",options:O,success:P,loading:G}]),{isError:j}=([s,u]=b(()=>E({queryKey:["rolesById",S],queryFn:()=>ve("Role",S.value),select:o=>{a.value.id=o.id,a.value.shortName=o.shortName,a.value.fullName=o.fullName,a.value.roleModules=[...o.roleModules],a.value.stateId=[o.stateId]},enabled:f})),s=await s,u(),s);ne(j,o=>{o&&L.push(R.HOME.path)});const{mutate:J}=_e({onMutate:o=>{o.stateId=o.stateId[0]},mutationFn:o=>ge("Role",o),onSuccess:o=>{a.value=he(a.value),N.invalidateQueries({queryKey:["roles"]}),N.invalidateQueries({queryKey:["rolesById",S]}),N.invalidateQueries({queryKey:["rolesList"]}),L.push(R.ROLE.path)}}),X=()=>{if(r.value.$validate(),r.value.$errors.length)return;const o={...a.value};J(o),r.value.$reset()};return(o,d)=>{var B,k;const Y=n("ManageHead"),Z=n("FormInput"),ee=n("FormSelect"),oe=n("ActionsModules"),ae=n("CustomButton"),se=n("Spinner");return f.value?(l(),I("section",Se,[C("div",$e,[de(Y,{title:"editRolesTitle",to:t(R).ROLE.path},null,8,["to"]),C("form",{class:"manage__form form-manage",onSubmit:me(X,["prevent"])},[(l(!0),I(U,null,x(z.value,e=>{var m,i,c,p,h;return l(),y(Z,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":$=>a.value[e.model]=$,width:500,placeholder:o.$t(e.placeholder),name:e.icon,error:(i=(m=t(r))==null?void 0:m[e.errorKey])==null?void 0:i.$error,textError:(h=(p=(c=t(r))==null?void 0:c[e.errorKey])==null?void 0:p.$errors[0])==null?void 0:h.$message},{default:V(()=>[K(w(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(l(!0),I(U,null,x(W.value,e=>{var m,i,c,p,h;return l(),y(ee,{key:e.id,modelValue:a.value[e.model],"onUpdate:modelValue":$=>a.value[e.model]=$,width:500,options:e.options,error:(i=(m=t(r))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:i.$error,placeholder:e==null?void 0:e.placeholder,textError:(h=(p=(c=t(r))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$errors[0])==null?void 0:h.$message,success:e.success,loading:e.loading},{default:V(()=>[K(w(o.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),t(q)?(l(),y(oe,{key:0,modelValue:a.value.roleModules,"onUpdate:modelValue":d[0]||(d[0]=e=>a.value.roleModules=e),actions:t(T)},null,8,["modelValue","actions"])):v("",!0),t(q)?(l(),y(ae,{key:1,className:`form__submit manage__submit ${(k=(B=t(r))==null?void 0:B.fullName.$errors[0])!=null&&k.$message?"centered":""}`},{default:V(()=>[K(w(o.$t("formButton")),1)]),_:1},8,["className"])):v("",!0)],32),t(D)?(l(),y(se,{key:0})):v("",!0)])])):v("",!0)}}};export{Le as default};
