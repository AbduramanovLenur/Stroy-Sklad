import{u as ae,a as oe,b as se,s as te,c as g,r as h,x as O,A as ne,d as I,e as B,k as L,h as t,w as ie,F,B as q,C as $,i as de,l as le,m as _,o as u,z as T,y as k,f as S,t as C,E as ce}from"./index--8tqH1cI.js";import{u as ue,r as b}from"./i18n-validators-ifF63VWe.js";import{a as me,u as pe}from"./generic.services-lNDsx7jF.js";import{u as M}from"./useQuery-_ggqNrTF.js";import{c as ge}from"./crud.services-U-Ys9NO0.js";import{m as he,a as _e}from"./manual.services-Zmd6WN_N.js";const be={key:0,class:"manage section-height shadowed"},ve={class:"manage__inner section-padding"},je={__name:"create",async setup(ye){let a,m;const V=me(),N=le();ae(),oe();const R=se(),{user:v}=te(R),j=g(()=>{var r,y;return!!((y=(r=v==null?void 0:v.value.user)==null?void 0:r.modules)!=null&&y.includes(ce.OBJECT.CREATE))}),w=h(!1),o=h({name:"",address:"",regionId:[],districtId:[]}),x=g(()=>({name:{required:b},address:{required:b},regionId:{required:b},districtId:{required:b}})),s=ue(x,o),{data:U,isSuccess:D,isLoading:P}=([a,m]=O(()=>M({queryKey:["regions"],queryFn:()=>he(),enabled:j})),a=await a,m(),a),p=g(()=>o.value.regionId),Q=g(()=>!!p.value.length);ne(p,()=>{w.value||(o.value.districtId=[])},{immediate:!0});const{data:A,isSuccess:H,isLoading:J}=([a,m]=O(()=>M({queryKey:["districts",{districtId:p}],queryFn:()=>_e(p.value),enabled:Q})),a=await a,m(),a),G=h([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"}]),z=h([{id:1,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:U,success:D,loading:P},{id:2,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:A,success:H,loading:J}]),{mutate:W}=pe({onMutate:r=>{w.value=!0,r.regionId=r.regionId[0],r.districtId=r.districtId[0]},mutationFn:r=>ge("building_object",r),onSuccess:()=>{V.invalidateQueries({queryKey:["objects"]}),V.invalidateQueries({queryKey:["objectsList"]}),N.push(T.OBJECTS.path)}}),X=()=>{s.value.$validate(),!s.value.$errors.length&&(W(o.value),s.value.$reset())};return(r,y)=>{var E,K;const Y=_("ManageHead"),Z=_("FormInput"),ee=_("FormSelect"),re=_("CustomButton");return j.value?(u(),I("section",be,[B("div",ve,[L(Y,{title:"addNewObjectTitle",to:t(T).OBJECTS.path},null,8,["to"]),B("form",{class:"manage__form form-manage",onSubmit:ie(X,["prevent"])},[(u(!0),I(F,null,q(G.value,e=>{var n,i,d,l,c;return u(),k(Z,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":f=>o.value[e.model]=f,width:500,placeholder:r.$t(e.placeholder),name:e.icon,error:(i=(n=t(s))==null?void 0:n[e.errorKey])==null?void 0:i.$error,textError:(c=(l=(d=t(s))==null?void 0:d[e.errorKey])==null?void 0:l.$errors[0])==null?void 0:c.$message},{default:$(()=>[S(C(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(u(!0),I(F,null,q(z.value,e=>{var n,i,d,l,c;return u(),k(ee,{key:e.id,modelValue:o.value[e.model],"onUpdate:modelValue":f=>o.value[e.model]=f,width:500,options:e.options,error:(i=(n=t(s))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:i.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(l=(d=t(s))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:l.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:$(()=>[S(C(r.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(re,{className:`form__submit ${(K=(E=t(s))==null?void 0:E.districtId.$errors[0])!=null&&K.$message?"centered":""}`},{default:$(()=>[S(C(r.$t("formButton")),1)]),_:1},8,["className"])],32)])])):de("",!0)}}};export{je as default};
//# sourceMappingURL=create-SdAT29Ns.js.map
