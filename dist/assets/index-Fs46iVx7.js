import{g as X,d as Y}from"./crud.services-5xsWAErC.js";import{u as Z,a as ee,x as te,y as K,b as se,c as oe,r as A,z as ae,d as O,e as ne,k as q,A as ie,h as e,B as I,i as n,t as N,m as i,o as c,f as ce,s as P,H as l}from"./index-6LvNiRNQ.js";import{u as le}from"./generic.services-Uat72V9U.js";import{u as ue}from"./useQuery-LO3_M3QD.js";import{u as re}from"./useMutation-luul9QM2.js";import{r as de}from"./index-jSOApseh.js";const me={key:0,class:"blocks"},be={class:"blocks__inner section-padding"},_e={key:2,class:"empty-table shadowed"},ve={__name:"index",async setup(he){let o,_;const u=le(),Q=Z(),{t:R}=ee(),U=te(),{page:r,limit:d,search:x}=K(U),H=se(),{user:s}=K(H),h=oe(()=>{var t,b;return!!((b=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&b.includes(l.BLOCK.READ))}),k=A(""),p=de(x,500),V=A([{id:1,label:"blockName",width:25},{id:2,label:"blockObject",width:25},{id:4,label:"blockFloors",width:15},{id:5,label:"blockRooms",width:15},{id:6,label:"blockAddress",width:25}]),{data:a,isLoading:z,isSuccess:m,isError:F}=([o,_]=ae(()=>ue({queryKey:["blocks",{page:r,limit:d,debouncedSearch:p,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>X("building_block",r.value,d.value,p.value),enabled:h})),o=await o,_(),o),{mutate:M}=re({mutationFn:t=>Y("building_block",t),onSuccess:t=>{t!=null&&t.success&&(u.invalidateQueries({queryKey:["blocks"]}),u.invalidateQueries({queryKey:["blocksById",k.value.toString()]}),u.invalidateQueries({queryKey:["blocksList"]}),setTimeout(()=>Q.success(R("deleteToast")),150))}}),$=async t=>{k.value=t,M(t)};return(t,b)=>{var y,S,g,f,v,w,C,T,B,E,L,D;const j=i("HeadPage"),W=i("Table"),G=i("Pagination"),J=i("Spinner");return h.value?(c(),O("section",me,[ne("div",be,[q(j,{title:"blockTitle",to:e(P).CREATE_BLOCK.path,isShowCreate:(g=(S=(y=e(s))==null?void 0:y.user)==null?void 0:S.modules)==null?void 0:g.includes(e(l).BLOCK.CREATE)},{default:ie(()=>[ce(N(t.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),e(m)&&((f=e(a))!=null&&f.count)?(c(),I(W,{key:0,headers:V.value,table:(v=e(a))==null?void 0:v.blocks,to:e(P).UPDATE_BLOCK.name,options:{page:e(r),limit:e(d)},isShowUpdate:(T=(C=(w=e(s))==null?void 0:w.user)==null?void 0:C.modules)==null?void 0:T.includes(e(l).BLOCK.UPDATE),isShowDelete:(L=(E=(B=e(s))==null?void 0:B.user)==null?void 0:E.modules)==null?void 0:L.includes(e(l).BLOCK.DELETE),onOnActionDelete:$},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q(G,{count:(D=e(a))==null?void 0:D.count,isSucces:e(m)},null,8,["count","isSucces"]),e(z)?(c(),I(J,{key:1})):n("",!0),e(m)&&!e(a).count||e(F)?(c(),O("div",_e,N(t.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{ve as default};
