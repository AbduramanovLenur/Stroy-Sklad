import{u as Y,a as Z,x as ee,y as B,b as te,c as se,r as O,z as oe,d as q,e as ae,k as I,A as ne,h as e,B as N,i as n,t as P,m as r,o as i,f as re,s as Q,H as u}from"./index-oRJgEnXe.js";import{u as ie}from"./generic.services-2HfgHzRB.js";import{u as ue}from"./useQuery-z22EShWF.js";import{u as le}from"./useMutation-TpRbp4qq.js";import{g as ce,d as de}from"./crud.services-UNG6PI8V.js";import{r as me}from"./index-9R_-BKnG.js";const _e={key:0,class:"roles"},pe={class:"roles__inner section-padding"},ye={key:2,class:"empty-table shadowed"},Re={__name:"index",async setup(he){let o,p;const l=ie(),U=Y(),{t:x}=Z(),H=ee(),{page:c,limit:d,search:K}=B(H),V=te(),{user:s}=B(V),y=se(()=>{var t,_;return!!((_=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&_.includes(u.ROLE.READ))}),h=O(""),S=me(K,500),z=O([{id:1,label:"rolesName",width:70}]),{data:a,isLoading:F,isSuccess:m,isError:M}=([o,p]=oe(()=>ue({queryKey:["roles",{page:c,limit:d,debouncedSearch:S,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>ce("Role",c.value,d.value,S.value),enabled:y})),o=await o,p(),o),{mutate:$}=le({mutationFn:t=>de("Role",t),onSuccess:t=>{t!=null&&t.success&&(l.invalidateQueries({queryKey:["roles"]}),l.invalidateQueries({queryKey:["rolesById",h.value.toString()]}),l.invalidateQueries({queryKey:["rolesList"]}),setTimeout(()=>U.success(x("deleteToast")),150))}}),W=async t=>{h.value=t,$(t)};return(t,_)=>{var E,f,v,T,g,R,b,w,L,C,D,k,A;const j=r("HeadPage"),G=r("Table"),J=r("Pagination"),X=r("Spinner");return y.value?(i(),q("section",_e,[ae("div",pe,[I(j,{title:"rolesTitle",to:e(Q).CREATE_ROLE.path,isShowCreate:(v=(f=(E=e(s))==null?void 0:E.user)==null?void 0:f.modules)==null?void 0:v.includes(e(u).ROLE.CREATE)},{default:ne(()=>[re(P(t.$t("addButton")),1)]),_:1},8,["to","isShowCreate"]),e(m)&&((T=e(a))!=null&&T.count)?(i(),N(G,{key:0,headers:z.value,table:(g=e(a))==null?void 0:g.roles,to:e(Q).UPDATE_ROLE.name,options:{page:e(c),limit:e(d)},isShowUpdate:(w=(b=(R=e(s))==null?void 0:R.user)==null?void 0:b.modules)==null?void 0:w.includes(e(u).ROLE.UPDATE),isShowDelete:(D=(C=(L=e(s))==null?void 0:L.user)==null?void 0:C.modules)==null?void 0:D.includes(e(u).ROLE.DELETE),onOnActionDelete:W},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),I(J,{count:(k=e(a))==null?void 0:k.count,isSucces:e(m)},null,8,["count","isSucces"]),e(F)?(i(),N(X,{key:1})):n("",!0),e(m)&&!((A=e(a))!=null&&A.count)||e(M)?(i(),q("div",ye,P(t.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{Re as default};
