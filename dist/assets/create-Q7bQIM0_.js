import{_ as xe,u as Ke,a as Fe,b as qe,y as Ce,c as d,r as K,z as b,B as Ee,d as B,e as I,k as Y,h as m,t as p,i as L,w as $e,F as Z,C as Ne,D as F,l as je,m as M,o as g,s as ee,A as ae,f as q,H as Ve,E as Oe}from"./index-6Y00dUwo.js";import{c as ze}from"./crud.services-n7kB94wy.js";import{u as Pe,r as v}from"./i18n-validators-CKocQCxg.js";import{l as Te,f as Qe,g as Ge,h as Ue,i as He}from"./manual.services-_7BrBx10.js";import{u as fe}from"./generic.services-DBqHHnAA.js";import{u as h}from"./useQuery-4Ev4vRio.js";import{u as Ae}from"./useMutation-ixZ1w3o_.js";const De={key:0,class:"manage section-height shadowed"},Re={class:"manage__inner section-padding"},Xe={class:"manage__stock-warehouse"},We={class:"manage__stock-label"},Je={key:0,class:"manage__stock-value"},Ye={class:"manage__overlay"},Ze={__name:"create",async setup(ea){let o,r;const _=fe(),oe=je(),C=Ke(),{t:E}=Fe(),se=qe(),{user:s}=Ce(se),y=d(()=>{var a,l;return!!((l=(a=s==null?void 0:s.value.user)==null?void 0:a.modules)!=null&&l.includes(Ve.EXPENS.CREATE))}),te=K(!1),t=K({constructionMaterialId:[],count:"",buildingObjectId:[],buildingBlockId:[],floorId:[],costId:[]}),re=d(()=>({constructionMaterialId:{required:v},count:{required:v},buildingObjectId:{required:v},buildingBlockId:{required:v},floorId:{required:v},costId:{required:v}})),u=Pe(re,t),{data:$,isSuccess:le,isLoading:ne}=([o,r]=b(()=>h({queryKey:["warehouseList",{organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>Te(),enabled:y})),o=await o,r(),o),c=d(()=>{var a;return(a=$.value)==null?void 0:a.filter(l=>{var n;return l.id===((n=t.value.constructionMaterialId)==null?void 0:n[0])})}),{data:ue,isSuccess:ce,isLoading:ie}=([o,r]=b(()=>h({queryKey:["objectsList",{organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>Qe(),enabled:y})),o=await o,r(),o),k=d(()=>t.value.buildingObjectId[0]),de=d(()=>!!k.value);Ee(k,()=>{te.value||(t.value.buildingBlockId=[])},{immediate:!0});const{data:me,isSuccess:pe,isLoading:ge}=([o,r]=b(()=>h({queryKey:["blocksList",{blockId:k,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>Ge(k.value),enabled:de})),o=await o,r(),o),w=d(()=>t.value.buildingBlockId[0]),ve=d(()=>!!w.value),{data:be,isSuccess:Ie,isLoading:he}=([o,r]=b(()=>h({queryKey:["floorsList",{floorId:w,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>Ue(w.value),enabled:ve})),o=await o,r(),o),{data:_e,isSuccess:ye,isLoading:ke}=([o,r]=b(()=>h({queryKey:["costsList",{organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>He(),enabled:y})),o=await o,r(),o),Se=K([{id:1,model:"constructionMaterialId",label:"expenseMaterialLabel",placeholder:"expenseMaterialPlaceholder",errorKey:"constructionMaterialId",options:$,success:le,loading:ne,select:!0},{id:2,model:"count",label:"expenseCountLabel",placeholder:"expenseCountPlaceholder",icon:"list",errorKey:"count",type:"number"},{id:3,model:"buildingObjectId",label:"expenseObjectLabel",placeholder:"expenseObjectPlaceholder",errorKey:"buildingObjectId",options:ue,success:ce,loading:ie,select:!0},{id:4,model:"buildingBlockId",label:"expenseBlockLabel",placeholder:"expenseBlockPlaceholder",errorKey:"buildingBlockId",options:me,success:pe,loading:ge,select:!0},{id:5,model:"floorId",label:"expenseFloorLabel",placeholder:"expenseFloorPlaceholder",errorKey:"floorId",options:be,success:Ie,loading:he,select:!0},{id:6,model:"costId",label:"expenseCostLabel",placeholder:"expenseCostPlaceholder",errorKey:"costId",options:_e,success:ye,loading:ke,select:!0}]),{mutate:Be,status:Le}=Ae({onMutate:a=>{a.constructionMaterialId=a.constructionMaterialId[0],a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.floorId=a.floorId[0],a.costId=a.costId[0]},mutationFn:a=>ze("expense",a),onSuccess:a=>{var l,n,i,S;a!=null&&a.success&&(_.invalidateQueries({queryKey:["expenses"]}),_.invalidateQueries({queryKey:["warehouse"]}),_.invalidateQueries({queryKey:["warehouseById",(n=(l=c.value)==null?void 0:l[0])==null?void 0:n.warehouseId]}),_.invalidateQueries({queryKey:["warehouseList"]}),console.log((S=(i=c.value)==null?void 0:i[0])==null?void 0:S.warehouseId),t.value=Oe(t.value),oe.push(ee.EXPENS.path),setTimeout(()=>C.success(E("createToast")),150))}}),Me=()=>{var n,i;if(((i=(n=c.value)==null?void 0:n[0])==null?void 0:i.count)-t.value.count<0){C.error(E("negativeMeaningToast"));return}if(u.value.$validate(),u.value.$errors.length)return;const l={...t.value};Be(l),u.value.$reset()};return(a,l)=>{var N,j,V,O,z,P,T,Q;const n=M("ManageHead"),i=M("FormInput"),S=M("FormSelect"),we=M("CustomButton");return y.value?(g(),B("section",De,[I("div",Re,[Y(n,{title:"addNewExpensesTitle",to:m(ee).EXPENS.path},null,8,["to"]),I("div",Xe,[I("div",We,p((j=(N=c.value)==null?void 0:N[0])!=null&&j.count?a.$t("expenseStockMaterial"):a.$t("expenseSampleMaterial")),1),(O=(V=c.value)==null?void 0:V[0])!=null&&O.count?(g(),B("div",Je,p((P=(z=c.value)==null?void 0:z[0])==null?void 0:P.count)+" "+p((Q=(T=c.value)==null?void 0:T[0])==null?void 0:Q.quantityType),1)):L("",!0)]),I("form",{class:"manage__form",onSubmit:$e(Me,["prevent"])},[I("div",Ye,[(g(!0),B(Z,null,Ne(Se.value,e=>{var G,U,H,f,A,D,R,X,W,J;return g(),B(Z,{key:e.id},[e!=null&&e.select?L("",!0):(g(),ae(i,{key:0,modelValue:t.value[e.model],"onUpdate:modelValue":x=>t.value[e.model]=x,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(U=(G=m(u))==null?void 0:G[e.errorKey])==null?void 0:U.$error,textError:(A=(f=(H=m(u))==null?void 0:H[e.errorKey])==null?void 0:f.$errors[0])==null?void 0:A.$message,type:e==null?void 0:e.type},{default:F(()=>[q(p(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])),e!=null&&e.select?(g(),ae(S,{key:1,modelValue:t.value[e.model],"onUpdate:modelValue":x=>t.value[e.model]=x,modelModifiers:{trim:!0},width:500,options:e.options,error:(R=(D=m(u))==null?void 0:D[e==null?void 0:e.errorKey])==null?void 0:R.$error,placeholder:e==null?void 0:e.placeholder,textError:(J=(W=(X=m(u))==null?void 0:X[e==null?void 0:e.errorKey])==null?void 0:W.$errors[0])==null?void 0:J.$message,success:e.success,loading:e.loading},{default:F(()=>[q(p(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):L("",!0)],64)}),128))]),Y(we,{className:"manage__submit",disabled:m(Le)==="pending"},{default:F(()=>[q(p(a.$t("formButton")),1)]),_:1},8,["disabled"])],32)])])):L("",!0)}}},ua=xe(Ze,[["__scopeId","data-v-87ebe18a"]]);export{ua as default};
