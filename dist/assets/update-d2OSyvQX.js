import{u as me,a as ge,b as ve,y as be,c as p,r as d,z as I,B as M,d as q,e as k,k as D,h as i,w as ye,F as N,C as R,D as B,i as he,l as pe,G as Ie,m as f,o as v,s as L,A as Q,f as w,t as C,H as fe,E as _e}from"./index-_XMrp3Vl.js";import{u as Se,r as l}from"./i18n-validators-8-I6ziaJ.js";import{a as je,u as Ke}from"./generic.services-t_drLwo6.js";import{u as _}from"./useQuery-aI4x6Qnk.js";import{a as $e,u as Oe}from"./crud.services-6WaoEN5X.js";import{m as qe,a as Be,b as Le}from"./manual.services-m5fLkJn9.js";const we={key:0,class:"manage section-height shadowed"},Ce={class:"manage__inner section-padding"},Ne={__name:"update",async setup(Ee){let s,r;const b=je(),E=pe(),U=Ie(),x=me(),{t:H}=ge(),P=ve(),{user:S}=be(P),y=p(()=>{var e,$;return!!(($=(e=S==null?void 0:S.value.user)==null?void 0:e.modules)!=null&&$.includes(fe.OBJECT.UPDATE))}),j=d(U.params.id),V=d(!1),K=d(!1),t=d({id:"",name:"",address:"",regionId:[],districtId:[],stateId:[]}),G=p(()=>({id:{required:l},name:{required:l},address:{required:l},regionId:{required:l},districtId:{required:l},stateId:{required:l}})),o=Se(G,t),{data:A,isSuccess:J,isLoading:z}=([s,r]=I(()=>_({queryKey:["regions"],queryFn:()=>qe(),enabled:y})),s=await s,r(),s),h=p(()=>t.value.regionId),W=p(()=>!!h.value.length);M(h,()=>{!K.value&&!V.value&&(t.value.districtId=[]),K.value=!1},{immediate:!0});const{data:X,isSuccess:Y,isLoading:Z}=([s,r]=I(()=>_({queryKey:["districts",{districtId:h}],queryFn:()=>Be(h.value),enabled:W})),s=await s,r(),s),{data:ee,isSuccess:ae,isLoading:se}=([s,r]=I(()=>_({queryKey:["states"],queryFn:()=>Le(),enabled:y})),s=await s,r(),s),te=d([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"}]),re=d([{id:1,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:A,success:J,loading:z},{id:2,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:X,success:Y,loading:Z},{id:3,model:"stateId",label:"stateObjectLabel",placeholder:"stateObjectLabel",errorKey:"stateId",options:ee,success:ae,loading:se}]),{isError:oe}=([s,r]=I(()=>_({queryKey:["objectById",j],queryFn:()=>$e("building_object",j.value),select:e=>{t.value.id=e.id,t.value.name=e.fullName,t.value.address=e.address,t.value.regionId=[e.regionId],t.value.districtId=[e.districtId],t.value.stateId=[e.stateId],K.value=!0},enabled:y})),s=await s,r(),s);M(oe,e=>{e&&E.push(L.HOME.path)});const{mutate:de}=Ke({onMutate:e=>{V.value=!0,e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>Oe("building_object",e),onSuccess:e=>{e!=null&&e.success&&(t.value=_e(t.value),b.invalidateQueries({queryKey:["objects"]}),b.invalidateQueries({queryKey:["objectById",j]}),b.invalidateQueries({queryKey:["objectsList"]}),b.invalidateQueries({queryKey:["blocks"]}),E.push(L.OBJECT.path),setTimeout(()=>x.success(H("updateToast")),150))}}),ie=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const e={...t.value};de(e),o.value.$reset()};return(e,$)=>{var F,T;const le=f("ManageHead"),ne=f("FormInput"),ue=f("FormSelect"),ce=f("CustomButton");return y.value?(v(),q("section",we,[k("div",Ce,[D(le,{title:"editObjectTitle",to:i(L).OBJECT.path},null,8,["to"]),k("form",{class:"manage__form form-manage",onSubmit:ye(ie,["prevent"])},[(v(!0),q(N,null,R(te.value,a=>{var n,u,c,m,g;return v(),Q(ne,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":O=>t.value[a.model]=O,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(u=(n=i(o))==null?void 0:n[a==null?void 0:a.errorKey])==null?void 0:u.$error,textError:(g=(m=(c=i(o))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message},{default:B(()=>[w(C(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(v(!0),q(N,null,R(re.value,a=>{var n,u,c,m,g;return v(),Q(ue,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":O=>t.value[a.model]=O,modelModifiers:{trim:!0},width:500,options:a.options,error:(u=(n=i(o))==null?void 0:n[a==null?void 0:a.errorKey])==null?void 0:u.$error,placeholder:a==null?void 0:a.placeholder,textError:(g=(m=(c=i(o))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message,success:a.success,loading:a.loading},{default:B(()=>[w(C(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),D(ce,{className:`form__submit ${(T=(F=i(o))==null?void 0:F.stateId.$errors[0])!=null&&T.$message?"centered":""}`},{default:B(()=>[w(C(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])):he("",!0)}}};export{Ne as default};
