import{_ as j,u as x,a as ee,b as se,y as oe,c as d,r as te,z as w,d as m,e as r,k as _,D as f,h as b,w as ae,F as ne,C as le,A as ie,i as h,l as re,m as p,o as u,f as A,t as E,s as ue,H as I}from"./index-zkjpq5my.js";import{a as ce,u as de}from"./generic.services-wx_DtCHh.js";import{u as q}from"./useQuery-copJlXh0.js";import{h as me,i as _e}from"./crud.services-8TgOaY3n.js";import{e as pe}from"./manual.services-LRvKoYix.js";import{v as c}from"./v4-yQnnJER4.js";const ve={key:0,class:"management-role section-height shadowed"},ge={class:"management-role__inner section-padding"},ye={class:"management-role__head"},fe={class:"management-role__selects"},he={class:"management-role__select-box"},Ae={class:"management-role__actions"},Ee=["onClick"],Ie=["onClick"],Me={__name:"management-role",async setup(ke){let l,v;const M=ce();re();const V=x(),{t:F}=ee(),G=se(),{user:a}=oe(G),k=d(()=>{var e,o;return(o=(e=a==null?void 0:a.value.user)==null?void 0:e.modules)==null?void 0:o.includes(I.MANAGEMENT_ROLE.READ)}),N=d(()=>{var e,o,s,t;return((o=(e=a==null?void 0:a.value.user)==null?void 0:e.modules)==null?void 0:o.includes(I.MANAGEMENT_ROLE.CREATE))||((t=(s=a==null?void 0:a.value.user)==null?void 0:s.modules)==null?void 0:t.includes(I.MANAGEMENT_ROLE.UPDATE))}),n=te([{uuid:c(),roleIds:[],label:"creatorApp"},{uuid:c(),roleIds:[],label:"confirmApp"}]),{data:z,isSuccess:D,isLoading:K}=([l,v]=w(()=>q({queryKey:["rolesList",{organizationId:a.value.user.organizationId}],queryFn:()=>pe(),enabled:k})),l=await l,v(),l),{data:Re,isSuccess:P,isLoading:Q}=([l,v]=w(()=>q({queryKey:["positions",{organizationId:a.value.user.organizationId}],queryFn:()=>me("application_position"),select:e=>{if(e.length)return n.value=e.map((o,s)=>{let t={};return s===0?t={uuid:c(),roleIds:[...o.roleIds],label:"creatorApp"}:s+1===e.length?t={uuid:c(),roleIds:[...o.roleIds],label:"confirmApp"}:t={uuid:c(),roleIds:[...o.roleIds],label:"inspectorApp"},t}),e},enabled:k})),l=await l,v(),l),O=d(()=>D.value&&P.value),U=d(()=>K.value&&Q.value),$=e=>{n.value.splice(e,0,{uuid:c(),roleIds:[],label:"inspectorApp"})},H=e=>{n.value.splice(e,1)},J=d(()=>e=>{var s;const o=n.value.reduce((t,R,g)=>(g!==e&&t.push(...R.roleIds),t),[]);return(s=z.value)==null?void 0:s.filter(t=>!o.includes(t.id))}),{mutate:W}=de({onMutate:e=>{e=e.map(o=>{const s={...o};return s==null||delete s.uuid,s==null||delete s.label,s})},mutationFn:e=>_e("application_position",e),onSuccess:e=>{M.invalidateQueries({queryKey:["positions"]}),M.invalidateQueries({queryKey:["applications"]}),M.invalidateQueries({queryKey:["applicationsById"]})}}),X=()=>{if(n.value.some(o=>!o.roleIds.length)){V.error(F("isEmptyRole"));return}W(n.value)};return(e,o)=>{const s=p("Title"),t=p("MyButton"),R=p("FormSelect"),g=p("Icon"),Y=p("CustomButton");return k.value?(u(),m("section",ve,[r("div",ge,[r("div",ye,[_(s,null,{default:f(()=>[A(`\r
                    `+E(e.$t("managementTitle"))+`\r
                `,1)]),_:1}),_(t,{to:b(ue).MANAGEMENT.path,icon:"back",type:"link",color:"black"},{default:f(()=>[A(E(e.$t("backButton")),1)]),_:1},8,["to"])]),r("form",{class:"management-role__form",onSubmit:ae(X,["prevent"])},[r("div",fe,[(u(!0),m(ne,null,le(n.value,(y,i)=>{var C,S,T,L,B;return u(),m("div",{class:"management-role__select",key:y.uuid},[r("div",he,[_(R,{modelValue:y.roleIds,"onUpdate:modelValue":Z=>y.roleIds=Z,width:500,options:J.value(i),placeholder:"managementRolePlaceholder",success:O.value,loading:U.value,isMultiSelect:!0},{default:f(()=>[A(E(e.$t(y.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","success","loading"])]),r("div",Ae,[i+1!==((C=n.value)==null?void 0:C.length)&&N.value?(u(),m("div",{key:0,class:"management-role__icon",onClick:()=>$(i+1)},[_(g,{name:"plus"})],8,Ee)):h("",!0),i!==0&&i+1!==((S=n.value)==null?void 0:S.length)&&((B=(L=(T=b(a))==null?void 0:T.user)==null?void 0:L.modules)!=null&&B.includes(b(I).MANAGEMENT_ROLE.DELETE))?(u(),m("div",{key:1,class:"management-role__icon",onClick:()=>H(i)},[_(g,{name:"delete-role"})],8,Ie)):h("",!0)])])}),128))]),N.value?(u(),ie(Y,{key:0,className:"form__submit"},{default:f(()=>[A(E(e.$t("formButton")),1)]),_:1})):h("",!0)],32)])])):h("",!0)}}},Be=j(Me,[["__scopeId","data-v-8ab51122"]]);export{Be as default};
