import{u as oe,a as re,b as ue,y as ne,c as F,r as p,z as q,B as le,d as $,e as E,k as L,h as u,w as de,F as M,C as U,D as S,i as ie,l as ce,G as me,m as h,o as m,s as P,A as k,f as b,t as K,H as ye,E as pe}from"./index-Z3zFsJx2.js";import{u as he,r as f}from"./i18n-validators-kd_2X_k0.js";import{a as fe,u as _e}from"./generic.services-kW4H25A9.js";import{u as V}from"./useQuery-jtATA6Uj.js";import{a as ve,u as ge}from"./crud.services-wSM5pbSJ.js";import{k as Ie,b as Te}from"./manual.services-IN4-PBDt.js";const qe={key:0,class:"manage section-height shadowed"},$e={class:"manage__inner section-padding"},Be={__name:"update",async setup(Se){let t,r;const _=fe(),w=ce(),Q=me(),D=oe(),{t:N}=re(),R=ue(),{user:v}=ne(R),y=F(()=>{var a,I;return!!((I=(a=v==null?void 0:v.value.user)==null?void 0:a.modules)!=null&&I.includes(ye.PRODUCT.UPDATE))}),g=p(Q.params.id),s=p({id:"",fullname:"",quantityTypeId:[],stateId:[]}),x=F(()=>({id:{required:f},fullname:{required:f},quantityTypeId:{required:f},stateId:{required:f}})),o=he(x,s),{data:H,isSuccess:O,isLoading:A}=([t,r]=q(()=>V({queryKey:["types"],queryFn:()=>Ie(),enabled:y})),t=await t,r(),t),{data:G,isSuccess:z,isLoading:W}=([t,r]=q(()=>V({queryKey:["states"],queryFn:()=>Te(),enabled:y})),t=await t,r(),t),j=p([{id:1,model:"fullname",label:"nameProductsLabel",placeholder:"nameProductsPlaceholder",icon:"pen",errorKey:"fullname"}]),J=p([{id:1,model:"quantityTypeId",label:"qunatityTypesProductsLabel",placeholder:"qunatityTypesProductsPlaceholder",errorKey:"quantityTypeId",options:H,success:O,loading:A},{id:2,model:"stateId",label:"stateProductsLabel",placeholder:"stateProductsPlaceholder",errorKey:"stateId",options:G,success:z,loading:W}]),{isError:X}=([t,r]=q(()=>V({queryKey:["productById",g],queryFn:()=>ve("construction_material",g.value),select:a=>{s.value.id=a.id,s.value.fullname=a.fullname,s.value.quantityTypeId=[a.quantityTypeId],s.value.stateId=[a.stateId]},enabled:y})),t=await t,r(),t);le(X,a=>{a&&w.push(P.HOME.path)});const{mutate:Y}=_e({onMutate:a=>{a.quantityTypeId=a.quantityTypeId[0],a.stateId=a.stateId[0]},mutationFn:a=>ge("construction_material",a),onSuccess:a=>{a!=null&&a.success&&(s.value=pe(s.value),_.invalidateQueries({queryKey:["products"]}),_.invalidateQueries({queryKey:["productById",g]}),_.invalidateQueries({queryKey:["materialsList"]}),w.push(P.PRODUCT.path),setTimeout(()=>D.success(N("updateToast")),150))}}),Z=async()=>{if(o.value.$validate(),o.value.$errors.length)return;const a={...s.value};Y(a),o.value.$reset()};return(a,I)=>{var C,B;const ee=h("ManageHead"),ae=h("FormInput"),te=h("FormSelect"),se=h("CustomButton");return y.value?(m(),$("section",qe,[E("div",$e,[L(ee,{title:"editProductTitle",to:u(P).PRODUCT.path},null,8,["to"]),E("form",{class:"manage__form form-manage",onSubmit:de(Z,["prevent"])},[(m(!0),$(M,null,U(j.value,e=>{var n,l,d,i,c;return m(),k(ae,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":T=>s.value[e.model]=T,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(l=(n=u(o))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,textError:(c=(i=(d=u(o))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message},{default:S(()=>[b(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(m(!0),$(M,null,U(J.value,e=>{var n,l,d,i,c;return m(),k(te,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":T=>s.value[e.model]=T,modelModifiers:{trim:!0},width:500,options:e.options,error:(l=(n=u(o))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(i=(d=u(o))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:S(()=>[b(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(se,{className:`form__submit ${(B=(C=u(o))==null?void 0:C.stateId.$errors[0])!=null&&B.$message?"centered":""}`},{default:S(()=>[b(K(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):ie("",!0)}}};export{Be as default};
