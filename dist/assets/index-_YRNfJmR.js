import{u as X,a as Y,x as Z,y as L,b as ee,c as te,r as O,z as se,d as q,e as oe,k as I,h as t,A as B,i as r,t as ae,m as i,o as l,s as M,H as d}from"./index-pfgEwabb.js";import{a as ne,u as ue}from"./generic.services-pFsvETxq.js";import{u as ce}from"./useQuery-MTkSqSbf.js";import{g as re,d as ie}from"./crud.services-dRS2qKm6.js";import{r as le}from"./index-jaF3u23u.js";const de={key:0,class:"products"},me={class:"products__inner section-padding"},pe={key:2,class:"empty-table shadowed"},fe={__name:"index",async setup(_e){let a,h;const m=ne(),Q=X(),{t:H}=Y(),K=Z(),{page:p,limit:_,search:x}=L(K),z=ee(),{user:s}=L(z),T=te(()=>{var e,o;return!!((o=(e=s==null?void 0:s.value.user)==null?void 0:e.modules)!=null&&o.includes(d.PRODUCT.READ))}),S=O(""),D=le(x,500),V=O([{id:1,label:"productsName",width:50},{id:1,label:"productsTypeName",width:20}]),{data:n,isLoading:F,isSuccess:y,isError:W}=([a,h]=se(()=>ce({queryKey:["products",{page:p,limit:_,debouncedSearch:D,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>re("construction_material",p.value,_.value,D.value),select:e=>{let o=[...e==null?void 0:e.constructionMaterial];return o=o.map(u=>{const c={...u,material:u.fullName};return delete c.fullName,c}),{constructionMaterial:o,count:e==null?void 0:e.count}},enabled:T})),a=await a,h(),a),{mutate:$}=ue({mutationFn:e=>ie("construction_material",e),onSuccess:e=>{e!=null&&e.success&&(m.invalidateQueries({queryKey:["products"]}),m.invalidateQueries({queryKey:["productById",S]}),m.invalidateQueries({queryKey:["materialsList"]}),setTimeout(()=>Q.success(H("deleteToast")),150))}}),j=async e=>{S.value=e,$(e)};return(e,o)=>{var f,v,C,b,g,P,w,E,U,R,k,A,N;const u=i("HeadPage"),c=i("Table"),G=i("Pagination"),J=i("Spinner");return T.value?(l(),q("section",de,[oe("div",me,[I(u,{title:"productsTitle",to:t(M).CREATE_PRODUCT.path,isShowCreate:(C=(v=(f=t(s))==null?void 0:f.user)==null?void 0:v.modules)==null?void 0:C.includes(t(d).PRODUCT.CREATE)},null,8,["to","isShowCreate"]),t(y)&&((b=t(n))!=null&&b.count)?(l(),B(c,{key:0,headers:V.value,table:(g=t(n))==null?void 0:g.constructionMaterial,to:t(M).UPDATE_PRODUCT.name,options:{page:t(p),limit:t(_)},isShowUpdate:(E=(w=(P=t(s))==null?void 0:P.user)==null?void 0:w.modules)==null?void 0:E.includes(t(d).PRODUCT.UPDATE),isShowDelete:(k=(R=(U=t(s))==null?void 0:U.user)==null?void 0:R.modules)==null?void 0:k.includes(t(d).PRODUCT.DELETE),onOnActionDelete:j},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):r("",!0),I(G,{count:(A=t(n))==null?void 0:A.count,isSucces:t(y)},null,8,["count","isSucces"]),t(F)?(l(),B(J,{key:1})):r("",!0),t(y)&&!((N=t(n))!=null&&N.count)||t(W)?(l(),q("div",pe,ae(e.$t("emptyTableTitle")),1)):r("",!0)])])):r("",!0)}}};export{fe as default};
