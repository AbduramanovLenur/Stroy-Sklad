import{_ as Ie,n as we,s as ze,r as d,c as N,q as _,d as u,o as l,e as w,f as A,l as O,j as n,x as z,k as $,t as F,y as S,F as H,g as R,h as L,w as Fe}from"./index-lIBmWoQk.js";import{d as Se,u as qe,a as C,c as U,b as c}from"./generic.services-wyHkLZNP.js";import{u as f,c as Ke,a as Ne,d as Oe,m as $e,b as Le,e as Ce,g as Ve,f as Me}from"./manual.services-hDEKQQqT.js";const Be={class:"company"},Te={class:"company__inner section-padding"},ke={key:2,class:"empty-table"},Ee={__name:"companies",async setup(De){let t,i;const p=Se(),V=we(),{toggleIsOpenModalForm:M}=V,{isOpenModalForm:q}=ze(V),B=d("addNewCompanyTitle"),g=d(""),y=d(0),T=N(()=>q),k=N(()=>q&&g.value==="edit"),{data:G,isSuccess:W,isLoading:j}=([t,i]=_(()=>f({queryKey:["regions"],queryFn:()=>$e(),enabled:T})),t=await t,i(),t),{data:J,isSuccess:X,isLoading:Y}=([t,i]=_(()=>f({queryKey:["districts"],queryFn:()=>Le(),enabled:T})),t=await t,i(),t),{data:Z,isSuccess:ee,isLoading:ae}=([t,i]=_(()=>f({queryKey:["states"],queryFn:()=>Ce(),enabled:k})),t=await t,i(),t),o=d({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:"",districtId:"",stateId:"",search:""}),oe=N(()=>({fullName:{required:c},inn:{required:c},address:{required:c},phoneNumber:{required:c},director:{required:c},regionId:{required:c},districtId:{required:c}})),te=d([{id:1,label:"organizationName",width:220},{id:2,label:"organizationInn",width:115},{id:3,label:"organizationRegion",width:215},{id:4,label:"organizationDistrict",width:155},{id:5,label:"organizationAddress",width:200},{id:6,label:"organizationPhone",width:170},{id:7,label:"organizationDirector",width:245},{id:7,label:"organizationState",width:100},{id:8,label:"organizationAction",width:130}]),ne=d([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),re=d([{id:1,model:"regionId",label:"regionOrganizationLabel",options:G,errorKey:"regionId",success:W,loading:j,show:["create","edit"]},{id:2,model:"districtId",label:"districtOrganizationLabel",options:J,errorKey:"districtId",success:X,loading:Y,show:["create","edit"]},{id:3,model:"stateId",label:"stateOrganizationLabel",options:Z,success:ee,loading:ae,show:"update",show:["edit"]}]),s=qe(oe,o),{data:K,isLoading:ie,isSuccess:E,isError:se}=([t,i]=_(()=>f({queryKey:["companies"],queryFn:()=>Ve("organization")})),t=await t,i(),t);[t,i]=_(()=>f({queryKey:["companiesById",y],queryFn:()=>Me("organization",y.value),select:e=>{o.value.id=e.id,o.value.fullName=e.fullName,o.value.inn=e.inn,o.value.address=e.address,o.value.phoneNumber=e.phoneNumber,o.value.director=e.director,o.value.regionId=e.regionId,o.value.districtId=e.districtId,o.value.stateId=e.stateId},enabled:k})),t=await t,i();const{mutate:le}=C({mutationFn:e=>Ke("organization",e),onSuccess:()=>{p.invalidateQueries({queryKey:["companies"]})}}),{mutate:de}=C({mutationFn:e=>Ne("organization",e),onSuccess:()=>{p.invalidateQueries({queryKey:["companies"]}),p.invalidateQueries({queryKey:["companiesById",y]})}}),{mutate:ue}=C({mutationFn:e=>Oe("organization",e),onSuccess:()=>{p.invalidateQueries({queryKey:["companies"]}),p.invalidateQueries({queryKey:["companiesById",y]})}}),D=(e,r)=>{B.value=e,g.value=r,M(),g.value==="create"&&q.value&&(o.value=U(o.value),s.value.$reset())},P=(e,r)=>{if(e==="edit"&&r){y.value=r,D("editCompanyTitle","edit");return}D("addNewCompanyTitle","create")},ce=async e=>{ue(e)},me=async()=>{s.value.$validate(),!s.value.$errors.length&&(g.value==="create"?(delete o.value.id,delete o.value.stateId,delete o.value.search,le(o.value)):de(o.value),M(),o.value=U(o.value),s.value.$reset())};return(e,r)=>{const pe=u("HeadPage"),ge=u("Table"),ye=u("Spinner"),he=u("FormInput"),ve=u("FormSelect"),be=u("CustomButton"),_e=u("FormModal");return l(),w("section",Be,[A("div",Te,[O(pe,{title:"comapnyTitle",onOnSearch:r[0]||(r[0]=m=>o.value.search=m),onOnOpenFormModal:r[1]||(r[1]=()=>P("create"))}),n(E)&&n(K).length?(l(),z(ge,{key:0,headers:te.value,table:n(K),onOnActionEdit:r[2]||(r[2]=m=>P("edit",m)),onOnActionDelete:ce},null,8,["headers","table"])):$("",!0),n(ie)?(l(),z(ye,{key:1})):$("",!0),n(E)&&!n(K).length||n(se)?(l(),w("div",ke,F(e.$t("emptyTableTitle")),1)):$("",!0)]),O(_e,{title:B.value},{default:S(()=>{var m,Q;return[A("form",{class:"company__form",onSubmit:Fe(me,["prevent"])},[(l(!0),w(H,null,R(ne.value,a=>{var h,v,b;return l(),z(he,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":I=>o.value[a.model]=I,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(h=n(s))==null?void 0:h[a.errorKey].$error,textError:(b=(v=n(s))==null?void 0:v[a.errorKey].$errors[0])==null?void 0:b.$message},{default:S(()=>[L(F(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(l(!0),w(H,null,R(re.value,a=>{var h,v,b,I,x;return l(),z(ve,{key:a.id,modelValue:o.value[a.model],"onUpdate:modelValue":fe=>o.value[a.model]=fe,width:500,options:a.options,error:(v=(h=n(s))==null?void 0:h[a==null?void 0:a.errorKey])==null?void 0:v.$error,textError:(x=(I=(b=n(s))==null?void 0:b[a==null?void 0:a.errorKey])==null?void 0:I.$errors[0])==null?void 0:x.$message,success:a.success,loading:a.loading,show:a==null?void 0:a.show,requestFlag:g.value},{default:S(()=>[L(F(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","textError","success","loading","show","requestFlag"])}),128)),O(be,{className:`form__submit ${(Q=(m=n(s))==null?void 0:m.districtId.$errors[0])!=null&&Q.$message?"centered":""}`},{default:S(()=>[L(F(e.$t("formButton")),1)]),_:1},8,["className"])],32)]}),_:1},8,["title"])])}}},Ae=Ie(Ee,[["__scopeId","data-v-045a5dc3"]]);export{Ae as default};
//# sourceMappingURL=companies-OnqADzYv.js.map
