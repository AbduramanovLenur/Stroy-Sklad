import{g as J,d as X}from"./crud.services-n7kB94wy.js";import{u as Y,a as Z,x as ee,y as M,b as te,c as se,r as B,z as ae,d as P,e as oe,k as q,h as e,A as L,i as n,t as ne,m as i,o as u,s as N,H as c}from"./index-6Y00dUwo.js";import{u as ie}from"./generic.services-DBqHHnAA.js";import{u as ue}from"./useQuery-4Ev4vRio.js";import{u as ce}from"./useMutation-ixZ1w3o_.js";import{r as re}from"./index-C_FfflJ0.js";const le={key:0,class:"estimate"},de={class:"estimate__inner"},me={key:2,class:"empty-table shadowed"},ge={__name:"index",async setup(_e){let a,_;const T=ie(),U=Y(),{t:H}=Z(),Q=ee(),{page:r,limit:l,search:R}=M(Q),x=te(),{user:s}=M(x),p=se(()=>{var t,m;return!!((m=(t=s==null?void 0:s.value.user)==null?void 0:t.modules)!=null&&m.includes(c.ESTIMATE.READ))}),S=B(""),b=re(R,500),z=B([{id:1,label:"estimateName",width:25},{id:2,label:"estimateObject",width:25},{id:3,label:"estimateAddress",width:20},{id:4,label:"estimatePrice",width:20}]),{data:o,isLoading:K,isSuccess:d,isError:V}=([a,_]=ae(()=>ue({queryKey:["budgets",{page:r,limit:l,debouncedSearch:b,organizationId:s.value.user.organizationId,name:s.value.user.fullName}],queryFn:()=>J("budget",r.value,l.value,b.value),enabled:p})),a=await a,_(),a),{mutate:F}=ce({mutationFn:t=>X("budget",t),onSuccess:t=>{t!=null&&t.success&&(T.invalidateQueries({queryKey:["budgets"]}),T.invalidateQueries({queryKey:["budgetById",S]}),setTimeout(()=>U.success(H("deleteToast")),150))}}),O=async t=>{S.value=t,F(t)};return(t,m)=>{var h,E,g,y,A,f,v,w,I,D,C,k;const j=i("HeadPage"),W=i("Table"),$=i("Pagination"),G=i("Spinner");return p.value?(u(),P("section",le,[oe("div",de,[q(j,{title:"estimateTitle",to:e(N).CREATE_ESTIMATE.path,isShowCreate:(g=(E=(h=e(s))==null?void 0:h.user)==null?void 0:E.modules)==null?void 0:g.includes(e(c).ESTIMATE.CREATE)},null,8,["to","isShowCreate"]),e(d)&&((y=e(o))!=null&&y.count)?(u(),L(W,{key:0,headers:z.value,table:(A=e(o))==null?void 0:A.budgets,to:e(N).UPDATE_ESTIMATE.name,options:{page:e(r),limit:e(l)},isShowUpdate:(w=(v=(f=e(s))==null?void 0:f.user)==null?void 0:v.modules)==null?void 0:w.includes(e(c).ESTIMATE.UPDATE),isShowDelete:(C=(D=(I=e(s))==null?void 0:I.user)==null?void 0:D.modules)==null?void 0:C.includes(e(c).ESTIMATE.DELETE),onOnActionDelete:O},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),q($,{count:(k=e(o))==null?void 0:k.count,isSucces:e(d)},null,8,["count","isSucces"]),e(K)?(u(),L(G,{key:1})):n("",!0),e(d)&&!e(o).count||e(V)?(u(),P("div",me,ne(t.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{ge as default};
