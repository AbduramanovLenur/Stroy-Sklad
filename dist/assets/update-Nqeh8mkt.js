import{u as te,a as se,b as oe,y as re,c as F,r as p,z as T,B as ue,d as $,e as E,k as L,h as u,w as ne,F as U,C as k,D as S,i as le,l as de,E as ie,m as h,o as m,s as P,A as M,f as b,t as K,G as ce}from"./index-jw_W6FAd.js";import{u as me,r as _}from"./i18n-validators-ft5uOkcD.js";import{a as ye,u as pe}from"./generic.services-QNpx3SIA.js";import{u as V}from"./useQuery-7GCzhTKE.js";import{a as he,u as _e}from"./crud.services-zWHC4qFT.js";import{k as fe,b as ge}from"./manual.services-6oDi3gTH.js";const ve={key:0,class:"manage section-height shadowed"},Ie={class:"manage__inner section-padding"},Ve={__name:"update",async setup(qe){let t,r;const f=ye(),w=de(),Q=ie();te(),se();const D=oe(),{user:g}=re(D),y=F(()=>{var a,I;return!!((I=(a=g==null?void 0:g.value.user)==null?void 0:a.modules)!=null&&I.includes(ce.PRODUCT.UPDATE))}),v=p(Q.params.id),s=p({id:"",fullname:"",quantityTypeId:[],stateId:[]}),N=F(()=>({id:{required:_},fullname:{required:_},quantityTypeId:{required:_},stateId:{required:_}})),o=me(N,s),{data:R,isSuccess:x,isLoading:H}=([t,r]=T(()=>V({queryKey:["types"],queryFn:()=>fe(),enabled:y})),t=await t,r(),t),{data:O,isSuccess:A,isLoading:G}=([t,r]=T(()=>V({queryKey:["states"],queryFn:()=>ge(),enabled:y})),t=await t,r(),t),z=p([{id:1,model:"fullname",label:"nameProductsLabel",placeholder:"nameProductsPlaceholder",icon:"pen",errorKey:"fullname"}]),W=p([{id:1,model:"quantityTypeId",label:"qunatityTypesProductsLabel",placeholder:"qunatityTypesProductsPlaceholder",errorKey:"quantityTypeId",options:R,success:x,loading:H},{id:2,model:"stateId",label:"stateProductsLabel",placeholder:"stateProductsPlaceholder",errorKey:"stateId",options:O,success:A,loading:G}]),{isError:j}=([t,r]=T(()=>V({queryKey:["productsById",v],queryFn:()=>he("construction_material",v.value),select:a=>{s.value.id=a.id,s.value.fullname=a.fullname,s.value.quantityTypeId=[a.quantityTypeId],s.value.stateId=[a.stateId]},enabled:y})),t=await t,r(),t);ue(j,a=>{a&&w.push(P.HOME.path)});const{mutate:J}=pe({onMutate:a=>{a.quantityTypeId=a.quantityTypeId[0],a.stateId=a.stateId[0]},mutationFn:a=>_e("construction_material",a),onSuccess:a=>{f.invalidateQueries({queryKey:["products"]}),f.invalidateQueries({queryKey:["productsById",v]}),f.invalidateQueries({queryKey:["materialsList"]}),w.push(P.PRODUCT.path)}}),X=async()=>{o.value.$validate(),!o.value.$errors.length&&(J(s.value),o.value.$reset())};return(a,I)=>{var C,B;const Y=h("ManageHead"),Z=h("FormInput"),ee=h("FormSelect"),ae=h("CustomButton");return y.value?(m(),$("section",ve,[E("div",Ie,[L(Y,{title:"editProductTitle",to:u(P).PRODUCT.path},null,8,["to"]),E("form",{class:"manage__form form-manage",onSubmit:ne(X,["prevent"])},[(m(!0),$(U,null,k(z.value,e=>{var n,l,d,i,c;return m(),M(Z,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":q=>s.value[e.model]=q,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(l=(n=u(o))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,textError:(c=(i=(d=u(o))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message},{default:S(()=>[b(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(m(!0),$(U,null,k(W.value,e=>{var n,l,d,i,c;return m(),M(ee,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":q=>s.value[e.model]=q,width:500,options:e.options,error:(l=(n=u(o))==null?void 0:n[e==null?void 0:e.errorKey])==null?void 0:l.$error,placeholder:e==null?void 0:e.placeholder,textError:(c=(i=(d=u(o))==null?void 0:d[e==null?void 0:e.errorKey])==null?void 0:i.$errors[0])==null?void 0:c.$message,success:e.success,loading:e.loading},{default:S(()=>[b(K(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),L(ae,{className:`form__submit ${(B=(C=u(o))==null?void 0:C.stateId.$errors[0])!=null&&B.$message?"centered":""}`},{default:S(()=>[b(K(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):le("",!0)}}};export{Ve as default};
