import{u as X,a as Y,x as Z,y as I,b as ee,c as se,r as q,z as te,d as B,e as oe,k as L,h as e,A as H,i as c,t as ae,m,o as d,s as Q,H as p}from"./index--ASsptNz.js";import{u as ne}from"./generic.services-OmFX1-7T.js";import{u as ue}from"./useQuery-aJZefqwx.js";import{u as le}from"./useMutation-KDcbY73c.js";import{g as re,d as ie}from"./crud.services-J6Vd6xLE.js";import{r as ce}from"./index-QW6gxCzp.js";const me={key:0,class:"employees"},de={class:"employees__inner section-padding"},pe={key:2,class:"empty-table shadowed"},Re={__name:"index",async setup(_e){let l,S;const E=ne(),x=X(),{t:z}=Y(),F=Z(),{page:_,limit:y,search:K}=I(F),M=ee(),{user:t}=I(M),b=se(()=>{var s,o;return!!((o=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)!=null&&o.includes(p.ORG_USER.READ))}),g=q(""),R=ce(K,500),V=q([{id:1,label:"employeesFullName",width:30},{id:3,label:"employeesPhone",width:25},{id:4,label:"employeesRole",width:20}]),{data:r,isLoading:W,isSuccess:h,isError:$}=([l,S]=te(()=>{var s,o;return ue({queryKey:["orgUsers",{page:_,limit:y,debouncedSearch:R,organizationId:(o=(s=t.value)==null?void 0:s.user)==null?void 0:o.organizationId,name:t.value.user.fullName}],queryFn:()=>re("user",_.value,y.value,R.value),select:a=>{let i={...a};return i.users=a==null?void 0:a.users.map(n=>{const u={...n,phone:n.phoneNumber,name:n.fullName};return delete u.fullName,delete u.phoneNumber,u}),i},enabled:b})}),l=await l,S(),l),{mutate:j}=le({mutationFn:s=>ie("user",s),onSuccess:s=>{s!=null&&s.success&&(E.invalidateQueries({queryKey:["orgUsers"]}),E.invalidateQueries({queryKey:["orgUserById",g]}),setTimeout(()=>x.success(z("deleteToast")),150))}}),J=s=>{g.value=s,j(s)};return(s,o)=>{var f,T,v,U,w,C,D,N,k,A,O,P,G;const a=m("HeadPage"),i=m("Table"),n=m("Pagination"),u=m("Spinner");return b.value?(d(),B("section",me,[oe("div",de,[L(a,{title:"employeesTitle",to:e(Q).CREATE_ORG_USER.path,isShowCreate:(v=(T=(f=e(t))==null?void 0:f.user)==null?void 0:T.modules)==null?void 0:v.includes(e(p).ORG_USER.CREATE)},null,8,["to","isShowCreate"]),e(h)&&((U=e(r))!=null&&U.count)?(d(),H(i,{key:0,headers:V.value,table:(w=e(r))==null?void 0:w.users,to:e(Q).UPDATE_ORG_USER.name,options:{page:e(_),limit:e(y)},isShowUpdate:(N=(D=(C=e(t))==null?void 0:C.user)==null?void 0:D.modules)==null?void 0:N.includes(e(p).ORG_USER.UPDATE),isShowDelete:(O=(A=(k=e(t))==null?void 0:k.user)==null?void 0:A.modules)==null?void 0:O.includes(e(p).ORG_USER.DELETE),onOnActionDelete:J},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):c("",!0),L(n,{count:(P=e(r))==null?void 0:P.count,isSucces:e(h)},null,8,["count","isSucces"]),e(W)?(d(),H(u,{key:1})):c("",!0),e(h)&&!((G=e(r))!=null&&G.count)||e($)?(d(),B("div",pe,ae(s.$t("emptyTableTitle")),1)):c("",!0)])])):c("",!0)}}};export{Re as default};
