import{_ as Oe,u as qe,a as je,r as c,b as Pe,x as Te,c as u,y as r,B as W,d as h,e as F,k as Ke,h as i,w as Ne,F as V,C as O,z as p,i as v,D as _,l as Re,E as Ee,m as g,o as n,A as w,f as k,t as f,ae as ze,G as q,I as j}from"./index-FhX-5zgX.js";import{a as Ue,u as x}from"./generic.services-shCmd6Kx.js";import{u as m}from"./useQuery-F-m0HCTz.js";import{a as De,b as $e,e as Ge}from"./crud.services--J3Fp5qL.js";import{e as Qe,f as He,g as We,h as xe,i as Je,j as Xe}from"./manual.services-VeWEuMUr.js";const Ye={key:0,class:"manage section-height shadowed"},Ze={class:"manage__inner section-padding"},ea={class:"manage__overlay"},aa={key:2,class:"manage__triggers"},oa={__name:"view",async setup(la){let o,t;const L=Ue(),C=Re(),J=Ee();qe(),je();const b=c(J.params.id),X=Pe(),{user:d}=Te(X),S=u(()=>{var e,s;return!!((s=(e=d==null?void 0:d.value.user)==null?void 0:e.modules)!=null&&s.includes(q.APPLICATION.READ))}),y=c([]),Y=c([{id:1,label:"appFloor",width:215},{id:2,label:"appMaterial",width:290},{id:3,label:"appCount",width:250},{id:4,label:"appPrice",width:300},{id:5,label:"appCost"}]),l=c({id:"",deadline:"",buildingObjectId:[],buildingBlockId:[],roleIds:[],applicationTables:[],details:"",statusId:""}),{data:Z,isSuccess:ee,isLoading:ae}=([o,t]=r(()=>m({queryKey:["rolesList",{organizationId:d.value.user.organizationId}],queryFn:()=>Qe(),enabled:S})),o=await o,t(),o),{data:oe,isSuccess:le,isLoading:se}=([o,t]=r(()=>m({queryKey:["objectsList",{organizationId:d.value.user.organizationId}],queryFn:()=>He(),enabled:S})),o=await o,t(),o),A=u(()=>l.value.buildingObjectId),te=u(()=>!!A.value.length),{data:ie,isSuccess:ne,isLoading:de}=([o,t]=r(()=>m({queryKey:["blocksList",{blockId:A}],queryFn:()=>Je(A.value),enabled:te})),o=await o,t(),o),M=u(()=>l.value.buildingBlockId),B=u(()=>!!M.value.length),{data:ue,isSuccess:P,isLoading:ce}=([o,t]=r(()=>m({queryKey:["floorsList",{floorId:M}],queryFn:()=>Xe(M.value),enabled:B})),o=await o,t(),o),{data:re,isSuccess:T,isLoading:pe}=([o,t]=r(()=>m({queryKey:["costsList",{organizationId:d.value.user.organizationId}],queryFn:()=>We(),enabled:B})),o=await o,t(),o),{data:me,isSuccess:K,isLoading:be}=([o,t]=r(()=>m({queryKey:["materialsList",{organizationId:d.value.user.organizationId}],queryFn:()=>xe(),enabled:B})),o=await o,t(),o),ve=c([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),ge=c([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:oe,success:le,loading:se},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:ie,success:ne,loading:de},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:Z,success:ee,loading:ae,multiple:!0}]),ye=c([{id:1,model:"details",label:"appCommentLabel",placeholder:"appCommentPlaceholder",errorKey:"details"}]),{isError:Ie}=([o,t]=r(()=>m({queryKey:["applicationsById",b],queryFn:()=>De("application",b.value),select:e=>{l.value.id=e.id,l.value.deadline=e.deadline,l.value.buildingObjectId=[e.buildingObjectId],l.value.buildingBlockId=[e.buildingBlockId],l.value.roleIds=[...e.roleIds],l.value.applicationTables=[...e.applicationTables],l.value.details=e.details,l.value.statusId=e.statusId},enabled:S})),o=await o,t(),o),N=u(()=>j(ue.value||[])),R=u(()=>j(re.value||[])),E=u(()=>j(me.value||[])),he=e=>{var s;return(s=N.value[e.floorId])==null?void 0:s.name},_e=e=>{var s;return(s=R.value[e.costId])==null?void 0:s.name},ke=e=>{var s;return(s=E.value[e==null?void 0:e.constructionMaterialId])==null?void 0:s.name},fe=u(()=>Object.keys(N.value).length&&Object.keys(R.value).length&&Object.keys(E.value).length);W(fe,e=>{e&&(l.value.applicationTables.forEach(s=>{y.value.push({floorValue:he(s),costValue:_e(s),constructionMaterialValue:ke(s),count:s.count,price:s.price})}),console.log(l.value.applicationTables),console.log(y.value))},{immediate:!0}),W(Ie,e=>{e&&C.push(w.HOME.path)});const{mutate:Le}=x({mutationFn:e=>$e("application",e),onSuccess:()=>{L.invalidateQueries({queryKey:["applications"]}),L.invalidateQueries({queryKey:["applicationsById",b]}),C.push(w.APPLICATION.path)}}),{mutate:Se}=x({mutationFn:e=>Ge("application",e),onSuccess:()=>{L.invalidateQueries({queryKey:["applications"]}),L.invalidateQueries({queryKey:["applicationsById",b]}),C.push(w.APPLICATION.path)}}),we=()=>{Le(b.value)},Ce=()=>{Se(b.value)};return(e,s)=>{var U,D,$,G,Q,H;const Ae=g("ManageHead"),Me=g("FormInput"),Be=g("FormSelect"),Fe=g("SubTable"),Ve=g("Spinner"),z=g("MyButton");return S.value?(n(),h("section",Ye,[F("div",Ze,[Ke(Ae,{title:"addNewApplicationTitle",to:i(w).APPLICATION.path},null,8,["to"]),F("form",{class:"manage__form",onSubmit:s[0]||(s[0]=Ne(()=>{},["prevent"]))},[F("div",ea,[(n(!0),h(V,null,O(ve.value,a=>(n(),p(Me,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":I=>l.value[a.model]=I,width:500,placeholder:e.$t(a.placeholder),name:a.icon,type:a==null?void 0:a.type,isDisabled:!0},{default:_(()=>[k(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),(n(!0),h(V,null,O(ge.value,a=>(n(),p(Be,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":I=>l.value[a.model]=I,width:500,options:a.options,placeholder:a==null?void 0:a.placeholder,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple,isDisabled:!0},{default:_(()=>[k(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128))]),i(T)&&i(K)&&i(P)&&y.value?(n(),p(Fe,{key:0,headers:Y.value,table:y.value},null,8,["headers","table"])):v("",!0),i(pe)||i(be)||i(ce)||!y.value.length?(n(),p(Ve,{key:1})):v("",!0),(n(!0),h(V,null,O(ye.value,a=>(n(),p(ze,{key:a.id,modelValue:l.value[a.model],"onUpdate:modelValue":I=>l.value[a.model]=I,width:500,placeholder:e.$t(a.placeholder),isDisabled:!0},{default:_(()=>[k(f(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]))),128)),i(T)&&i(K)&&i(P)&&l.value.statusId!==7&&l.value.statusId!==15?(n(),h("div",aa,[($=(D=(U=i(d))==null?void 0:U.user)==null?void 0:D.modules)!=null&&$.includes(i(q).APPLICATION.CONFIRM)?(n(),p(z,{key:0,icon:"approve",type:"submit",color:"green",width:180,onClick:Ce},{default:_(()=>[k(f(e.$t("acceptButton")),1)]),_:1})):v("",!0),(H=(Q=(G=i(d))==null?void 0:G.user)==null?void 0:Q.modules)!=null&&H.includes(i(q).APPLICATION.REFUSAL)?(n(),p(z,{key:1,icon:"refusal",type:"submit",color:"red",width:180,onClick:we},{default:_(()=>[k(f(e.$t("cancelButton")),1)]),_:1})):v("",!0)])):v("",!0)],32)])])):v("",!0)}}},ua=Oe(oa,[["__scopeId","data-v-3897e6a1"]]);export{ua as default};
//# sourceMappingURL=view-4W4z-SXW.js.map
