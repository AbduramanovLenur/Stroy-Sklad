import{u as ie,a as le,b as de,y as me,c as i,r as h,z as M,B as pe,d as b,e as N,k as R,h as o,w as ge,F as D,C as he,D as _,i as v,l as be,m as l,o as n,s as x,A as U,f as y,t as I,H as _e,E as ve}from"./index-qYaOSAk5.js";import{u as ye,r as d}from"./i18n-validators-FA-njMbI.js";import{a as Ie,u as $e}from"./generic.services-uSp9rJcx.js";import{u as H}from"./useQuery-3KlBkAoQ.js";import{c as Se}from"./crud.services-6H1cbtzh.js";import{m as Ce,a as Ve}from"./manual.services-e5QN_9-o.js";const je={key:0,class:"manage section-height shadowed"},we={class:"manage__inner section-padding"},ke={__name:"create",async setup(Ee){let a,c;const $=Ie(),P=be(),Q=ie(),{t:A}=le(),J=de(),{user:m}=me(J),S=i(()=>{var t,p;return!!((p=(t=m==null?void 0:m.value.user)==null?void 0:t.modules)!=null&&p.includes(_e.OBJECT.CREATE))}),C=h(!1),s=h({name:"",address:"",regionId:[],districtId:[]}),G=i(()=>({name:{required:d},address:{required:d},regionId:{required:d},districtId:{required:d}})),r=ye(G,s),{data:z,isSuccess:W,isLoading:X}=([a,c]=M(()=>H({queryKey:["regions"],queryFn:()=>Ce(),enabled:S})),a=await a,c(),a),u=i(()=>s.value.regionId[0]),Y=i(()=>!!u.value);pe(u,()=>{C.value||(s.value.districtId=[])},{immediate:!0});const{data:Z,isSuccess:f,isLoading:ee}=([a,c]=M(()=>H({queryKey:["districts",{districtId:u}],queryFn:()=>Ve(u.value),enabled:Y})),a=await a,c(),a),te=h([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"},{id:3,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:z,success:W,loading:X,select:!0},{id:4,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:Z,success:f,loading:ee,select:!0}]),{mutate:se,status:ae}=$e({onMutate:t=>{C.value=!0,t.regionId=t.regionId[0],t.districtId=t.districtId[0]},mutationFn:t=>Se("building_object",t),onSuccess:t=>{t!=null&&t.success&&(s.value=ve(s.value),$.invalidateQueries({queryKey:["objects"]}),$.invalidateQueries({queryKey:["objectsList"]}),P.push(x.OBJECT.path),setTimeout(()=>Q.success(A("createToast")),150))}}),re=()=>{if(r.value.$validate(),r.value.$errors.length)return;const t={...s.value};se(t),r.value.$reset()};return(t,p)=>{var V,j;const oe=l("ManageHead"),ne=l("FormInput"),ce=l("FormSelect"),ue=l("CustomButton");return S.value?(n(),b("section",je,[N("div",we,[R(oe,{title:"addNewObjectTitle",to:o(x).OBJECT.path},null,8,["to"]),N("form",{class:"manage__form form-manage",onSubmit:ge(re,["prevent"])},[(n(!0),b(D,null,he(te.value,e=>{var w,E,K,O,B,L,T,F,k,q;return n(),b(D,{key:e.id},[e!=null&&e.select?v("",!0):(n(),U(ne,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":g=>s.value[e.model]=g,width:500,placeholder:t.$t(e.placeholder),name:e.icon,error:(E=(w=o(r))==null?void 0:w[e.errorKey])==null?void 0:E.$error,textError:(B=(O=(K=o(r))==null?void 0:K[e.errorKey])==null?void 0:O.$errors[0])==null?void 0:B.$message},{default:_(()=>[y(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(n(),U(ce,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":g=>s.value[e.model]=g,modelModifiers:{trim:!0},width:500,options:e.options,error:(T=(L=o(r))==null?void 0:L[e==null?void 0:e.errorKey])==null?void 0:T.$error,placeholder:e==null?void 0:e.placeholder,textError:(q=(k=(F=o(r))==null?void 0:F[e==null?void 0:e.errorKey])==null?void 0:k.$errors[0])==null?void 0:q.$message,success:e.success,loading:e.loading},{default:_(()=>[y(I(t.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):v("",!0)],64)}),128)),R(ue,{className:`form__submit ${(j=(V=o(r))==null?void 0:V.districtId.$errors[0])!=null&&j.$message?"centered":""}`,disabled:o(ae)==="pending"},{default:_(()=>[y(I(t.$t("formButton")),1)]),_:1},8,["className","disabled"])],32)])])):v("",!0)}}};export{ke as default};
