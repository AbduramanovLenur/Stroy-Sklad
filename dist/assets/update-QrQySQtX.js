import{u as le,a as ce,r as y,b as me,y as ie,c as A,z as _,B as de,d as g,e as N,k as R,h as u,w as pe,F as x,C as he,D as I,i as v,l as ye,G as _e,m,o as n,s as S,A as P,f as q,t as w,H as ge,E as Ie}from"./index-Znn7x0w2.js";import{a as ve,u as Se}from"./crud.services-oovoAPUX.js";import{j as qe,b as we}from"./manual.services-CtkFg6uR.js";import{u as $e,r as i}from"./i18n-validators-IvsyUnkI.js";import{a as Ee,u as be}from"./generic.services-CuHvXiDr.js";import{u as $}from"./useQuery-n34yz_OD.js";const Ve={key:0,class:"manage section-height shadowed"},Ke={class:"manage__inner section-padding"},ke={__name:"update",async setup(Me){let t,o;const E=Ee(),b=ye(),D=_e(),O=le(),{t:Q}=ce(),d=y(D.params.id),z=me(),{user:l}=ie(z),c=A(()=>{var a,p;return!!((p=(a=l==null?void 0:l.value.user)==null?void 0:a.modules)!=null&&p.includes(ge.WAREHOUSE.UPDATE))}),s=y({id:"",materialId:[],quantity:"",stateId:[]}),G=A(()=>({id:{required:i},materialId:{required:i},quantity:{required:i},stateId:{required:i}})),r=$e(G,s),{data:j,isSuccess:J,isLoading:X}=([t,o]=_(()=>$({queryKey:["materialsList",{organizationId:l.value.user.organizationId}],queryFn:()=>qe(),enabled:c})),t=await t,o(),t),{data:Y,isSuccess:Z,isLoading:f}=([t,o]=_(()=>$({queryKey:["states"],queryFn:()=>we(),enabled:c})),t=await t,o(),t),ee=y([{id:1,model:"materialId",label:"materialsWarehouseLabel",placeholder:"materialsWarehousePlaceholder",errorKey:"materialId",options:j,success:J,loading:X,select:!0},{id:2,model:"quantity",label:"quantityWarehouseLabel",placeholder:"quantityWarehousePlaceholder",icon:"list",errorKey:"quantity"},{id:3,model:"stateId",label:"stateWarehouseLabel",placeholder:"stateWarehousePlaceholder",errorKey:"stateId",options:Y,success:Z,loading:f,select:!0}]),{isError:ae}=([t,o]=_(()=>$({queryKey:["warehouseById",d],queryFn:()=>ve("warehouse",d.value),select:a=>{s.value.id=a.id,s.value.materialId=[a.materialId],s.value.quantity=a.quantity,s.value.stateId=[a.stateId]},enabled:c})),t=await t,o(),t);de(ae,a=>{a&&b.push(S.HOME.path)});const{mutate:te}=be({onMutate:a=>{a.materialId=a.materialId[0],a.stateId=a.stateId[0]},mutationFn:a=>Se("warehouse",a),onSuccess:a=>{a!=null&&a.success&&(s.value=Ie(s.value),E.invalidateQueries({queryKey:["warehouse"]}),E.invalidateQueries({queryKey:["warehouseById",d]}),b.push(S.WAREHOUSE.path),setTimeout(()=>O.success(Q("updateToast")),150))}}),se=async()=>{if(r.value.$validate(),r.value.$errors.length)return;const a={...s.value};te(a),r.value.$reset()};return(a,p)=>{var V,K;const re=m("ManageHead"),oe=m("FormInput"),ue=m("FormSelect"),ne=m("CustomButton");return c.value?(n(),g("section",Ve,[N("div",Ke,[R(re,{title:"editProductTitle",to:u(S).WAREHOUSE.path},null,8,["to"]),N("form",{class:"manage__form form-manage",onSubmit:pe(se,["prevent"])},[(n(!0),g(x,null,he(ee.value,e=>{var M,B,C,F,W,L,U,k,H,T;return n(),g(x,{key:e.id},[e!=null&&e.select?v("",!0):(n(),P(oe,{key:0,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(B=(M=u(r))==null?void 0:M[e==null?void 0:e.errorKey])==null?void 0:B.$error,textError:(W=(F=(C=u(r))==null?void 0:C[e==null?void 0:e.errorKey])==null?void 0:F.$errors[0])==null?void 0:W.$message},{default:I(()=>[q(w(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])),e!=null&&e.select?(n(),P(ue,{key:1,modelValue:s.value[e.model],"onUpdate:modelValue":h=>s.value[e.model]=h,modelModifiers:{trim:!0},width:500,options:e.options,error:(U=(L=u(r))==null?void 0:L[e==null?void 0:e.errorKey])==null?void 0:U.$error,placeholder:e==null?void 0:e.placeholder,textError:(T=(H=(k=u(r))==null?void 0:k[e==null?void 0:e.errorKey])==null?void 0:H.$errors[0])==null?void 0:T.$message,success:e.success,loading:e.loading},{default:I(()=>[q(w(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])):v("",!0)],64)}),128)),R(ne,{className:`form__submit ${(K=(V=u(r))==null?void 0:V.stateId.$errors[0])!=null&&K.$message?"centered":""}`},{default:I(()=>[q(w(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):v("",!0)}}};export{ke as default};
