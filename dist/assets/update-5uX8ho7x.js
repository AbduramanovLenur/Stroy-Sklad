import{u as de,a as ue,q as ce,r as n,z as y,c as z,y as F,d as N,e as V,k as B,h as l,w as me,F as E,C as M,D as O,l as ge,E as pe,m as I,o as p,B as S,A as k,f as K,t as $}from"./index-qZ69CyC7.js";import{u as he,r as s}from"./i18n-validators-dGSGbQKY.js";import{a as ye,u as Ie}from"./generic.services-34GP1Yc8.js";import{u as v}from"./useQuery-IZNqF3Xo.js";import{a as ve,u as fe}from"./crud.services-qYEmjzHd.js";import{m as _e,a as be,b as ze}from"./manual.services-BxKPmsPu.js";const Ne={class:"manage section-height shadowed"},Oe={class:"manage__inner section-padding"},Fe={__name:"update",async setup(Se){let o,t;const L=ye(),w=ge(),R=pe();de(),ue();const x=ce(),{setPagePagination:D,setLimitPagination:A}=x,f=n(R.params.id),q=n(!1),_=n(!1),r=n({id:"",fullName:"",inn:"",address:"",phoneNumber:"",director:"",regionId:[],districtId:[],stateId:[]}),{data:H,isSuccess:Q,isLoading:T}=([o,t]=y(()=>v({queryKey:["regions"],queryFn:()=>_e()})),o=await o,t(),o),h=z(()=>r.value.regionId),U=z(()=>!!h.value.length);F(h,()=>{!_.value&&!q.value&&(r.value.districtId=[]),_.value=!1},{immediate:!0});const{data:G,isSuccess:W,isLoading:j}=([o,t]=y(()=>v({queryKey:["districts",{districtId:h}],queryFn:()=>be(h.value),enabled:U})),o=await o,t(),o),{data:J,isSuccess:X,isLoading:Y}=([o,t]=y(()=>v({queryKey:["states"],queryFn:()=>ze()})),o=await o,t(),o),Z=z(()=>({id:{required:s},fullName:{required:s},inn:{required:s},address:{required:s},phoneNumber:{required:s},director:{required:s},regionId:{required:s},districtId:{required:s},stateId:{required:s}})),i=he(Z,r),ee=n([{id:1,model:"fullName",label:"nameOrganizationLabel",placeholder:"nameOrganizationPlaceholder",icon:"input-company",errorKey:"fullName"},{id:2,model:"inn",label:"innOrganizationLabel",placeholder:"innOrganizationPlaceholder",icon:"tin",errorKey:"inn"},{id:3,model:"address",label:"addressOrganizationLabel",placeholder:"addressOrganizationPlaceholder",icon:"address",errorKey:"address"},{id:4,model:"phoneNumber",label:"phoneOrganizationLabel",placeholder:"phoneOrganizationPlaceholder",icon:"phone",errorKey:"phoneNumber"},{id:5,model:"director",label:"directorOrganizationLabel",placeholder:"directorOrganizationPlaceholder",icon:"person",errorKey:"director"}]),ae=n([{id:1,model:"regionId",label:"regionOrganizationLabel",placeholder:"regionOrganizationPlaceholder",errorKey:"regionId",options:H,success:Q,loading:T},{id:2,model:"districtId",label:"districtOrganizationLabel",placeholder:"districtOrganizationPlaceholder",errorKey:"districtId",options:G,success:W,loading:j},{id:3,model:"stateId",label:"stateOrganizationLabel",placeholder:"stateOrganizationPlaceholder",errorKey:"stateId",options:J,success:X,loading:Y}]),{isError:re}=([o,t]=y(()=>v({queryKey:["companiesById",f],queryFn:()=>ve("organization",f.value),select:e=>{r.value.id=e.id,r.value.fullName=e.fullName,r.value.inn=e.inn,r.value.address=e.address,r.value.phoneNumber=e.phoneNumber,r.value.director=e.director,r.value.regionId=[e==null?void 0:e.regionId],r.value.districtId=[e==null?void 0:e.districtId],r.value.stateId=[e==null?void 0:e.stateId],_.value=!0}})),o=await o,t(),o);F(re,e=>{e&&w.push(S.HOME.path)});const{mutate:oe}=Ie({onMutate:e=>{q.value=!0,e.regionId=e.regionId[0],e.districtId=e.districtId[0],e.stateId=e.stateId[0]},mutationFn:e=>fe("organization",e),onSuccess:async()=>{await L.invalidateQueries({queryKey:["companies"]}),await L.invalidateQueries({queryKey:["companiesById",f]}),D(1),A(10),w.push(S.COMPANIES.path)}}),se=async()=>{i.value.$validate(),!i.value.$errors.length&&(oe(r.value),i.value.$reset())};return(e,Ke)=>{var P,C;const te=I("ManageHead"),ie=I("FormInput"),ne=I("FormSelect"),le=I("CustomButton");return p(),N("section",Ne,[V("div",Oe,[B(te,{title:"editCompanyTitle",to:l(S).COMPANIES.path},null,8,["to"]),V("form",{class:"manage__form form-manage",onSubmit:me(se,["prevent"])},[(p(!0),N(E,null,M(ee.value,a=>{var d,u,c,m,g;return p(),k(ie,{key:a.id,modelValue:r.value[a.model],"onUpdate:modelValue":b=>r.value[a.model]=b,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(u=(d=l(i))==null?void 0:d[a==null?void 0:a.errorKey])==null?void 0:u.$error,textError:(g=(m=(c=l(i))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message},{default:O(()=>[K($(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(p(!0),N(E,null,M(ae.value,a=>{var d,u,c,m,g;return p(),k(ne,{key:a.id,modelValue:r.value[a.model],"onUpdate:modelValue":b=>r.value[a.model]=b,width:500,options:a.options,error:(u=(d=l(i))==null?void 0:d[a==null?void 0:a.errorKey])==null?void 0:u.$error,placeholder:a==null?void 0:a.placeholder,textError:(g=(m=(c=l(i))==null?void 0:c[a==null?void 0:a.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message,success:a.success,loading:a.loading},{default:O(()=>[K($(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),B(le,{className:`form__submit ${(C=(P=l(i))==null?void 0:P.stateId.$errors[0])!=null&&C.$message?"centered":""}`},{default:O(()=>[K($(e.$t("formButton")),1)]),_:1},8,["className"])],32)])])}}};export{Fe as default};
//# sourceMappingURL=update-5uX8ho7x.js.map
