import{u as X,a as Y,x as Z,y as O,b as ee,c as se,r as q,z as te,d as I,e as oe,k as P,h as e,A as B,i as n,t as ae,m as r,o as i,s as N,H as l}from"./index-pfgEwabb.js";import{a as ne,u as re}from"./generic.services-pFsvETxq.js";import{u as ie}from"./useQuery-MTkSqSbf.js";import{g as le,d as ue}from"./crud.services-dRS2qKm6.js";import{r as ce}from"./index-jaF3u23u.js";const de={key:0,class:"roles"},me={class:"roles__inner section-padding"},_e={key:2,class:"empty-table shadowed"},Te={__name:"index",async setup(pe){let o,p;const u=ne(),Q=X(),{t:U}=Y(),H=Z(),{page:c,limit:d,search:K}=O(H),x=ee(),{user:t}=O(x),y=se(()=>{var s,_;return!!((_=(s=t==null?void 0:t.value.user)==null?void 0:s.modules)!=null&&_.includes(l.ROLE.READ))}),h=q(""),S=ce(K,500),z=q([{id:1,label:"rolesName",width:70}]),{data:a,isLoading:V,isSuccess:m,isError:F}=([o,p]=te(()=>ie({queryKey:["roles",{page:c,limit:d,debouncedSearch:S,organizationId:t.value.user.organizationId,name:t.value.user.fullName}],queryFn:()=>le("Role",c.value,d.value,S.value),enabled:y})),o=await o,p(),o),{mutate:M}=re({mutationFn:s=>ue("Role",s),onSuccess:s=>{s!=null&&s.success&&(u.invalidateQueries({queryKey:["roles"]}),u.invalidateQueries({queryKey:["rolesById",h]}),u.invalidateQueries({queryKey:["rolesList"]}),setTimeout(()=>Q.success(U("deleteToast")),150))}}),W=async s=>{h.value=s,M(s)};return(s,_)=>{var E,v,T,g,R,b,f,L,w,D,C,k,A;const $=r("HeadPage"),j=r("Table"),G=r("Pagination"),J=r("Spinner");return y.value?(i(),I("section",de,[oe("div",me,[P($,{title:"rolesTitle",to:e(N).CREATE_ROLE.path,isShowCreate:(T=(v=(E=e(t))==null?void 0:E.user)==null?void 0:v.modules)==null?void 0:T.includes(e(l).ROLE.CREATE)},null,8,["to","isShowCreate"]),e(m)&&((g=e(a))!=null&&g.count)?(i(),B(j,{key:0,headers:z.value,table:(R=e(a))==null?void 0:R.roles,to:e(N).UPDATE_ROLE.name,options:{page:e(c),limit:e(d)},isShowUpdate:(L=(f=(b=e(t))==null?void 0:b.user)==null?void 0:f.modules)==null?void 0:L.includes(e(l).ROLE.UPDATE),isShowDelete:(C=(D=(w=e(t))==null?void 0:w.user)==null?void 0:D.modules)==null?void 0:C.includes(e(l).ROLE.DELETE),onOnActionDelete:W},null,8,["headers","table","to","options","isShowUpdate","isShowDelete"])):n("",!0),P(G,{count:(k=e(a))==null?void 0:k.count,isSucces:e(m)},null,8,["count","isSucces"]),e(V)?(i(),B(J,{key:1})):n("",!0),e(m)&&!((A=e(a))!=null&&A.count)||e(F)?(i(),I("div",_e,ae(s.$t("emptyTableTitle")),1)):n("",!0)])])):n("",!0)}}};export{Te as default};
