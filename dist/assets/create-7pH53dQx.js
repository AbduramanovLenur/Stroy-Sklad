import{_ as me,u as be,a as ve,r as g,c as u,B as ge,m,o as d,d as h,e as T,t as b,F as w,C as E,A as O,D as I,f as _,k as f,K as ze,q as De,b as He,y as xe,z as M,h as p,w as Ge,i as ue,l as Qe,s as pe,H as Re,J as G,E as Je}from"./index-4OOvqjps.js";import{u as We,r as B}from"./i18n-validators-S6ZLWYVi.js";import{a as Xe,u as Ye}from"./generic.services-cM7RLDwf.js";import{u as F}from"./useQuery-k2tfLaah.js";import{c as Ze}from"./crud.services-NECAoUBm.js";import{f as ea,g as aa,h as oa,i as la,j as ta}from"./manual.services-SGmJYzSL.js";import{v as sa}from"./v4-yQnnJER4.js";const ra={class:"application-form"},ia={class:"application-form__title"},na={class:"application-form__overlay form-manage"},da={__name:"ApplicationForm",props:["selects","buildingBlockId","isSubmit"],emits:["onAddTable"],setup(P,{emit:l}){const n=be(),{t:q}=ve(),K=P,j=l,r=g({floorId:[],costId:[],constructionMaterialId:[],count:""}),N=u(()=>K.buildingBlockId);ge(N,()=>{r.value.floorId=[]});const v=g([{id:1,model:"count",label:"countAppLabel",placeholder:"countAppPlaceholder",icon:"list"}]),L=()=>{if(!ze(r.value)){n.error(q("isEmptyModal"));return}r.value={floorId:r.value.floorId[0],costId:r.value.costId[0],constructionMaterialId:r.value.constructionMaterialId[0],count:r.value.count,price:r.value.price},j("onAddTable",r.value),r.value=De(r.value)};return(c,Q)=>{const t=m("FormSelect"),U=m("FormInput"),i=m("CustomButton");return d(),h("div",ra,[T("h4",ia,b(c.$t("appInfo")),1),T("div",na,[(d(!0),h(w,null,E(P.selects,o=>(d(),O(t,{key:o.id,modelValue:r.value[o.model],"onUpdate:modelValue":y=>r.value[o.model]=y,modelModifiers:{trim:!0},width:500,options:o.options,placeholder:o==null?void 0:o.placeholder,success:o.success,loading:o.loading,isMultiSelect:o==null?void 0:o.multiple},{default:I(()=>[_(b(c.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","placeholder","success","loading","isMultiSelect"]))),128)),(d(!0),h(w,null,E(v.value,o=>(d(),O(U,{key:o.id,modelValue:r.value[o.model],"onUpdate:modelValue":y=>r.value[o.model]=y,width:500,placeholder:c.$t(o.placeholder),name:o.icon,type:o==null?void 0:o.type},{default:I(()=>[_(b(c.$t(o.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","type"]))),128)),f(i,{className:"form__submit",type:"button",onClick:L},{default:I(()=>[_(b(c.$t("addButtonForm")),1)]),_:1})])])}}},ca=me(da,[["__scopeId","data-v-74869bfc"]]),ua={key:0,class:"manage section-height shadowed"},pa={class:"manage__inner section-padding"},ma={class:"manage__overlay"},ba={key:0,class:"error"},va={__name:"create",async setup(P){let l,n;const q=Xe(),K=Qe(),j=be(),{t:r}=ve(),N=He(),{user:v}=xe(N),L=u(()=>{var e,s;return!!((s=(e=v==null?void 0:v.value.user)==null?void 0:e.modules)!=null&&s.includes(Re.APPLICATION.CREATE))}),c=g(!1),Q=g([{id:1,label:"appFloor",width:15},{id:2,label:"appMaterial",width:30},{id:3,label:"appCount",width:15},{id:4,label:"appPrice",width:20}]),t=g({deadline:"",buildingObjectId:[],buildingBlockId:[],createApplicationTables:[],details:""}),U=u(()=>({deadline:{required:B},buildingObjectId:{required:B},buildingBlockId:{required:B},createApplicationTables:{required:B},details:{required:B}})),i=We(U,t),{data:o,isSuccess:y,isLoading:he}=([l,n]=M(()=>F({queryKey:["objectsList",{organizationId:v.value.user.organizationId}],queryFn:()=>ea(),enabled:L})),l=await l,n(),l),C=u(()=>t.value.buildingObjectId),Ie=u(()=>!!C.value.length);ge(C,()=>{c.value||(t.value.buildingBlockId=[])},{immediate:!0});const{data:_e,isSuccess:fe,isLoading:ye}=([l,n]=M(()=>F({queryKey:["blocksList",{blockId:C}],queryFn:()=>la(C.value),enabled:Ie})),l=await l,n(),l),z=u(()=>t.value.buildingBlockId),D=u(()=>!!z.value.length),{data:R,isSuccess:Ae,isLoading:ke}=([l,n]=M(()=>F({queryKey:["floorsList",{floorId:z}],queryFn:()=>ta(z.value),enabled:D})),l=await l,n(),l),{data:J,isSuccess:Ve,isLoading:Se}=([l,n]=M(()=>F({queryKey:["costsList",{organizationId:v.value.user.organizationId}],queryFn:()=>aa(),enabled:D})),l=await l,n(),l),{data:W,isSuccess:$e,isLoading:Me}=([l,n]=M(()=>F({queryKey:["materialsList",{organizationId:v.value.user.organizationId}],queryFn:()=>oa(),enabled:D})),l=await l,n(),l),Be=g([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),Fe=g([{id:1,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:o,success:y,loading:he},{id:2,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:_e,success:fe,loading:ye}]),Te=g([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",options:R,success:Ae,loading:ke},{id:2,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",options:J,success:Ve,loading:Se},{id:3,model:"constructionMaterialId",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",options:W,success:$e,loading:Me}]),Le=u(()=>G(R.value)),Ce=u(()=>G(J.value)),we=u(()=>G(W.value)),Ee=e=>{var s;return(s=Le.value[e.floorId])==null?void 0:s.name},Oe=e=>{var s;return(s=Ce.value[e.costId])==null?void 0:s.name},Pe=e=>{var s;return(s=we.value[e==null?void 0:e.constructionMaterialId])==null?void 0:s.name},qe=e=>{t.value.createApplicationTables.push({...e,delId:sa(),floorValue:Ee(e),costValue:Oe(e),constructionMaterialValue:Pe(e)})},Ke=e=>{t.value.createApplicationTables=t.value.createApplicationTables.filter(s=>s.delId!==e)},{mutate:je}=Ye({onMutate:e=>{c.value=!0,e.buildingObjectId=e.buildingObjectId[0],e.buildingBlockId=e.buildingBlockId[0],e.createApplicationTables=e.createApplicationTables.map(s=>{const{delId:X,floorValue:Y,costValue:Z,constructionMaterialValue:ee,...H}=s;return H})},mutationFn:e=>Ze("application",e),onSuccess:e=>{e!=null&&e.success&&(t.value=Je(t.value),q.invalidateQueries({queryKey:["applications"]}),K.push(pe.APPLICATION.path),setTimeout(()=>j.success(r("createToast")),150))}}),Ne=()=>{if(i.value.$validate(),i.value.$errors.length)return;const e={...t.value};je(e),i.value.$reset()};return(e,s)=>{var ae,oe,le,te,se,re,ie,ne,de,ce;const X=m("ManageHead"),Y=m("FormInput"),Z=m("FormSelect"),ee=m("SubTable"),H=m("FormTextarea"),Ue=m("CustomButton");return L.value?(d(),h("section",ua,[T("div",pa,[f(X,{title:"addNewApplicationTitle",to:p(pe).APPLICATION.path},null,8,["to"]),T("form",{class:"manage__form",onSubmit:Ge(Ne,["prevent"])},[T("div",ma,[(d(!0),h(w,null,E(Be.value,a=>{var A,k,V,S,$;return d(),O(Y,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":x=>t.value[a.model]=x,width:500,placeholder:e.$t(a.placeholder),name:a.icon,error:(k=(A=p(i))==null?void 0:A[a.errorKey])==null?void 0:k.$error,textError:($=(S=(V=p(i))==null?void 0:V[a.errorKey])==null?void 0:S.$errors[0])==null?void 0:$.$message,type:a==null?void 0:a.type},{default:I(()=>[_(b(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(d(!0),h(w,null,E(Fe.value,a=>{var A,k,V,S,$;return d(),O(Z,{key:a.id,modelValue:t.value[a.model],"onUpdate:modelValue":x=>t.value[a.model]=x,modelModifiers:{trim:!0},width:500,options:a.options,error:(k=(A=p(i))==null?void 0:A[a==null?void 0:a.errorKey])==null?void 0:k.$error,placeholder:a==null?void 0:a.placeholder,textError:($=(S=(V=p(i))==null?void 0:V[a==null?void 0:a.errorKey])==null?void 0:S.$errors[0])==null?void 0:$.$message,success:a.success,loading:a.loading,isMultiSelect:a==null?void 0:a.multiple},{default:I(()=>[_(b(e.$t(a.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128))]),f(ca,{selects:Te.value,buildingBlockId:t.value.buildingBlockId,isSubmit:c.value,onOnAddTable:qe},null,8,["selects","buildingBlockId","isSubmit"]),(oe=(ae=p(i))==null?void 0:ae.createApplicationTables)!=null&&oe.$error?(d(),h("span",ba,b((se=(te=(le=p(i))==null?void 0:le.createApplicationTables)==null?void 0:te.$errors[0])==null?void 0:se.$message),1)):ue("",!0),f(ee,{headers:Q.value,table:t.value.createApplicationTables,onOnActionDelete:Ke,isShowDelete:!0},null,8,["headers","table"]),f(H,{modelValue:t.value.details,"onUpdate:modelValue":s[0]||(s[0]=a=>t.value.details=a),modelModifiers:{trim:!0},width:500,placeholder:e.$t("appCommentPlaceholder"),error:(ie=(re=p(i))==null?void 0:re.details)==null?void 0:ie.$error,textError:(ce=(de=(ne=p(i))==null?void 0:ne.details)==null?void 0:de.$errors[0])==null?void 0:ce.$message},{default:I(()=>[_(b(e.$t("appCommentLabel")),1)]),_:1},8,["modelValue","placeholder","error","textError"]),f(Ue,{className:"manage__submit"},{default:I(()=>[_(b(e.$t("appButton")),1)]),_:1})],32)])])):ue("",!0)}}},ka=me(va,[["__scopeId","data-v-15ddc15a"]]);export{ka as default};
