import{u as ue,a as ce,b as me,x as ge,c as v,r as d,y as I,B as M,d as q,e as T,k as N,h as i,w as pe,F as R,C as x,D as B,i as be,l as ye,E as he,m as _,o as p,A as L,z as D,f as w,t as C,G as ve}from"./index-KKCGiaOF.js";import{u as Ie,r as n}from"./i18n-validators-TpKHFGOg.js";import{a as _e,u as fe}from"./generic.services-xhLq1RN3.js";import{u as f}from"./useQuery-W7o1xA7A.js";import{a as Se,u as je}from"./crud.services-tsBZfuRX.js";import{m as Ke,a as $e,b as Oe}from"./manual.services-1tbz_eEo.js";const qe={key:0,class:"manage section-height shadowed"},Be={class:"manage__inner section-padding"},Me={__name:"update",async setup(Le){let s,r;const b=_e(),E=ye(),Q=he();ue(),ce();const U=me(),{user:S}=ge(U),y=v(()=>{var a,$;return!!(($=(a=S==null?void 0:S.value.user)==null?void 0:a.modules)!=null&&$.includes(ve.OBJECT.UPDATE))}),j=d(Q.params.id),V=d(!1),K=d(!1),t=d({id:"",name:"",address:"",regionId:[],districtId:[],stateId:[]}),P=v(()=>({id:{required:n},name:{required:n},address:{required:n},regionId:{required:n},districtId:{required:n},stateId:{required:n}})),o=Ie(P,t),{data:G,isSuccess:H,isLoading:A}=([s,r]=I(()=>f({queryKey:["regions"],queryFn:()=>Ke(),enabled:y})),s=await s,r(),s),h=v(()=>t.value.regionId),J=v(()=>!!h.value.length);M(h,()=>{!K.value&&!V.value&&(t.value.districtId=[]),K.value=!1},{immediate:!0});const{data:z,isSuccess:W,isLoading:X}=([s,r]=I(()=>f({queryKey:["districts",{districtId:h}],queryFn:()=>$e(h.value),enabled:J})),s=await s,r(),s),{data:Y,isSuccess:Z,isLoading:ee}=([s,r]=I(()=>f({queryKey:["states"],queryFn:()=>Oe(),enabled:y})),s=await s,r(),s),ae=d([{id:1,model:"name",label:"nameObjectLabel",placeholder:"nameObjectPlaceholder",icon:"input-company",errorKey:"name"},{id:2,model:"address",label:"addressObjectLabel",placeholder:"addressObjectPlaceholder",icon:"address",errorKey:"address"}]),se=d([{id:1,model:"regionId",label:"regionObjectLabel",placeholder:"regionObjectPlaceholder",errorKey:"regionId",options:G,success:H,loading:A},{id:2,model:"districtId",label:"districtObjectLabel",placeholder:"districtObjectPlaceholder",errorKey:"districtId",options:z,success:W,loading:X},{id:3,model:"stateId",label:"stateObjectLabel",placeholder:"stateObjectLabel",errorKey:"stateId",options:Y,success:Z,loading:ee}]),{isError:te}=([s,r]=I(()=>f({queryKey:["objectById",j],queryFn:()=>Se("building_object",j.value),select:a=>{t.value.id=a.id,t.value.name=a.fullName,t.value.address=a.address,t.value.regionId=[a.regionId],t.value.districtId=[a.districtId],t.value.stateId=[a.stateId],K.value=!0},enabled:y})),s=await s,r(),s);M(te,a=>{a&&E.push(L.HOME.path)});const{mutate:re}=fe({onMutate:a=>{V.value=!0,a.regionId=a.regionId[0],a.districtId=a.districtId[0],a.stateId=a.stateId[0]},mutationFn:a=>je("building_object",a),onSuccess:()=>{b.invalidateQueries({queryKey:["objects"]}),b.invalidateQueries({queryKey:["objectById",j]}),b.invalidateQueries({queryKey:["objectsList"]}),b.invalidateQueries({queryKey:["blocks"]}),E.push(L.OBJECT.path)}}),oe=async()=>{o.value.$validate(),!o.value.$errors.length&&(re(t.value),o.value.$reset())};return(a,$)=>{var F,k;const de=_("ManageHead"),ie=_("FormInput"),ne=_("FormSelect"),le=_("CustomButton");return y.value?(p(),q("section",qe,[T("div",Be,[N(de,{title:"editObjectTitle",to:i(L).OBJECT.path},null,8,["to"]),T("form",{class:"manage__form form-manage",onSubmit:pe(oe,["prevent"])},[(p(!0),q(R,null,x(ae.value,e=>{var l,u,c,m,g;return p(),D(ie,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":O=>t.value[e.model]=O,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(u=(l=i(o))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:u.$error,textError:(g=(m=(c=i(o))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message},{default:B(()=>[w(C(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError"])}),128)),(p(!0),q(R,null,x(se.value,e=>{var l,u,c,m,g;return p(),D(ne,{key:e.id,modelValue:t.value[e.model],"onUpdate:modelValue":O=>t.value[e.model]=O,width:500,options:e.options,error:(u=(l=i(o))==null?void 0:l[e==null?void 0:e.errorKey])==null?void 0:u.$error,placeholder:e==null?void 0:e.placeholder,textError:(g=(m=(c=i(o))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:m.$errors[0])==null?void 0:g.$message,success:e.success,loading:e.loading},{default:B(()=>[w(C(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading"])}),128)),N(le,{className:`form__submit ${(k=(F=i(o))==null?void 0:F.stateId.$errors[0])!=null&&k.$message?"centered":""}`},{default:B(()=>[w(C(a.$t("formButton")),1)]),_:1},8,["className"])],32)])])):be("",!0)}}};export{Me as default};
//# sourceMappingURL=update-3N5Kgjbr.js.map
