import{u as pe,a as me,r as d,y as n,c as L,x as q,b as k,d as F,j as Ie,g as b,w as ge,F as M,B as O,k as be,D as ye,l as S,o as y,A as B,z as w,C,e as $,t as V}from"./index-u_2KKI46.js";import{u as he,r as t}from"./i18n-validators-SGtCpuoI.js";import{a as ve,u as fe}from"./generic.services-Zkt5ZkSV.js";import{u}from"./useQuery-n3W-mpu_.js";import{a as _e,u as Le}from"./crud.services-WcX_HSPp.js";import{h as ke,i as Se,g as Be,d as Ke,e as je,j as Ae}from"./manual.services-W9iJUjqa.js";const qe={class:"manage section-height shadowed"},Fe={class:"manage__inner section-padding"},xe={__name:"update",async setup(Me){let o,l;const K=ve(),j=be(),P=ye();pe(),me();const v=d(P.params.id),r=d(localStorage.getItem("organizationId")),A=d(!1),f=d(!1),s=d({userId:"",deadline:"",constructionMaterialIds:[],buildingObjectId:[],buildingBlockId:[],floorId:[],costId:[],roleIds:[]}),{data:E,isSuccess:x,isLoading:R}=([o,l]=n(()=>u({queryKey:["floors",{organizationId:r}],queryFn:()=>ke(r.value)})),o=await o,l(),o),{data:G,isSuccess:N,isLoading:T}=([o,l]=n(()=>u({queryKey:["costs",{organizationId:r}],queryFn:()=>Se(r.value)})),o=await o,l(),o),{data:D,isSuccess:H,isLoading:Q}=([o,l]=n(()=>u({queryKey:["materials",{organizationId:r}],queryFn:()=>Be(r.value)})),o=await o,l(),o),{data:U,isSuccess:z,isLoading:W}=([o,l]=n(()=>u({queryKey:["roles"],queryFn:()=>Ke()})),o=await o,l(),o),{data:J,isSuccess:X,isLoading:Y}=([o,l]=n(()=>u({queryKey:["objectsList",{organizationId:r}],queryFn:()=>je(r.value)})),o=await o,l(),o),h=L(()=>s.value.buildingObjectId),Z=L(()=>!!h.value.length);q(h,()=>{!f.value&&!A.value&&(s.value.buildingBlockId=[]),f.value=!1},{immediate:!0});const{data:ee,isSuccess:oe,isLoading:ae}=([o,l]=n(()=>u({queryKey:["blocksList",{blockId:h}],queryFn:()=>Ae(h.value),enabled:Z})),o=await o,l(),o),se=L(()=>({userId:{required:t},deadline:{required:t},constructionMaterialIds:{required:t},buildingObjectId:{required:t},buildingBlockId:{required:t},floorId:{required:t},costId:{required:t},roleIds:{required:t}})),i=he(se,s),le=d([{id:1,model:"deadline",label:"dateAppLabel",placeholder:"dateAppPlaceholder",icon:"date",errorKey:"deadline",type:"date"}]),re=d([{id:1,model:"floorId",label:"floorsAppLabel",placeholder:"floorsAppPlaceholder",errorKey:"floorId",options:E,success:x,loading:R},{id:2,model:"constructionMaterialIds",label:"materialsAppLabel",placeholder:"materialsAppPlaceholder",errorKey:"constructionMaterialIds",options:D,success:H,loading:Q,multiple:!0},{id:3,model:"costId",label:"costAppLabel",placeholder:"costAppPlaceholder",errorKey:"costId",options:G,success:N,loading:T},{id:4,model:"buildingObjectId",label:"objectAppLabel",placeholder:"objectAppPlaceholder",errorKey:"buildingObjectId",options:J,success:X,loading:Y},{id:5,model:"buildingBlockId",label:"blockAppLabel",placeholder:"blockAppPlaceholder",errorKey:"buildingBlockId",options:ee,success:oe,loading:ae},{id:6,model:"roleIds",label:"appRoleLabel",placeholder:"appRolePlaceholder",errorKey:"roleIds",options:U,success:z,loading:W,multiple:!0}]),{isError:te}=([o,l]=n(()=>u({queryKey:["applicationsById",v],queryFn:()=>_e("application",v.value),select:a=>{s.value.id=a.id,s.value.userId=a.userId,s.value.deadline=a.deadline,s.value.constructionMaterialIds=[...a.constructionMaterialIds],s.value.buildingObjectId=[a.buildingObjectId],s.value.buildingBlockId=[a.buildingBlockId],s.value.floorId=[a.floorId],s.value.costId=[a.costId],s.value.roleIds=[...a.roleIds],f.value=!0}})),o=await o,l(),o);q(te,a=>{a&&j.push(B.HOME.path)});const{mutate:ie}=fe({onMutate:a=>{A.value=!0,a.buildingObjectId=a.buildingObjectId[0],a.buildingBlockId=a.buildingBlockId[0],a.floorId=a.floorId[0],a.costId=a.costId[0]},mutationFn:a=>Le("application",a),onSuccess:()=>{K.invalidateQueries({queryKey:["applications"]}),K.invalidateQueries({queryKey:["applicationsById",v]}),j.push(B.APPLICATIONS.path)}}),de=async()=>{i.value.$validate(),!i.value.$errors.length&&(ie(s.value),i.value.$reset())};return(a,Oe)=>{const ne=S("ManageHead"),ue=S("FormInput"),ce=S("FormSelect");return y(),k("section",qe,[F("div",Fe,[Ie(ne,{title:"editApplicationTitle",to:b(B).APPLICATIONS.path},null,8,["to"]),F("form",{class:"manage__form form-manage",onSubmit:ge(de,["prevent"])},[(y(!0),k(M,null,O(le.value,e=>{var c,p,m,I,g;return y(),w(ue,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":_=>s.value[e.model]=_,width:500,placeholder:a.$t(e.placeholder),name:e.icon,error:(p=(c=b(i))==null?void 0:c[e.errorKey])==null?void 0:p.$error,textError:(g=(I=(m=b(i))==null?void 0:m[e.errorKey])==null?void 0:I.$errors[0])==null?void 0:g.$message,type:e==null?void 0:e.type,isDisabled:!0},{default:C(()=>[$(V(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","name","error","textError","type"])}),128)),(y(!0),k(M,null,O(re.value,e=>{var c,p,m,I,g;return y(),w(ce,{key:e.id,modelValue:s.value[e.model],"onUpdate:modelValue":_=>s.value[e.model]=_,width:500,options:e.options,error:(p=(c=b(i))==null?void 0:c[e==null?void 0:e.errorKey])==null?void 0:p.$error,placeholder:e==null?void 0:e.placeholder,textError:(g=(I=(m=b(i))==null?void 0:m[e==null?void 0:e.errorKey])==null?void 0:I.$errors[0])==null?void 0:g.$message,success:e.success,loading:e.loading,isMultiSelect:e==null?void 0:e.multiple,isDisabled:!0},{default:C(()=>[$(V(a.$t(e.label)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error","placeholder","textError","success","loading","isMultiSelect"])}),128))],32)])])}}};export{xe as default};
//# sourceMappingURL=update-o05WWiiP.js.map
